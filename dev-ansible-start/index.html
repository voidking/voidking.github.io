<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言《Ubuntu16使用Kolla安装OpenStack》一文中，用到了ansible。本文，我们就来研究一下ansible的基本用法。"><meta property="og:type" content="article"><meta property="og:title" content="Ansible入门"><meta property="og:url" content="https://www.voidking.com/dev-ansible-start/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言《Ubuntu16使用Kolla安装OpenStack》一文中，用到了ansible。本文，我们就来研究一下ansible的基本用法。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2018-08-06T09:00:00.000Z"><meta property="article:modified_time" content="2020-05-31T06:10:02.915Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="openstack"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-ansible-start/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Ansible入门 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-ansible-start/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Ansible入门</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-08-06 09:00:00" itemprop="dateCreated datePublished" datetime="2018-08-06T09:00:00+00:00">2018-08-06</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/" itemprop="url" rel="index"><span itemprop="name">专业</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/ubuntu/" itemprop="url" rel="index"><span itemprop="name">ubuntu</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><a href="https://www.voidking.com/dev-ubuntu16-kolla-openstack-all-in-one/">《Ubuntu16使用Kolla安装OpenStack》</a>一文中，用到了ansible。本文，我们就来研究一下ansible的基本用法。</p><a id="more"></a><h1 id="Ansible简介"><a href="#Ansible简介" class="headerlink" title="Ansible简介"></a>Ansible简介</h1><p>ansible是一个用于自动化运维的配置管理和应用部署工具。基于Python开发，集合了众多运维工具（puppet、cfengine、chef、func、fabric.SaltStack ）的优点，实现了批量系统配置、批量程序部署、批量运行命令等功能。ansible是基于模块工作的，本身没有批量部署的能力，真正具有批量部署能力的是ansible所运行的模块。</p><p>ansible的基本架构：</p><ul><li>连接插件（connectior plugins）用于连接管理端和被管理端。</li><li>核心模块（core modules）连接主机实现操作，它依赖于具体的模块来做具体的事情。</li><li>自定义模块（custom modules）根据自己的需求编写具体的模块。</li><li>插件（plugins）完成模块功能的补充。</li><li>剧本（playbooks）ansible的配置文件，将多个任务定义在剧本中，由ansible自动执行。</li><li>主机清单（host inventory）定义ansible需要操作主机的范围。</li></ul><p>上述简介摘自<a href="https://www.jianshu.com/p/575ced3a08fa" target="_blank" rel="noopener">ansible基础</a>。</p><h1 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h1><p>两台主机，都是ubuntu14.04.4 server版，用户都是voidking。一台作为管理机，IP为192.168.56.101，一台作为被管理机（以下称为客户机），IP为192.168.56.102。</p><p>在管理机上安装ansible，一条命令搞定：<code>sudo apt install ansible</code>。不过，安装的ansible版本很低，默认1.5.4。这里我们通过添加源来安装最新版ansible：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt <span class="builtin-name">remove</span> ansible</span><br><span class="line">sudo apt-<span class="builtin-name">get</span> install software-properties-common</span><br><span class="line">sudo apt-add-repository ppa:ansible/ansible</span><br><span class="line">sudo apt-<span class="builtin-name">get</span> update</span><br><span class="line">sudo apt-<span class="builtin-name">get</span> install ansible</span><br></pre></td></tr></table></figure><p>这样，就能安装好最新版的ansible。</p><h1 id="连接准备"><a href="#连接准备" class="headerlink" title="连接准备"></a>连接准备</h1><p>1、在管理机生成密钥<br><code>ssh-keygen</code>，连续回车即可。</p><p>2、将公钥写入客户机<br><code>ssh-copy-id -i .ssh/id_rsa.pub -p 22 voidking@192.168.56.102</code></p><p>3、在管理机添加客户机到hosts<br><code>sudo vim /etc/ansible/hosts</code>，在文档最后添加：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[commonservers]</span></span><br><span class="line"><span class="number">192.168.56.102</span></span><br></pre></td></tr></table></figure><p>4、在管理机第一条命令<br><code>ansible all -m ping</code></p><p>5、在客户机把voidking用户添加进sudo免密，方便以后的操作<br><code>sudo vim /etc/sudoers</code>，添加</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">voidking <span class="keyword">ALL</span> = NOPASSWD: <span class="keyword">ALL</span></span><br></pre></td></tr></table></figure><h1 id="ssh-agent"><a href="#ssh-agent" class="headerlink" title="ssh-agent"></a>ssh-agent</h1><p>ansible可能使用到ssh-agent，那就顺便学习一下，参考<a href="http://www.zsythink.net/archives/2407" target="_blank" rel="noopener">了解ssh代理：ssh-agent</a>。</p><p>ssh-agent是ssh代理程序，ssh-agent可以帮助我们管理私钥。</p><p>那么什么时候需要ssh代理帮助我们管理私钥呢？当遇到如下情况时，我们会需要ssh代理。</p><ul><li><p>使用不同的密钥连接到不同的主机时，需要手动指定对应的密钥，ssh代理可以帮助我们选择对应的密钥进行认证，不用手动指定密钥即可进行连接。</p></li><li><p>当私钥设置了密码，我们又需要频繁的使用私钥进行认证时，ssh代理可以帮助我们免去重复的输入密码的操作。</p></li><li><p>管理机可以通过密钥连接到客户机A和客户机B，但是客户机A无法通过密钥连接到客户机B，ssh代理可以帮助我们在客户机A也能通过密钥连接到客户机B。</p></li></ul><p>我们以添加.ssh/id_rsa私钥给ssh代理为例，查看一下使用流程。</p><p>1、启用ssh-agent<br><code>ssh-agent bash</code></p><p>2、把.ssh/id_rsa添加到ssh代理<br><code>ssh-add ~/.ssh/id_rsa</code></p><p>3、测试登录<br><code>ssh voidking@192.168.56.102</code><br>登录成功。<br>切换到root用户，ssh-agent失效。重新使用voidking登录，ssh-agent失效。想要重新登录依然生效，那就创建个脚本登录时自动执行。</p><p>常用命令：</p><ul><li><code>ssh-agent $SHELL</code>，启动</li><li><code>ssh-agent -k</code>，关闭</li><li><code>ssh-add ~/.ssh/key_name</code>，添加指定私钥</li><li><code>ssh-add -l</code>，查看私钥</li><li><code>ssh-add -L</code>，查看公钥</li><li><code>ssh-add -d /path/of/key/key_name</code>，删除指定私钥</li><li><code>ssh-add -D</code>，删除所有私钥</li><li><code>ssh-add -x</code>，设置密码，锁定ssh代理</li><li><code>ssh-add -X</code>，输入密码，解锁ssh代理</li></ul><h1 id="ansible命令"><a href="#ansible命令" class="headerlink" title="ansible命令"></a>ansible命令</h1><h2 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h2><ul><li>ansible，主程序，临时命令执行工具</li><li>ansible-doc，查看配置文档，模块功能查看工具</li><li>ansible-galaxy，下载/上传优秀代码或Roles模块的官网平台</li><li>ansible-lint，对playbook的语法进行检查的一个工具。</li><li>ansible-playbook，定制自动化任务，编排剧本工具</li><li>ansible-pull，远程执行命令的工具</li><li>ansible-vault，文件加密工具。</li><li>ansible-console，基于console界面与用户交互的执行工具。</li></ul><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><ul><li>/etc/ansible/ansible.cfg，主配置文件，配置ansible工作特性</li><li>/etc/ansible/hosts，主机清单</li><li>/etc/ansible/roles/，存放角色的目录</li></ul><p>1、ansible.cfg的配置参考<a href="https://docs.ansible.com/ansible/latest/installation_guide/intro_configuration.html" target="_blank" rel="noopener">Configuring Ansible</a>，主要留意inventory、forks、poll_interval、remote_port、log_path等参数。</p><p>2、hosts文件有一个特性很棒，可以指定变量，例如：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[commonservers]</span></span><br><span class="line"><span class="number">192.168.56.102</span></span><br><span class="line"><span class="string">[commonservers:vars]</span></span><br><span class="line">ansible_ssh_pass='<span class="number">123456</span>'</span><br><span class="line">ansible_ssh_port=<span class="number">22</span></span><br><span class="line"></span><br><span class="line"><span class="string">[commonservers1]</span></span><br><span class="line"><span class="number">192.168.56.103</span></span><br><span class="line"><span class="string">[commonservers:children]</span></span><br><span class="line">commonservers1</span><br></pre></td></tr></table></figure><p>内置变量小结：</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 主机名</span></span><br><span class="line">ansible_ssh_host </span><br><span class="line"><span class="meta"># 端口号</span></span><br><span class="line">ansible_ssh_port</span><br><span class="line"><span class="meta"># 用户名 </span></span><br><span class="line">ansible_ssh_user </span><br><span class="line"><span class="meta"># 密码</span></span><br><span class="line">ansible_ssh_pass </span><br><span class="line"><span class="meta"># 使用sudo连接用户时的密码</span></span><br><span class="line">ansible_sudo_pass </span><br><span class="line"><span class="meta"># 秘钥文件如果不想使用ssh-agent管理时可以使用此选项</span></span><br><span class="line">ansible_ssh_private_key_file </span><br><span class="line"><span class="meta"># shell的类型默认sh</span></span><br><span class="line">ansible_shell_type </span><br><span class="line"><span class="meta"># SSH 连接的类型</span></span><br><span class="line">ansible_connection </span><br><span class="line"><span class="meta"># 指定python解释器的路径</span></span><br><span class="line">ansible_python_interpreter</span><br></pre></td></tr></table></figure><h2 id="ansible"><a href="#ansible" class="headerlink" title="ansible"></a>ansible</h2><p>格式：<code>ansible &lt;host-pattern&gt; [-m module_name] [options]</code></p><p>ansible是指令核心部分，其主要用于执行ad-hoc命令，即单条命令。默认后面需要跟主机和选项部分，默认不指定模块时，使用的是command模块。command模块不是调用的shell的指令，所以没有bash的环境变量，也不能使用shell的一些操作方式，其他和shell模块没有区别。</p><p>例子：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看所有主机</span></span><br><span class="line">ansible all --list-hosts</span><br><span class="line"><span class="comment"># 指定主机清单</span></span><br><span class="line">ansible all -i ./hosts --list-hosts</span><br><span class="line"><span class="comment"># 查看commonservers组的主机</span></span><br><span class="line">ansible commonservers --list-hosts</span><br><span class="line"><span class="comment"># 测试连通</span></span><br><span class="line">ansible all -m ping</span><br><span class="line"><span class="comment"># 查看客户机的内存</span></span><br><span class="line">ansible all -m command -a <span class="string">"free -h"</span></span><br><span class="line"><span class="comment"># 在客户机执行管理机脚本</span></span><br><span class="line">cp /bin/echo ~/echo.sh</span><br><span class="line">ansible all -m<span class="built_in"> script </span>-a <span class="string">"~/echo.sh hello"</span> -vvv</span><br><span class="line"><span class="comment"># 在客户机执行客户机脚本</span></span><br><span class="line">ansible all -m command -a <span class="string">"cp /bin/echo /home/voidking/echo.sh"</span></span><br><span class="line">ansible all -m shell -a <span class="string">"/home/voidking/echo.sh hello"</span></span><br><span class="line"><span class="comment"># 向客户机拷贝文件</span></span><br><span class="line">ansible all -m copy -a <span class="string">"src=/home/voidking/echo.sh dest=/tmp/ owner=voidking group=voidking mode=0755"</span></span><br><span class="line"><span class="comment"># 后台执行命令</span></span><br><span class="line">ansible all -m<span class="built_in"> ping </span>-B 3600 -P 0</span><br><span class="line">ansible all -m async_status -a <span class="string">"jid='182829279182.2094'"</span></span><br><span class="line"><span class="comment"># 批量添加sudo权限</span></span><br><span class="line">ansible all -i hosts -s -m shell -a <span class="string">"echo 'haojin ALL=(ALL) NOPASSWD: ALL' &gt;&gt; /etc/sudoers"</span></span><br><span class="line"><span class="comment"># 批量移除sudo权限</span></span><br><span class="line">ansible all -i hosts -s -m shell -a <span class="string">"sed -i '/haojin ALL=(ALL) NOPASSWD: ALL/d' /etc/sudoers"</span></span><br><span class="line"><span class="comment"># 使用root用户备份和拷贝文件</span></span><br><span class="line">ansible all -i hosts -s -m shell -a <span class="string">"mv /tmp/run.sh /tmp/run.sh.bak"</span></span><br><span class="line">ansible all -i hosts -b <span class="attribute">--become-user</span>=root -m shell -a <span class="string">"mv /tmp/run.sh /tmp/run.sh.bak"</span></span><br><span class="line">ansible all -i hosts -s -m copy -a <span class="string">"src=/root/run.sh dest=/tmp/run.sh owner=voidking group=root mode=0755"</span></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">ansible all -i hosts -s -m shell -a <span class="string">"/tmp/stop.sh"</span></span><br><span class="line">ansible all -i hosts -s -m shell -a <span class="string">"/tmp/run.sh"</span> -u voidking</span><br></pre></td></tr></table></figure><h2 id="ansible-doc"><a href="#ansible-doc" class="headerlink" title="ansible-doc"></a>ansible-doc</h2><p>格式：<code>ansible-doc [options] [module...]</code></p><p>例子：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ansible-doc ping</span><br><span class="line">ansible-doc -s ping</span><br><span class="line">ansible-doc -l</span><br><span class="line">ansible-doc -a</span><br></pre></td></tr></table></figure><h2 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 匹配所有主机，相当于all</span></span><br><span class="line">ansible <span class="string">'*'</span> -m ping</span><br><span class="line"><span class="comment"># 匹配含有common的主机组</span></span><br><span class="line">ansible <span class="string">'*common*'</span> -m ping</span><br><span class="line"><span class="comment"># 匹配IP为100-109的主机</span></span><br><span class="line">ansible <span class="string">'192.168.56.10?'</span> -m ping</span><br><span class="line"><span class="comment"># 匹配IP段</span></span><br><span class="line">ansible <span class="string">'192.168.56.101:192.168.56.200'</span> -m ping</span><br><span class="line"><span class="comment"># 逻辑与</span></span><br><span class="line">ansible <span class="string">'commonservers:&amp;dbservers'</span> --list</span><br><span class="line"><span class="comment"># 逻辑非</span></span><br><span class="line">ansible <span class="string">'commonservers:!dbservers'</span> --list</span><br><span class="line"><span class="comment"># 正则表达式</span></span><br><span class="line">ansible <span class="string">'~192\.168\.56\.[1-254]'</span> --list</span><br></pre></td></tr></table></figure><h1 id="指定ansible-cfg"><a href="#指定ansible-cfg" class="headerlink" title="指定ansible.cfg"></a>指定ansible.cfg</h1><p>如果ansible没有指定ansible.cfg，或者想要临时使用自己定义的ansible.cfg，该怎么处理？</p><p>1、参考<a href="https://github.com/ansible/ansible/blob/devel/examples/ansible.cfg" target="_blank" rel="noopener">ansible.cfg</a>，创建ansible.cfg文件，假设路径为 /home/voidking/ansible.cfg</p><p>2、设置环境变量<br><code>export ANSIBLE_CONFIG=/home/voidking/ansible.cfg</code></p><p>3、查看配置<br><code>ansible --version</code></p><h1 id="书签"><a href="#书签" class="headerlink" title="书签"></a>书签</h1><p><a href="https://docs.ansible.com/" target="_blank" rel="noopener">Ansible Documentation</a></p><p><a href="http://www.ansible.com.cn/" target="_blank" rel="noopener">Ansible中文权威指南</a></p><p><a href="http://study.163.com/course/introduction.htm?courseId=1004525015" target="_blank" rel="noopener">Ansible精讲</a></p><p><a href="http://blog.51cto.com/191226139/2066936" target="_blank" rel="noopener">运维自动化-Ansible ( 一 )</a></p><p><a href="https://www.cnblogs.com/wangxiaoqiangs/p/5685239.html" target="_blank" rel="noopener">Ansible 运维自动化 ( 配置管理工具 )</a></p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/ubuntu/" rel="tag"># ubuntu</a> <a href="/tags/openstack/" rel="tag"># openstack</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-kolla-instance-network/" rel="prev" title="Kolla配置实例网络"><i class="fa fa-chevron-left"></i> Kolla配置实例网络</a></div><div class="post-nav-item"> <a href="/dev-ansible-playbooks/" rel="next" title="Ansible Playbooks">Ansible Playbooks<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ansible简介"><span class="nav-number">2.</span> <span class="nav-text">Ansible简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#实验环境"><span class="nav-number">3.</span> <span class="nav-text">实验环境</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#连接准备"><span class="nav-number">4.</span> <span class="nav-text">连接准备</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ssh-agent"><span class="nav-number">5.</span> <span class="nav-text">ssh-agent</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ansible命令"><span class="nav-number">6.</span> <span class="nav-text">ansible命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#基本命令"><span class="nav-number">6.1.</span> <span class="nav-text">基本命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置文件"><span class="nav-number">6.2.</span> <span class="nav-text">配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ansible"><span class="nav-number">6.3.</span> <span class="nav-text">ansible</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ansible-doc"><span class="nav-number">6.4.</span> <span class="nav-text">ansible-doc</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#通配符"><span class="nav-number">6.5.</span> <span class="nav-text">通配符</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#指定ansible-cfg"><span class="nav-number">7.</span> <span class="nav-text">指定ansible.cfg</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#书签"><span class="nav-number">8.</span> <span class="nav-text">书签</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">600</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">40</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">194</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://twitter.com/voidking_com" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;voidking_com" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i> Twitter</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://www.beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>