<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="需求描述《Hexo启用https加密连接》一文中，我们在腾讯云申请了一个三级域名证书，然后给网站配置上了域名证书。 那如果我们有一百个域名，一个个申请域名证书就太麻烦了，这是我们就需要一个泛域名证书。怎么申请泛域名证书呢？方案一：通过阿里云、腾讯云等云平台申请，但是需要付费，便宜的也要年费两千左右。方案二：使用certbot申请泛域名证书，然后配置好自动续期。 因为想要省点钱，所以本文中我们就来研"><meta property="og:type" content="article"><meta property="og:title" content="使用Certbot申请泛域名证书"><meta property="og:url" content="https://www.voidking.com/dev-certbot-domain-certificate/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="需求描述《Hexo启用https加密连接》一文中，我们在腾讯云申请了一个三级域名证书，然后给网站配置上了域名证书。 那如果我们有一百个域名，一个个申请域名证书就太麻烦了，这是我们就需要一个泛域名证书。怎么申请泛域名证书呢？方案一：通过阿里云、腾讯云等云平台申请，但是需要付费，便宜的也要年费两千左右。方案二：使用certbot申请泛域名证书，然后配置好自动续期。 因为想要省点钱，所以本文中我们就来研"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2018-04-08T15:30:00.000Z"><meta property="article:modified_time" content="2023-05-20T08:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="docker"><meta property="article:tag" content="https"><meta property="article:tag" content="tls"><meta property="article:tag" content="ssl"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-certbot-domain-certificate/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>使用Certbot申请泛域名证书 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-certbot-domain-certificate/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> 使用Certbot申请泛域名证书</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-04-08 15:30:00" itemprop="dateCreated datePublished" datetime="2018-04-08T15:30:00+00:00">2018-04-08</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2023-05-20 08:00:00" itemprop="dateModified" datetime="2023-05-20T08:00:00+00:00">2023-05-20</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h1><p><a href="https://www.voidking.com/dev-hexo-https/">《Hexo启用https加密连接》</a>一文中，我们在腾讯云申请了一个三级域名证书，然后给网站配置上了域名证书。</p><p>那如果我们有一百个域名，一个个申请域名证书就太麻烦了，这是我们就需要一个泛域名证书。怎么申请泛域名证书呢？<br>方案一：通过阿里云、腾讯云等云平台申请，但是需要付费，便宜的也要年费两千左右。<br>方案二：使用certbot申请泛域名证书，然后配置好自动续期。</p><p>因为想要省点钱，所以本文中我们就来研究学习一下方案二，给dnspod上的域名申请一个泛域名证书。</p><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://sliu.vip/linux/certbot/">使用 Certbot 自动申请和续期泛域名证书</a></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36840228/article/details/121038844">使用 certbot 申请泛域名证书和自动续签</a></li><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/354241539">使用Certbot申请泛域名SSL证书（Let’s Encrypt）</a></li><li><a target="_blank" rel="noopener" href="https://certbot.eff.org/instructions?ws=nginx&os=centosrhel7">certbot instructions - Nginx on CentOS7</a></li><li><a target="_blank" rel="noopener" href="https://eff-certbot.readthedocs.io/en/stable/install.html">Certbot Document</a></li></ul><span id="more"></span><h1 id="Certbot简介"><a href="#Certbot简介" class="headerlink" title="Certbot简介"></a>Certbot简介</h1><blockquote><p>为了在您的网站上启用 HTTPS，您需要从证书颁发机构（CA）获取证书（一种文件）。 Let’s Encrypt 是一个证书颁发机构（CA）。 要从 Let’s Encrypt 获取您网站域名的证书，您必须证明您对域名的实际控制权。 您可以在您的 Web 主机上运行使用 ACME 协议的软件来获取 Let’s Encrypt 证书。</p></blockquote><p>而 Certbot，就是Let’s Encrypt推荐的 ACME 客户端，可以用来申请Let’s Encrypt颁发的域名证书。</p><p>Let’s Encrypt 的证书有效期为 90 天， 建议每 60 天自动续期一次证书。</p><p>Let’s Encrypt 对证书申请进行了限制，每个注册域名（顶级域名）可签发证书数量为每周50张。<br>证书续期遵守特殊规则：它们不计入每个注册域名的证书数量的限制，但它们受到每周最多 5 张重复证书的限制。</p><p>PS：与 Let’s Encrypt 类似的，还有一个 <a target="_blank" rel="noopener" href="https://zerossl.com/">ZeroSSL</a>。</p><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://letsencrypt.org/zh-cn/getting-started/">Let’s Encrypt - 入门指南</a></li><li><a target="_blank" rel="noopener" href="https://letsencrypt.org/zh-cn/docs/faq/">Let’s Encrypt - 常见问题</a></li><li><a target="_blank" rel="noopener" href="https://letsencrypt.org/zh-cn/docs/rate-limits/">Let’s Encrypt - 速率限制</a></li><li><a target="_blank" rel="noopener" href="https://letsencrypt.org/">Let’s Encrypt</a></li><li><a target="_blank" rel="noopener" href="https://certbot.eff.org/">Certbot</a></li><li><a target="_blank" rel="noopener" href="https://zerossl.com/">ZeroSSL</a></li></ul><h1 id="安装配置思路"><a href="#安装配置思路" class="headerlink" title="安装配置思路"></a>安装配置思路</h1><p>1、安装certbot（docker方式）<br>2、配置dns自动验证<br>3、申请泛域名<br>4、配置使用证书<br>5、配置证书自动续期</p><h1 id="安装Certbot"><a href="#安装Certbot" class="headerlink" title="安装Certbot"></a>安装Certbot</h1><p>1、下载<a target="_blank" rel="noopener" href="https://hub.docker.com/u/certbot">certbot镜像</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull certbot/certbot:v1.32.0</span><br></pre></td></tr></table></figure><p>该镜像里包含python3.10.8，能够方便我们后续使用DNS自动验证脚本。</p><p>2、创建挂载目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/letsencrypt</span><br></pre></td></tr></table></figure><p>3、测试运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --<span class="built_in">rm</span> --name certbot \</span><br><span class="line">    -v <span class="string">&quot;/etc/letsencrypt:/etc/letsencrypt&quot;</span> \</span><br><span class="line">    -v <span class="string">&quot;/var/log/letsencryt:/var/log/letsencryt&quot;</span> \</span><br><span class="line">    certbot/certbot:v1.32.0 certonly</span><br></pre></td></tr></table></figure><p>当我们运行certbot容器时，默认会执行certbot命令。<br>certonly是个参数，表示只申请证书，不会对nginx等web服务器进行自动配置。</p><h1 id="配置DNS自动验证"><a href="#配置DNS自动验证" class="headerlink" title="配置DNS自动验证"></a>配置DNS自动验证</h1><p>申请域名证书时，需要验证对域名的所有权，这个验证操作可以通过手动修改域名解析完成，也可以通过域名供应商提供的API自动完成。</p><p>本文中，对域名供应商API的自动操作，使用 <a target="_blank" rel="noopener" href="https://github.com/ywdblog/certbot-letencrypt-wildcardcertificates-alydns-au">certbot-letencrypt-wildcardcertificates-alydns-au</a></p><h2 id="申请DNS-API密钥"><a href="#申请DNS-API密钥" class="headerlink" title="申请DNS API密钥"></a>申请DNS API密钥</h2><p>要使用DNS API，需要先申请密钥。常见域名供应商获取 DNS API 密钥的入口：</p><ul><li>ALY_KEY 和 ALY_TOKEN：<a target="_blank" rel="noopener" href="https://help.aliyun.com/knowledge_detail/38738.html">阿里云 API key 和 Secrec 官方申请文档</a>。</li><li>TXY_KEY 和 TXY_TOKEN：<a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/cam/capi">腾讯云 API 密钥官方申请文档</a>。</li><li>HWY_KEY 和 HWY_TOKEN：<a target="_blank" rel="noopener" href="https://support.huaweicloud.com/devg-apisign/api-sign-provide.html">华为云 API 密钥官方申请文档</a></li><li>GODADDY_KEY 和 GODADDY_TOKEN：<a target="_blank" rel="noopener" href="https://developer.godaddy.com/getstarted">GoDaddy API 密钥官方申请文档</a>。</li></ul><h2 id="脚本配置"><a href="#脚本配置" class="headerlink" title="脚本配置"></a>脚本配置</h2><p>本节会对DNS自动验证脚本简单修改，适配<code>certbot/certbot:v1.32.0</code>镜像，觉得麻烦的同学可以直接跳到【脚本配置2.0】一节，使用修改好的脚本。</p><p>1、下载DNS自动验证脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/letsencrypt/auth-hook</span><br><span class="line"><span class="built_in">cd</span> /etc/letsencrypt/auth-hook</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/ywdblog/certbot-letencrypt-wildcardcertificates-alydns-au au</span><br><span class="line"><span class="built_in">chmod</span> 0777 au/au.sh</span><br></pre></td></tr></table></figure><p>2、修改DNS API密钥<br>au.sh中，填入我们申请的DNS API密钥</p><p>3、指定使用sh运行脚本<br>容器中不存在bash，只有sh<br>所以au.sh头部，<code>!#/bin/bash</code>改为<code>#/bin/sh</code></p><p>否则申请证书时会报错：<br>Hook ‘–manual-auth-hook’ for voidking.com reported error code 127<br>Hook ‘–manual-auth-hook’ for voidking.com ran with error output:<br> /bin/sh: /etc/letsencrypt/auth-hook/au/au.sh: not found</p><p>详情参考<a target="_blank" rel="noopener" href="https://cksdid4993.tistory.com/13">Certbot 无法运行挂钩脚本</a></p><p>4、修改python路径<br>容器中的python路径是<code>/usr/local/bin/python</code><br>所以au.sh中，<code>/usr/bin/python</code> 改为 <code>/usr/local/bin/python</code></p><p>否则申请证书时会报错：<br>Hook ‘–manual-auth-hook’ for voidking.com ran with error output:<br> /etc/letsencrypt/auth-hook/au/au.sh: line 112: /usr/bin/python: not found</p><p>5、添加根域名（可选）<br>domain.ini中，如果没有需要的根域名，需要自行添加</p><h2 id="脚本配置2-0"><a href="#脚本配置2-0" class="headerlink" title="脚本配置2.0"></a>脚本配置2.0</h2><p>1、下载DNS自动验证脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/letsencrypt/auth-hook</span><br><span class="line"><span class="built_in">cd</span> /etc/letsencrypt/auth-hook</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/voidking/certbot-dns-au au</span><br><span class="line"><span class="built_in">chmod</span> 0777 au/au.sh</span><br></pre></td></tr></table></figure><p>2、修改DNS API密钥<br>au.sh中，填入我们申请的DNS API密钥</p><p>3、添加根域名（可选）<br>domain.ini中，如果没有需要的根域名，需要自行添加</p><h1 id="申请泛域名证书"><a href="#申请泛域名证书" class="headerlink" title="申请泛域名证书"></a>申请泛域名证书</h1><p>1、测试申请泛域名证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --<span class="built_in">rm</span> --name certbot \</span><br><span class="line">    -v <span class="string">&quot;/etc/letsencrypt:/etc/letsencrypt&quot;</span> \</span><br><span class="line">    -v <span class="string">&quot;/var/log/letsencryt:/var/log/letsencryt&quot;</span> \</span><br><span class="line">    certbot/certbot:v1.32.0 certonly \</span><br><span class="line">    -d *.voidking.com \</span><br><span class="line">    -d voidking.com \</span><br><span class="line">    --manual \</span><br><span class="line">    --preferred-challenges dns \</span><br><span class="line">    --manual-auth-hook <span class="string">&quot;/etc/letsencrypt/auth-hook/au/au.sh python txy add&quot;</span> \</span><br><span class="line">    --manual-cleanup-hook <span class="string">&quot;/etc/letsencrypt/auth-hook/au/au.sh python txy clean&quot;</span> \</span><br><span class="line">    --dry-run</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Saving debug log to /var/log/letsencrypt/letsencrypt.log</span><br><span class="line">Simulating a certificate request for *.voidking.com</span><br><span class="line">The dry run was successful.</span><br></pre></td></tr></table></figure><p>参数说明：</p><ul><li>-d：要申请证书的域名。这里使用两个-d参数，使证书同时支持泛域名 <code>*.voidking.com</code> 和主域名 <code>voidking.com</code></li><li>–manual-auth-hook：指定要添加dns记录的脚本，调用域名供应商提供的API添加要验证的dns记录</li><li>–manual-cleaup-hook：指定要删除dns记录的脚步，调用域名供应商提供的API删除要验证的dns记录</li><li>–dry-run：测试运行，并不真实申请证书</li></ul><p>2、申请泛域名证书（去掉–dry-run）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --<span class="built_in">rm</span> --name certbot \</span><br><span class="line">    -v <span class="string">&quot;/etc/letsencrypt:/etc/letsencrypt&quot;</span> \</span><br><span class="line">    -v <span class="string">&quot;/var/log/letsencryt:/var/log/letsencryt&quot;</span> \</span><br><span class="line">    certbot/certbot:v1.32.0 certonly \</span><br><span class="line">    -d *.voidking.com \</span><br><span class="line">    -d voidking.com \</span><br><span class="line">    --manual \</span><br><span class="line">    --preferred-challenges dns \</span><br><span class="line">    --manual-auth-hook <span class="string">&quot;/etc/letsencrypt/auth-hook/au/au.sh python txy add&quot;</span> \</span><br><span class="line">    --manual-cleanup-hook <span class="string">&quot;/etc/letsencrypt/auth-hook/au/au.sh python txy clean&quot;</span></span><br></pre></td></tr></table></figure><p>根据提示，填写邮箱，同意协议等。</p><p>申请的证书文件，会被放到 <code>/etc/letsencrypt/archive</code> 路径中，同时 <code>/etc/letsencrypt/live</code> 路径中会创建软链，续期时会自动修改软链。<br>申请证书的相关参数，会被放到 <code>/etc/letsencrypt/renewal</code> 路径中</p><p>证书文件有四个，官方说明如下：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">This directory contains your keys and certificates.</span><br><span class="line"></span><br><span class="line"><span class="code">`privkey.pem`</span>  : the private key for your certificate.</span><br><span class="line"><span class="code">`fullchain.pem`</span>: the certificate file used in most server software.</span><br><span class="line"><span class="code">`chain.pem`</span>    : used for OCSP stapling in Nginx &gt;=1.3.7.</span><br><span class="line"><span class="code">`cert.pem`</span>     : will break many server configurations, and should not be used</span><br><span class="line"><span class="code">                 without reading further documentation (see link below).</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">WARNING: DO NOT MOVE OR RENAME THESE FILES!</span><br><span class="line"><span class="code">         Certbot expects these files to remain in this location in order</span></span><br><span class="line"><span class="code">         to function properly!</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">We recommend not moving these files. For more information, see the Certbot</span><br><span class="line">User Guide at https://certbot.eff.org/docs/using.html#where-are-my-certificates.</span><br></pre></td></tr></table></figure><p>一般使用fullchain.pem和privkey.pem就可以了。如果开启了OCSP stapling，那么需要使用chain.pem。</p><h1 id="查看证书"><a href="#查看证书" class="headerlink" title="查看证书"></a>查看证书</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --<span class="built_in">rm</span> --name certbot \</span><br><span class="line">    -v <span class="string">&quot;/etc/letsencrypt:/etc/letsencrypt&quot;</span> \</span><br><span class="line">    -v <span class="string">&quot;/var/log/letsencryt:/var/log/letsencryt&quot;</span> \</span><br><span class="line">    certbot/certbot:v1.32.0 certificates</span><br></pre></td></tr></table></figure><h1 id="配置证书自动续期"><a href="#配置证书自动续期" class="headerlink" title="配置证书自动续期"></a>配置证书自动续期</h1><p>因为申请证书的相关参数放到了 <code>/etc/letsencrypt/renewal</code> 路径中，所以我们可以通过一条命令实现续期。</p><h2 id="续期所有证书"><a href="#续期所有证书" class="headerlink" title="续期所有证书"></a>续期所有证书</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --<span class="built_in">rm</span> --name certbot \</span><br><span class="line">    -v <span class="string">&quot;/etc/letsencrypt:/etc/letsencrypt&quot;</span> \</span><br><span class="line">    -v <span class="string">&quot;/var/log/letsencryt:/var/log/letsencryt&quot;</span> \</span><br><span class="line">    certbot/certbot:v1.32.0 renew \</span><br><span class="line">    --manual \</span><br><span class="line">    --preferred-challenges dns \</span><br><span class="line">    --manual-auth-hook <span class="string">&quot;/etc/letsencrypt/auth-hook/au/au.sh python txy add&quot;</span> \</span><br><span class="line">    --manual-cleanup-hook <span class="string">&quot;/etc/letsencrypt/auth-hook/au/au.sh python txy clean&quot;</span></span><br></pre></td></tr></table></figure><p>证书有效期小于 30 天的情况才会被 renew。</p><h2 id="续期指定证书"><a href="#续期指定证书" class="headerlink" title="续期指定证书"></a>续期指定证书</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --<span class="built_in">rm</span> --name certbot \</span><br><span class="line">    -v <span class="string">&quot;/etc/letsencrypt:/etc/letsencrypt&quot;</span> \</span><br><span class="line">    -v <span class="string">&quot;/var/log/letsencryt:/var/log/letsencryt&quot;</span> \</span><br><span class="line">    certbot/certbot:v1.32.0 renew \</span><br><span class="line">    --cert-name voidking.com \</span><br><span class="line">    --manual \</span><br><span class="line">    --preferred-challenges dns \</span><br><span class="line">    --manual-auth-hook <span class="string">&quot;/etc/letsencrypt/auth-hook/au/au.sh python txy add&quot;</span> \</span><br><span class="line">    --manual-cleanup-hook <span class="string">&quot;/etc/letsencrypt/auth-hook/au/au.sh python txy clean&quot;</span></span><br></pre></td></tr></table></figure><h2 id="配置定时自动续期"><a href="#配置定时自动续期" class="headerlink" title="配置定时自动续期"></a>配置定时自动续期</h2><p>1、证书续期脚本写入 cert-renew.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt; /etc/letsencrypt/auth-hook/cert-renew.sh</span></span><br><span class="line"><span class="string">docker run -it --rm --name certbot \</span></span><br><span class="line"><span class="string">    -v &quot;/etc/letsencrypt:/etc/letsencrypt&quot; \</span></span><br><span class="line"><span class="string">    -v &quot;/var/log/letsencryt:/var/log/letsencryt&quot; \</span></span><br><span class="line"><span class="string">    certbot/certbot:v1.32.0 renew \</span></span><br><span class="line"><span class="string">    --cert-name voidking.com \</span></span><br><span class="line"><span class="string">    --manual \</span></span><br><span class="line"><span class="string">    --preferred-challenges dns \</span></span><br><span class="line"><span class="string">    --manual-auth-hook &quot;/etc/letsencrypt/auth-hook/au/au.sh python txy add&quot; \</span></span><br><span class="line"><span class="string">    --manual-cleanup-hook &quot;/etc/letsencrypt/auth-hook/au/au.sh python txy clean&quot; \</span></span><br><span class="line"><span class="string">    &gt;&gt; /etc/letsencrypt/auth-hook/cert-renew.log</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> a+x /etc/letsencrypt/auth-hook/cert-renew.sh</span><br></pre></td></tr></table></figure><p>2、添加定时任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure><p>添加每周定时执行：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 * * 0 /bin/bash /etc/letsencrypt/auth-hook/cert-renew.sh</span><br></pre></td></tr></table></figure><p>因为证书有效期小于 30 天的情况才会被 renew，所以 crontab 的周期可以配置为 1 天或 1 周。</p><h1 id="撤销证书"><a href="#撤销证书" class="headerlink" title="撤销证书"></a>撤销证书</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --<span class="built_in">rm</span> --name certbot \</span><br><span class="line">    -v <span class="string">&quot;/etc/letsencrypt:/etc/letsencrypt&quot;</span> \</span><br><span class="line">    -v <span class="string">&quot;/var/log/letsencryt:/var/log/letsencryt&quot;</span> \</span><br><span class="line">    certbot/certbot:v1.32.0 revoke \</span><br><span class="line">    --cert-name voidking.com</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">docker run -it --<span class="built_in">rm</span> --name certbot \</span><br><span class="line">    -v <span class="string">&quot;/etc/letsencrypt:/etc/letsencrypt&quot;</span> \</span><br><span class="line">    -v <span class="string">&quot;/var/log/letsencryt:/var/log/letsencryt&quot;</span> \</span><br><span class="line">    certbot/certbot:v1.32.0 revoke \</span><br><span class="line">    --cert-path /etc/letsencrypt/live/voidking.com/cert.pem</span><br></pre></td></tr></table></figure><h1 id="使用证书"><a href="#使用证书" class="headerlink" title="使用证书"></a>使用证书</h1><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name www.voidking.com;</span><br><span class="line">    charset utf-8;</span><br><span class="line"></span><br><span class="line">    ssl_certificate /etc/letsencrypt/live/voidking.com/fullchain.pem;</span><br><span class="line">    ssl_certificate_key  /etc/letsencrypt/live/voidking.com/privkey.pem;</span><br><span class="line">    ssl_stapling on;</span><br><span class="line">    ssl_stapling_verify on;</span><br><span class="line">    ssl_trusted_certificate /etc/letsencrypt/live/voidking.com/chain.pem;</span><br><span class="line">    ssl_session_timeout  5m;</span><br><span class="line">    ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">    ssl_ciphers  HIGH:!ADH:!EXPORT56:RC4+RSA:+MEDIUM;</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>详情参考文档<a href="https://www.voidking.com/dev-nginx-start/">《Nginx入门篇》</a></p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>对于泛域名证书的配置，建议配置在内网最外层的网关入口处，这样方便统一配置。<br>例如：</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Request -&gt; Nginx<span class="function"><span class="params">(certificate)</span>  -&gt;</span> Ingress</span><br><span class="line">                               -&gt; Nginx</span><br><span class="line">                               -&gt; Real Server</span><br></pre></td></tr></table></figure><p>除了certbot，还有一款<a target="_blank" rel="noopener" href="https://github.com/acmesh-official/acme.sh">acme.sh</a>也很好用，感兴趣的同学可以自行研究下。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-certbot-domain-certificate/" title="使用Certbot申请泛域名证书">https://www.voidking.com/dev-certbot-domain-certificate/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/docker/" rel="tag"># docker</a> <a href="/tags/https/" rel="tag"># https</a> <a href="/tags/tls/" rel="tag"># tls</a> <a href="/tags/ssl/" rel="tag"># ssl</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-encryption-algorithm/" rel="prev" title="浅谈数据加密"><i class="fa fa-chevron-left"></i> 浅谈数据加密</a></div><div class="post-nav-item"> <a href="/dev-ganglia-auth/" rel="next" title="Ganglia认证授权">Ganglia认证授权<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%9C%80%E6%B1%82%E6%8F%8F%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">需求描述</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Certbot%E7%AE%80%E4%BB%8B"><span class="nav-number">2.</span> <span class="nav-text">Certbot简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E6%80%9D%E8%B7%AF"><span class="nav-number">3.</span> <span class="nav-text">安装配置思路</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Certbot"><span class="nav-number">4.</span> <span class="nav-text">安装Certbot</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEDNS%E8%87%AA%E5%8A%A8%E9%AA%8C%E8%AF%81"><span class="nav-number">5.</span> <span class="nav-text">配置DNS自动验证</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%B3%E8%AF%B7DNS-API%E5%AF%86%E9%92%A5"><span class="nav-number">5.1.</span> <span class="nav-text">申请DNS API密钥</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="nav-number">5.2.</span> <span class="nav-text">脚本配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC%E9%85%8D%E7%BD%AE2-0"><span class="nav-number">5.3.</span> <span class="nav-text">脚本配置2.0</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%94%B3%E8%AF%B7%E6%B3%9B%E5%9F%9F%E5%90%8D%E8%AF%81%E4%B9%A6"><span class="nav-number">6.</span> <span class="nav-text">申请泛域名证书</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E8%AF%81%E4%B9%A6"><span class="nav-number">7.</span> <span class="nav-text">查看证书</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E8%AF%81%E4%B9%A6%E8%87%AA%E5%8A%A8%E7%BB%AD%E6%9C%9F"><span class="nav-number">8.</span> <span class="nav-text">配置证书自动续期</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%AD%E6%9C%9F%E6%89%80%E6%9C%89%E8%AF%81%E4%B9%A6"><span class="nav-number">8.1.</span> <span class="nav-text">续期所有证书</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%AD%E6%9C%9F%E6%8C%87%E5%AE%9A%E8%AF%81%E4%B9%A6"><span class="nav-number">8.2.</span> <span class="nav-text">续期指定证书</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%AE%9A%E6%97%B6%E8%87%AA%E5%8A%A8%E7%BB%AD%E6%9C%9F"><span class="nav-number">8.3.</span> <span class="nav-text">配置定时自动续期</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%92%A4%E9%94%80%E8%AF%81%E4%B9%A6"><span class="nav-number">9.</span> <span class="nav-text">撤销证书</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%AF%81%E4%B9%A6"><span class="nav-number">10.</span> <span class="nav-text">使用证书</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E8%AE%B0"><span class="nav-number">11.</span> <span class="nav-text">后记</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">645</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">242</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>