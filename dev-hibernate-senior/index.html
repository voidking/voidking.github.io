<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="Hibernate批量处理批量插入Hibernate直接处理首先在hibernate.cfg.xml中设置批量尺寸属性hibernate.jdbc.batch_size，最好关闭Hibernate的二级缓存以提高效率。 123456&lt;hibernate-configuration&gt;	&lt;session-factory&gt;		&lt;property name&#x3D;&quot;hibernat"><meta property="og:type" content="article"><meta property="og:title" content="Hibernate高级应用"><meta property="og:url" content="https://www.voidking.com/dev-hibernate-senior/index.html"><meta property="og:site_name" content="VoidKing"><meta property="og:description" content="Hibernate批量处理批量插入Hibernate直接处理首先在hibernate.cfg.xml中设置批量尺寸属性hibernate.jdbc.batch_size，最好关闭Hibernate的二级缓存以提高效率。 123456&lt;hibernate-configuration&gt;	&lt;session-factory&gt;		&lt;property name&#x3D;&quot;hibernat"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2014-02-21T13:10:24.000Z"><meta property="article:modified_time" content="2020-02-10T11:59:26.322Z"><meta property="article:author" content="VoidKing"><meta property="article:tag" content="java"><meta property="article:tag" content="eclipse"><meta property="article:tag" content="hibernate"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-hibernate-senior/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Hibernate高级应用 | VoidKing</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="VoidKing" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">VoidKing</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-hibernate-senior/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="VoidKing"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="VoidKing"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Hibernate高级应用</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2014-02-21 13:10:24" itemprop="dateCreated datePublished" datetime="2014-02-21T13:10:24+00:00">2014-02-21</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/" itemprop="url" rel="index"><span itemprop="name">专业</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E5%90%8E%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E5%90%8E%E7%AB%AF/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h3 id="Hibernate批量处理"><a href="#Hibernate批量处理" class="headerlink" title="Hibernate批量处理"></a>Hibernate批量处理</h3><h4 id="批量插入"><a href="#批量插入" class="headerlink" title="批量插入"></a>批量插入</h4><h5 id="Hibernate直接处理"><a href="#Hibernate直接处理" class="headerlink" title="Hibernate直接处理"></a>Hibernate直接处理</h5><p>首先在hibernate.cfg.xml中设置批量尺寸属性hibernate.jdbc.batch_size，最好关闭Hibernate的二级缓存以提高效率。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.jdbc.batch_size"</span>&gt;</span>50<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.jdbc.use_second_level_cache"</span>&gt;</span>false<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>下面批量插入500个课程到数据库表中：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">//KcbBatch.java</span><br><span class="line">package com.voidking.hibernate.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.<span class="keyword">Session</span>;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.<span class="keyword">Transaction</span>;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.<span class="keyword">Configuration</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.voidking.hibernate.model.Kcb;</span><br><span class="line"></span><br><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> KcbBatch &#123;</span><br><span class="line">	<span class="built_in">public</span> static <span class="type">void</span> main(String[] args)&#123;</span><br><span class="line">		//创建<span class="keyword">Session</span>对象</span><br><span class="line">		<span class="keyword">Configuration</span> cfg = <span class="built_in">new</span> <span class="keyword">Configuration</span>();</span><br><span class="line">        SessionFactory sf = cfg.configure().buildSessionFactory();</span><br><span class="line">		<span class="keyword">Session</span> <span class="keyword">session</span> = sf.openSession();</span><br><span class="line">		</span><br><span class="line">		//创建事务对象</span><br><span class="line">		<span class="keyword">Transaction</span> ts=<span class="keyword">session</span>.beginTransaction();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">500</span>; i++) &#123;</span><br><span class="line">			Kcb kcb = <span class="built_in">new</span> Kcb();</span><br><span class="line">			kcb.setKch(i+"");</span><br><span class="line">			<span class="keyword">session</span>.save(kcb);</span><br><span class="line">			<span class="keyword">if</span>(i%<span class="number">50</span>==<span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">session</span>.flush();</span><br><span class="line">				<span class="keyword">session</span>.clear();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		ts.<span class="keyword">commit</span>();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">		sf.<span class="keyword">close</span>();</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h5 id="调用JDBC"><a href="#调用JDBC" class="headerlink" title="调用JDBC"></a>调用JDBC</h5><p>由于Hibernate只是对JDBC进行了轻量级的封装，因此完全可以绕过Hibernate直接用JDBC进行批量插入。因此上面的代码可以改成：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">//KcbBatch.java</span><br><span class="line">package com.voidking.hibernate.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="keyword">sql</span>.<span class="keyword">Connection</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="keyword">sql</span>.PreparedStatement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.<span class="keyword">Session</span>;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.<span class="keyword">Transaction</span>;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.<span class="keyword">Configuration</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.voidking.hibernate.model.Kcb;</span><br><span class="line"></span><br><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> KcbBatch2 &#123;</span><br><span class="line">	<span class="built_in">public</span> static <span class="type">void</span> main(String[] args)&#123;</span><br><span class="line">		//创建<span class="keyword">Session</span>对象</span><br><span class="line">		<span class="keyword">Configuration</span> cfg = <span class="built_in">new</span> <span class="keyword">Configuration</span>();</span><br><span class="line">        SessionFactory sf = cfg.configure().buildSessionFactory();</span><br><span class="line">		<span class="keyword">Session</span> <span class="keyword">session</span> = sf.openSession();</span><br><span class="line">		</span><br><span class="line">		//创建事务对象</span><br><span class="line">		<span class="keyword">Transaction</span> ts=<span class="keyword">session</span>.beginTransaction();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">Connection</span> conn = <span class="keyword">session</span>.<span class="keyword">connection</span>();</span><br><span class="line">		</span><br><span class="line">		try &#123;</span><br><span class="line">			PreparedStatement stmt = conn.prepareStatement("insert into kcb(kch) values(?)");</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">500</span>;i++)</span><br><span class="line">			&#123;</span><br><span class="line">				stmt.setString(<span class="number">1</span>, i+"");</span><br><span class="line">				stmt.addBatch();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; catch (<span class="keyword">Exception</span> e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		ts.<span class="keyword">commit</span>();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">		sf.<span class="keyword">close</span>();</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h5><p>在用Hibernate进行操作的时候操作的是表对应的类，而在用JDBC进行操作时操作的是数据库中的表。</p><h4 id="批量更新"><a href="#批量更新" class="headerlink" title="批量更新"></a>批量更新</h4><h5 id="Hibernate直接处理-1"><a href="#Hibernate直接处理-1" class="headerlink" title="Hibernate直接处理"></a>Hibernate直接处理</h5><p>为了使Hibernate的HQL直接支持update/delete的批量更新语法，首先要hibernate.cfg.xml中设置HQL/SQL查询翻译器属性hibernate.query.factory_class。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;property name=<span class="string">"hibernate.query.factory_class"</span>&gt;</span><br><span class="line">	org<span class="selector-class">.hibernate</span><span class="selector-class">.hql</span><span class="selector-class">.ast</span>.ASTQueryTranslatorFactory</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure><p>为了防止类名输入错误，可以按住Ctrl键，同时单击这个类名。如果可以跳转到.class文件，说明输入正确，否则输入错误。<br>下面使用HQL批量更新把课程表中XS修改为30。</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Query</span> <span class="keyword">query</span> = session.createQuery(<span class="string">"update kcb set xs=30"</span>);</span><br><span class="line"><span class="keyword">query</span>.executeUpdate();</span><br></pre></td></tr></table></figure><h5 id="调用JDBC-1"><a href="#调用JDBC-1" class="headerlink" title="调用JDBC"></a>调用JDBC</h5><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	Statement stmt = conn.create<span class="constructor">Statement()</span>;</span><br><span class="line">	stmt.execute<span class="constructor">Update(<span class="string">"update kcb set xs=30"</span>)</span>;</span><br><span class="line">&#125;catch(Exception)&#123;</span><br><span class="line">	e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="批量删除"><a href="#批量删除" class="headerlink" title="批量删除"></a>批量删除</h4><h5 id="Hibernate直接处理-2"><a href="#Hibernate直接处理-2" class="headerlink" title="Hibernate直接处理"></a>Hibernate直接处理</h5><p>删除课程表中课程号大于200的课程。</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Query</span> <span class="keyword">query</span> = session.createQuery(<span class="string">"delete kcb where kch &gt; 200"</span>);</span><br><span class="line"><span class="keyword">query</span>.executeUpdate();</span><br></pre></td></tr></table></figure><h5 id="调用JDBC-2"><a href="#调用JDBC-2" class="headerlink" title="调用JDBC"></a>调用JDBC</h5><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	Statement stmt = conn.create<span class="constructor">Statement()</span>;</span><br><span class="line">	stmt.execute<span class="constructor">Update(<span class="string">"delete from kcb where kch&gt;200"</span>)</span>;</span><br><span class="line">&#125;catch(Exception)&#123;</span><br><span class="line">	e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实体对象生命周期"><a href="#实体对象生命周期" class="headerlink" title="实体对象生命周期"></a>实体对象生命周期</h3><p>实体对象，特指Hibernate O/R映射关系中的域对象（即O/R中的O）。</p><h4 id="transient（瞬时态）"><a href="#transient（瞬时态）" class="headerlink" title="transient（瞬时态）"></a>transient（瞬时态）</h4><p>瞬时态，即实体对象在内存中的存在，与数据库中的记录无关。</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Student stu = <span class="keyword">new</span> <span class="constructor">Student()</span>;</span><br><span class="line">stu.set<span class="constructor">Snumber(<span class="string">"081101"</span>)</span>;</span><br><span class="line">stu.set<span class="constructor">Sname(<span class="string">"李方方"</span>)</span>;</span><br><span class="line">stu.set<span class="constructor">Sage(21)</span>;</span><br></pre></td></tr></table></figure><p>这里的stu对象，与数据库中的记录没有任何关联。</p><h4 id="persisent（持久态）"><a href="#persisent（持久态）" class="headerlink" title="persisent（持久态）"></a>persisent（持久态）</h4><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Student stu = <span class="keyword">new</span> <span class="constructor">Student()</span>;</span><br><span class="line">stu.set<span class="constructor">Snumber(<span class="string">"081101"</span>)</span>;</span><br><span class="line">stu.set<span class="constructor">Sname(<span class="string">"李方方"</span>)</span>;</span><br><span class="line">stu.set<span class="constructor">Sage(21)</span>;</span><br><span class="line"></span><br><span class="line">Student stu1 = <span class="keyword">new</span> <span class="constructor">Student()</span>;</span><br><span class="line">stu1.set<span class="constructor">Snumber(<span class="string">"081102"</span>)</span>;</span><br><span class="line">stu1.set<span class="constructor">Sname(<span class="string">"程明"</span>)</span>;</span><br><span class="line">stu1.set<span class="constructor">Sage(22)</span>;</span><br><span class="line"></span><br><span class="line">Transaction ts = session.<span class="keyword">begin</span><span class="constructor">Transaction()</span>;</span><br><span class="line"></span><br><span class="line">session.save(stu);<span class="comment">//stu对象转换为持久态，由Hibernate纳入实体管理器；stu1仍然处于瞬时态</span></span><br><span class="line"></span><br><span class="line">ts.commit<span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">Transaction ts2 = session.<span class="keyword">begin</span><span class="constructor">Transaction()</span>;</span><br><span class="line">stu.set<span class="constructor">Sname(<span class="string">"李方"</span>)</span>;<span class="comment">//虽然这个事务没有显式调用session.sava()保存stu对象，但是由于stu为持久态，将自动被固化到数据库</span></span><br><span class="line">stu1.set<span class="constructor">Sname(<span class="string">"程明明"</span>)</span>;<span class="comment">//stu1仍是一个普通Java对象，对数据库未产生任何影响</span></span><br><span class="line"></span><br><span class="line">ts2.commit<span class="literal">()</span>;</span><br></pre></td></tr></table></figure><p>处于瞬时态的对象，可以通过Session的save()方法转换成持久状态。同样，如果一个实体对象由Hibernate加载，那么，它也处于持久状态。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Student stu = (Student)<span class="keyword">session</span>.<span class="keyword">load</span>(Student.<span class="keyword">class</span>,net <span class="type">Integer</span>(<span class="number">1</span>));</span><br></pre></td></tr></table></figure><p>持久对象对应着数据库中的一条记录，可以看做是数据库记录的对象化操作接口，其状态的变更将对数据库中的记录产生影响。</p><h4 id="Detached（脱管状态）"><a href="#Detached（脱管状态）" class="headerlink" title="Detached（脱管状态）"></a>Detached（脱管状态）</h4><p>处于持久化的对象，其对应的Session实例关闭之后，此对象就处于脱管状态。Session实例可以看做是持久对象的宿主，一旦此宿主失效，其从属的持久对象进入脱管状态。</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Student stu = <span class="keyword">new</span> <span class="constructor">Student()</span>;<span class="comment">//stu对象为瞬时态</span></span><br><span class="line">stu.set<span class="constructor">Snumber(<span class="string">"081101"</span>)</span>;</span><br><span class="line">stu.set<span class="constructor">Sname(<span class="string">"李方方"</span>)</span>;</span><br><span class="line">stu.set<span class="constructor">Sage(21)</span>;</span><br><span class="line"></span><br><span class="line">Transaction ts = session.<span class="keyword">begin</span><span class="constructor">Transaction()</span>;</span><br><span class="line"></span><br><span class="line">session.save(stu);<span class="comment">//stu对象由Hibernate纳入管理容器，处于持久状态</span></span><br><span class="line"></span><br><span class="line">ts.commit<span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">session.close<span class="literal">()</span>;<span class="comment">//stu对象为脱管状态，因为与其关联的session已经关闭</span></span><br></pre></td></tr></table></figure><p>托管态和瞬时态有什么区别？瞬时状态的stu对象与库表中的数据缺乏对应关系，而脱管状态的stu对象，却在库表中存在相对应的记录，只不过由于脱管对象脱离Session这个数据操作平台，其状态的改变无法更新到库表中对应的记录。</p><p>有时候为了方便，将处于瞬时和脱管状态的对象统称为值对象（Value Object，VO），将处于持久态的对象称为持久对象（Persistent Object，PO）。也就是说，对Hibernate实体管理容器而言，非管理的实体对象统称为VO，被管理的对象称为PO。</p><h3 id="Hibernate事务管理"><a href="#Hibernate事务管理" class="headerlink" title="Hibernate事务管理"></a>Hibernate事务管理</h3><p>事务是数据库并发控制不可分割的基本工作单位，具有原子性、一致性、隔离性和持久性的特点。</p><p>事务（Transaction）是工作中的基本逻辑单元，可以用于确保数据库能够被正确修改，避免数据只修改一部分而导致数据不完整，或者在修改时受到用户干扰。</p><h4 id="基于JDBC的事务管理"><a href="#基于JDBC的事务管理" class="headerlink" title="基于JDBC的事务管理"></a>基于JDBC的事务管理</h4><p>Hibernate是JDBC的轻量级封装，本身并不具备事务管理能力。在事务管理层，Hibernate将其委托给底层的JDBC或JTA，以实现事务管理和调度功能。</p><p>在JDBC中，事务默认是自动提交。也就是说，一条对数据库的更新表达式代表一项事务操作。操作成功后，系统将自动调用commit提交。否则，将调用rollback回滚。</p><p>在JDBC中，可以通过调用setAutoCommit(false)禁止自动提交。之后就可以把多个数据库操作的表达式作为一个事务，在操作完成后调用commit进行整体提交。</p><p>将事务管理委托给JDBC进行处理是最简单的实现方式，Hibernate对于JDBC事务的封装也比较简单。如下面的代码：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//创建<span class="keyword">Session</span>对象</span><br><span class="line"><span class="keyword">Configuration</span> cfg = <span class="built_in">new</span> <span class="keyword">Configuration</span>();</span><br><span class="line">SessionFactory sf = cfg.configure().buildSessionFactory();</span><br><span class="line"><span class="keyword">Session</span> <span class="keyword">session</span> = sf.openSession();</span><br><span class="line"></span><br><span class="line">//创建事务对象</span><br><span class="line"><span class="keyword">Transaction</span> ts=<span class="keyword">session</span>.beginTransaction();</span><br><span class="line"></span><br><span class="line">seesion.save(stu);</span><br><span class="line"></span><br><span class="line">ts.<span class="keyword">commit</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">sf.<span class="keyword">close</span>();</span><br></pre></td></tr></table></figure><p>从JDBC层面而言，上面的代码实际对应着：</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Connection <span class="literal">cn</span> = getConnection;</span><br><span class="line"><span class="literal">cn</span>.setAutoCommit(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">//JDBC调用相关的SQL语句</span></span><br><span class="line"><span class="literal">cn</span>.commit();</span><br></pre></td></tr></table></figure><p>在sf.openSession()语句中，Hibernate会初始化数据库连接。与此同时，将其AutoCommit设为关闭状态（false）。即一开始获得的session，其自动提交属性已经被关闭。下面的代码不会对数据库产生任何效果：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//创建<span class="keyword">Session</span>对象</span><br><span class="line"><span class="keyword">Configuration</span> cfg = <span class="built_in">new</span> <span class="keyword">Configuration</span>();</span><br><span class="line">SessionFactory sf = cfg.configure().buildSessionFactory();</span><br><span class="line"><span class="keyword">Session</span> <span class="keyword">session</span> = sf.openSession();</span><br><span class="line"></span><br><span class="line">seesion.save(stu);</span><br><span class="line"></span><br><span class="line"><span class="keyword">session</span>.<span class="keyword">close</span>();</span><br><span class="line">sf.<span class="keyword">close</span>();</span><br></pre></td></tr></table></figure><p>这实际上相当于JDBC Connection的AutoCommit属性被设为false，执行了若干JDBC操作之后，没有调用commit操作。</p><h4 id="基于JTA的事务管理"><a href="#基于JTA的事务管理" class="headerlink" title="基于JTA的事务管理"></a>基于JTA的事务管理</h4><p>JTA（Java Transaction API）是由Java EE Transaction Manager去管理的事务。其最大的特点是调用UserTransaction接口的begin、commit和rollback方法来完成事务范围的界定、事务的提交和回滚。JTA可以实现统一事务对应不同的数据库。</p><p>JTA主要用于分布式的多个数据源的两阶段提交的事务，而JDBC的Connection提供单个数据源的事务。后者因为只涉及一个数据源，所以其事务可以由数据库自己单独实现。而JTA事务因为其分布式和多数据库的特性，不可能由任何一个数据源实现事务。因此，JTA中的事务是由“事务管理器”实现的。它会在多个数据源之间统筹事务，具体使用的技术就是所谓的“两阶段提交”。</p><p>JTA提供了跨Session的事务管理能力。这一点是与JDBC Transaction最大的差异。JDBC事务由Connection管理，即事务管理实际上是在JDBC Connection中实现。事务周期限于Connection的生命周期之内。同样，对于基于JDBC Transaction的Hibernate事务管理机制而言，事务管理在Session所依托的JDBC Connection中实现，事务周期限于Session的生命周期。</p><p>JTA事务管理则由JTA容器实现。JTA对当前加入事务的众多Connection进行调度，实现事务性要求。JTA的事务周期可以横跨多个JDBC Connection生命周期。同样，对于基于JTA事务的Hibernate而言，JTA事务横跨多个Session。</p><h4 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h4><p>Hibernate支持两种锁机制，悲观锁（Pessimistic Locking）和乐观锁（Optimistic Locking）。<br>悲观锁是指对数据被外界修改保持保守态度。假定任何时刻存取数据时，都可能有一个客户也正在存取同一数据。为了保持数据被操作的移植性，于是对数据采取了数据库层次的锁定状态，依靠数据库提供的锁机制来实现。</p><p>乐观锁则乐观地认为数据很少发生同时存取的问题，因此不做数据库层次上的锁定。为了维护正确的数据，乐观锁采用应用程序上的逻辑实现版本控制的方法。</p><h3 id="源代码分享"><a href="#源代码分享" class="headerlink" title="源代码分享"></a>源代码分享</h3><p>Hibernate概述、Hibernate关系映射、Hibernate高级应用，三篇博客中使用的代码，都在下面这个工程。<br><a href="https://github.com/voidking/hibernate.git" target="_blank" rel="noopener">https://github.com/voidking/hibernate.git</a></p><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p>《Java EE基础实用教程》，郑阿奇主编</p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/java/" rel="tag"># java</a> <a href="/tags/eclipse/" rel="tag"># eclipse</a> <a href="/tags/hibernate/" rel="tag"># hibernate</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-hibernate-orm/" rel="prev" title="Hibernate关系映射"><i class="fa fa-chevron-left"></i> Hibernate关系映射</a></div><div class="post-nav-item"> <a href="/dev-hibernate-struts2-integration/" rel="next" title="Hibernate与Struts2整合应用">Hibernate与Struts2整合应用<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Hibernate批量处理"><span class="nav-number">1.</span> <span class="nav-text">Hibernate批量处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#批量插入"><span class="nav-number">1.1.</span> <span class="nav-text">批量插入</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Hibernate直接处理"><span class="nav-number">1.1.1.</span> <span class="nav-text">Hibernate直接处理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#调用JDBC"><span class="nav-number">1.1.2.</span> <span class="nav-text">调用JDBC</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#对比"><span class="nav-number">1.1.3.</span> <span class="nav-text">对比</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#批量更新"><span class="nav-number">1.2.</span> <span class="nav-text">批量更新</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Hibernate直接处理-1"><span class="nav-number">1.2.1.</span> <span class="nav-text">Hibernate直接处理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#调用JDBC-1"><span class="nav-number">1.2.2.</span> <span class="nav-text">调用JDBC</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#批量删除"><span class="nav-number">1.3.</span> <span class="nav-text">批量删除</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Hibernate直接处理-2"><span class="nav-number">1.3.1.</span> <span class="nav-text">Hibernate直接处理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#调用JDBC-2"><span class="nav-number">1.3.2.</span> <span class="nav-text">调用JDBC</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实体对象生命周期"><span class="nav-number">2.</span> <span class="nav-text">实体对象生命周期</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#transient（瞬时态）"><span class="nav-number">2.1.</span> <span class="nav-text">transient（瞬时态）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#persisent（持久态）"><span class="nav-number">2.2.</span> <span class="nav-text">persisent（持久态）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Detached（脱管状态）"><span class="nav-number">2.3.</span> <span class="nav-text">Detached（脱管状态）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hibernate事务管理"><span class="nav-number">3.</span> <span class="nav-text">Hibernate事务管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#基于JDBC的事务管理"><span class="nav-number">3.1.</span> <span class="nav-text">基于JDBC的事务管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#基于JTA的事务管理"><span class="nav-number">3.2.</span> <span class="nav-text">基于JTA的事务管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#锁"><span class="nav-number">3.3.</span> <span class="nav-text">锁</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#源代码分享"><span class="nav-number">4.</span> <span class="nav-text">源代码分享</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考文档"><span class="nav-number">5.</span> <span class="nav-text">参考文档</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="VoidKing" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">VoidKing</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">583</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">40</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">189</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://twitter.com/voidking_com" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;voidking_com" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i> Twitter</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">VoidKing</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://www.beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>