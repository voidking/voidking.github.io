<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//qiniu.cdn.voidking.com/doc/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言《好好学Linux：Linux系统配置静态IP》一文中，描述了 CentOS7 和 Ubuntu16.04 系统中配置静态IP的方法。但是，Ubuntu18之后的版本，网络配置方法发生了较大的变更，本文学习一下新的配置方法。"><meta property="og:type" content="article"><meta property="og:title" content="好好学Linux：Ubuntu18配置静态IP"><meta property="og:url" content="https://www.voidking.com/dev-ubuntu18-static-ip/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言《好好学Linux：Linux系统配置静态IP》一文中，描述了 CentOS7 和 Ubuntu16.04 系统中配置静态IP的方法。但是，Ubuntu18之后的版本，网络配置方法发生了较大的变更，本文学习一下新的配置方法。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2023-02-07T18:00:00.000Z"><meta property="article:modified_time" content="2024-06-22T08:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="好好学Linux"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="libvirt"><meta property="article:tag" content="virsh"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-ubuntu18-static-ip/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>好好学Linux：Ubuntu18配置静态IP | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">一个计算机技术爱好者与学习者</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-ubuntu18-static-ip/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="一个计算机技术爱好者与学习者"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> 好好学Linux：Ubuntu18配置静态IP</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-02-07 18:00:00" itemprop="dateCreated datePublished" datetime="2023-02-07T18:00:00+00:00">2023-02-07</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-06-22 08:00:00" itemprop="dateModified" datetime="2024-06-22T08:00:00+00:00">2024-06-22</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/troubleshooting/" itemprop="url" rel="index"><span itemprop="name">troubleshooting</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><span class="post-title-index">1.</span><a href="#前言" class="headerlink" title="前言"></a> 前言</h1><p><a href="https://www.voidking.com/dev-linux-static-ip/">《好好学Linux：Linux系统配置静态IP》</a>一文中，描述了 CentOS7 和 Ubuntu16.04 系统中配置静态IP的方法。<br>但是，Ubuntu18之后的版本，网络配置方法发生了较大的变更，本文学习一下新的配置方法。</p><span id="more"></span><h1 id="单网卡静态IP配置方法"><span class="post-title-index">2.</span><a href="#单网卡静态IP配置方法" class="headerlink" title="单网卡静态IP配置方法"></a> 单网卡静态IP配置方法</h1><p>1、编辑网卡配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/netplan/01-network-manager-all.yaml</span><br></pre></td></tr></table></figure><p>如下修改：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Let NetworkManager manage all devices on this system</span></span><br><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">renderer:</span> <span class="string">NetworkManager</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">eth0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">false</span>                          <span class="comment"># 禁止动态IP</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="number">192.168</span><span class="number">.56</span><span class="number">.111</span><span class="string">/24</span>]       <span class="comment"># IP地址和掩码</span></span><br><span class="line">      <span class="attr">gateway4:</span> <span class="number">192.168</span><span class="number">.56</span><span class="number">.1</span>              <span class="comment"># 网关</span></span><br><span class="line">      <span class="attr">nameservers:</span></span><br><span class="line">        <span class="attr">addresses:</span> [<span class="number">180.76</span><span class="number">.76</span><span class="number">.76</span>,<span class="number">114.114</span><span class="number">.114</span><span class="number">.114</span>]   <span class="comment">#DNS服务器</span></span><br></pre></td></tr></table></figure><p>其中 dhcp4 参数的值可以改为 <code>no</code> ，和 <code>false</code> 等价。</p><p>2、使配置生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netplan apply</span><br></pre></td></tr></table></figure><p>3、验证配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip addr show dev eth0</span><br></pre></td></tr></table></figure><h1 id="多网卡静态IP配置方法"><span class="post-title-index">3.</span><a href="#多网卡静态IP配置方法" class="headerlink" title="多网卡静态IP配置方法"></a> 多网卡静态IP配置方法</h1><h2 id="配置方法一：单文件配置"><span class="post-title-index">3.1.</span><a href="#配置方法一：单文件配置" class="headerlink" title="配置方法一：单文件配置"></a> 配置方法一：单文件配置</h2><p>编辑网卡配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/netplan/01-network-manager-all.yaml</span><br></pre></td></tr></table></figure><p>如下修改：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Let NetworkManager manage all devices on this system</span></span><br><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">renderer:</span> <span class="string">NetworkManager</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">eth0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">false</span>                          <span class="comment"># 禁止动态IP</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="number">192.168</span><span class="number">.56</span><span class="number">.111</span><span class="string">/24</span>]       <span class="comment"># IP地址和掩码</span></span><br><span class="line">      <span class="attr">gateway4:</span> <span class="number">192.168</span><span class="number">.56</span><span class="number">.1</span>              <span class="comment"># 网关</span></span><br><span class="line">      <span class="attr">nameservers:</span></span><br><span class="line">        <span class="attr">addresses:</span> [<span class="number">180.76</span><span class="number">.76</span><span class="number">.76</span>,<span class="number">114.114</span><span class="number">.114</span><span class="number">.114</span>]   <span class="comment">#DNS服务器</span></span><br><span class="line">    <span class="attr">eth1:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="number">172.16</span><span class="number">.0</span><span class="number">.111</span><span class="string">/24</span>]</span><br></pre></td></tr></table></figure><h2 id="配置方法二：多文件配置"><span class="post-title-index">3.2.</span><a href="#配置方法二：多文件配置" class="headerlink" title="配置方法二：多文件配置"></a> 配置方法二：多文件配置</h2><p>拷贝网卡配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /etc/netplan/01-network-manager-all.yaml /etc/netplan/02-network-manager-all.yaml</span><br><span class="line">vim /etc/netplan/02-network-manager-all.yaml</span><br></pre></td></tr></table></figure><p>如下修改：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Let NetworkManager manage all devices on this system</span></span><br><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">renderer:</span> <span class="string">NetworkManager</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">eth1:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="number">172.16</span><span class="number">.0</span><span class="number">.111</span><span class="string">/24</span>]</span><br></pre></td></tr></table></figure><h1 id="临时配置固定IP"><span class="post-title-index">4.</span><a href="#临时配置固定IP" class="headerlink" title="临时配置固定IP"></a> 临时配置固定IP</h1><p>给 eth0 配置两个固定IP：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip addr add 192.168.1.100/24 dev eth0</span><br><span class="line">ip addr add 192.168.1.101/24 dev eth0</span><br></pre></td></tr></table></figure><h1 id="配置默认网关"><span class="post-title-index">5.</span><a href="#配置默认网关" class="headerlink" title="配置默认网关"></a> 配置默认网关</h1><p>配置文件中，可以通过 <code>gateway4</code> 指定网关。</p><p>如果多个网卡有不同的网关，该怎样指定默认网关？<br>答：在 netplan 配置文件中，我们可以针对不同的网卡配置不同的网关。但是，请不要这么做，因为一个系统只能有一个默认网关，否则会导致混乱出现网络问题。<br>如果有多个网卡，每个网卡的网关不同，那么请选择出想要配置为默认网关的网卡，给该网卡配置上网关，其他的网卡不要配置网关。</p><h1 id="扩展：禁用和启用指定的网卡"><span class="post-title-index">6.</span><a href="#扩展：禁用和启用指定的网卡" class="headerlink" title="扩展：禁用和启用指定的网卡"></a> 扩展：禁用和启用指定的网卡</h1><p>如果一台主机上有多个网卡，想要禁用和启用其中一张或多张网卡，可以使用下面的方法。</p><h2 id="临时禁用和启用"><span class="post-title-index">6.1.</span><a href="#临时禁用和启用" class="headerlink" title="临时禁用和启用"></a> 临时禁用和启用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth1 down <span class="comment"># 禁用</span></span><br><span class="line">ifconfig eth1 up <span class="comment"># 启用</span></span><br></pre></td></tr></table></figure><h2 id="永久禁用和启用"><span class="post-title-index">6.2.</span><a href="#永久禁用和启用" class="headerlink" title="永久禁用和启用"></a> 永久禁用和启用</h2><h3 id="基于netplan（推荐）"><span class="post-title-index">6.2.1.</span><a href="#基于netplan（推荐）" class="headerlink" title="基于netplan（推荐）"></a> 基于netplan（推荐）</h3><p><strong>永久禁用方法：</strong><br>1、修改netplay配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/netplan/01-network-manager-all.yaml</span><br></pre></td></tr></table></figure><p>添加：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">renderer:</span> <span class="string">NetworkManager</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">eth1:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">optional:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>2、应用netplan配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netplan apply</span><br></pre></td></tr></table></figure><p>3、重启网络服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart systemd-networkd</span><br></pre></td></tr></table></figure><p><strong>永久启用方法：</strong><br>修改netplay配置（删除其中的禁用配置），应用netplan配置，重启网络服务。</p><h3 id="基于interfaces"><span class="post-title-index">6.2.2.</span><a href="#基于interfaces" class="headerlink" title="基于interfaces"></a> 基于interfaces</h3><p>使用 /etc/network/interfaces（如果我们的系统使用此旧方法配置网络），这种方法在新版的Ubuntu中并不常见，因为Netplan取代了/etc/network/interfaces文件，但如果我们的系统依然使用它，可以使用下面的方法。</p><p><strong>永久禁用方法：</strong><br>1、修改interfaces配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/network/interfaces</span><br></pre></td></tr></table></figure><p>将指定的网卡设置为不自动启动</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auto eth0</span><br><span class="line">iface eth0 inet manual</span><br></pre></td></tr></table></figure><p>2、重启网络服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart networking</span><br></pre></td></tr></table></figure><p><strong>永久启用方法：</strong><br>修改interfaces配置（删除其中的禁用配置），重启网络服务。</p><h3 id="基于initramfs"><span class="post-title-index">6.2.3.</span><a href="#基于initramfs" class="headerlink" title="基于initramfs"></a> 基于initramfs</h3><p><strong>永久禁用方法：</strong><br>1、配置 blacklist.conf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/modprobe.d/blacklist.conf </span><br></pre></td></tr></table></figure><p>在文件最后添加：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blacklist eth1</span><br></pre></td></tr></table></figure><p>2、更新initramfs</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update-initramfs -u</span><br></pre></td></tr></table></figure><p>该命令用于更新 Linux 系统的初始化 RAM 磁盘文件系统（initramfs）。<br>在系统引导过程中，initramfs 用于加载必要的驱动程序并初始化硬件，以便在挂载根文件系统之前完成这些工作。该命令生成一个新的 initramfs映像文件并更新符号链接到最新的映像文件。在更新内核或任何与内核相关的配置文件更改之后，通常会运行此命令，以确保系统可以正确引导。</p><p>3、重启主机进行验证（可选）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure><p><strong>永久启用方法：</strong><br>blacklist.conf 删除禁用的配置，更新initramfs。</p><h1 id="扩展：Netplan-和-NetworkManager的关系"><span class="post-title-index">7.</span><a href="#扩展：Netplan-和-NetworkManager的关系" class="headerlink" title="扩展：Netplan 和 NetworkManager的关系"></a> 扩展：Netplan 和 NetworkManager的关系</h1><p>在 Ubuntu 和一些其他基于 Debian 的 Linux 发行版中，Netplan 和 NetworkManager 有着紧密的合作关系。</p><p>Netplan 是一个配置网络的工具，它使用简单的 YAML 文件来描述网络接口的配置。Netplan 是 Ubuntu 17.10 以后的版本中引入的默认网络配置工具，用于统一和简化网络配置过程。Netplan 本身并不直接管理网络连接；它是一个抽象层，将配置转换成底层网络管理服务可以理解的格式。</p><p>Netplan 支持将配置转换给以下两种网络后端服务之一：</p><ul><li>systemd-networkd: 主要用于服务器和无界面系统，是一个系统服务，用于配置网络接口。</li><li>NetworkManager: 适用于桌面和服务器环境，特别是需要频繁连接和断开网络的场景。NetworkManager 提供了丰富的命令行界面 (CLI) 和图形用户界面 (GUI)，便于用户进行网络配置。</li></ul><p>这些后端是 Netplan 生成的配置的 “消费者”，负责实际的网络接口管理工作。</p><p>NetworkManager 是一个动态网络控制和配置系统，可以响应网络环境的变化并进行相应的调整。NetworkManager 旨在简化和自动化网络配置和连接管理，尤其是在 WLAN（无线局域网）和移动宽带连接方面。</p><p>它们的关系在使用上很简单：</p><p>1、系统管理员或用户编写一个 YAML 格式的 Netplan 配置文件，定义了网络接口的期望配置。<br>2、运行 <code>netplan apply</code> 命令时，Netplan 读取 YAML 文件，然后根据当前系统所使用的网络后端（systemd-networkd 或 NetworkManager），生成相应的配置。</p><ul><li>如果是 NetworkManager，Netplan 将生成 NetworkManager 可以理解的配置，并将这些配置置于 <code>/etc/NetworkManager/system-connections/</code>目录下。</li><li>如果是 systemd-networkd，Netplan 将生成适当的单位文件放在 <code>/etc/systemd/network/</code> 目录下。<br>3、NetworkManager 或 systemd-networkd 接管，应用这些配置，并管理网络连接。</li></ul><p>由此，Netplan 作为一个中间层，可以无缝地与 NetworkManager（或 systemd-networkd）配合工作，让用户能够通过统一的接口来处理网络配置，而无需直接与底层网络管理工具交互。这降低了配置的复杂性，特别是在有多种网络接口和连接类型需要管理的环境中。</p><h1 id="设置静态IP无效问题"><span class="post-title-index">8.</span><a href="#设置静态IP无效问题" class="headerlink" title="设置静态IP无效问题"></a> 设置静态IP无效问题</h1><h2 id="问题描述"><span class="post-title-index">8.1.</span><a href="#问题描述" class="headerlink" title="问题描述"></a> 问题描述</h2><p>/etc/netplan/01-network-manager-all.yaml 配置为：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">renderer:</span> <span class="string">NetworkManager</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">ens5f0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="number">172.22</span><span class="number">.3</span><span class="number">.211</span><span class="string">/24</span>]</span><br><span class="line">      <span class="attr">gateway4:</span> <span class="number">172.22</span><span class="number">.3</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">ens5f2:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">optional:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>上面的配置中给ens5f0网卡配置了一个静态IP 172.22.3.211 ，但是实际上该网卡获取到的IP为 172.22.3.56</p><h2 id="问题排查解决"><span class="post-title-index">8.2.</span><a href="#问题排查解决" class="headerlink" title="问题排查解决"></a> 问题排查解决</h2><p>1、重新执行 <code>netplan apply</code>，无效。<br>2、重新启动NetworkManager，<code>systemctl restart NetworkManager</code>，无效。<br>3、重启主机，无效。<br>4、查看查看网络接口状态和配置信息 <code>nmcli</code>，发现了异常：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ens5f0：已连接 到 配置 1</span><br><span class="line">        &quot;Intel I350&quot;</span><br><span class="line">        ethernet (igb), B4:96:91:12:9E:26, 硬件, mtu 1500</span><br><span class="line">        ip4 默认</span><br><span class="line">        inet4 172.22.3.56/24</span><br><span class="line">        route4 0.0.0.0/0</span><br><span class="line">        route4 172.22.3.0/24</span><br><span class="line">        inet6 fe80::a0e0:cc7b:xxx:xxx/64</span><br><span class="line">        route6 fe80::/64</span><br><span class="line"></span><br><span class="line">ens5f2：已连接 到 netplan-ens5f2</span><br><span class="line">        &quot;Intel I350&quot;</span><br><span class="line">        ethernet (igb), B4:96:91:12:9E:28, 硬件, mtu 1500</span><br><span class="line">        inet4 169.254.136.104/16</span><br><span class="line">        inet4 169.254.249.45/16</span><br><span class="line">        route4 224.0.0.0/4</span><br><span class="line">        route4 169.254.0.0/16</span><br><span class="line">        route4 169.254.0.0/16</span><br><span class="line">        inet6 fe80::b696:91ff:xxx:xxx/64</span><br><span class="line">        route6 fe80::/64</span><br></pre></td></tr></table></figure><p>ens5f0 正常应该连接到 netplan-ens5f0，但是上面显示连接到配置1，这明显是有问题的。</p><p>5、检查网络配置方式<br>在 Linux 系统中，网络配置可能通过多种不同的方式进行管理：</p><ul><li>命令行工具：如 nmcli（NetworkManager 的命令行界面）和 netplan。</li><li>配置文件：如 <code>/etc/network/interfaces</code>（传统 Debian 配置），<code>/etc/netplan/*.yaml</code> 文件（Ubuntu 的 netplan 工具），或者 <code>/etc/NetworkManager/system-connections/</code> 目录下的文件（由 NetworkManager 管理）。</li><li>图形用户界面：如 GNOME 的网络设置或其他桌面环境提供的网络管理器GUI。</li></ul><p>在检查 <code>/etc/NetworkManager/system-connections/</code> 目录下的文件时，找到了配置1。由此证明是NetworkManager和netplan协调工作时出现了问题。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># cat /etc/NetworkManager/system-connections/&#x27;配置 1.nmconnection&#x27;</span><br><span class="line">[connection]</span><br><span class="line">id=配置 1</span><br><span class="line">uuid=657c4d21-ebc8-48a9-9ccf-41a234060f68</span><br><span class="line">type=ethernet</span><br><span class="line">permissions=</span><br><span class="line">timestamp=1691305627</span><br><span class="line"></span><br><span class="line">[ethernet]</span><br><span class="line">mac-address-blacklist=</span><br><span class="line"></span><br><span class="line">[ipv4]</span><br><span class="line">dns-search=</span><br><span class="line">method=auto</span><br><span class="line"></span><br><span class="line">[ipv6]</span><br><span class="line">addr-gen-mode=stable-privacy</span><br><span class="line">dns-search=</span><br><span class="line">method=auto</span><br><span class="line"></span><br><span class="line">[proxy]</span><br></pre></td></tr></table></figure><p>解决办法：删除配置1，重新生成NetworkManager配置。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /etc/NetworkManager/system-connections/<span class="string">&#x27;配置 1.nmconnection&#x27;</span> ~</span><br><span class="line">netplan apply</span><br></pre></td></tr></table></figure><p>执行上面的命令之后，IP成功设置为 172.22.3.211 ，但是 /etc/NetworkManager/system-connections/ 目录中并没有生成新的配置，且不管它。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>原文链接：</strong> <a href="https://www.voidking.com/dev-ubuntu18-static-ip/" title="好好学Linux：Ubuntu18配置静态IP">https://www.voidking.com/dev-ubuntu18-static-ip/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本文采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议，转载请注明出处！源站会即时更新知识点并修正错误，欢迎访问~</li><li> <img width="200" height="200" src="/images/avatar.jpg"><p style="text-align:center;margin-bottom:0">微信公众号同步更新，欢迎关注~</p></li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/%E5%A5%BD%E5%A5%BD%E5%AD%A6Linux/" rel="tag"># 好好学Linux</a> <a href="/tags/ubuntu/" rel="tag"># ubuntu</a> <a href="/tags/libvirt/" rel="tag"># libvirt</a> <a href="/tags/virsh/" rel="tag"># virsh</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-docker-dolphinscheduler/" rel="prev" title="好好学Docker：Docker安装配置DolphinScheduler"><i class="fa fa-chevron-left"></i> 好好学Docker：Docker安装配置DolphinScheduler</a></div><div class="post-nav-item"> <a href="/dev-hexo-github-actions/" rel="next" title="好好学Hexo：Hexo配置GitHub Actions自动构建发布">好好学Hexo：Hexo配置GitHub Actions自动构建发布<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3284447971731414" data-ad-slot="9697986181"></ins><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">1. 前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%95%E7%BD%91%E5%8D%A1%E9%9D%99%E6%80%81IP%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95"><span class="nav-text">2. 单网卡静态IP配置方法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A4%9A%E7%BD%91%E5%8D%A1%E9%9D%99%E6%80%81IP%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95"><span class="nav-text">3. 多网卡静态IP配置方法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9A%E5%8D%95%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE"><span class="nav-text">3.1. 配置方法一：单文件配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A%E5%A4%9A%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE"><span class="nav-text">3.2. 配置方法二：多文件配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%B4%E6%97%B6%E9%85%8D%E7%BD%AE%E5%9B%BA%E5%AE%9AIP"><span class="nav-text">4. 临时配置固定IP</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E9%BB%98%E8%AE%A4%E7%BD%91%E5%85%B3"><span class="nav-text">5. 配置默认网关</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%EF%BC%9A%E7%A6%81%E7%94%A8%E5%92%8C%E5%90%AF%E7%94%A8%E6%8C%87%E5%AE%9A%E7%9A%84%E7%BD%91%E5%8D%A1"><span class="nav-text">6. 扩展：禁用和启用指定的网卡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%B4%E6%97%B6%E7%A6%81%E7%94%A8%E5%92%8C%E5%90%AF%E7%94%A8"><span class="nav-text">6.1. 临时禁用和启用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B0%B8%E4%B9%85%E7%A6%81%E7%94%A8%E5%92%8C%E5%90%AF%E7%94%A8"><span class="nav-text">6.2. 永久禁用和启用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8Enetplan%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%89"><span class="nav-text">6.2.1. 基于netplan（推荐）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8Einterfaces"><span class="nav-text">6.2.2. 基于interfaces</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8Einitramfs"><span class="nav-text">6.2.3. 基于initramfs</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%EF%BC%9ANetplan-%E5%92%8C-NetworkManager%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-text">7. 扩展：Netplan 和 NetworkManager的关系</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E9%9D%99%E6%80%81IP%E6%97%A0%E6%95%88%E9%97%AE%E9%A2%98"><span class="nav-text">8. 设置静态IP无效问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="nav-text">8.1. 问题描述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E8%A7%A3%E5%86%B3"><span class="nav-text">8.2. 问题排查解决</span></a></li></ol></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">一个计算机技术爱好者与学习者</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">723</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">31</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">254</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: '072539ca374e8eaee5d5d6f948f764ab',
      title: '好好学Linux：Ubuntu18配置静态IP',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>