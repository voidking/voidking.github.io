<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言《Ubuntu16使用Kolla安装OpenStack》一文中，使用kolla安装了单节点的openstack。 在实际的部署中，当然要安装多节点的openstack，本文就来研究一下在多个节点上使用kolla安装部署openstack的方法。"><meta property="og:type" content="article"><meta property="og:title" content="Kolla安装OpenStack多节点"><meta property="og:url" content="https://www.voidking.com/dev-ubuntu16-kolla-openstack-multinode/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言《Ubuntu16使用Kolla安装OpenStack》一文中，使用kolla安装了单节点的openstack。 在实际的部署中，当然要安装多节点的openstack，本文就来研究一下在多个节点上使用kolla安装部署openstack的方法。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-all-in-one/dockerinfo.jpg?imageView2/0/w/650"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/pingall.jpg?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-all-in-one/globals.jpg?imageView2/0/w/650"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/check.jpg?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/deploy.jpg?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/compute.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/network.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/init.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/server.jpg?imageView2/0/w/650"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/curl.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/dashboard.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/netns.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/ping.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/ping2.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/ssh.jpg?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/ping3.jpg?imageView2/0/w/600"><meta property="article:published_time" content="2018-08-13T09:00:00.000Z"><meta property="article:modified_time" content="2018-08-13T09:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="docker"><meta property="article:tag" content="linux"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="ansible"><meta property="article:tag" content="openstack"><meta property="article:tag" content="kolla"><meta property="article:tag" content="sshpass"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-all-in-one/dockerinfo.jpg?imageView2/0/w/650"><link rel="canonical" href="https://www.voidking.com/dev-ubuntu16-kolla-openstack-multinode/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Kolla安装OpenStack多节点 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-ubuntu16-kolla-openstack-multinode/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Kolla安装OpenStack多节点</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-08-13 09:00:00" itemprop="dateCreated datePublished" datetime="2018-08-13T09:00:00+00:00">2018-08-13</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><a href="https://www.voidking.com/dev-ubuntu16-kolla-openstack-all-in-one/">《Ubuntu16使用Kolla安装OpenStack》</a>一文中，使用kolla安装了单节点的openstack。</p><p>在实际的部署中，当然要安装多节点的openstack，本文就来研究一下在多个节点上使用kolla安装部署openstack的方法。</p><a id="more"></a><h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>VirtualBox虚拟机三台，系统为ubuntu-16.04.4-server-amd64，分别作为控制节点、网络节点和计算节点，用户名为voidking/root，密码为voidking。<br>控制节点4核8G内存40G存储，主机名为controller，eth0的IP为192.168.56.110，eth1为nat上网网卡，eth2为neutron服务网络。<br>网络节点2核4G内存40G存储，主机名为network，eth0的IP为192.168.56.111，eth1为nat上网网卡，eth2为neutron服务网络。<br>计算节点2核4G内存40G存储，主机名为compute，eth0的IP为192.168.56.112，eth1为nat上网网卡，eth2为neutron服务网络。</p><h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><h2 id="网络设置"><a href="#网络设置" class="headerlink" title="网络设置"></a>网络设置</h2><p>在控制节点上，执行以下操作：</p><p>1、切换到root用户<br><code>sudo -i</code></p><p>2、<code>vim /etc/network/interfaces</code>，设置网卡为：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This file describes the network interfaces available on your system</span></span><br><span class="line"><span class="comment"># and how to activate them. For more information, see interfaces(5).</span></span><br><span class="line"></span><br><span class="line"><span class="attr">source</span> <span class="string">/etc/network/interfaces.d/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The loopback network interface</span></span><br><span class="line"><span class="attr">auto</span> <span class="string">lo</span></span><br><span class="line"><span class="attr">iface</span> <span class="string">lo inet loopback</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The primary network interface</span></span><br><span class="line"><span class="attr">auto</span> <span class="string">eth0</span></span><br><span class="line"><span class="attr">iface</span> <span class="string">eth0 inet static</span></span><br><span class="line"><span class="attr">address</span> <span class="string">192.168.56.110</span></span><br><span class="line"><span class="attr">netmask</span> <span class="string">255.255.255.0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">auto</span> <span class="string">eth1</span></span><br><span class="line"><span class="attr">iface</span> <span class="string">eth1 inet dhcp</span></span><br><span class="line"></span><br><span class="line"><span class="attr">auto</span> <span class="string">eth2</span></span><br><span class="line"><span class="attr">iface</span> <span class="string">eth2 inet manual</span></span><br><span class="line"><span class="attr">up</span> <span class="string">ifconfig $IFACE 0.0.0.0 up</span></span><br><span class="line"><span class="attr">up</span> <span class="string">ifconfig $IFACE promisc</span></span><br></pre></td></tr></table></figure><p>3、启用网卡<br><code>ifup eth2</code></p><p>4、修改/etc/hosts，添加：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192.168.56.110</span>  controller</span><br><span class="line"><span class="number">192.168.56.111</span>  network</span><br><span class="line"><span class="number">192.168.56.112</span>  compute</span><br></pre></td></tr></table></figure><p>网络节点和计算节点参考控制节点配置即可。<br>需要注意的是，hosts文件在OpenStack安装完成后会被ansible修改，建议保留ansible创建的那一份，原因参考<a href="https://www.voidking.com/dev-openstack-compute-node-broken/">《OpenStack计算节点的奇葩问题》</a>。</p><h2 id="python"><a href="#python" class="headerlink" title="python"></a>python</h2><p>在三台机器上安装python<br><code>sudo apt -y install python-simplejson</code><br>不安装的话，在使用ansible的时候会报错/bin/sh: 1: /usr/bin/python: not found。</p><h2 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h2><p>1、在三台机器上安装docker<br><code>curl -SSL https://get.docker.io | bash</code></p><p>或者：<br><code>apt install docker.io</code></p><p>2、为docker和kolla创建配置文件</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -<span class="keyword">p</span> /etc/systemd/<span class="built_in">system</span>/docker.service.d</span><br><span class="line"><span class="keyword">vim</span> /etc/systemd/<span class="built_in">system</span>/docker.service.d/kolla.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure><p>修改为：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">MountFlags</span>=shared</span><br></pre></td></tr></table></figure><p>3、重启docker</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">systemctl</span> <span class="string">daemon-reload</span></span><br><span class="line"><span class="attr">systemctl</span> <span class="string">restart docker</span></span><br></pre></td></tr></table></figure><p>4、查看docker信息<br><code>docker info</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-all-in-one/dockerinfo.jpg?imageView2/0/w/650" alt=""></p><p>如果报错的话，参考<a href="https://www.voidking.com/dev-ubuntu16-kolla-openstack-all-in-one/">《Ubuntu16使用Kolla安装OpenStack》</a>解决。</p><h2 id="加速镜像拉取"><a href="#加速镜像拉取" class="headerlink" title="加速镜像拉取"></a>加速镜像拉取</h2><p>使用 Docker 的时候，需要经常从官方获取镜像，但是由于显而易见的网络原因，拉取镜像的过程非常耗时，严重影响使用 Docker 的体验。因此DaoCloud推出了加速器工具解决这个难题，通过智能路由和缓存机制，极大提升了国内网络访问 Docker Hub 的速度，目前已经拥有了广泛的用户群体，并得到了 Docker 官方的大力推荐。</p><p>1、访问<a href="https://www.daocloud.io" target="_blank" rel="noopener">DaoCloud官网</a>，注册一个账号。</p><p>2、访问<a href="https://www.daocloud.io/mirror#accelerator-doc" target="_blank" rel="noopener">配置 Docker 加速器</a>，可以获得一个专属加速地址（每次访问都会获得不同的地址）。</p><p>3、参考<a href="http://guide.daocloud.io/dcs/daocloud-9153151.html" target="_blank" rel="noopener">Docker 加速器</a>，创建或修改 /etc/docker/daemon.json，内容为：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"registry-mirrors"</span>: [</span><br><span class="line">        <span class="string">"http://2fd0f33c.m.daocloud.io"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"insecure-registries"</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4、重启docker</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">systemctl</span> <span class="string">daemon-reload</span></span><br><span class="line"><span class="attr">systemctl</span> <span class="string">restart docker</span></span><br></pre></td></tr></table></figure><p>PS：也可以使用阿里云的<a href="https://cr.console.aliyun.com/#/accelerator" target="_blank" rel="noopener">镜像加速器</a>。</p><h2 id="密钥登录"><a href="#密钥登录" class="headerlink" title="密钥登录"></a>密钥登录</h2><p>1、在控制节点生成密钥<br><code>ssh-keygen</code>，连续回车即可。</p><p>2、将公钥写入三台机器</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -i .ssh/id_rsa.pub -p <span class="number">22</span> <span class="built_in">void</span><span class="symbol">king@</span><span class="number">192.168</span><span class="number">.56</span><span class="number">.110</span></span><br><span class="line">ssh-copy-id -i .ssh/id_rsa.pub -p <span class="number">22</span> <span class="built_in">void</span><span class="symbol">king@</span><span class="number">192.168</span><span class="number">.56</span><span class="number">.111</span></span><br><span class="line">ssh-copy-id -i .ssh/id_rsa.pub -p <span class="number">22</span> <span class="built_in">void</span><span class="symbol">king@</span><span class="number">192.168</span><span class="number">.56</span><span class="number">.112</span></span><br></pre></td></tr></table></figure><p>3、在三台机器把voidking用户添加进sudo免密，方便以后的操作<br><code>sudo vim /etc/sudoers</code>，添加</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">voidking <span class="keyword">ALL</span> = NOPASSWD: <span class="keyword">ALL</span></span><br></pre></td></tr></table></figure><h1 id="控制节点"><a href="#控制节点" class="headerlink" title="控制节点"></a>控制节点</h1><p>主要参考<a href="https://elatov.github.io/2018/01/openstack-ansible-and-kolla-on-ubuntu-1604/" target="_blank" rel="noopener">OpenStack, Ansible, and Kolla on Ubuntu 16.04</a>、<a href="https://www.lijiawang.org/posts/kolla%20queens%20on%20centos7.41.html" target="_blank" rel="noopener">kolla queens on centos7.4</a>和<a href="https://docs.openstack.org/kolla-ansible/latest/" target="_blank" rel="noopener">Kolla-Ansible’s documentation!</a>。</p><h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><p>1、安装并升级pip</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-get <span class="keyword">update</span></span><br><span class="line">apt-<span class="keyword">get</span> <span class="keyword">install</span> python-pip</span><br><span class="line">pip <span class="keyword">install</span> <span class="comment">--upgrade pip</span></span><br></pre></td></tr></table></figure><p>2、安装依赖<br><code>apt-get -y install python-dev libffi-dev gcc libssl-dev python-selinux</code></p><p>3、安装ansible</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="built_in">get</span> install software-properties-common</span><br><span class="line">apt-<span class="built_in">add</span>-repository <span class="keyword">pp</span><span class="variable">a:ansible</span>/ansible</span><br><span class="line">apt-<span class="built_in">get</span> <span class="keyword">update</span></span><br><span class="line">apt-<span class="built_in">get</span> install ansible</span><br></pre></td></tr></table></figure><p>4、<code>vim /etc/ansible/ansible.cfg</code>，添加如下：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">line 10, add</span><br><span class="line">[defaults]</span><br><span class="line"><span class="attribute">host_key_checking</span>=<span class="literal">False</span></span><br><span class="line"><span class="attribute">pipelining</span>=<span class="literal">True</span></span><br><span class="line"><span class="attribute">forks</span>=100</span><br></pre></td></tr></table></figure><h2 id="安装Kolla-ansible"><a href="#安装Kolla-ansible" class="headerlink" title="安装Kolla-ansible"></a>安装Kolla-ansible</h2><p>1、安装kolla-ansible<br><code>pip install kolla-ansible</code></p><p>报错：ImportError: cannot import name main，参考<a href="https://blog.csdn.net/accumulate_zhang/article/details/80269313" target="_blank" rel="noopener">升级pip后出现ImportError: cannot import name main</a>，编辑/usr/bin/pip文件，如下修改：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># line 9, change</span></span><br><span class="line">from pip import __main__</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    sys.<span class="keyword">exit</span>(__main__._main())</span><br></pre></td></tr></table></figure><p>报红：oslo-config 6.4.0 has requirement PyYAML&gt;=3.12, but you’ll have pyyaml 3.11 which is incompatible.忽略。</p><p>2、拷贝globals.yml和passwords.yml到/etc/kolla目录<br><code>cp -r /usr/local/share/kolla-ansible/etc_examples/kolla /etc/</code></p><p>3、拷贝all-in-one和multinode清单文件到当前目录<br><code>cp /usr/local/share/kolla-ansible/ansible/inventory/* .</code></p><p>4、生成kolla密码<br><code>kolla-genpwd</code><br>我们部署中使用的密码存储在/etc/kolla/passwords.yml文件中。此文件中的所有密码都是空白的，必须手动填写或运行随机密码生成器。</p><p>5、配置multinode文件<br><code>vim multinode</code>，如下修改：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># line 3, change</span></span><br><span class="line">[control]</span><br><span class="line">192.168.56.110 <span class="attribute">ansible_ssh_user</span>=voidking <span class="attribute">ansible_ssh_pass</span>=voidking <span class="attribute">ansible_sudo</span>=voidking <span class="attribute">ansible_sudo_pass</span>=voidking <span class="attribute">ansible_become_user</span>=root <span class="attribute">ansible_become_pass</span>=voidking <span class="attribute">ansible_become</span>=<span class="literal">true</span></span><br><span class="line"><span class="comment"># line 12, change</span></span><br><span class="line">[network]</span><br><span class="line">192.168.56.111 <span class="attribute">ansible_ssh_user</span>=voidking <span class="attribute">ansible_ssh_pass</span>=voidking <span class="attribute">ansible_sudo</span>=voidking <span class="attribute">ansible_sudo_pass</span>=voidking <span class="attribute">ansible_become_user</span>=root <span class="attribute">ansible_become_pass</span>=voidking <span class="attribute">ansible_become</span>=<span class="literal">true</span></span><br><span class="line"><span class="comment"># line 17, change</span></span><br><span class="line">[inner-compute]</span><br><span class="line">192.168.56.112 <span class="attribute">ansible_ssh_user</span>=voidking <span class="attribute">ansible_ssh_pass</span>=voidking <span class="attribute">ansible_sudo</span>=voidking <span class="attribute">ansible_sudo_pass</span>=voidking <span class="attribute">ansible_become_user</span>=root <span class="attribute">ansible_become_pass</span>=voidking <span class="attribute">ansible_become</span>=<span class="literal">true</span></span><br><span class="line"><span class="comment"># line 21, change</span></span><br><span class="line">[external-compute]</span><br><span class="line">192.168.56.112 <span class="attribute">ansible_ssh_user</span>=voidking <span class="attribute">ansible_ssh_pass</span>=voidking <span class="attribute">ansible_sudo</span>=voidking <span class="attribute">ansible_sudo_pass</span>=voidking <span class="attribute">ansible_become_user</span>=root <span class="attribute">ansible_become_pass</span>=voidking <span class="attribute">ansible_become</span>=<span class="literal">true</span></span><br><span class="line"><span class="comment"># line 28, comment</span></span><br><span class="line">[monitoring]</span><br><span class="line"><span class="comment">#monitoring01</span></span><br><span class="line"><span class="comment"># line 36, comment</span></span><br><span class="line">[storage]</span><br><span class="line"><span class="comment">#storage01</span></span><br></pre></td></tr></table></figure><p>6、测试连通<br><code>ansible -i multinode -m ping all</code><br>报错：ERROR! to use the ‘ssh’ connection type with passwords, you must install the sshpass program<br>安装sshpass：<code>apt install sshpass</code><br>然后重新测试连通。<br><img src="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/pingall.jpg?imageView2/0/w/600" alt=""></p><h2 id="配置globals-yml"><a href="#配置globals-yml" class="headerlink" title="配置globals.yml"></a>配置globals.yml</h2><p>1、查看globals.yml配置<br><code>grep -vE &#39;^$|^#&#39; /etc/kolla/globals.yml</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-all-in-one/globals.jpg?imageView2/0/w/650" alt=""></p><p>2、<code>vim /etc/kolla/globals.yml</code>，如下修改：</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># line 15,uncomment</span></span><br><span class="line"><span class="symbol">kolla_base_distro:</span> <span class="string">"centos"</span></span><br><span class="line"><span class="meta"># line 18,uncomment</span></span><br><span class="line"><span class="symbol">kolla_install_type:</span> <span class="string">"binary"</span></span><br><span class="line"><span class="meta"># line 21,uncomment and change</span></span><br><span class="line"><span class="symbol">openstack_release:</span> <span class="string">"queens"</span></span><br><span class="line"><span class="meta"># line 31,change</span></span><br><span class="line"><span class="symbol">kolla_internal_vip_address:</span> <span class="string">"192.168.56.120"</span></span><br><span class="line"><span class="meta"># line 85,uncomment and change</span></span><br><span class="line"><span class="symbol">network_interface:</span> <span class="string">"eth0"</span></span><br><span class="line"><span class="meta"># line 100,uncomment and change</span></span><br><span class="line"><span class="symbol">neutron_external_interface:</span> <span class="string">"eth2"</span></span><br><span class="line"><span class="meta"># line 331,uncomment</span></span><br><span class="line"><span class="symbol">designate_backend:</span> <span class="string">"bind9"</span></span><br><span class="line"><span class="symbol">designate_ns_record:</span> <span class="string">"sample.openstack.org"</span></span><br><span class="line"><span class="meta"># line 340,uncomment and change</span></span><br><span class="line"><span class="symbol">nova_compute_virt_type:</span> <span class="string">"qemu"</span></span><br><span class="line"><span class="meta"># other</span></span><br><span class="line"><span class="symbol">tempest_image_id:</span></span><br><span class="line"><span class="symbol">tempest_flavor_ref_id:</span></span><br><span class="line"><span class="symbol">tempest_public_network_id:</span></span><br><span class="line"><span class="symbol">tempest_floating_network_name:</span></span><br></pre></td></tr></table></figure><p>kolla_internal_vip_address为192.168.56.120，它是一个和OpenStack宿主机内网连接网络（eth0 192.168.56.110）同一个网段的未使用IP。network_interface为eth0，意思是openstack内部网络使用eth0网卡。neutron_external_interface为eth2，意思是openstack的虚拟机外部网络使用eth2网卡。因为是在虚拟机中安装openstack，所以nova_compute_virt_type设置为qemu。</p><p>PS：实际上，kolla_internal_vip_address最好设置为192.168.56.110，原因参考<a href="https://www.voidking.com/dev-openstack-compute-node-broken/">《OpenStack计算节点的奇葩问题》</a>。</p><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p>1、初始化<br><code>kolla-ansible -i ./multinode bootstrap-servers</code><br>时间很久，请耐心等待。</p><p>2、预检查<br><code>kolla-ansible -i ./multinode prechecks</code></p><p><img src="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/check.jpg?imageView2/0/w/600" alt=""></p><p>3、拉取镜像<br><code>kolla-ansible -i ./multinode pull</code><br>这一步的时间特别久，挺耐心等待。如果拉取失败，就多尝试几次。<br>这里郝同学取巧一下，直接把<a href="https://www.voidking.com/dev-ubuntu16-kolla-openstack-all-in-one/">《Ubuntu16使用Kolla安装OpenStack》</a>一文中的images拷贝到控制节点、网络节点和计算节点。</p><p>（1）打包所有images<br><code>docker save $(docker images | grep -v REPOSITORY | awk &#39;BEGIN{OFS=&quot;:&quot;;ORS=&quot; &quot;}{print $1,$2}&#39;) -o kolla.tar</code></p><p>（2）导入所有images<br><code>docker load -i kolla.tar</code></p><p>4、查看镜像<br><code>docker images</code></p><p>5、部署<br><code>kolla-ansible -i ./multinode deploy</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/deploy.jpg?imageView2/0/w/600" alt=""></p><h1 id="测试使用openstack"><a href="#测试使用openstack" class="headerlink" title="测试使用openstack"></a>测试使用openstack</h1><p>1、在控制节点安装openstack客户端<br><code>pip install python-openstackclient python-glanceclient python-neutronclient --ignore-installed</code></p><p>2、生成admin-openrc.sh等<br><code>kolla-ansible post-deploy</code></p><p>3、使admin环境生效<br><code>source /etc/kolla/admin-openrc.sh</code></p><p>4、查看计算服务<br><code>openstack compute service list</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/compute.jpg?imageView2/0/w/750" alt=""></p><p>5、查看网络服务<br><code>openstack network agent list</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/network.jpg?imageView2/0/w/750" alt=""></p><h1 id="初始化配置"><a href="#初始化配置" class="headerlink" title="初始化配置"></a>初始化配置</h1><p>1、执行init-runonce脚本<br><code>. /usr/local/share/kolla-ansible/init-runonce</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/init.jpg?imageView2/0/w/750" alt=""></p><p>执行初始化之前，可以参考<a href="http://blog.51cto.com/yuweibing/1981189?cid=702783" target="_blank" rel="noopener">openstack 之 Kolla部署指南</a>，设置一下外部网络。这样，就可以从路由器给虚拟机分配IP，安装完虚拟机就可以宿主机互相ping通。比如：</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXT_NET_CIDR='<span class="number">192.168</span><span class="number">.56</span><span class="number">.0</span>/<span class="number">24</span>'</span><br><span class="line">EXT_NET_RANGE='start=<span class="number">192.168</span><span class="number">.56</span><span class="number">.200</span>,end=<span class="number">192.168</span><span class="number">.56</span><span class="number">.240</span>'</span><br><span class="line">EXT_NET_GATEWAY='<span class="number">192.168</span><span class="number">.56</span><span class="number">.1</span>'</span><br></pre></td></tr></table></figure><p>这里配置的网络范围，对应globals.yml中配置的neutron_external_interface，也就是eth2网卡。</p><p>2、根据提示，创建实例</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">openstack<span class="built_in"> server </span>create \</span><br><span class="line">    --image cirros \</span><br><span class="line">    --flavor m1.tiny \</span><br><span class="line">    --key-name mykey \</span><br><span class="line">    --nic <span class="attribute">net-id</span>=25e6c0ef-6a0a-481c-a08a-46f7ef67ad3e \</span><br><span class="line">    demo1</span><br></pre></td></tr></table></figure><p>3、给demo1实例分配浮动IP</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">source /etc/kolla/admin-openrc.sh</span><br><span class="line">openstack<span class="built_in"> network </span>list</span><br><span class="line">openstack floating<span class="built_in"> ip </span>create public1</span><br><span class="line">openstack<span class="built_in"> server </span><span class="builtin-name">add</span> floating<span class="built_in"> ip </span>demo1 10.0.2.157</span><br></pre></td></tr></table></figure><p>4、查看demo1<br><code>openstack server list</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/server.jpg?imageView2/0/w/650" alt=""></p><p>5、访问horizon服务<br><code>curl 192.168.56.120 -L</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/curl.jpg?imageView2/0/w/750" alt=""></p><p>在浏览器访问 <a href="http://192.168.56.120" target="_blank" rel="noopener">http://192.168.56.120</a> ，使用admin账号登录，密码在passwords.yml文件中查看。<br><code>less /etc/kolla/passwords.yml | grep keystone_admin_password</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/dashboard.jpg?imageView2/0/w/700" alt=""></p><p>至此，使用kolla安装部署多节点openstack成功。</p><h1 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h1><h2 id="网络节点"><a href="#网络节点" class="headerlink" title="网络节点"></a>网络节点</h2><p>关于网络的配置，主要参考<a href="https://www.voidking.com/dev-kolla-instance-network/">Kolla配置实例网络</a>。</p><p>1、在网络节点编辑/etc/network/interfaces，添加：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">auto br-ex</span><br><span class="line">iface br-ex inet static</span><br><span class="line">address 10.0.2.1</span><br><span class="line">netmask 255.255.255.0</span><br></pre></td></tr></table></figure><p>2、启用br-ex<br><code>ifup br-ex</code></p><p>3、添加路由</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ip netns</span><br><span class="line">ip netns exec qrouter-9dbabbdd-cc45-42c3-b9e0-9dbbc03e66f1<span class="built_in"> ip </span>add</span><br><span class="line">route <span class="builtin-name">add</span> -net 10.0.0.0/24 gw 10.0.2.153 dev br-ex</span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/netns.jpg?imageView2/0/w/700" alt=""></p><p>重启后路由失效，如果想要永久生效，那就在/etc/network/interfaces文件的尾部添加：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">up<span class="built_in"> route </span><span class="builtin-name">add</span> -net 10.0.0.0/24 gw 10.0.2.153 dev br-ex</span><br></pre></td></tr></table></figure><p>4、在网络节点连通demo1</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping 10.0.2.157 -c3</span><br><span class="line">ping 10.0.0.3 -c3</span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/ping.jpg?imageView2/0/w/700" alt=""></p><p>5、设置demo1上网</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iptables -I INPUT -i eth2 -j ACCEPT</span><br><span class="line">iptables -I INPUT -i br-ex -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-A POSTROUTING -s 10.0.2.0/24 -o eth1 -j MASQUERADE</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-A POSTROUTING -s 10.0.0.0/24 -o eth1 -j MASQUERADE</span><br></pre></td></tr></table></figure><p>设置永久生效参考<a href="https://www.voidking.com/dev-linux-snat/">《Linux配置SNAT上网》</a>。</p><h2 id="控制节点-1"><a href="#控制节点-1" class="headerlink" title="控制节点"></a>控制节点</h2><p>1、添加路由<br><code>route add -net 10.0.2.0/24 gw 192.168.56.110 dev eth0</code><br>同样的，想要路由永久生效，也要添加到interfaces文件的尾部。</p><p>2、在控制节点连通demo1<br><code>ping 10.0.2.157 -c3</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/ping2.jpg?imageView2/0/w/700" alt=""></p><p>3、连接demo1<br><code>ssh cirros@10.0.2.157</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/ssh.jpg?imageView2/0/w/600" alt=""></p><p>4、测试外网连通<br><code>ping 8.8.8.8 -c3</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-kolla-openstack-multinode/ping3.jpg?imageView2/0/w/600" alt=""></p><h1 id="清除OpenStack"><a href="#清除OpenStack" class="headerlink" title="清除OpenStack"></a>清除OpenStack</h1><p>安装OpenStack，会对宿主机的网络有很大的影响。安装完成后，如果网络瘫痪，不要怕，还有补救措施：清除已经安装部署的OpenStack环境，然后重新配置，重新部署。<br>清除OpenStack的命令如下：<br><code>kolla-ansible destroy -i ./multinode --yes-i-really-really-mean-it</code></p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>本文的网络设置不合理，但是也能正常使用。因为已经安装部署完成，所以就不再更改了，在此做一下补充说明。<br>本文中eth0作为管理网卡，eth1作为上网网卡，eth0作为OpenStack宿主机间的内网网卡，eth2作为OpenStack的虚拟机外网网卡。这里eth0复用了，既作为管理网卡，又作为OpenStack内网网卡。更好的做法是，再添加一块网卡作为OpenStack的内网网卡，使每个网卡只有一个职责。</p><p>在物理机中安装OpenStack的话，可以参考<a href="https://www.voidking.com/dev-ubuntu16-manual-openstack-neutron/">《Ubuntu16手动安装OpenStack——neutron篇》</a>。控制节点一个网卡，用来上网和管理；网络节点三个网卡，一张用来上网和管理，一张用来OpenStack宿主机内网连接，一张用来OpenStack虚拟机外网连接；计算节点两个网卡，一张用来上网和管理，一张用来OpenStack宿主机内网连接。</p><p>还有，在物理机安装OpenStack时，要关闭其他虚拟化工具，比如VirtualBox或者VMware，否则会无法创建实例，查看日志<code>tail -n 20 /var/lib/docker/volumes/kolla_logs/_data/nova/nova-compute.log</code>，出现<a href="https://www.agix.com.au/kvm-error-ioctlkvm_create_vm-failed-16-device-or-resource-busy/" target="_blank" rel="noopener">KVM Error – ioctl(KVM_CREATE_VM) failed: 16 Device or Resource busy</a>问题。</p><h1 id="书签"><a href="#书签" class="headerlink" title="书签"></a>书签</h1><p><a href="https://docs.openstack.org/kolla/latest/" target="_blank" rel="noopener">Kolla’s documentation!</a></p><p><a href="https://www.imooc.com/article/31896" target="_blank" rel="noopener">Kolla让OpenStack部署更贴心</a></p><p><a href="http://www.chenshake.com/kolla-installation/" target="_blank" rel="noopener">Kolla安装Ocata单节点</a></p><p><a href="https://wenku.baidu.com/view/94fe6479ef06eff9aef8941ea76e58fafab045d7.html" target="_blank" rel="noopener">kolla部署openstack ocata版</a></p><p><a href="https://blog.inkubate.io/install-and-configure-openstack-ocata-with-kolla-as-a-standalone/" target="_blank" rel="noopener">Install and configure OpenStack Ocata with Kolla as a standalone</a></p><p><a href="http://edu.51cto.com/course/13250.html" target="_blank" rel="noopener">Kolla OpenStack系统视频课程</a></p><p><a href="https://www.xpv.cn/html/kolla-openstack-pike.html" target="_blank" rel="noopener">利用kolla快速搭建openstack-pike多节点</a></p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-ubuntu16-kolla-openstack-multinode/" title="Kolla安装OpenStack多节点">https://www.voidking.com/dev-ubuntu16-kolla-openstack-multinode/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/docker/" rel="tag"># docker</a> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/ubuntu/" rel="tag"># ubuntu</a> <a href="/tags/ansible/" rel="tag"># ansible</a> <a href="/tags/openstack/" rel="tag"># openstack</a> <a href="/tags/kolla/" rel="tag"># kolla</a> <a href="/tags/sshpass/" rel="tag"># sshpass</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-ansible-in-action/" rel="prev" title="Ansible实战"><i class="fa fa-chevron-left"></i> Ansible实战</a></div><div class="post-nav-item"> <a href="/dev-frp/" rel="next" title="使用frp进行内网穿透">使用frp进行内网穿透<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#环境"><span class="nav-number">2.</span> <span class="nav-text">环境</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#准备"><span class="nav-number">3.</span> <span class="nav-text">准备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#网络设置"><span class="nav-number">3.1.</span> <span class="nav-text">网络设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python"><span class="nav-number">3.2.</span> <span class="nav-text">python</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装docker"><span class="nav-number">3.3.</span> <span class="nav-text">安装docker</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#加速镜像拉取"><span class="nav-number">3.4.</span> <span class="nav-text">加速镜像拉取</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#密钥登录"><span class="nav-number">3.5.</span> <span class="nav-text">密钥登录</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#控制节点"><span class="nav-number">4.</span> <span class="nav-text">控制节点</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#安装依赖"><span class="nav-number">4.1.</span> <span class="nav-text">安装依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装Kolla-ansible"><span class="nav-number">4.2.</span> <span class="nav-text">安装Kolla-ansible</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置globals-yml"><span class="nav-number">4.3.</span> <span class="nav-text">配置globals.yml</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#部署"><span class="nav-number">4.4.</span> <span class="nav-text">部署</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#测试使用openstack"><span class="nav-number">5.</span> <span class="nav-text">测试使用openstack</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#初始化配置"><span class="nav-number">6.</span> <span class="nav-text">初始化配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#网络配置"><span class="nav-number">7.</span> <span class="nav-text">网络配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#网络节点"><span class="nav-number">7.1.</span> <span class="nav-text">网络节点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#控制节点-1"><span class="nav-number">7.2.</span> <span class="nav-text">控制节点</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#清除OpenStack"><span class="nav-number">8.</span> <span class="nav-text">清除OpenStack</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#后记"><span class="nav-number">9.</span> <span class="nav-text">后记</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#书签"><span class="nav-number">10.</span> <span class="nav-text">书签</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">628</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">31</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">231</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>