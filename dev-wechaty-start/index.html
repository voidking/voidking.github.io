<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//qiniu.cdn.voidking.com/doc/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="Wechaty简介 Wechaty 是一个开源聊天机器人框架SDK，具有高度封装、高可用的特性，支持NodeJs, Python, Go 和Java 等多语言版本。在过去的4年中，服务了数万名开发者，收获了 Github 的 1w+ Star。同时配置了完整的 DevOps 体系并持续按照 Apache 的方式管理技术社区。  参考文档：  github - wechaty&#x2F;getting-sta"><meta property="og:type" content="article"><meta property="og:title" content="Wechaty入门篇"><meta property="og:url" content="https://www.voidking.com/dev-wechaty-start/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="Wechaty简介 Wechaty 是一个开源聊天机器人框架SDK，具有高度封装、高可用的特性，支持NodeJs, Python, Go 和Java 等多语言版本。在过去的4年中，服务了数万名开发者，收获了 Github 的 1w+ Star。同时配置了完整的 DevOps 体系并持续按照 Apache 的方式管理技术社区。  参考文档：  github - wechaty&#x2F;getting-sta"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.voidking.com/imgs/wechaty-start/gateway.png?imageView2/0/w/800"><meta property="og:image" content="https://cdn.voidking.com/imgs/wechaty-start/check-gateway.png?imageView2/0/w/800"><meta property="og:image" content="https://cdn.voidking.com/imgs/wechaty-start/error.png?imageView2/0/w/800"><meta property="og:image" content="https://cdn.voidking.com/imgs/wechaty-start/qrcode.png?imageView2/0/w/800"><meta property="og:image" content="https://cdn.voidking.com/imgs/wechaty-start/logout.png?imageView2/0/w/800"><meta property="og:image" content="https://cdn.voidking.com/imgs/wechaty-start/paimon-login.png?imageView2/0/w/800"><meta property="og:image" content="https://cdn.voidking.com/imgs/wechaty-start/ding.png?imageView2/0/w/800"><meta property="og:image" content="https://cdn.voidking.com/imgs/wechaty-start/result.png?imageView2/0/w/800"><meta property="article:published_time" content="2023-08-05T08:00:00.000Z"><meta property="article:modified_time" content="2023-08-05T08:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="python"><meta property="article:tag" content="docker"><meta property="article:tag" content="微信"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.voidking.com/imgs/wechaty-start/gateway.png?imageView2/0/w/800"><link rel="canonical" href="https://www.voidking.com/dev-wechaty-start/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Wechaty入门篇 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">一个计算机技术爱好者与学习者</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-wechaty-start/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="一个计算机技术爱好者与学习者"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Wechaty入门篇</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-08-05 08:00:00" itemprop="dateCreated datePublished" datetime="2023-08-05T08:00:00+00:00">2023-08-05</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="Wechaty简介"><span class="post-title-index">1.</span><a href="#Wechaty简介" class="headerlink" title="Wechaty简介"></a> Wechaty简介</h1><blockquote><p>Wechaty 是一个开源聊天机器人框架SDK，具有高度封装、高可用的特性，支持NodeJs, Python, Go 和Java 等多语言版本。在过去的4年中，服务了数万名开发者，收获了 Github 的 1w+ Star。同时配置了完整的 DevOps 体系并持续按照 Apache 的方式管理技术社区。</p></blockquote><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://github.com/wechaty/getting-started">github - wechaty/getting-started</a></li><li><a target="_blank" rel="noopener" href="https://github.com/Wechaty/python-wechaty">github - Wechaty/python-wechaty</a></li><li><a target="_blank" rel="noopener" href="https://github.com/wechaty/python-wechaty-template">github - wechaty/python-wechaty-template</a></li><li><a target="_blank" rel="noopener" href="https://github.com/wechaty/python-wechaty-getting-started/">github - wechaty/python-wechaty-getting-started</a></li><li><a target="_blank" rel="noopener" href="https://github.com/wechaty/docker-getting-started">github - wechaty/docker-getting-started</a></li><li><a target="_blank" rel="noopener" href="https://github.com/juzibot/Welcome/wiki/Everything-about-Wechaty">Everything about Wechaty</a></li><li><a target="_blank" rel="noopener" href="https://wechaty.readthedocs.io/zh_CN/latest/">python-wechaty首页</a></li><li><a target="_blank" rel="noopener" href="https://wechaty.readthedocs.io/zh_CN/latest/introduction/use-padlocal-protocol/">使用Padlocal协议</a></li><li><a target="_blank" rel="noopener" href="https://github.com/wechaty/puppet-padlocal">github - wechaty/puppet-padlocal</a></li><li><a target="_blank" rel="noopener" href="https://wechaty.readthedocs.io/zh_CN/latest/introduction/use-paimon-protocol/">使用Paimon协议</a></li></ul><span id="more"></span><h1 id="Wechaty核心概念"><span class="post-title-index">2.</span><a href="#Wechaty核心概念" class="headerlink" title="Wechaty核心概念"></a> Wechaty核心概念</h1><h2 id="协议"><span class="post-title-index">2.1.</span><a href="#协议" class="headerlink" title="协议"></a> 协议</h2><p>运行微信机器人有多种协议可以使用，有以下几种不同的协议方式：</p><ul><li>Padlocal协议(推荐使用)</li><li>Paimon协议(最简单)</li><li>免费Web协议(目前已不可用)</li><li>puppet-xp协议（仅windows下可用）</li></ul><p>每个协议都有不用的特点，如果不知道选什么，那么建议使用Padlocal协议。</p><h2 id="Token"><span class="post-title-index">2.2.</span><a href="#Token" class="headerlink" title="Token"></a> Token</h2><p>Token 是 Wechaty 开放源代码项目中，所设计和支持的一种认证技术，可以使用第三方的 <a target="_blank" rel="noopener" href="https://wechaty.js.org/docs/puppet-servies/">Wechaty Puppet Service</a> 服务。Wechaty 社区中，提供 Puppet Service 的第三方，称之为 Wechaty Puppet Service Provider 。句子互动公司是 Wechaty PadPlus, WxWork, Donut 等 Puppet Service 的 Provider，提供对应 Puppet Service 的 Token ，实现开发者可以使用对应的协议服务。</p><p>在设置 Token 后，每个 Token 将可以使得一个微信号以 iPad 或 Mac 登录的方式进行登录，避免了既有网页端登录受限的问题。</p><p>每个 Token 可以使得一个微信号登录，如果希望多个号同时登录，需要获取多个 Token 。 但 Token 不与微信号绑定，即可以多个号不同时段轮流使用一个 Token 进行登录。</p><h2 id="Puppet"><span class="post-title-index">2.3.</span><a href="#Puppet" class="headerlink" title="Puppet"></a> Puppet</h2><p>Wechaty 中的术语 Puppet 是用于实现协议插件的抽象类。插件是帮助控制 微信/Whatspp/TikTok 的组件，这就是我们称之为Puttet（傀儡）的原因。</p><h1 id="Padlocal-Getting-Started"><span class="post-title-index">3.</span><a href="#Padlocal-Getting-Started" class="headerlink" title="Padlocal Getting Started"></a> Padlocal Getting Started</h1><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://github.com/voidking/python-wechaty-template">github - voidking/python-wechaty-template</a></li><li><a target="_blank" rel="noopener" href="https://wechaty.readthedocs.io/zh_CN/latest/introduction/use-padlocal-protocol/">使用Padlocal协议</a></li><li><a target="_blank" rel="noopener" href="https://wechaty.js.org/2021/02/03/python-wechaty-for-padlocal-puppet-service/">Python Wechaty如何使用PadLocal Puppet Service</a></li><li><a target="_blank" rel="noopener" href="https://wechaty.js.org/2022/06/23/wechaty-gateway-use/">Wechaty Gateway 使用教程</a></li></ul><h2 id="申请Token"><span class="post-title-index">3.1.</span><a href="#申请Token" class="headerlink" title="申请Token"></a> 申请Token</h2><p>申请 Padlocal Token 链接：<a target="_blank" rel="noopener" href="http://pad-local.com/#/login">Padlocal</a><br>免费试用Token可以使用7天，续费200元/月。建议成为Wechaty开发者，可以免费续期Token，参考文档<a target="_blank" rel="noopener" href="https://github.com/juzibot/Welcome/wiki/How-to-be-a-Wechaty-Contributor">How to be a Wechaty Contributor</a>。</p><h2 id="启动Gateway"><span class="post-title-index">3.2.</span><a href="#启动Gateway" class="headerlink" title="启动Gateway"></a> 启动Gateway</h2><p>1、启动Gateway Docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/voidking/python-wechaty-template.git</span><br><span class="line"><span class="built_in">cd</span> python-wechaty-template/</span><br><span class="line">./start_gateway_docker.sh puppet_padlocal_xxx</span><br></pre></td></tr></table></figure><p>其中 <code>puppet_padlocal_xxx</code> 要替换成自己的Token。</p><p><img src="https://cdn.voidking.com/imgs/wechaty-start/gateway.png?imageView2/0/w/800"></p><p>最后一行的链接，是一个微信登录的二维码，python-wechaty连接gateway之后能够自动获取到这个链接并展示，以便我们登录。<br>当然，直接在浏览器中也能访问这个二维码，微信扫码可以登录，不过没什么用。</p><p>Gateway启动时，会生成一个<code>WECHATY_TOKEN</code>，Gateway使用；同时会填入到 <code>.env</code> 文件中，给机器人使用。<br>运行自己的机器人代码时，也要用到这个 <code>WECHATY_TOKEN</code>。</p><p>2、验证Gateway是否启动成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://api.chatie.io/v0/hosties/<span class="variable">$WECHATY_TOKEN</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.voidking.com/imgs/wechaty-start/check-gateway.png?imageView2/0/w/800"></p><h2 id="运行机器人"><span class="post-title-index">3.3.</span><a href="#运行机器人" class="headerlink" title="运行机器人"></a> 运行机器人</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make bot</span><br></pre></td></tr></table></figure><p><img src="https://cdn.voidking.com/imgs/wechaty-start/error.png?imageView2/0/w/800"></p><p>报错：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/usr/local/lib/python3.9/site-packages/wechaty/wechaty.py&quot;, line 445, in start</span><br><span class="line">    await self.puppet.start()</span><br><span class="line">  File &quot;/usr/local/lib/python3.9/site-packages/wechaty_puppet_service/puppet.py&quot;, line 911, in start</span><br><span class="line">    self._init_puppet()</span><br><span class="line">  File &quot;/usr/local/lib/python3.9/site-packages/wechaty_puppet_service/puppet.py&quot;, line 894, in _init_puppet</span><br><span class="line">    raise WechatyPuppetConfigurationError(</span><br><span class="line">wechaty_puppet.exceptions.WechatyPuppetConfigurationError: WechatyPuppetConfigurationError(&quot;can&#x27;t not ping endpoint: 42.194.xxx.xxx:8080&quot;, None, None)</span><br></pre></td></tr></table></figure><p>这是因为，机器人连接Gateway Docker时，使用了外网IP，而外网IP的8080端口并未开放。<br>有两个解决办法：（1）开放外网IP的8080端口；（2）配置使用 <code>WECHATY_PUPPET_SERVICE_ENDPOINT</code> 变量。</p><p>这里选择第二种方法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name bot -d \</span><br><span class="line">    -v $(<span class="built_in">pwd</span>):/bot \</span><br><span class="line">    -p 8004:8004 \</span><br><span class="line">    -e WECHATY_PUPPET_SERVICE_ENDPOINT=<span class="string">&quot;192.168.56.101:8080&quot;</span> \</span><br><span class="line">    py-wechaty-template-bot:latest</span><br><span class="line"></span><br><span class="line">docker logs -f bot</span><br></pre></td></tr></table></figure><p><img src="https://cdn.voidking.com/imgs/wechaty-start/qrcode.png?imageView2/0/w/800"><br>这里有个错误：<code>Wechaty - ERROR - internal error &lt;&gt;</code><br>参考<a target="_blank" rel="noopener" href="https://github.com/wechaty/python-wechaty-getting-started/issues/63">Wechaty - ERROR - internal error and failed to scan</a>，忽略即可。</p><p>扫描登录，第一次登录时，会询问你登录的是 mac、windows还是ipad，这里要选择ipad。</p><p>登录成功后，半分钟左右，会自动退出，提示<code>为了你的账号安全，请重新登录。</code><br><img src="https://cdn.voidking.com/imgs/wechaty-start/logout.png?imageView2/0/w/800"></p><p>然后，再扫描登录，登录成功后还是会退出，后来再扫描二维码就没有反应了。。。</p><p>Padlocal Get Started，以失败告终。</p><h1 id="Paimon-Get-Started"><span class="post-title-index">4.</span><a href="#Paimon-Get-Started" class="headerlink" title="Paimon Get Started"></a> Paimon Get Started</h1><p>Paimon相对于Padlocal，缺点很多：发送/接收图片、文件较慢；不支持接收/转发动图；不支持接收/发送语音消息；不支持转发音频/视频等。<br>不过，Paimon最大的优点就是简单，这就够了，关键是能用。</p><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://github.com/wechaty/python-wechaty-getting-started/">github - wechaty/python-wechaty-getting-started</a></li><li><a target="_blank" rel="noopener" href="https://wechaty.readthedocs.io/zh_CN/latest/introduction/use-paimon-protocol/">使用Paimon协议</a></li></ul><h2 id="申请Token-1"><span class="post-title-index">4.1.</span><a href="#申请Token-1" class="headerlink" title="申请Token"></a> 申请Token</h2><p>申请Token链接：<a target="_blank" rel="noopener" href="https://wechaty.js.org/docs/puppet-services/paimon#how-to-buy">Puppet Service: Paimon</a><br>免费试用Token可以使用7天，续费200元/月。建议成为Wechaty开发者，可以免费续期Token，参考文档<a target="_blank" rel="noopener" href="https://github.com/juzibot/Welcome/wiki/How-to-be-a-Wechaty-Contributor">How to be a Wechaty Contributor</a>。</p><h2 id="运行机器人-1"><span class="post-title-index">4.2.</span><a href="#运行机器人-1" class="headerlink" title="运行机器人"></a> 运行机器人</h2><p>1、安装依赖</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install wechaty -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure><p>2、编写脚本 test.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio, os</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Optional</span>, <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> wechaty_puppet <span class="keyword">import</span> FileBox  <span class="comment"># type: ignore</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> wechaty <span class="keyword">import</span> Wechaty, Contact</span><br><span class="line"><span class="keyword">from</span> wechaty.user <span class="keyword">import</span> Message, Room</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyBot</span>(<span class="title class_ inherited__">Wechaty</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">on_message</span>(<span class="params">self, msg: Message</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        listen for message event</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        from_contact: <span class="type">Optional</span>[Contact] = msg.talker()</span><br><span class="line">        text = msg.text()</span><br><span class="line">        room: <span class="type">Optional</span>[Room] = msg.room()</span><br><span class="line">        <span class="keyword">if</span> text == <span class="string">&#x27;ding&#x27;</span>:</span><br><span class="line">            conversation: <span class="type">Union</span>[</span><br><span class="line">                Room, Contact] = from_contact <span class="keyword">if</span> room <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> room</span><br><span class="line">            <span class="keyword">await</span> conversation.ready()</span><br><span class="line">            <span class="keyword">await</span> conversation.say(<span class="string">&#x27;dong&#x27;</span>)</span><br><span class="line">            <span class="comment"># file_box = FileBox.from_url(</span></span><br><span class="line">            <span class="comment">#     &#x27;https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/&#x27;</span></span><br><span class="line">            <span class="comment">#     &#x27;u=1116676390,2305043183&amp;fm=26&amp;gp=0.jpg&#x27;,</span></span><br><span class="line">            <span class="comment">#     name=&#x27;ding-dong.jpg&#x27;)</span></span><br><span class="line">            file_box = FileBox.from_url(</span><br><span class="line">                <span class="string">&#x27;https://cdn.voidking.com/@/imgs/about/about.png?imageView2/0/w/1000&#x27;</span>,</span><br><span class="line">                name=<span class="string">&#x27;ding-dong.jpg&#x27;</span>)</span><br><span class="line">            <span class="keyword">await</span> conversation.say(file_box)</span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">&#x27;TOKEN&#x27;</span>] = <span class="string">&quot;puppet_paimon_1fe5f846-3cfb-401d-b20c-XXXXX&quot;</span></span><br><span class="line">asyncio.run(MyBot().start())</span><br></pre></td></tr></table></figure><p>3、启动脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python test.py</span><br></pre></td></tr></table></figure><p><img src="https://cdn.voidking.com/imgs/wechaty-start/paimon-login.png?imageView2/0/w/800"><br>使用微信号B扫码登录微信。</p><p>4、测试 ding dong<br>使用微信号A给微信号B发送一个<code>ding</code>，可以收到自动回复的<code>dong</code>，但是并没有接收到图片消息。<br>代码出现了报错：<br><img src="https://cdn.voidking.com/imgs/wechaty-start/ding.png?imageView2/0/w/800"></p><p>经查，是因为教程中给的图片地址过期了，换成可用的地址后，可以正常接收到图片消息了。<br><img src="https://cdn.voidking.com/imgs/wechaty-start/result.png?imageView2/0/w/800"></p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>原文链接：</strong> <a href="https://www.voidking.com/dev-wechaty-start/" title="Wechaty入门篇">https://www.voidking.com/dev-wechaty-start/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本文采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议，转载请注明出处！源站会即时更新知识点并修正错误，欢迎访问~</li><li> <img width="200" height="200" src="/images/avatar.jpg"><p style="text-align:center;margin-bottom:0">微信公众号同步更新，欢迎关注~</p></li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/python/" rel="tag"># python</a> <a href="/tags/docker/" rel="tag"># docker</a> <a href="/tags/%E5%BE%AE%E4%BF%A1/" rel="tag"># 微信</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-docker-openai-api-proxy/" rel="prev" title="使用Docker安装配置OPANAI API代理"><i class="fa fa-chevron-left"></i> 使用Docker安装配置OPANAI API代理</a></div><div class="post-nav-item"> <a href="/dev-python-openai-api/" rel="next" title="Python调用OpenAI API">Python调用OpenAI API<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3284447971731414" data-ad-slot="9697986181"></ins><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Wechaty%E7%AE%80%E4%BB%8B"><span class="nav-text">1. Wechaty简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Wechaty%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-text">2. Wechaty核心概念</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%8F%E8%AE%AE"><span class="nav-text">2.1. 协议</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Token"><span class="nav-text">2.2. Token</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Puppet"><span class="nav-text">2.3. Puppet</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Padlocal-Getting-Started"><span class="nav-text">3. Padlocal Getting Started</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%B3%E8%AF%B7Token"><span class="nav-text">3.1. 申请Token</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8Gateway"><span class="nav-text">3.2. 启动Gateway</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%99%A8%E4%BA%BA"><span class="nav-text">3.3. 运行机器人</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Paimon-Get-Started"><span class="nav-text">4. Paimon Get Started</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%B3%E8%AF%B7Token-1"><span class="nav-text">4.1. 申请Token</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%99%A8%E4%BA%BA-1"><span class="nav-text">4.2. 运行机器人</span></a></li></ol></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">一个计算机技术爱好者与学习者</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">699</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">248</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: 'b435e3d39cac9c8bef1c8b32922a88af',
      title: 'Wechaty入门篇',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>