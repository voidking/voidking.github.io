<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言本文中研究学习beego的静态文件配置使用方法，请求返回值的json化处理，使用goland调试beego框架，数据库从sqlite迁移到mysql。"><meta property="og:type" content="article"><meta property="og:title" content="beego入门篇——下"><meta property="og:url" content="https://www.voidking.com/dev-beego-start-2/index.html"><meta property="og:site_name" content="VoidKing"><meta property="og:description" content="前言本文中研究学习beego的静态文件配置使用方法，请求返回值的json化处理，使用goland调试beego框架，数据库从sqlite迁移到mysql。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com/@/imgs/beego-start/debugconf.jpg?imageView2/0/w/800"><meta property="og:image" content="http://cdn.voidking.com/@/imgs/beego-start/point.jpg?imageView2/0/w/800"><meta property="og:image" content="http://cdn.voidking.com/@/imgs/beego-start/debug.jpg?imageView2/0/w/800"><meta property="article:published_time" content="2019-08-13T20:00:00.000Z"><meta property="article:modified_time" content="2020-03-18T07:29:20.431Z"><meta property="article:author" content="VoidKing"><meta property="article:tag" content="golang"><meta property="article:tag" content="beego"><meta property="article:tag" content="debug"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com/@/imgs/beego-start/debugconf.jpg?imageView2/0/w/800"><link rel="canonical" href="https://www.voidking.com/dev-beego-start-2/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>beego入门篇——下 | VoidKing</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="VoidKing" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">VoidKing</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-beego-start-2/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="VoidKing"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="VoidKing"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> beego入门篇——下</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-08-13 20:00:00" itemprop="dateCreated datePublished" datetime="2019-08-13T20:00:00+00:00">2019-08-13</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/" itemprop="url" rel="index"><span itemprop="name">专业</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E5%90%8E%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E5%90%8E%E7%AB%AF/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本文中研究学习beego的静态文件配置使用方法，请求返回值的json化处理，使用goland调试beego框架，数据库从sqlite迁移到mysql。</p><a id="more"></a><h1 id="静态文件配置"><a href="#静态文件配置" class="headerlink" title="静态文件配置"></a>静态文件配置</h1><p>使用bee工具生成的vkbeego项目，index.tpl中包含css。实际项目中，静态文件是和模板文件分离的，下面分离出index.tpl中的css，改成引用的方式。</p><p>1、图片准备<br>index.tpl中的两个base64格式的图片，另存为icon.png和background.png，放到在static/img目录下。</p><p>2、在static/css目录下新建index.css文件，内容从index.tpl中拷贝，详见<a href="https://github.com/voidking/vkbeego/releases/tag/v0.0.2" target="_blank" rel="noopener">源码v0.0.2</a>。</p><p>3、修改views/index.tpl文件为：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Beego<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">href</span>=<span class="string">"/static/img/icon.png"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/static/css/index.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--keep the same--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>启动beego，此时看到的首页和原首页相同。</p><h1 id="json处理"><a href="#json处理" class="headerlink" title="json处理"></a>json处理</h1><p>当今，json已经成为了Web开发中前后端交互的标准格式。本节中修改<a href="https://www.voidking.com/dev-beego-start-1/">《beego入门篇——中》</a>一文中的增删查改接口，使返回数据变成json格式。为节省篇幅，下文中省略了文件头部。</p><p>1、修改controllers/user/add.go，内容为：</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// omit the head</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(<span class="built_in">c</span> *AddController)</span></span> <span class="type">Get</span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> username = <span class="built_in">c</span>.<span class="type">GetString</span>(<span class="string">"username"</span>)</span><br><span class="line">    fmt.<span class="type">Println</span>(username)</span><br><span class="line">    <span class="built_in">c</span>.<span class="type">Ctx</span>.<span class="type">WriteString</span>(<span class="string">"Please add user by post request."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(<span class="built_in">c</span> *AddController)</span></span> <span class="type">Post</span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> username = <span class="built_in">c</span>.<span class="type">GetString</span>(<span class="string">"username"</span>)</span><br><span class="line">    <span class="keyword">var</span> password = <span class="built_in">c</span>.<span class="type">GetString</span>(<span class="string">"password"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> o = orm.<span class="type">NewOrm</span>()</span><br><span class="line">    o.<span class="type">Using</span>(<span class="string">"default"</span>)</span><br><span class="line">    exist := o.<span class="type">QueryTable</span>(<span class="string">"user"</span>).<span class="type">Filter</span>(<span class="string">"UserName"</span>, username).<span class="type">Exist</span>()</span><br><span class="line">    <span class="keyword">if</span> exist&#123;</span><br><span class="line">        <span class="built_in">c</span>.<span class="type">Data</span>[<span class="string">"json"</span>] = <span class="built_in">map</span>[string]interface&#123;&#125;&#123;<span class="string">"code"</span>: <span class="number">1</span>, <span class="string">"ext"</span>: <span class="string">"Username has been existed!"</span>&#125;</span><br><span class="line">        <span class="built_in">c</span>.<span class="type">ServeJSON</span>()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> user = new(models.<span class="type">User</span>)</span><br><span class="line">    user.<span class="type">Username</span> = username</span><br><span class="line">    user.<span class="type">Password</span> = password</span><br><span class="line">    id,err := o.<span class="type">Insert</span>(user)</span><br><span class="line">    <span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.<span class="type">Println</span>(id)</span><br><span class="line">        <span class="built_in">c</span>.<span class="type">Data</span>[<span class="string">"json"</span>] = <span class="built_in">map</span>[string]interface&#123;&#125;&#123;<span class="string">"code"</span>: <span class="number">0</span>, <span class="string">"userid"</span>: id,<span class="string">"ext"</span>: <span class="string">"User has been added!"</span>&#125;</span><br><span class="line">        <span class="built_in">c</span>.<span class="type">ServeJSON</span>()</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">c</span>.<span class="type">Data</span>[<span class="string">"json"</span>] = <span class="built_in">map</span>[string]interface&#123;&#125;&#123;<span class="string">"code"</span>: <span class="number">2</span>, <span class="string">"ext"</span>: <span class="string">"Write to database failed!"</span>&#125;</span><br><span class="line">        <span class="built_in">c</span>.<span class="type">ServeJSON</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//c.Ctx.WriteString("add user: " + username)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2、修改controllers/user/list.go，内容为：</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// omit the head</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(<span class="built_in">c</span> *ListController)</span></span> <span class="type">Get</span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> o = orm.<span class="type">NewOrm</span>()</span><br><span class="line">    o.<span class="type">Using</span>(<span class="string">"default"</span>)</span><br><span class="line">    <span class="keyword">var</span> qs orm.<span class="type">QuerySeter</span></span><br><span class="line">    qs = o.<span class="type">QueryTable</span>(<span class="string">"user"</span>)</span><br><span class="line">    <span class="keyword">var</span> users []*models.<span class="type">User</span></span><br><span class="line">    <span class="comment">//num, err := qs.All(&amp;users)</span></span><br><span class="line">    num, err := qs.<span class="type">All</span>(&amp;users,<span class="string">"Id"</span>, <span class="string">"Username"</span>)</span><br><span class="line">    fmt.<span class="type">Printf</span>(<span class="string">"Returned Rows Num: %d, %s \n"</span>, num, err)</span><br><span class="line">    fmt.<span class="type">Println</span>(users[<span class="number">0</span>].<span class="type">Username</span>)</span><br><span class="line">    <span class="built_in">c</span>.<span class="type">Data</span>[<span class="string">"users"</span>] = users</span><br><span class="line">    <span class="built_in">c</span>.<span class="type">TplName</span> = <span class="string">"user/list.tpl"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(<span class="built_in">c</span> *ListController)</span></span> <span class="type">Post</span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> o = orm.<span class="type">NewOrm</span>()</span><br><span class="line">    o.<span class="type">Using</span>(<span class="string">"default"</span>)</span><br><span class="line">    <span class="keyword">var</span> qs orm.<span class="type">QuerySeter</span></span><br><span class="line">    qs = o.<span class="type">QueryTable</span>(<span class="string">"user"</span>)</span><br><span class="line">    <span class="keyword">var</span> users []*models.<span class="type">User</span></span><br><span class="line">    <span class="comment">//num, err := qs.All(&amp;users)</span></span><br><span class="line">    qs.<span class="type">All</span>(&amp;users,<span class="string">"Id"</span>, <span class="string">"Username"</span>)</span><br><span class="line">    <span class="built_in">c</span>.<span class="type">Data</span>[<span class="string">"json"</span>] = <span class="built_in">map</span>[string]interface&#123;&#125;&#123;<span class="string">"code"</span>: <span class="number">0</span>, <span class="string">"ext"</span>: <span class="string">"success"</span>, <span class="string">"userlist"</span>: users&#125;</span><br><span class="line">    <span class="built_in">c</span>.<span class="type">ServeJSON</span>()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3、修改controllers/user/update.go，内容为：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// omit the head</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *UpdateController)</span> <span class="title">Post</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//id,_ := c.GetInt("id")</span></span><br><span class="line">    username := c.GetString(<span class="string">"username"</span>)</span><br><span class="line">    password := c.GetString(<span class="string">"password"</span>)</span><br><span class="line">    new_password := c.GetString(<span class="string">"new_password"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> o = orm.NewOrm()</span><br><span class="line">    o.Using(<span class="string">"default"</span>)</span><br><span class="line"></span><br><span class="line">    exist := o.QueryTable(<span class="string">"user"</span>).Filter(<span class="string">"UserName"</span>, username).Exist()</span><br><span class="line">    <span class="keyword">if</span> !exist&#123;</span><br><span class="line">        c.Data[<span class="string">"json"</span>] = <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;<span class="string">"code"</span>: <span class="number">1</span>, <span class="string">"ext"</span>: <span class="string">"Username doesn't exist!"</span>&#125;</span><br><span class="line">        c.ServeJSON()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> user models.User</span><br><span class="line">    o.QueryTable(<span class="string">"user"</span>).Filter(<span class="string">"Username"</span>,username).Filter(<span class="string">"Password"</span>,password).One(&amp;user)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> o.Read(&amp;user) == <span class="literal">nil</span> &#123;</span><br><span class="line">        user.Password = new_password</span><br><span class="line">        <span class="keyword">if</span> num, err := o.Update(&amp;user); err == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> num != <span class="number">0</span> &#123;</span><br><span class="line">                c.Data[<span class="string">"json"</span>] = <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;<span class="string">"code"</span>: <span class="number">0</span>, <span class="string">"ext"</span>: <span class="string">"Password has been updated!"</span>&#125;</span><br><span class="line">                c.ServeJSON()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        c.Data[<span class="string">"json"</span>] = <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;<span class="string">"code"</span>: <span class="number">2</span>, <span class="string">"ext"</span>: <span class="string">"Username or password is wrong!"</span>&#125;</span><br><span class="line">        c.ServeJSON()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4、修改controllers/user/del.go，内容为：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// omit the head</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *DelController)</span> <span class="title">Get</span><span class="params">()</span></span> &#123;</span><br><span class="line">    c.Ctx.WriteString(<span class="string">"Please use post request."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *DelController)</span> <span class="title">Post</span><span class="params">()</span></span> &#123;</span><br><span class="line">    id,_ := c.GetInt(<span class="string">"id"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> o = orm.NewOrm()</span><br><span class="line">    o.Using(<span class="string">"default"</span>)</span><br><span class="line"></span><br><span class="line">    num,err := o.QueryTable(<span class="string">"user"</span>).Filter(<span class="string">"Id"</span>,id).Delete()</span><br><span class="line">    fmt.Printf(<span class="string">"Returned Rows Num: %d, %s \n"</span>, num, err)</span><br><span class="line">    <span class="keyword">if</span> num != <span class="number">0</span> &#123;</span><br><span class="line">        c.Data[<span class="string">"json"</span>] = <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;<span class="string">"code"</span>: <span class="number">0</span>, <span class="string">"ext"</span>: <span class="string">"User has been deleted!"</span>&#125;</span><br><span class="line">        c.ServeJSON()</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        c.Data[<span class="string">"json"</span>] = <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;<span class="string">"code"</span>: <span class="number">1</span>, <span class="string">"ext"</span>: <span class="string">"User Id doesn't exist! Can't delete!"</span>&#125;</span><br><span class="line">        c.ServeJSON()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改之后，四个接口都能够返回json格式的数据，使用Postman测试通过，可供js进行调用。</p><h1 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h1><p>以调试controllers/user/add.go中的Post方法为例。<br>1、设置调试环境<br>Run，Edit Configuration，Add New Configuration，Go Build。Run kind选择Directory，Directory、Output directory、Working directory都选择项目目录，OK。点击工具栏的Debug按钮，进入调试模式。<br><img src="http://cdn.voidking.com/@/imgs/beego-start/debugconf.jpg?imageView2/0/w/800" alt=""></p><p>2、在Post方法中添加断点<br>在代码左侧，单击添加断点。<br><img src="http://cdn.voidking.com/@/imgs/beego-start/point.jpg?imageView2/0/w/800" alt=""></p><p>3、测试调试<br>使用Postman，发送Post请求到 <a href="http://localhost:8080/user/add" target="_blank" rel="noopener">http://localhost:8080/user/add</a> ，请求参数包括username和password。查看Goland面板，可以看到面板中显示出了请求的参数等信息。<br><img src="http://cdn.voidking.com/@/imgs/beego-start/debug.jpg?imageView2/0/w/800" alt=""><br>使用F8进入下一步，F7进入函数，Shift+F8退出函数。</p><h1 id="数据库迁移"><a href="#数据库迁移" class="headerlink" title="数据库迁移"></a>数据库迁移</h1><p>前文中，使用sqlite数据库，而在生产环境中，大多是使用mysql。本节中研究学习数据库的迁移，把sqlite数据库中的数据移动到mysql数据库中。</p><h2 id="表结构迁移"><a href="#表结构迁移" class="headerlink" title="表结构迁移"></a>表结构迁移</h2><p>1、创建数据库<br>使用mysql时，beego不会自动生成数据库，因此需要手动创建vkbeego数据库。</p><p>2、修改models/model.go文件，修改注册驱动和注册数据库为mysql：</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">import</span> <span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    _ <span class="string">"github.com/go-sql-driver/mysql"</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">orm</span>.R<span class="title">egisterDriver</span><span class="params">(<span class="string">"mysql"</span>, orm.DRMySQL)</span></span></span><br><span class="line"><span class="function"><span class="title">orm</span>.R<span class="title">egisterDataBase</span><span class="params">(<span class="string">"default"</span>, <span class="string">"mysql"</span>, <span class="string">"root:voidking@tcp(192.168.56.104:3306)/vkbeego?charset=utf8"</span>)</span></span></span><br></pre></td></tr></table></figure><p>3、生成表结构<br>运行<code>bee run</code>，即可在beego数据库中生成表结构。</p><h2 id="表结构迁移2-0"><a href="#表结构迁移2-0" class="headerlink" title="表结构迁移2.0"></a>表结构迁移2.0</h2><p>1、创建beego/database/migrations/vkbeego.sql文件，内容为：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE <span class="keyword">IF</span> <span class="keyword">NOT</span> EXISTS `user` (</span><br><span class="line">    `id` integer <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY KEY AUTOINCREMENT,</span><br><span class="line">    `username` varchar(255) <span class="keyword">NOT</span> <span class="literal">NULL</span><span class="built_in"> DEFAULT </span><span class="string">''</span> ,</span><br><span class="line">    `password` varchar(255) <span class="keyword">NOT</span> <span class="literal">NULL</span><span class="built_in"> DEFAULT </span><span class="string">''</span> </span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>2、生成表结构<br>创建数据库，修改models/model.go使用mysql后，执行命令：<br><code>bee migrate [-driver=mysql] [-conn=&quot;root:voidking@tcp(127.0.0.1:3306)/vkbeego&quot;]</code></p><h2 id="数据迁移"><a href="#数据迁移" class="headerlink" title="数据迁移"></a>数据迁移</h2><p>sqlite和mysql的SQL语句不兼容，参考<a href="https://www.cnblogs.com/goldenstones/articles/9185950.html" target="_blank" rel="noopener">sqlite导入到mysql</a>进行数据迁移，此处不再展开。</p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>以上，学习了beego静态文件配置、json处理、调试和数据库迁移。beego还有好多内容值得学习，比如模块使用、进程监控、应用部署、第三方库等等，但是入门篇到这里就告一段落，see you。</p><p>源码分享：<a href="https://github.com/voidking/vkbeego/releases/tag/v0.0.2" target="_blank" rel="noopener">v0.0.2</a></p><h1 id="书签"><a href="#书签" class="headerlink" title="书签"></a>书签</h1><p><a href="https://beego.me/" target="_blank" rel="noopener">beego官网</a><br><a href="https://www.kancloud.cn/hello123/beego/126086" target="_blank" rel="noopener">beego开发文档</a></p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/golang/" rel="tag"># golang</a> <a href="/tags/beego/" rel="tag"># beego</a> <a href="/tags/debug/" rel="tag"># debug</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-beego-start-1/" rel="prev" title="beego入门篇——中"><i class="fa fa-chevron-left"></i> beego入门篇——中</a></div><div class="post-nav-item"> <a href="/dev-k8s-start/" rel="next" title="K8S入门篇">K8S入门篇<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#静态文件配置"><span class="nav-number">2.</span> <span class="nav-text">静态文件配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#json处理"><span class="nav-number">3.</span> <span class="nav-text">json处理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#调试"><span class="nav-number">4.</span> <span class="nav-text">调试</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据库迁移"><span class="nav-number">5.</span> <span class="nav-text">数据库迁移</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#表结构迁移"><span class="nav-number">5.1.</span> <span class="nav-text">表结构迁移</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#表结构迁移2-0"><span class="nav-number">5.2.</span> <span class="nav-text">表结构迁移2.0</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据迁移"><span class="nav-number">5.3.</span> <span class="nav-text">数据迁移</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#后记"><span class="nav-number">6.</span> <span class="nav-text">后记</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#书签"><span class="nav-number">7.</span> <span class="nav-text">书签</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="VoidKing" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">VoidKing</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">589</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">40</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">190</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://twitter.com/voidking_com" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;voidking_com" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i> Twitter</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">VoidKing</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://www.beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>