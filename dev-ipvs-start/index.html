<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="ipvs简介 Linux Virtual Server (LVS) is load balancing software for Linux kernel–based operating systems.   LVS is a free and open-source project started by Wensong Zhang in May 1998, subject to the requ"><meta property="og:type" content="article"><meta property="og:title" content="ipvs入门篇"><meta property="og:url" content="https://www.voidking.com/dev-ipvs-start/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="ipvs简介 Linux Virtual Server (LVS) is load balancing software for Linux kernel–based operating systems.   LVS is a free and open-source project started by Wensong Zhang in May 1998, subject to the requ"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2013-11-23T14:22:46.000Z"><meta property="article:modified_time" content="2023-02-14T17:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="网络"><meta property="article:tag" content="ipvs"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-ipvs-start/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>ipvs入门篇 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-ipvs-start/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> ipvs入门篇</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2013-11-23 14:22:46" itemprop="dateCreated datePublished" datetime="2013-11-23T14:22:46+00:00">2013-11-23</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2023-02-14 17:00:00" itemprop="dateModified" datetime="2023-02-14T17:00:00+00:00">2023-02-14</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/network/" itemprop="url" rel="index"><span itemprop="name">network</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="ipvs简介"><a href="#ipvs简介" class="headerlink" title="ipvs简介"></a>ipvs简介</h1><blockquote><p>Linux Virtual Server (LVS) is load balancing software for Linux kernel–based operating systems.</p></blockquote><blockquote><p>LVS is a free and open-source project started by Wensong Zhang in May 1998, subject to the requirements of the GNU General Public License (GPL), version 2. The mission of the project is to build a high-performance and highly available server for Linux using clustering technology, which provides good scalability, reliability and serviceability.</p></blockquote><blockquote><p>The major work of the LVS project is now to develop advanced IP load balancing software (IPVS), application-level load balancing software (KTCPVS), and cluster management components.</p></blockquote><blockquote><p>IPVS (IP Virtual Server) implements transport-layer load balancing, usually called Layer 4 LAN switching, as part of the Linux kernel. It’s configured via the user-space utility <a target="_blank" rel="noopener" href="https://man.cx/?page=ipvsadm(8)">ipvsadm(8)</a> tool.</p></blockquote><blockquote><p>IPVS is incorporated into the Linux Virtual Server (LVS), where it runs on a host and acts as a load balancer in front of a cluster of real servers. IPVS can direct requests for TCP- and UDP-based services to the real servers, and make services of the real servers appear as virtual services on a single IP address. IPVS is built on top of the Netfilter.</p></blockquote><p>简而言之，lvs是一个四层负载均衡软件（项目），ipvs是lvs的一部分。ipvs内置在linux内核空间中，在用户空间使用ipvsadm对ipvs进行管理。</p><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Linux_Virtual_Server">Wikipedia - Linux Virtual Server</a></li><li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/IP_Virtual_Server">Wikipedia - IP Virtual Server</a></li><li><a target="_blank" rel="noopener" href="http://www.linuxvirtualserver.org/">The Linux Virtual Server Project</a></li></ul><span id="more"></span><h1 id="ipvs工作原理"><a href="#ipvs工作原理" class="headerlink" title="ipvs工作原理"></a>ipvs工作原理</h1><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/laolieren/p/lvs_explained.html">LVS原理详解</a></li><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/klb561/p/9215667.html">LVS原理详解以及部署</a></li><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/94418251">IPVS从入门到精通kube-proxy实现原理</a></li><li><a target="_blank" rel="noopener" href="https://www.cloudflare.com/zh-cn/learning/network-layer/what-is-tunneling/">什么是隧道？| 网络中的隧道</a></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/u010560161/article/details/115995256">IPVS在k8s中的使用</a></li></ul><h2 id="ipvs术语"><a href="#ipvs术语" class="headerlink" title="ipvs术语"></a>ipvs术语</h2><ul><li>DS：Director Server。指的是前端负载均衡器节点。</li><li>RS：Real Server。后端真实的工作服务器。</li><li>VIP：Virtual IP，向外部直接面向用户请求，作为用户请求的目标的IP地址。</li><li>DIP：Director Server IP，主要用于和内部主机通讯的IP地址。</li><li>RIP：Real Server IP，后端服务器的IP地址。</li><li>CIP：Client IP，访问客户端的IP地址。</li></ul><h2 id="ipvs基本原理"><a href="#ipvs基本原理" class="headerlink" title="ipvs基本原理"></a>ipvs基本原理</h2><p>1、当用户向负载均衡调度器（Director Server）发起请求，调度器将请求发往至内核空间。<br>2、PREROUTING链首先会接收到用户请求，判断目标IP确定是本机IP，将数据包发往INPUT链。<br>3、IPVS是工作在INPUT链上的，当用户请求到达INPUT时，IPVS会将用户请求和自己已定义好的集群服务进行比对，如果用户请求的就是定义的集群服务，那么此时IPVS会强行修改数据包里的目标IP地址及端口，并将新的数据包发往POSTROUTING链。<br>4、POSTROUTING链接收数据包后发现目标IP地址刚好是自己的后端服务器，那么此时通过选路，将数据包最终发送给后端的服务器。</p><h2 id="ipvs工作模式"><a href="#ipvs工作模式" class="headerlink" title="ipvs工作模式"></a>ipvs工作模式</h2><ul><li>nat模式：通过网络地址转换，调度器重写请求报文的目标地址，根据预设的调度算法，将请求分派给后端的真实服务器；真实服务器的响应报文通过调度器时，报文的源地址被重写，再返回给客户，完成整个负载调度过程。</li><li>tunnel模式：改写请求的IP地址，将请求和响应分开处理，即在负载调度器中只负责调度请求而响应直接返回给客户，将极大地提高整个集群系统的吞吐量。</li><li>dr模式：改写请求报文的MAC地址，将请求发送到真实服务器，而真实服务器将响应直接返回给客户。这种方法没有IP隧道的开销，对集群中的真实服务器也没有必须支持IP隧道协议的要求，但是要求调度器与真实服务器都有一块网卡连在同一物理网段上。</li></ul><h2 id="ipvs调度算法"><a href="#ipvs调度算法" class="headerlink" title="ipvs调度算法"></a>ipvs调度算法</h2><p>固定调度算法：即调度器不会去判断后端服务器的繁忙与否，一如既往得将请求派发下去。具体包括rr、wrr、dh、sh<br>动态调度算法：调度器会去判断后端服务器的繁忙程度，然后依据调度算法动态得派发请求。具体包括wlc、lc、lblc、lblcr</p><h3 id="rr"><a href="#rr" class="headerlink" title="rr"></a>rr</h3><p>rr：轮询（round robin）<br>这种算法是最简单的，就是按依次循环的方式将请求调度到不同的服务器上，该算法最大的特点就是简单。轮询算法假设所有的服务器处理请求的能力都是一样的，调度器会将所有的请求平均分配给每个真实服务器，不管后端 RS 配置和处理能力，非常均衡地分发下去。这个调度的缺点是，不管后端服务器的繁忙程度是怎样的，调度器都会讲请求依次发下去。如果A服务器上的请求很快请求完了，而B服务器的请求一直持续着，将会导致B服务器一直很忙，而A很闲，这样便没起到均衡的左右。</p><h3 id="wrr"><a href="#wrr" class="headerlink" title="wrr"></a>wrr</h3><p>wrr：加权轮询（weight round robin）<br>这种算法比 rr 的算法多了一个权重的概念，可以给 RS 设置权重，权重越高，那么分发的请求数越多，权重的取值范围 0 – 100。主要是对rr算法的一种优化和补充， LVS 会考虑每台服务器的性能，并给每台服务器添加要给权值，如果服务器A的权值为1，服务器B的权值为2，则调度到服务器B的请求会是服务器A的2倍。权值越高的服务器，处理的请求越多。</p><h3 id="dh"><a href="#dh" class="headerlink" title="dh"></a>dh</h3><p>dh：目标地址散列调度算法 （destination hash）<br>简单的说，即将同一类型的请求分配给同一个后端服务器，例如将以 .jgp、.png等结尾的请求转发到同一个节点。这种算法其实不是为了真正意义的负载均衡，而是为了资源的分类管理。这种调度算法主要应用在使用了缓存节点的系统中，提高缓存的命中率。</p><h3 id="sh"><a href="#sh" class="headerlink" title="sh"></a>sh</h3><p>sh：源地址散列调度算法（source hash）<br>即将来自同一个ip的请求发给后端的同一个服务器，如果后端服务器工作正常没有超负荷的话。这可以解决session共享的问题，但是这里有个问题，很多企业、社区、学校都是共用的一个IP，这将导致请求分配的不均衡。</p><h3 id="lc"><a href="#lc" class="headerlink" title="lc"></a>lc</h3><p>lc：最少连接数（least-connection）<br>这个算法会根据后端 RS 的连接数来决定把请求分发给谁，比如 RS1 连接数比 RS2 连接数少，那么请求就优先发给 RS1。这里问题是无法做到会话保持，即session共享。</p><h3 id="wlc"><a href="#wlc" class="headerlink" title="wlc"></a>wlc</h3><p>wlc：加权最少连接数（weight least-connection）<br>这个比最少连接数多了一个加权的概念，即在最少连接数的基础上加一个权重值，当连接数相近，权重值越大，越优先被分派请求。</p><h3 id="lblc"><a href="#lblc" class="headerlink" title="lblc"></a>lblc</h3><p>lblc：基于局部性的最少连接调度算法（locality-based least-connection）<br>将来自同一目的地址的请求分配给同一台RS如果这台服务器尚未满负荷，否则分配给连接数最小的RS，并以它为下一次分配的首先考虑。</p><h3 id="lblcr"><a href="#lblcr" class="headerlink" title="lblcr"></a>lblcr</h3><p>lblcr：基于地址的带重复最小连接数调度 (Locality-Based Least-Connection with Replication)</p><h1 id="安装ipvsadm"><a href="#安装ipvsadm" class="headerlink" title="安装ipvsadm"></a>安装ipvsadm</h1><h2 id="ubuntu"><a href="#ubuntu" class="headerlink" title="ubuntu"></a>ubuntu</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install ipvsadm</span><br></pre></td></tr></table></figure><h2 id="centos"><a href="#centos" class="headerlink" title="centos"></a>centos</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install ipvsadm</span><br><span class="line"><span class="comment">#systemctl start ipvsadm</span></span><br><span class="line"><span class="comment">#systemctl enable ipvsadm</span></span><br></pre></td></tr></table></figure><h1 id="使用ipvsadm"><a href="#使用ipvsadm" class="headerlink" title="使用ipvsadm"></a>使用ipvsadm</h1><h2 id="ipvsadm命令帮助"><a href="#ipvsadm命令帮助" class="headerlink" title="ipvsadm命令帮助"></a>ipvsadm命令帮助</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm v1.27 2008/5/15 (compiled with popt and IPVS v1.2.1)</span><br><span class="line">Usage:</span><br><span class="line">  ipvsadm -A|E -t|u|f service-address [-s scheduler] [-p [timeout]] [-M netmask] [--pe persistence_engine] [-b sched-flags]</span><br><span class="line">  ipvsadm -D -t|u|f service-address</span><br><span class="line">  ipvsadm -C</span><br><span class="line">  ipvsadm -R</span><br><span class="line">  ipvsadm -S [-n]</span><br><span class="line">  ipvsadm -a|e -t|u|f service-address -r server-address [options]</span><br><span class="line">  ipvsadm -d -t|u|f service-address -r server-address</span><br><span class="line">  ipvsadm -L|l [options]</span><br><span class="line">  ipvsadm -Z [-t|u|f service-address]</span><br><span class="line">  ipvsadm --set tcp tcpfin udp</span><br><span class="line">  ipvsadm --start-daemon state [--mcast-interface interface] [--syncid sid]</span><br><span class="line">  ipvsadm --stop-daemon state</span><br><span class="line">  ipvsadm -h</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">Either long or short options are allowed.</span><br><span class="line">  --add-service     -A        add virtual service with options</span><br><span class="line">  --edit-service    -E        edit virtual service with options</span><br><span class="line">  --delete-service  -D        delete virtual service</span><br><span class="line">  --clear           -C        clear the whole table</span><br><span class="line">  --restore         -R        restore rules from stdin</span><br><span class="line">  --save            -S        save rules to stdout</span><br><span class="line">  --add-server      -a        add real server with options</span><br><span class="line">  --edit-server     -e        edit real server with options</span><br><span class="line">  --delete-server   -d        delete real server</span><br><span class="line">  --list            -L|-l     list the table</span><br><span class="line">  --zero            -Z        zero counters in a service or all services</span><br><span class="line">  --set tcp tcpfin udp        set connection timeout values</span><br><span class="line">  --start-daemon              start connection sync daemon</span><br><span class="line">  --stop-daemon               stop connection sync daemon</span><br><span class="line">  --help            -h        display this help message</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --tcp-service  -t service-address   service-address is host[:port]</span><br><span class="line">  --udp-service  -u service-address   service-address is host[:port]</span><br><span class="line">  --fwmark-service  -f fwmark         fwmark is an integer greater than zero</span><br><span class="line">  --ipv6         -6                   fwmark entry uses IPv6</span><br><span class="line">  --scheduler    -s scheduler         one of rr|wrr|lc|wlc|lblc|lblcr|dh|sh|sed|nq,</span><br><span class="line">                                      the default scheduler is wlc.</span><br><span class="line">  --pe            engine              alternate persistence engine may be sip,</span><br><span class="line">                                      not set by default.</span><br><span class="line">  --persistent   -p [timeout]         persistent service</span><br><span class="line">  --netmask      -M netmask           persistent granularity mask</span><br><span class="line">  --real-server  -r server-address    server-address is host (and port)</span><br><span class="line">  --gatewaying   -g                   gatewaying (direct routing) (default)</span><br><span class="line">  --ipip         -i                   ipip encapsulation (tunneling)</span><br><span class="line">  --masquerading -m                   masquerading (NAT)</span><br><span class="line">  --weight       -w weight            capacity of real server</span><br><span class="line">  --u-threshold  -x uthreshold        upper threshold of connections</span><br><span class="line">  --l-threshold  -y lthreshold        lower threshold of connections</span><br><span class="line">  --mcast-interface interface         multicast interface for connection sync</span><br><span class="line">  --syncid sid                        syncid for connection sync (default=255)</span><br><span class="line">  --connection   -c                   output of current IPVS connections</span><br><span class="line">  --timeout                           output of timeout (tcp tcpfin udp)</span><br><span class="line">  --daemon                            output of daemon information</span><br><span class="line">  --stats                             output of statistics information</span><br><span class="line">  --rate                              output of rate information</span><br><span class="line">  --exact                             expand numbers (display exact values)</span><br><span class="line">  --thresholds                        output of thresholds information</span><br><span class="line">  --persistent-conn                   output of persistent connection info</span><br><span class="line">  --nosort                            disable sorting output of service/server entries</span><br><span class="line">  --sort                              does nothing, for backwards compatibility</span><br><span class="line">  --ops          -o                   one-packet scheduling</span><br><span class="line">  --numeric      -n                   numeric output of addresses and ports</span><br><span class="line">  --sched-flags  -b flags             scheduler flags (comma-separated)</span><br></pre></td></tr></table></figure><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://man.cx/?page=ipvsadm(8)">ipvsadm(8)</a></li><li><a target="_blank" rel="noopener" href="https://www.linuxcool.com/ipvsadm">ipvsadm命令 – 管理Linux虚拟服务器</a></li><li><a target="_blank" rel="noopener" href="https://www.modb.pro/db/151087">LVS策略管理工具：ipvsadm命令详解</a></li></ul><h2 id="环境描述"><a href="#环境描述" class="headerlink" title="环境描述"></a>环境描述</h2><p>192.168.56.254作为DS，创建虚拟服务时，虚拟服务的VIP要使用这个IP。<br>192.168.56.102-104作为RS，上面部署nginx服务在80端口。</p><h2 id="查看虚拟服务和真实服务器"><a href="#查看虚拟服务和真实服务器" class="headerlink" title="查看虚拟服务和真实服务器"></a>查看虚拟服务和真实服务器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -Ln</span><br></pre></td></tr></table></figure><h2 id="查看ipvs模块中的链接信息"><a href="#查看ipvs模块中的链接信息" class="headerlink" title="查看ipvs模块中的链接信息"></a>查看ipvs模块中的链接信息</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -lnc</span><br></pre></td></tr></table></figure><h2 id="查看ipvs模块中的转发情况信息"><a href="#查看ipvs模块中的转发情况信息" class="headerlink" title="查看ipvs模块中的转发情况信息"></a>查看ipvs模块中的转发情况信息</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -Ln --stats | --rate</span><br></pre></td></tr></table></figure><h2 id="添加虚拟服务"><a href="#添加虚拟服务" class="headerlink" title="添加虚拟服务"></a>添加虚拟服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -A -t 192.168.56.254:80 -s rr</span><br></pre></td></tr></table></figure><h2 id="修改虚拟服务算法"><a href="#修改虚拟服务算法" class="headerlink" title="修改虚拟服务算法"></a>修改虚拟服务算法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -E -t 192.168.56.254:80 -s wlc</span><br></pre></td></tr></table></figure><h2 id="删除虚拟服务"><a href="#删除虚拟服务" class="headerlink" title="删除虚拟服务"></a>删除虚拟服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -D -t 192.168.56.254:80</span><br></pre></td></tr></table></figure><h2 id="添加真实服务器"><a href="#添加真实服务器" class="headerlink" title="添加真实服务器"></a>添加真实服务器</h2><p>NAT模式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -a -t 192.168.56.254:80 -r 192.168.56.102:80 -m</span><br><span class="line">ipvsadm -a -t 192.168.56.254:80 -r 192.168.56.103:80 -m</span><br></pre></td></tr></table></figure><p>NAT模式加权轮询：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -a -t 192.168.56.254:80 -r 192.168.56.104:80 -m -w 1</span><br></pre></td></tr></table></figure><p>访问测试：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl 192.168.56.254</span><br></pre></td></tr></table></figure><h2 id="修改真实服务器"><a href="#修改真实服务器" class="headerlink" title="修改真实服务器"></a>修改真实服务器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -a -t 192.168.56.254:80 -r 192.168.56.102:80 -m -w 2</span><br></pre></td></tr></table></figure><h2 id="删除真实服务器"><a href="#删除真实服务器" class="headerlink" title="删除真实服务器"></a>删除真实服务器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -d -t 192.168.56.254:80 -r 192.168.56.103:80</span><br></pre></td></tr></table></figure><h2 id="清空转发数据计数器"><a href="#清空转发数据计数器" class="headerlink" title="清空转发数据计数器"></a>清空转发数据计数器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -Z</span><br></pre></td></tr></table></figure><h2 id="删除所有ipvs规则"><a href="#删除所有ipvs规则" class="headerlink" title="删除所有ipvs规则"></a>删除所有ipvs规则</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -C</span><br></pre></td></tr></table></figure><h2 id="保存ipvs规则"><a href="#保存ipvs规则" class="headerlink" title="保存ipvs规则"></a>保存ipvs规则</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm-save &gt; /path/to/ipvsadm</span><br></pre></td></tr></table></figure><h2 id="加载ipvs规则"><a href="#加载ipvs规则" class="headerlink" title="加载ipvs规则"></a>加载ipvs规则</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm-restore &lt; /path/to/ipvsadm</span><br></pre></td></tr></table></figure><h2 id="VIP自定义"><a href="#VIP自定义" class="headerlink" title="VIP自定义"></a>VIP自定义</h2><p>上面的例子中，我们使用的VIP是宿主机的IP，如果想要自己再定义一个IP作为VIP，该怎么搞？<br>答：创建一个VIP，绑定给宿主机的网卡。</p><p>例如，创建一个VIP为10.0.0.10/24，后端RIP为192.168.56.102/24</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ip addr add 10.0.0.10/24 dev enp0s3:0</span><br><span class="line">ipvsadm -A -t 10.0.0.10:80 -s rr</span><br><span class="line">ipvsadm -a -t 10.0.0.10:80 -r 192.168.56.102:80 -m</span><br><span class="line">curl 10.0.0.10</span><br></pre></td></tr></table></figure></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-ipvs-start/" title="ipvs入门篇">https://www.voidking.com/dev-ipvs-start/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag"># 网络</a> <a href="/tags/ipvs/" rel="tag"># ipvs</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-vm9-ubuntu-vmtools/" rel="prev" title="VM9下ubuntu安装vmtools"><i class="fa fa-chevron-left"></i> VM9下ubuntu安装vmtools</a></div><div class="post-nav-item"> <a href="/dev-centos-skill/" rel="next" title="CentOS的一些小技巧">CentOS的一些小技巧<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><div class="_xduxciwe4ao"></div><script type="text/javascript" src="//cpro.baidustatic.com/cpro/ui/cm.js" async="async" defer="defer"></script><script type="text/javascript">(window.slotbydup=window.slotbydup||[]).push({id:"u6920911",container:"_xduxciwe4ao",async:!0}),(window.slotbydup=window.slotbydup||[]).push({id:"u6920919",container:"_053ydasmd31h",async:!0}),(window.slotbydup=window.slotbydup||[]).push({id:"u6921432",container:"_ft8kcphe7kl",async:!0})</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ipvs%E7%AE%80%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">ipvs简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ipvs%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">2.</span> <span class="nav-text">ipvs工作原理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ipvs%E6%9C%AF%E8%AF%AD"><span class="nav-number">2.1.</span> <span class="nav-text">ipvs术语</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ipvs%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="nav-number">2.2.</span> <span class="nav-text">ipvs基本原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ipvs%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.3.</span> <span class="nav-text">ipvs工作模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ipvs%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95"><span class="nav-number">2.4.</span> <span class="nav-text">ipvs调度算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#rr"><span class="nav-number">2.4.1.</span> <span class="nav-text">rr</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wrr"><span class="nav-number">2.4.2.</span> <span class="nav-text">wrr</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dh"><span class="nav-number">2.4.3.</span> <span class="nav-text">dh</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sh"><span class="nav-number">2.4.4.</span> <span class="nav-text">sh</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lc"><span class="nav-number">2.4.5.</span> <span class="nav-text">lc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wlc"><span class="nav-number">2.4.6.</span> <span class="nav-text">wlc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lblc"><span class="nav-number">2.4.7.</span> <span class="nav-text">lblc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lblcr"><span class="nav-number">2.4.8.</span> <span class="nav-text">lblcr</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85ipvsadm"><span class="nav-number">3.</span> <span class="nav-text">安装ipvsadm</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ubuntu"><span class="nav-number">3.1.</span> <span class="nav-text">ubuntu</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#centos"><span class="nav-number">3.2.</span> <span class="nav-text">centos</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8ipvsadm"><span class="nav-number">4.</span> <span class="nav-text">使用ipvsadm</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ipvsadm%E5%91%BD%E4%BB%A4%E5%B8%AE%E5%8A%A9"><span class="nav-number">4.1.</span> <span class="nav-text">ipvsadm命令帮助</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E6%8F%8F%E8%BF%B0"><span class="nav-number">4.2.</span> <span class="nav-text">环境描述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E8%99%9A%E6%8B%9F%E6%9C%8D%E5%8A%A1%E5%92%8C%E7%9C%9F%E5%AE%9E%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">4.3.</span> <span class="nav-text">查看虚拟服务和真实服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8Bipvs%E6%A8%A1%E5%9D%97%E4%B8%AD%E7%9A%84%E9%93%BE%E6%8E%A5%E4%BF%A1%E6%81%AF"><span class="nav-number">4.4.</span> <span class="nav-text">查看ipvs模块中的链接信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8Bipvs%E6%A8%A1%E5%9D%97%E4%B8%AD%E7%9A%84%E8%BD%AC%E5%8F%91%E6%83%85%E5%86%B5%E4%BF%A1%E6%81%AF"><span class="nav-number">4.5.</span> <span class="nav-text">查看ipvs模块中的转发情况信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E8%99%9A%E6%8B%9F%E6%9C%8D%E5%8A%A1"><span class="nav-number">4.6.</span> <span class="nav-text">添加虚拟服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E8%99%9A%E6%8B%9F%E6%9C%8D%E5%8A%A1%E7%AE%97%E6%B3%95"><span class="nav-number">4.7.</span> <span class="nav-text">修改虚拟服务算法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E8%99%9A%E6%8B%9F%E6%9C%8D%E5%8A%A1"><span class="nav-number">4.8.</span> <span class="nav-text">删除虚拟服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E7%9C%9F%E5%AE%9E%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">4.9.</span> <span class="nav-text">添加真实服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E7%9C%9F%E5%AE%9E%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">4.10.</span> <span class="nav-text">修改真实服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E7%9C%9F%E5%AE%9E%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">4.11.</span> <span class="nav-text">删除真实服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%85%E7%A9%BA%E8%BD%AC%E5%8F%91%E6%95%B0%E6%8D%AE%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="nav-number">4.12.</span> <span class="nav-text">清空转发数据计数器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89ipvs%E8%A7%84%E5%88%99"><span class="nav-number">4.13.</span> <span class="nav-text">删除所有ipvs规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%9D%E5%AD%98ipvs%E8%A7%84%E5%88%99"><span class="nav-number">4.14.</span> <span class="nav-text">保存ipvs规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BDipvs%E8%A7%84%E5%88%99"><span class="nav-number">4.15.</span> <span class="nav-text">加载ipvs规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VIP%E8%87%AA%E5%AE%9A%E4%B9%89"><span class="nav-number">4.16.</span> <span class="nav-text">VIP自定义</span></a></li></ol></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3284447971731414" data-ad-slot="2661998066"></ins></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">645</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">242</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>