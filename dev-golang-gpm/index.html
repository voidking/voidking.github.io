<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.voidking.com/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="包管理工具简介大一点的项目，通常会依赖很多第三方包。Golang把所有的第三方包都放在GOPATH&#x2F;src目录下，且每个包仅保留一个版本。如果两个项目依赖不同版本的第三方包，就会产生问题。 为了解决这个问题，go在1.5版本引入了vendor属性（默认关闭），并在1.6版本中默认开启了vendor属性。简单来说，vendor属性就是让go编译时，优先从项目源码树根目录下的vendor目录查找代码（"><meta property="og:type" content="article"><meta property="og:title" content="Golang包管理工具"><meta property="og:url" content="https://www.voidking.com/dev-golang-gpm/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="包管理工具简介大一点的项目，通常会依赖很多第三方包。Golang把所有的第三方包都放在GOPATH&#x2F;src目录下，且每个包仅保留一个版本。如果两个项目依赖不同版本的第三方包，就会产生问题。 为了解决这个问题，go在1.5版本引入了vendor属性（默认关闭），并在1.6版本中默认开启了vendor属性。简单来说，vendor属性就是让go编译时，优先从项目源码树根目录下的vendor目录查找代码（"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com/@/imgs/k8s-client-go/404.jpg?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com/@/imgs/k8s-client-go/goget.jpg?imageView2/0/w/600"><meta property="article:published_time" content="2019-09-20T20:00:00.000Z"><meta property="article:modified_time" content="2019-09-20T20:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="golang"><meta property="article:tag" content="client-go"><meta property="article:tag" content="godep"><meta property="article:tag" content="govendor"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com/@/imgs/k8s-client-go/404.jpg?imageView2/0/w/600"><link rel="canonical" href="https://www.voidking.com/dev-golang-gpm/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Golang包管理工具 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-golang-gpm/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Golang包管理工具</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-09-20 20:00:00" itemprop="dateCreated datePublished" datetime="2019-09-20T20:00:00+00:00">2019-09-20</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/golang/" itemprop="url" rel="index"><span itemprop="name">golang</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/cloudnative/" itemprop="url" rel="index"><span itemprop="name">cloudnative</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="包管理工具简介"><span class="post-title-index">1.</span><a href="#包管理工具简介" class="headerlink" title="包管理工具简介"></a> 包管理工具简介</h1><p>大一点的项目，通常会依赖很多第三方包。Golang把所有的第三方包都放在GOPATH/src目录下，且每个包仅保留一个版本。如果两个项目依赖不同版本的第三方包，就会产生问题。</p><p>为了解决这个问题，go在1.5版本引入了vendor属性（默认关闭），并在1.6版本中默认开启了vendor属性。简单来说，vendor属性就是让go编译时，优先从项目源码树根目录下的vendor目录查找代码（可以理解为切了一次GOPATH），如果vendor中有，则不再去GOPATH中去查找。</p><p>但是vendor目录又带来了新的问题：<br>（1）vendor目录中依赖包没有版本信息。这样依赖包脱离了版本管理，对于升级、问题追溯，会有点困难。<br>（2）如何方便的得到本项目依赖了哪些包，并方便的将其拷贝到vendor目录下？</p><p>为了解决这些问题，开发者在vendor基础上开发了多个管理工具，比较常用的有godep、govendor、glide，以及官方的dep和gomod。下面来学习一下godep、govendor和gomod，更多内容参考<a target="_blank" rel="noopener" href="https://ieevee.com/tech/2017/07/10/go-import.html">go依赖包管理工具对比</a>、<a target="_blank" rel="noopener" href="https://www.cnblogs.com/apocelipes/p/9534885.html">golang包管理解决之道——go modules初探</a>、<a target="_blank" rel="noopener" href="https://www.cnblogs.com/apocelipes/p/10295096.html">再探go modules：使用与细节</a>。</p><span id="more"></span><h1 id="理论篇"><span class="post-title-index">2.</span><a href="#理论篇" class="headerlink" title="理论篇"></a> 理论篇</h1><h2 id="godep"><span class="post-title-index">2.1.</span><a href="#godep" class="headerlink" title="godep"></a> godep</h2><p>godep的使用者众多，如docker、kubernetes、coreos等go项目很多都是使用godep来管理其依赖，当然原因可能是早期也没的工具可选。</p><p>godep早期版本并不依赖vendor，所以对go的版本要求很松，go 1.5之前的版本也可以用，只是行为上有所不同。在vendor推出以后，godep也改为使用vendor了。</p><p>godep使用很简单，当项目编写完成，使用GOPATH的依赖包测试没问题的时候，执行<code>godep save</code>，该命令会做两件事：<br>（1）扫描项目的代码，将项目依赖的包及该包的版本号（即git commit）记录到Godeps/Godeps.json文件中。<br>（2）将依赖的包从GOPATH/src中拷贝到vendor目录（忽略依赖包的.git目录）。对于不支持vendor的早期版本，则会拷贝到Godeps/_workspace/里。</p><p>其他命令：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 安装</span><br><span class="line"><span class="keyword">go</span> <span class="built_in">get</span> -<span class="keyword">u</span> -v github.<span class="keyword">com</span>/tools/godep</span><br><span class="line"></span><br><span class="line"># 安装新的包</span><br><span class="line"><span class="keyword">go</span> <span class="built_in">get</span> github.<span class="keyword">com</span>/voidking/k8s-client-<span class="keyword">go</span></span><br><span class="line">import <span class="string">&quot;github.com/voidking/k8s-client-go&quot;</span></span><br><span class="line">godep save</span><br><span class="line"></span><br><span class="line"># 更新依赖包</span><br><span class="line"><span class="keyword">go</span> <span class="built_in">get</span> -<span class="keyword">u</span> github.<span class="keyword">com</span>/voidking/k8s-client-<span class="keyword">go</span></span><br><span class="line">godep <span class="keyword">update</span> github.<span class="keyword">com</span>/voidking/k8s-client-<span class="keyword">go</span></span><br><span class="line"># <span class="built_in">or</span></span><br><span class="line">godep <span class="keyword">update</span> github.<span class="keyword">com</span>/voidking/...</span><br><span class="line"></span><br><span class="line"># 下载godeps.json里的包到GOPATH/src</span><br><span class="line">godep restore</span><br></pre></td></tr></table></figure><h2 id="govendor"><span class="post-title-index">2.2.</span><a href="#govendor" class="headerlink" title="govendor"></a> govendor</h2><p>govendor是在vendor之后出现的，功能相对godep多一点，不过就核心问题的解决来说基本是一样的。govendor生成vendor目录的时候需要2条命令：<br><code>govendor init</code>生成vendor/vendor.json，此时文件中只有本项目的信息。<br><code>govendor add +external</code>更新vendor/vendor.json，并拷贝GOPATH下的第三方包到vendor目录中。</p><p>其他命令：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">go get -u github.com<span class="regexp">/kardianos/g</span>ovendor</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取指定版本的包</span></span><br><span class="line">govendor fetch golang.org<span class="regexp">/x/</span>net/context@v1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看依赖的包</span></span><br><span class="line">govendor list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看哪些包使用了fmt</span></span><br><span class="line">govendor list -v fmt</span><br></pre></td></tr></table></figure><h2 id="gomod"><span class="post-title-index">2.3.</span><a href="#gomod" class="headerlink" title="gomod"></a> gomod</h2><p>go modules随着golang1.11的发布和我们见面了，这是官方提倡的新的包管理，乃至项目管理机制，可以不再需要GOPATH的存在。</p><p>现在modules机制仍在早期阶段，所以golang提供了一个环境变量“GO111MODULE”，默认值为auto，如果当前目录里有go.mod文件，就使用go modules，否则使用旧的GOPATH和vendor机制，因为在modules机制下go get只会下载go modules，这一行为会在以后版本中成为默认值，这里我们保持auto即可，如果你想直接使用modules而不需要从GOPATH过度，那么把“GO111MODULE”设置为on。</p><p>modules和传统的GOPATH不同，不需要包含例如src，bin这样的子目录，一个源代码目录甚至是空目录都可以作为module，只要其中包含有go.mod文件。</p><p>1、启用modules机制</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># linux and mac</span></span><br><span class="line"><span class="built_in">export</span> <span class="attribute">GO111MODULE</span>=on</span><br><span class="line"></span><br><span class="line"><span class="comment"># windows powershell</span></span><br><span class="line"><span class="variable">$env</span>:GO111MODULE = <span class="string">&quot;on&quot;</span></span><br></pre></td></tr></table></figure><p>2、初始化test项目为module<br><code>go mod init test</code><br>初始化之后，目录下会自动生成go.mod文件。当我们使用go build，go test以及go list时，go会自动得更新go.mod文件，将依赖关系写入其中。</p><p>3、整理依赖<br><code>go mod tidy -v</code></p><ul><li>这条命令会自动下载依赖的module到cache，清除无用的module。</li><li>生成go.mod的require部分，和go.sum文件。go.sum是一个构建状态跟踪文件，它会记录当前module所有的顶层和间接依赖，go modules根据这些记录去寻找对应的依赖。</li><li>依赖的module下载到GOPATH/pkg/cache/和GOPATH/pkg/mod/目录下。</li></ul><p>4、Goland启用gomod<br>File，Settings，Go，Go Modules，勾选Enable Go Modules(vgo) integration，Apply。</p><p>其他命令：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 帮助</span><br><span class="line"><span class="keyword">go</span> <span class="keyword">help</span> <span class="keyword">mod</span></span><br><span class="line"></span><br><span class="line"># 已有<span class="keyword">go</span>.<span class="keyword">mod</span>，下载依赖到cache</span><br><span class="line"><span class="keyword">go</span> <span class="keyword">mod</span> download</span><br><span class="line"></span><br><span class="line"># 拷贝依赖到vendor（没有则先下载）</span><br><span class="line"><span class="keyword">go</span> <span class="keyword">mod</span> vendor</span><br><span class="line"></span><br><span class="line"># 清空cache</span><br><span class="line"><span class="keyword">go</span> clean -modcache</span><br></pre></td></tr></table></figure><h1 id="gomod实践篇"><span class="post-title-index">3.</span><a href="#gomod实践篇" class="headerlink" title="gomod实践篇"></a> gomod实践篇</h1><h2 id="安装client-go"><span class="post-title-index">3.1.</span><a href="#安装client-go" class="headerlink" title="安装client-go"></a> 安装client-go</h2><p>假设一个项目依赖client-go，那么参考<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/tasks/administer-cluster/access-cluster-api/#go-client">官方说明</a>进行安装。</p><p>1、查看k8s版本<br><code>kubectl version</code><br>Client Version表示kubectl的版本，Server Version表示apiserver的版本（假设版本为v1.15.0）。</p><p>2、查找对应版本的client-go<br>在<a target="_blank" rel="noopener" href="https://github.com/kubernetes/client-go">kubernetes/client-go</a>上查找k8s v1.15.0对应的client-go版本，找到版本为12.0</p><p>3、安装对应版本的client-go<br><code>go get k8s.io/client-go/12.0/kubernetes</code><br>这里有个坑，国内无法访问k8s.io，需要科学上网（恰好我的搬瓦工服务器也访问不到k8s.io）。因此，这里使用GOPROXY的方式来解决，参考<a target="_blank" rel="noopener" href="https://shockerli.net/post/go-get-golang-org-x-solution/">一键解决 go get golang.org/x 包失败</a>。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># export GOPROXY=https://goproxy.cn</span></span><br><span class="line"><span class="built_in">export</span> <span class="attribute">GOPROXY</span>=https://goproxy.io</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">GO111MODULE</span>=on</span><br><span class="line">go <span class="built_in">get</span> k8s.io/client-go/12.0/kubernetes</span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com/@/imgs/k8s-client-go/404.jpg?imageView2/0/w/600"></p><p>失败了，返回404，猜测是12.0版本在代理服务器不存在，使用另外一种下载方式。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">go</span> get k8s.io/client-go@kubernetes-<span class="number">1</span>.<span class="number">15</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com/@/imgs/k8s-client-go/goget.jpg?imageView2/0/w/600"><br>此处下载了两个版本的client-go，我们使用v0.0.0版本。</p><p>4、安装client-go相关依赖<br>client-go默认下载到<code>$GOPATH/pkg/mod/k8s.io</code>目录下，把k8s.io目录移动到<code>$GOPATH/src</code>目录下。然后把<a href="mailto:&#x63;&#x6c;&#x69;&#101;&#110;&#116;&#45;&#103;&#x6f;&#64;&#x76;&#48;&#x2e;&#48;&#x2e;&#x30;">&#x63;&#x6c;&#x69;&#101;&#110;&#116;&#45;&#103;&#x6f;&#64;&#x76;&#48;&#x2e;&#48;&#x2e;&#x30;</a>重命名为client-go，然后在client-go目录下执行安装依赖的命令：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="attribute">GOPROXY</span>=https://goproxy.io</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">GO111MODULE</span>=on</span><br><span class="line">go mod vendor</span><br></pre></td></tr></table></figure><p>完成之后，所有的依赖都下载到了client-go/vendor目录下，一个完整的client-go依赖库就准备好了。</p><h2 id="依赖库版本管理"><span class="post-title-index">3.2.</span><a href="#依赖库版本管理" class="headerlink" title="依赖库版本管理"></a> 依赖库版本管理</h2><p>client-go依赖库准备好了，但是另一个问题来了：假设项目vk-project依赖client-go和库A，client-go依赖库A，两个依赖库A版本不一致，那么vk-project在编译时，会同时依赖两个不同的库A，导致编译出的二进制包有问题。</p><p>此时，一个简单的办法是把GOPATH/src/k8s.io/client-go/vendor目录剪切覆盖vk-project/vendor目录，然后把GOPATH/src/k8s.io/client-go目录移动到vk-project/vendor/k8s.io/目录下。这么做的话，client-go就和自己的依赖是平级的存在了。</p><p>但是，这么做有另一个问题：依赖库版本没有记录。因为没有版本记录，那么在上传vk-project项目时，就要把依赖全部上传，否则别人下载了vk-project也没办法正确安装依赖。</p><p>这里，使用gomod进行依赖库版本管理。</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">go</span> <span class="built_in">mod</span> init vk-project</span><br><span class="line"><span class="built_in">go</span> <span class="built_in">mod</span> tidy -v</span><br><span class="line"><span class="built_in">go</span> <span class="built_in">mod</span> vendor</span><br></pre></td></tr></table></figure><p>上传代码时忽略vendor目录，在gitignore中添加：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/vendor/</span></span><br></pre></td></tr></table></figure><h2 id="安装依赖"><span class="post-title-index">3.3.</span><a href="#安装依赖" class="headerlink" title="安装依赖"></a> 安装依赖</h2><p>1、下载项目后，进入项目目录<br><code>cd vk-project</code></p><p>2、下载依赖<br><code>go mod download</code></p><p>3、拷贝依赖到vendor（可选）<br><code>go mod vendor</code></p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-golang-gpm/" title="Golang包管理工具">https://www.voidking.com/dev-golang-gpm/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/golang/" rel="tag"># golang</a> <a href="/tags/client-go/" rel="tag"># client-go</a> <a href="/tags/godep/" rel="tag"># godep</a> <a href="/tags/govendor/" rel="tag"># govendor</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-k8s-client-go/" rel="prev" title="使用client-go操作K8S"><i class="fa fa-chevron-left"></i> 使用client-go操作K8S</a></div><div class="post-nav-item"> <a href="/dev-k8s-client-go-deploy/" rel="next" title="使用client-go在K8S集群发布项目">使用client-go在K8S集群发布项目<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3284447971731414" data-ad-slot="9697986181"></ins><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E7%AE%80%E4%BB%8B"><span class="nav-text">1. 包管理工具简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%90%86%E8%AE%BA%E7%AF%87"><span class="nav-text">2. 理论篇</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#godep"><span class="nav-text">2.1. godep</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#govendor"><span class="nav-text">2.2. govendor</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gomod"><span class="nav-text">2.3. gomod</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#gomod%E5%AE%9E%E8%B7%B5%E7%AF%87"><span class="nav-text">3. gomod实践篇</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85client-go"><span class="nav-text">3.1. 安装client-go</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E5%BA%93%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86"><span class="nav-text">3.2. 依赖库版本管理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="nav-text">3.3. 安装依赖</span></a></li></ol></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">650</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">29</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">242</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: '9acf52f658488e66816f69c4f4c2b61a',
      title: 'Golang包管理工具',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>