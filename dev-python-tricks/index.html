<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="语法检查pylint 是一个能够检查Python编码质量、编码规范的工具。它分析 Python 代码中的错误，查找不符合代码风格标准（Pylint 默认使用的代码风格是 PEP 8）和有潜在问题的代码。 个人认为正确性比风格更加重要，不妨大材小用，执行脚本之前，都使用pylint进行语法检查一下。 12pip install pylintpylint test.py"><meta property="og:type" content="article"><meta property="og:title" content="Python小技巧"><meta property="og:url" content="https://www.voidking.com/dev-python-tricks/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="语法检查pylint 是一个能够检查Python编码质量、编码规范的工具。它分析 Python 代码中的错误，查找不符合代码风格标准（Pylint 默认使用的代码风格是 PEP 8）和有潜在问题的代码。 个人认为正确性比风格更加重要，不妨大材小用，执行脚本之前，都使用pylint进行语法检查一下。 12pip install pylintpylint test.py"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2021-11-07T12:00:00.000Z"><meta property="article:modified_time" content="2022-04-17T00:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="python"><meta property="article:tag" content="测试"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-python-tricks/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Python小技巧 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-python-tricks/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Python小技巧</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-11-07 20:00:00" itemprop="dateCreated datePublished" datetime="2021-11-07T20:00:00+08:00">2021-11-07</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-04-17 08:00:00" itemprop="dateModified" datetime="2022-04-17T08:00:00+08:00">2022-04-17</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/" itemprop="url" rel="index"><span itemprop="name">专业</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">开发</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E5%BC%80%E5%8F%91/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="语法检查"><a href="#语法检查" class="headerlink" title="语法检查"></a>语法检查</h1><p><a href="https://www.pylint.org/" target="_blank" rel="noopener">pylint</a> 是一个能够检查Python编码质量、编码规范的工具。它分析 Python 代码中的错误，查找不符合代码风格标准（Pylint 默认使用的代码风格是 PEP 8）和有潜在问题的代码。</p><p>个人认为正确性比风格更加重要，不妨大材小用，执行脚本之前，都使用pylint进行语法检查一下。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install pylint</span><br><span class="line">pylint test.py</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="导入自定义模块"><a href="#导入自定义模块" class="headerlink" title="导入自定义模块"></a>导入自定义模块</h1><h2 id="全局导入"><a href="#全局导入" class="headerlink" title="全局导入"></a>全局导入</h2><p>自己新建了一个模块，怎样让它可以被全局引用？答：导入自定义模块。<br>具体操作方法：<br>1、进入 xxx/python3/lib/python3.6/site-packages 目录<br>2、新建 yyy.pth 文件，写入自定义模块的路径</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/home/</span>voidking<span class="regexp">/scripts/</span>vktools<span class="regexp">/</span></span><br></pre></td></tr></table></figure><p>详情参考<a href="https://blog.csdn.net/yuezhuo_752/article/details/95632014" target="_blank" rel="noopener">python之使用.pth文件导入自定义模块</a></p><h2 id="指定文件导入"><a href="#指定文件导入" class="headerlink" title="指定文件导入"></a>指定文件导入</h2><p>自己新建了一个模块a，路径不同的情况下，怎样让它被模块b引用？答：使用 sys.path.append 函数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sys.path.remove('/path/to/a')</span></span><br><span class="line">sys.path.append(<span class="string">'/path/to/a'</span>)</span><br></pre></td></tr></table></figure><h1 id="获取脚本路径"><a href="#获取脚本路径" class="headerlink" title="获取脚本路径"></a>获取脚本路径</h1><p>已知路径：</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">path</span><br><span class="line">└── <span class="keyword">module</span><span class="number">_</span>a</span><br><span class="line">    ├── getpath.py</span><br><span class="line">    └── <span class="keyword">module</span><span class="number">_</span>b</span><br><span class="line">        └── getpath.py</span><br></pre></td></tr></table></figure><p>getpath.py脚本内容为：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> module_b <span class="keyword">import</span> getpath</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_path</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">f'os.getcwd() is <span class="subst">&#123;os.getcwd()&#125;</span>'</span>)</span><br><span class="line">    print(<span class="string">f'sys.path[0] is <span class="subst">&#123;sys.path[<span class="number">0</span>]&#125;</span>'</span>)</span><br><span class="line">    print(<span class="string">f'sys.argv[0] is <span class="subst">&#123;sys.argv[<span class="number">0</span>]&#125;</span>'</span>)</span><br><span class="line">    print(<span class="string">f'__file__ is <span class="subst">&#123;__file__&#125;</span>'</span>)</span><br><span class="line">    print(<span class="string">f'os.path.dirname(__file__) is <span class="subst">&#123;os.path.dirname(__file__)&#125;</span>'</span>)</span><br><span class="line">    print(<span class="string">f'os.path.abspath(__file__) is <span class="subst">&#123;os.path.abspath(__file__)&#125;</span>'</span>)</span><br><span class="line">    print(<span class="string">f'os.path.realpath(__file__) is <span class="subst">&#123;os.path.realpath(__file__)&#125;</span>'</span>)</span><br><span class="line">    print(<span class="string">f'os.path.split(os.path.realpath(__file__))[0] is <span class="subst">&#123;os.path.split(os.path.realpath(__file__))[<span class="number">0</span>]&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'------ module_a/getpath.py ------'</span>)</span><br><span class="line">print_path()</span><br><span class="line">print(<span class="string">'---------------------------------'</span>)</span><br><span class="line">print(<span class="string">'------ module_a/module_b/getpath.py ------'</span>)</span><br><span class="line">getpath.print_path()</span><br><span class="line">print(<span class="string">'------------------------------------------'</span>)</span><br></pre></td></tr></table></figure><p>在path目录中执行脚本<code>python module_a/getpath.py</code> ，得到结果为：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">------ module_a/getpath.py ------</span></span><br><span class="line">os.getcwd() <span class="keyword">is</span> /Users/vk/tmp/<span class="type">path</span></span><br><span class="line">sys.path[<span class="number">0</span>] <span class="keyword">is</span> /Users/vk/tmp/<span class="type">path</span>/module_a</span><br><span class="line">sys.argv[<span class="number">0</span>] <span class="keyword">is</span> module_a/getpath.py</span><br><span class="line">__file__ <span class="keyword">is</span> module_a/getpath.py</span><br><span class="line">os.path.dirname(__file__) <span class="keyword">is</span> module_a</span><br><span class="line">os.path.abspath(__file__) <span class="keyword">is</span> /Users/vk/tmp/<span class="type">path</span>/module_a/getpath.py</span><br><span class="line">os.path.realpath(__file__) <span class="keyword">is</span> /Users/vk/tmp/<span class="type">path</span>/module_a/getpath.py</span><br><span class="line">os.path.split(os.path.realpath(__file__))[<span class="number">0</span>] <span class="keyword">is</span> /Users/vk/tmp/<span class="type">path</span>/module_a</span><br><span class="line"><span class="comment">---------------------------------</span></span><br><span class="line"><span class="comment">------ module_a/module_b/getpath.py ------</span></span><br><span class="line">os.getcwd() <span class="keyword">is</span> /Users/vk/tmp/<span class="type">path</span></span><br><span class="line">sys.path[<span class="number">0</span>] <span class="keyword">is</span> /Users/vk/tmp/<span class="type">path</span>/module_a</span><br><span class="line">sys.argv[<span class="number">0</span>] <span class="keyword">is</span> module_a/getpath.py</span><br><span class="line">__file__ <span class="keyword">is</span> /Users/vk/tmp/<span class="type">path</span>/module_a/module_b/getpath.py</span><br><span class="line">os.path.dirname(__file__) <span class="keyword">is</span> /Users/vk/tmp/<span class="type">path</span>/module_a/module_b</span><br><span class="line">os.path.abspath(__file__) <span class="keyword">is</span> /Users/vk/tmp/<span class="type">path</span>/module_a/module_b/getpath.py</span><br><span class="line">os.path.realpath(__file__) <span class="keyword">is</span> /Users/vk/tmp/<span class="type">path</span>/module_a/module_b/getpath.py</span><br><span class="line">os.path.split(os.path.realpath(__file__))[<span class="number">0</span>] <span class="keyword">is</span> /Users/vk/tmp/<span class="type">path</span>/module_a/module_b</span><br><span class="line"><span class="comment">------------------------------------------</span></span><br></pre></td></tr></table></figure><p>由实验结果，可以得出如下结论。</p><h2 id="获取执行命令的绝对路径"><a href="#获取执行命令的绝对路径" class="headerlink" title="获取执行命令的绝对路径"></a>获取执行命令的绝对路径</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.getcwd()</span><br></pre></td></tr></table></figure><h2 id="获取入口脚本的父绝对路径"><a href="#获取入口脚本的父绝对路径" class="headerlink" title="获取入口脚本的父绝对路径"></a>获取入口脚本的父绝对路径</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sys.path[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><h2 id="获取执行脚本的绝对路劲"><a href="#获取执行脚本的绝对路劲" class="headerlink" title="获取执行脚本的绝对路劲"></a>获取执行脚本的绝对路劲</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">os.path.abspath(__file__)</span><br><span class="line">os.path.realpath(__file__)</span><br></pre></td></tr></table></figure><h2 id="获取执行脚本的父绝对路径"><a href="#获取执行脚本的父绝对路径" class="headerlink" title="获取执行脚本的父绝对路径"></a>获取执行脚本的父绝对路径</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.path.split(os.path.realpath(__file__))[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><h2 id="获取文件-目录的父路径"><a href="#获取文件-目录的父路径" class="headerlink" title="获取文件/目录的父路径"></a>获取文件/目录的父路径</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.path.dirname(__file__)</span><br></pre></td></tr></table></figure><h1 id="查找文件"><a href="#查找文件" class="headerlink" title="查找文件"></a>查找文件</h1><p>在指定目录中，根据文件前缀查找文件。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_files_by_prefix</span><span class="params">(prefix, dir_path)</span>:</span></span><br><span class="line">    file_list = list()</span><br><span class="line">    file_pattern = os.path.join(dir_path, <span class="string">'&#123;&#125;*'</span>.format(prefix))</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> glob.glob(file_pattern):</span><br><span class="line">        file_list.append(f)</span><br><span class="line">    <span class="keyword">return</span> file_list</span><br></pre></td></tr></table></figure><h1 id="删除目录和文件"><a href="#删除目录和文件" class="headerlink" title="删除目录和文件"></a>删除目录和文件</h1><p>封装几个简单函数，删除目录和文件。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除空目录</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_dir</span><span class="params">(dir_path)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(dir_path):</span><br><span class="line">        os.removedirs(dir_path)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除文件</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_file</span><span class="params">(file_path)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(file_path):</span><br><span class="line">        os.remove(file_path)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除目录和文件</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_dir_and_file</span><span class="params">(dir_path)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(dir_path):</span><br><span class="line">        shutil.rmtree(dir_path)</span><br></pre></td></tr></table></figure><h1 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h1><p><a href="https://docs.python.org/zh-cn/3/library/unittest.html" target="_blank" rel="noopener">unittest</a>是一个Python单元测试框架。它受到 JUnit 的启发，与其他语言中的主流单元测试框架有着相似的风格。其支持测试自动化，配置共享和关机代码测试。支持将测试样例聚合到测试集中，并将测试与报告框架独立。</p><h2 id="脚本编写"><a href="#脚本编写" class="headerlink" title="脚本编写"></a>脚本编写</h2><p>新建一个 tests/test_demo.py 脚本，内容如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestStringMethods</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_upper</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.assertEqual(<span class="string">'foo'</span>.upper(), <span class="string">'FOO'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_isupper</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.assertTrue(<span class="string">'FOO'</span>.isupper())</span><br><span class="line">        self.assertFalse(<span class="string">'Foo'</span>.isupper())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_split</span><span class="params">(self)</span>:</span></span><br><span class="line">        s = <span class="string">'hello world'</span></span><br><span class="line">        self.assertEqual(s.split(), [<span class="string">'hello'</span>, <span class="string">'world'</span>])</span><br><span class="line">        <span class="comment"># check that s.split fails when the separator is not a string</span></span><br><span class="line">        <span class="keyword">with</span> self.assertRaises(TypeError):</span><br><span class="line">            s.split(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure><p>继承 unittest.TestCase 就创建了一个测试样例。上述三个独立的测试是三个类的方法，这些方法的命名都以 test 开头。 这个命名约定告诉测试运行者类的哪些方法表示测试。</p><p>每个测试的关键是：调用 assertEqual() 来检查预期的输出； 调用 assertTrue() 或 assertFalse() 来验证一个条件；调用 assertRaises() 来验证抛出了一个特定的异常。</p><p>通过 setUp() 和 tearDown() 方法，可以设置测试开始前与完成后需要执行的指令。</p><p>最后的代码块中，演示了运行测试的一个简单的方法。 unittest.main() 提供了一个测试脚本的命令行接口。</p><h2 id="执行测试"><a href="#执行测试" class="headerlink" title="执行测试"></a>执行测试</h2><p>方法一：脚本级别调用（直接运行脚本）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python tests/test_demo.py</span><br><span class="line">python tests/test_demo.py -v</span><br><span class="line">python -m unittest tests/test_demo.py</span><br></pre></td></tr></table></figure><p>方法二：包、模块、类和方法级别调用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 包级别调用（进入tests目录查找所有test_*.py文件并运行）</span></span><br><span class="line">python -m unittest discover -s tests -p "test_*.py"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 模块级别调用</span></span><br><span class="line">python -m unittest tests.test_demo</span><br><span class="line"><span class="meta">#</span><span class="bash"> 类级别调用</span></span><br><span class="line">python -m unittest tests.test_demo.TestStringMethods</span><br><span class="line"><span class="meta">#</span><span class="bash"> 方法级别调用</span></span><br><span class="line">python -m unittest tests.test_demo.TestStringMethods.test_upper</span><br></pre></td></tr></table></figure><h2 id="单元测试之mock"><a href="#单元测试之mock" class="headerlink" title="单元测试之mock"></a>单元测试之mock</h2><p>单元测试时，如果涉及网络请求，建议使用mock模块来模拟。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> unittest <span class="keyword">import</span> mock</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">request_system</span><span class="params">(method: str, url: str, data=&#123;&#125;)</span>:</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.request(method=method, url=url, headers=headers, data=json.dumps(data))</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(username: str, password: str)</span>:</span></span><br><span class="line">    <span class="comment"># 以下接口暂时访问不通</span></span><br><span class="line">    LOGIN_URL=<span class="string">'http://127.0.0.1/login'</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">'username'</span>: username,</span><br><span class="line">        <span class="string">'password'</span>: password</span><br><span class="line">    &#125;</span><br><span class="line">    response = request_system(<span class="string">'POST'</span>, LOGIN_URL)</span><br><span class="line">    <span class="keyword">if</span> response.status == <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">return</span> json.loads(response.text)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestMockMethods</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_request_system</span><span class="params">(self)</span>:</span></span><br><span class="line">        mock_response = mock.Mock()</span><br><span class="line">        mock_response.status_code = <span class="number">200</span></span><br><span class="line">        mock_response.text = json.dumps(&#123;<span class="string">"code"</span>: <span class="number">0</span>, <span class="string">"msg"</span>:<span class="string">"success"</span>&#125;)</span><br><span class="line">        request_system = mock.Mock(return_value=mock_response)</span><br><span class="line"></span><br><span class="line">        response = request_system(method=<span class="string">'POST'</span>,url=<span class="string">'http://127.0.0.1/'</span>)</span><br><span class="line">        print(response.status_code)</span><br><span class="line">        print(response.text)</span><br><span class="line">        self.assertEqual(<span class="number">200</span>, response.status_code)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_login</span><span class="params">(self)</span>:</span></span><br><span class="line">        login = mock.Mock(return_value=&#123;<span class="string">"code"</span>: <span class="number">0</span>, <span class="string">"msg"</span>:<span class="string">"success"</span>&#125;)</span><br><span class="line">        data = login(username=<span class="string">'voidking'</span>,password=<span class="string">'voidking'</span>)</span><br><span class="line">        print(data)</span><br><span class="line">        self.assertEqual(<span class="number">0</span>, data.get(<span class="string">'code'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure><p>这种模拟测试方式很巧妙，适合测试访问第三方接口，但是并不会真正发出请求。<br>另一个问题来了，Python怎么测试自己的接口？不知道。<br>想到以前使用Beego框架进行开发，它的单元测试就很巧妙，先在测试数据库插入数据，然后通过beego.BeeApp.Handlers.ServeHTTP(w, r)把自己临时启动起来，最后自己的单元测试调用自己的接口。<br>其中的关键在于把自己启动起来，理论上Python也能做到。</p><h1 id="url特殊字符转义"><a href="#url特殊字符转义" class="headerlink" title="url特殊字符转义"></a>url特殊字符转义</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line">labelselector = parse.quote(<span class="string">'app_id=voidking,env in (test,online)'</span>)</span><br><span class="line">url = <span class="string">f'https://www.voidking.com?labelselector=<span class="subst">&#123;labelselector&#125;</span>'</span></span><br></pre></td></tr></table></figure><p>特殊字符对应url编码表：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">空格 : %20</span><br><span class="line">" : %22</span><br><span class="line"># : %23</span><br><span class="line">% : %25</span><br><span class="line">&amp; : %26</span><br><span class="line">( : %28</span><br><span class="line">) : %29</span><br><span class="line">+ : %2B</span><br><span class="line">, : %2C</span><br><span class="line">/ : %2F</span><br><span class="line"><span class="meta">: :</span> %3A</span><br><span class="line">; : %3B</span><br><span class="line">&lt; : %3C</span><br><span class="line"><span class="section">= : %3D</span></span><br><span class="line">&gt; : %3E</span><br><span class="line">? : %3F</span><br><span class="line">@ : %40</span><br><span class="line">\ : %5C</span><br><span class="line">| : %7C</span><br></pre></td></tr></table></figure><h1 id="函数重试"><a href="#函数重试" class="headerlink" title="函数重试"></a>函数重试</h1><p>函数重试，我们可以通过循环多次调用实现，也可以使用retrying包。</p><h2 id="任意异常重试"><a href="#任意异常重试" class="headerlink" title="任意异常重试"></a>任意异常重试</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> retrying <span class="keyword">import</span> retry</span><br><span class="line"></span><br><span class="line"><span class="meta">@retry(stop_max_attempt_number=3, wait_random_min=1000, wait_random_max=3000)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'run'</span>)</span><br><span class="line">    <span class="keyword">raise</span> ValueError</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure><p>当函数run抛出任意异常时，则进行重试。</p><ul><li>stop_max_attempt_number：最大重试次数</li><li>wait_random_min：最小重试间隔</li><li>wait_random_max：最大重试间隔</li></ul><p>注意函数内不要使用try except，否则异常就被函数自己捕获处理了，不会抛给retry。</p><h2 id="指定异常重试"><a href="#指定异常重试" class="headerlink" title="指定异常重试"></a>指定异常重试</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> retrying <span class="keyword">import</span> retry</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">if_value_error</span><span class="params">(exception)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> isinstance(exception, ValueError)</span><br><span class="line"></span><br><span class="line"><span class="meta">@retry(retry_on_exception=if_value_error, stop_max_attempt_number=3, wait_random_min=1000, wait_random_max=3000)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    value = random.randint(<span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line">    msg = <span class="string">f'value is <span class="subst">&#123;value&#125;</span>'</span></span><br><span class="line">    print(msg)</span><br><span class="line">    <span class="keyword">if</span> value &lt;= <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'value is too small!'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">'value is too large!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure><p>当函数run抛出ValueError异常时，则进行重试；抛出Exception异常时，不会重试。</p><h2 id="指定返回值重试"><a href="#指定返回值重试" class="headerlink" title="指定返回值重试"></a>指定返回值重试</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> retrying <span class="keyword">import</span> retry</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">if_return_small</span><span class="params">(value)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> value &lt;= <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@retry(retry_on_result=if_return_small, stop_max_attempt_number=3, wait_random_min=1000, wait_random_max=3000)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    value = random.randint(<span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line">    msg = <span class="string">f'value is <span class="subst">&#123;value&#125;</span>'</span></span><br><span class="line">    print(msg)</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure><p>当函数run返回值小于5时，进行重试。</p><h2 id="多次重试后容忍异常"><a href="#多次重试后容忍异常" class="headerlink" title="多次重试后容忍异常"></a>多次重试后容忍异常</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> retrying <span class="keyword">import</span> retry</span><br><span class="line"></span><br><span class="line"><span class="meta">@retry(stop_max_attempt_number=3, wait_random_min=1000, wait_random_max=3000)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'run'</span>)</span><br><span class="line">    <span class="keyword">raise</span> ValueError</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run2</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'run2'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    run()</span><br><span class="line">    run2()</span><br></pre></td></tr></table></figure><p>当函数run抛出任意异常时，则进行重试。重试指定次数后，程序就异常结束了。这时，如果我们想要容忍异常，让run2可以正常运行，该怎么办呢？很简单，给run函数包裹一个try except即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> retrying <span class="keyword">import</span> retry</span><br><span class="line"></span><br><span class="line"><span class="meta">@retry(wrap_exception=True,stop_max_attempt_number=3, wait_random_min=1000, wait_random_max=3000)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'run'</span>)</span><br><span class="line">    <span class="keyword">raise</span> ValueError</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrap_run</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        run()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run2</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'run2'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    wrap_run()</span><br><span class="line">    run2()</span><br></pre></td></tr></table></figure><h1 id="操作mysql数据库"><a href="#操作mysql数据库" class="headerlink" title="操作mysql数据库"></a>操作mysql数据库</h1><p>python操作mysql数据库，是经常遇到的需求，下面整理一下具体操作方法。</p><h2 id="数据库准备"><a href="#数据库准备" class="headerlink" title="数据库准备"></a>数据库准备</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> vkphp <span class="keyword">default</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8 <span class="keyword">collate</span> utf8_general_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> vkphp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="string">`user`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">8</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`password`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure><p>更多内容参考<a href="https://www.voidking.com/dev-docker-mysql/">《使用Docker安装配置Mysql》</a>和<a href="https://www.voidking.com/dev-mysql-command/">《MySQL常用命令》</a></p><h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><p><code>pip3 install mysqlclient==1.3.13</code></p><h2 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开数据库连接</span></span><br><span class="line">db = MySQLdb.connect(host=<span class="string">"localhost"</span>, </span><br><span class="line">                    port=<span class="string">"3306"</span>,</span><br><span class="line">                    user=<span class="string">"root"</span>, </span><br><span class="line">                    password=<span class="string">"voidking"</span>, </span><br><span class="line">                    database=<span class="string">"vkphp"</span>, </span><br><span class="line">                    charset=<span class="string">'utf8'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用cursor()方法获取操作游标 </span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># SQL 插入语句</span></span><br><span class="line">sql = <span class="string">"insert into `user` (`name`,`password`) values('haojin','voidking');"</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">   <span class="comment"># 执行sql语句</span></span><br><span class="line">   cursor.execute(sql)</span><br><span class="line">   <span class="comment"># 提交到数据库执行</span></span><br><span class="line">   db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">   <span class="comment"># 发生错误时回滚</span></span><br><span class="line">   db.rollback()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭数据库连接</span></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><p>其他操作参考<a href="https://www.runoob.com/python/python-mysql.html" target="_blank" rel="noopener">Python 操作 MySQL 数据库</a>。</p><h1 id="安装pip"><a href="#安装pip" class="headerlink" title="安装pip"></a>安装pip</h1><p>一些情况下，在安装python时没有默认安装pip，这时就需要手动安装。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 方法一：</span></span><br><span class="line">python -m ensurepip</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 方法二：</span></span><br><span class="line">wget https://bootstrap.pypa.io/get-pip.py</span><br><span class="line">python get-pip.py -i http://pypi.douban.com/simple/ --trusted-host pypi.douban.com</span><br></pre></td></tr></table></figure><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul><li><a href="https://docs.python.org/3.6/" target="_blank" rel="noopener">Python官方文档</a></li><li><a href="https://docs.python.org/zh-cn/3.6/download.html" target="_blank" rel="noopener">Python官方文档下载</a></li><li><a href="https://www.python.org/downloads/windows/" target="_blank" rel="noopener">Python官方文档下载-chm格式</a></li><li><a href="https://magic.iswbm.com/" target="_blank" rel="noopener">Python黑魔法手册</a></li><li><a href="https://python3-cookbook.readthedocs.io/zh_CN/latest/" target="_blank" rel="noopener">Python Cookbook 3rd Edition Documentation</a></li><li><a href="https://www.kancloud.cn/kancloud/google-style-guide/43289" target="_blank" rel="noopener">Google Python风格指南</a></li><li><a href="https://docs.python.org/zh-cn/3/library/unittest.html" target="_blank" rel="noopener">unittest - 单元测试框架</a></li></ul></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-python-tricks/" title="Python小技巧">https://www.voidking.com/dev-python-tricks/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/python/" rel="tag"># python</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" rel="tag"># 测试</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-python-log/" rel="prev" title="Python打印日志"><i class="fa fa-chevron-left"></i> Python打印日志</a></div><div class="post-nav-item"> <a href="/dev-airflow-start/" rel="next" title="Airflow入门篇">Airflow入门篇<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#语法检查"><span class="nav-number">1.</span> <span class="nav-text">语法检查</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#导入自定义模块"><span class="nav-number">2.</span> <span class="nav-text">导入自定义模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#全局导入"><span class="nav-number">2.1.</span> <span class="nav-text">全局导入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指定文件导入"><span class="nav-number">2.2.</span> <span class="nav-text">指定文件导入</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#获取脚本路径"><span class="nav-number">3.</span> <span class="nav-text">获取脚本路径</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#获取执行命令的绝对路径"><span class="nav-number">3.1.</span> <span class="nav-text">获取执行命令的绝对路径</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取入口脚本的父绝对路径"><span class="nav-number">3.2.</span> <span class="nav-text">获取入口脚本的父绝对路径</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取执行脚本的绝对路劲"><span class="nav-number">3.3.</span> <span class="nav-text">获取执行脚本的绝对路劲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取执行脚本的父绝对路径"><span class="nav-number">3.4.</span> <span class="nav-text">获取执行脚本的父绝对路径</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取文件-目录的父路径"><span class="nav-number">3.5.</span> <span class="nav-text">获取文件&#x2F;目录的父路径</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#查找文件"><span class="nav-number">4.</span> <span class="nav-text">查找文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#删除目录和文件"><span class="nav-number">5.</span> <span class="nav-text">删除目录和文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#单元测试"><span class="nav-number">6.</span> <span class="nav-text">单元测试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#脚本编写"><span class="nav-number">6.1.</span> <span class="nav-text">脚本编写</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#执行测试"><span class="nav-number">6.2.</span> <span class="nav-text">执行测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#单元测试之mock"><span class="nav-number">6.3.</span> <span class="nav-text">单元测试之mock</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#url特殊字符转义"><span class="nav-number">7.</span> <span class="nav-text">url特殊字符转义</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#函数重试"><span class="nav-number">8.</span> <span class="nav-text">函数重试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#任意异常重试"><span class="nav-number">8.1.</span> <span class="nav-text">任意异常重试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指定异常重试"><span class="nav-number">8.2.</span> <span class="nav-text">指定异常重试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指定返回值重试"><span class="nav-number">8.3.</span> <span class="nav-text">指定返回值重试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多次重试后容忍异常"><span class="nav-number">8.4.</span> <span class="nav-text">多次重试后容忍异常</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#操作mysql数据库"><span class="nav-number">9.</span> <span class="nav-text">操作mysql数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库准备"><span class="nav-number">9.1.</span> <span class="nav-text">数据库准备</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装依赖"><span class="nav-number">9.2.</span> <span class="nav-text">安装依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#插入数据"><span class="nav-number">9.3.</span> <span class="nav-text">插入数据</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装pip"><span class="nav-number">10.</span> <span class="nav-text">安装pip</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考文档"><span class="nav-number">11.</span> <span class="nav-text">参考文档</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">632</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">50</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">199</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://www.beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>