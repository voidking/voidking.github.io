<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//qiniu-cdn.voidking.com/doc/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="sealos hub简介在使用sealos安装k8s时，会自动安装一个docker registry，它就是sealos hub，用于存储容器镜像。sealos hub在集群中的主机名和端口为sealos.hub:5000，默认用户名admin，密码passw0rd。 参考文档：  labring&#x2F;sealos Sealos - 集群生命周期管理 Sealos 命令说明"><meta property="og:type" content="article"><meta property="og:title" content="好好学Sealos：Sealos Hub私有容器镜像仓库"><meta property="og:url" content="https://www.voidking.com/dev-sealos-hub/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="sealos hub简介在使用sealos安装k8s时，会自动安装一个docker registry，它就是sealos hub，用于存储容器镜像。sealos hub在集群中的主机名和端口为sealos.hub:5000，默认用户名admin，密码passw0rd。 参考文档：  labring&#x2F;sealos Sealos - 集群生命周期管理 Sealos 命令说明"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://sealos.run/assets/images/image-cri-shim-e4a9e589d78a85f24defeb20bd8f8d05.png"><meta property="article:published_time" content="2023-01-04T10:00:00.000Z"><meta property="article:modified_time" content="2024-02-24T08:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="docker"><meta property="article:tag" content="k8s"><meta property="article:tag" content="问题排查"><meta property="article:tag" content="sealos"><meta property="article:tag" content="好好学Sealos"><meta property="article:tag" content="htpasswd"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://sealos.run/assets/images/image-cri-shim-e4a9e589d78a85f24defeb20bd8f8d05.png"><link rel="canonical" href="https://www.voidking.com/dev-sealos-hub/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>好好学Sealos：Sealos Hub私有容器镜像仓库 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">一个计算机技术爱好者与学习者</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-sealos-hub/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="一个计算机技术爱好者与学习者"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> 好好学Sealos：Sealos Hub私有容器镜像仓库</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-01-04 10:00:00" itemprop="dateCreated datePublished" datetime="2023-01-04T10:00:00+00:00">2023-01-04</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-02-24 08:00:00" itemprop="dateModified" datetime="2024-02-24T08:00:00+00:00">2024-02-24</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/cloudnative/" itemprop="url" rel="index"><span itemprop="name">cloudnative</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/troubleshooting/" itemprop="url" rel="index"><span itemprop="name">troubleshooting</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="sealos-hub简介"><span class="post-title-index">1.</span><a href="#sealos-hub简介" class="headerlink" title="sealos hub简介"></a> sealos hub简介</h1><p>在使用sealos安装k8s时，会自动安装一个docker registry，它就是sealos hub，用于存储容器镜像。<br>sealos hub在集群中的主机名和端口为<code>sealos.hub:5000</code>，默认用户名<code>admin</code>，密码<code>passw0rd</code>。</p><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://github.com/labring/sealos">labring/sealos</a></li><li><a target="_blank" rel="noopener" href="https://www.sealyun.com/docs/lifecycle-management/">Sealos - 集群生命周期管理</a></li><li><a target="_blank" rel="noopener" href="https://sealos.io/docs/lifecycle-management/reference/sealos/commands/">Sealos 命令说明</a></li></ul><span id="more"></span><h1 id="sealos-hub部署方式"><span class="post-title-index">2.</span><a href="#sealos-hub部署方式" class="headerlink" title="sealos hub部署方式"></a> sealos hub部署方式</h1><p>sealos hub会部署到宿主机上，我们可以通过systemctl对它进行管理。</p><p>查看registry状态：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status registry</span><br></pre></td></tr></table></figure><p>配置文件路径：/etc/registry/registry_config.yml<br>密码路径：/etc/registry/registry_htpasswd</p><h1 id="sealos-hub原理"><span class="post-title-index">3.</span><a href="#sealos-hub原理" class="headerlink" title="sealos hub原理"></a> sealos hub原理</h1><h2 id="存储容器镜像"><span class="post-title-index">3.1.</span><a href="#存储容器镜像" class="headerlink" title="存储容器镜像"></a> 存储容器镜像</h2><p>sealos build 的过程中，如何知道软件中有哪些容器镜像？<br>因为我们需要把这些镜像缓存下来，不管是扫描用户的 yaml 文件还是用 helm template 之后扫描都是不完美的。首先不能确定用户的编排方式是什么，其次有些软件不把镜像地址写在编排文件中，而是通过自己的程序去拉起，无法保证 build 成功运行就一定没问题。</p><p>对于这个问题，sealos的处理方法比较原始，需要用户自己找到需要的容器镜像列表，写入到 <code>images/shim/images-list.txt</code> 文件中。</p><p>sealos build 打包集群镜像完成后，容器镜像就存储到了集群镜像中，在使用 sealos run 安装应用时，容器镜像就会被加载到本地存储 sealos hub仓库中。</p><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://juejin.cn/post/7088146275677241380">揭秘sealer背后实现整个集群一键交付的奥秘 | 龙蜥技术</a></li><li><a target="_blank" rel="noopener" href="https://sealos.io/zh-Hans/docs/self-hosting/lifecycle-management/advanced-guide/sealos-run">Sealos Run 的工作原理</a></li><li><a href="https://www.voidking.com/dev-sealos-mysql/">《sealos制作MySQL集群镜像》</a></li><li><a href="https://www.voidking.com/dev-sealos-kube-prometheus-stack/">《sealos制作 kube-prometheus-stack 集群镜像》</a></li></ul><h2 id="下载容器镜像"><span class="post-title-index">3.2.</span><a href="#下载容器镜像" class="headerlink" title="下载容器镜像"></a> 下载容器镜像</h2><p>容器镜像被打包到了集群镜像里，sealos run时容器镜像被存储到了私有仓库sealos hub中。<br>此时，编排文件中写的容器镜像地址 和 私有仓库容器镜像地址 是不一致的，怎么保证用户从私有仓库中下载容器镜像？特别是怎么保证用户 alwayPull 的时候还是能够在私有仓库中下载到镜像？</p><p>对于这个问题，有两种解决方案：<br>第一种是 hack docker，让docker具备只要私有镜像仓库中有就直接从私有镜像中拉取，没有才去公网拉取镜像的能力。<br>第二种方案是无侵入 docker 的 proxy，把 docker 请求全部打给代理，让代理去决定如果私有仓库有就从私有仓库拉取。同时增强了 registry 的能力让 registry 可以 cache 多个远程仓库的能力。</p><p>sealos采用的是第二种方案：docker 的 proxy，<a href="(https://github.com/labring/image-cri-shim)">image-cri-shim</a>。</p><p><img src="https://sealos.run/assets/images/image-cri-shim-e4a9e589d78a85f24defeb20bd8f8d05.png"></p><p>image-cri-shim 是一个基于 CRI (Container Runtime Interface) 和 kubelet 的 gRPC (Google Remote Procedure Call) shim。CRI 是 Kubernetes 中用于与容器运行时进行交互的接口，而 kubelet 是负责维护容器运行状态和节点级别的资源管理的 Kubernetes 组件。</p><p>image-cri-shim 的主要功能是自动识别镜像名称，让用户在使用 Kubernetes 部署容器时无需手动指定镜像名称。这样可以降低用户的操作难度，提高部署容器的便利性。</p><p>在实际使用中，image-cri-shim 可以作为一个中间件，接收来自 kubelet 的请求，然后将请求转发给容器运行时。通过自动识别镜像名称，image-cri-shim 可以简化容器镜像的部署流程，减轻用户的操作负担。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml --container-runtime=remote --container-runtime-endpoint=/var/run/cri-dockerd.sock --container-runtime=remote --pod-infra-container-image=sealos.hub:5000/pause:3.2 --runtime-request-timeout=15m --container-runtime-endpoint=unix:///var/run/cri-dockerd.sock --image-service-endpoint=unix:///var/run/image-cri-shim.sock</span><br></pre></td></tr></table></figure><p>上面的kubelet启动命令中，通过指定 <code>--image-service-endpoint=unix:///var/run/image-cri-shim.sock</code> ，实现了 image-cri-shim 中间件的配置，很巧妙。</p><p>image-cri-shim 示例配置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">shim:</span> <span class="string">/var/run/image-cri-shim.sock</span></span><br><span class="line"><span class="attr">cri:</span> <span class="string">/run/containerd/containerd.sock</span></span><br><span class="line"><span class="attr">address:</span> <span class="string">http://sealos.hub:5000</span></span><br><span class="line"><span class="attr">force:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">debug:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">timeout:</span> <span class="string">15m</span></span><br><span class="line"><span class="attr">auth:</span> <span class="string">admin:passw0rd</span></span><br><span class="line"></span><br><span class="line"><span class="attr">registries:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">address:</span> <span class="string">http://172.18.1.38:5000</span></span><br><span class="line">  <span class="attr">auth:</span> <span class="string">admin:passw0rd</span></span><br></pre></td></tr></table></figure><p>配置说明：</p><ul><li>shim: 指定 image-cri-shim 的 UNIX 套接字文件路径。这个路径用于与 kubelet 之间的通信。</li><li>cri: 指定容器运行时（如 containerd）的 UNIX 套接字文件路径。image-cri-shim 会使用这个路径与容器运行时进行通信。</li><li>address: 定义镜像仓库的地址。在本例中，镜像仓库地址为 <a href="http://sealos.hub:5000。">http://sealos.hub:5000。</a></li><li>force: 设置为 true 时，image-cri-shim 会在强制启动shim,无需等待cri启动后启动。</li><li>debug: 设置为 true 时，启用调试模式，输出更多的日志信息。</li><li>timeout: 定义镜像操作的超时时间。在本例中，超时时间为 15 分钟（15m）。</li><li>auth: 定义用于访问镜像仓库的身份验证凭据。在本例中，用户名为 admin，密码为 passw0rd。</li></ul><p>此外，配置文件还包含了一个 registries 列表，用于定义其他镜像仓库及其身份验证凭据，以便 sealos hub 从其他镜像仓库拉取镜像。在这个例子中，只有一个其他仓库：</p><ul><li>address: 该仓库的地址为 <a href="http://172.18.1.38:5000。">http://172.18.1.38:5000。</a></li><li>auth: 用于访问该仓库的身份验证凭据。在本例中，用户名为 admin，密码为 passw0rd。 这个配置文件为 image-cri-shim 提供了所需的信息，以便正确地与 kubelet 和容器运行时（如 containerd）进行通信，以及访问和管理镜像仓库。</li></ul><p>image-cri-shim 通常作为一个系统服务运行。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl start image-cri-shim</span><br><span class="line">systemctl stop image-cri-shim</span><br><span class="line">systemctl restart image-cri-shim</span><br><span class="line">systemctl status image-cri-shim</span><br></pre></td></tr></table></figure><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://juejin.cn/post/7088146275677241380">揭秘sealer背后实现整个集群一键交付的奥秘 | 龙蜥技术</a></li><li><a target="_blank" rel="noopener" href="https://sealos.run/docs/self-hosting/lifecycle-management/reference/Image-cri-shim/">image-cri-shim 使用指南</a></li><li><a target="_blank" rel="noopener" href="https://github.com/labring/image-cri-shim">github - labring/image-cri-shim</a></li><li><a target="_blank" rel="noopener" href="https://sealos.io/zh-Hans/docs/self-hosting/lifecycle-management/operations/registry/using_sealoshub_private_registry">如何使用 sealos作为私有容器仓库</a></li></ul><h1 id="sealos-hub弱密码问题"><span class="post-title-index">4.</span><a href="#sealos-hub弱密码问题" class="headerlink" title="sealos hub弱密码问题"></a> sealos hub弱密码问题</h1><h2 id="问题描述"><span class="post-title-index">4.1.</span><a href="#问题描述" class="headerlink" title="问题描述"></a> 问题描述</h2><p>sealos hub的默认admin密码为<code>passw0rd</code>，是一个弱密码，可能会被漏洞扫描工具扫描出来，因此最好改成强密码。</p><h2 id="解决办法（错误）"><span class="post-title-index">4.2.</span><a href="#解决办法（错误）" class="headerlink" title="解决办法（错误）"></a> 解决办法（错误）</h2><p>修改 /etc/registry/registry_htpasswd 密码本文件中的admin用户的密码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">htpasswd -Bb /etc/registry/registry_htpasswd admin xxx</span><br><span class="line"></span><br><span class="line">systemctl restart registry</span><br></pre></td></tr></table></figure><p>修改密码后，每个主机都使用新密码重新登录一下registry。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">logout</span> sealos.hub:5000</span><br><span class="line">docker login sealos.hub:5000</span><br></pre></td></tr></table></figure><p>PS：htpasswd的安装使用方法，参考文档<a href="https://www.voidking.com/dev-shell-htpasswd/">《shell命令之htpasswd》</a></p><h2 id="新的问题"><span class="post-title-index">4.3.</span><a href="#新的问题" class="headerlink" title="新的问题"></a> 新的问题</h2><p>使用 htpasswd 修改了 /etc/registry/registry_htpasswd 中的密码，docker login也可以使用新密码登录了，但是查看registry日志，很多请求还是使用旧密码，而且主机重启后很多原本正常running的pod无法拉取镜像了。<br>看来我们上面修改sealos hub密码的方法并不正确。</p><h2 id="解决办法（正确）"><span class="post-title-index">4.4.</span><a href="#解决办法（正确）" class="headerlink" title="解决办法（正确）"></a> 解决办法（正确）</h2><p>sealos群里咨询大佬们，获悉可以使用最新版本的sealos来修改registry密码。<br>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://docs.sealos.io/docs/lifecycle-management/reference/sealos/commands/registry#sealossealos-registry-passwd-%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3%E4%B8%8E%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97">Sealos：sealos registry passwd 命令详解与使用指南</a></li><li><a target="_blank" rel="noopener" href="https://github.com/labring/sealos/pull/3119">refactor(main): replace registry password config generator</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/labring/sealos/releases/download/v4.2.3/sealos_4.2.3_linux_amd64.tar.gz</span><br><span class="line">tar -xzvf sealos_4.2.3_linux_amd64.tar.gz sealos</span><br><span class="line">./sealos registry passwd</span><br></pre></td></tr></table></figure><p>此外，修改完registry密码后，还需要修改 <code>~/.sealos/default/Clusterfile</code> 中的registry密码配置，以便在新增节点时使用新密码。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">mounts:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">env:</span></span><br><span class="line">      <span class="attr">registryDomain:</span> <span class="string">sealos.hub</span></span><br><span class="line">      <span class="attr">registryPassword:</span> <span class="string">new_password</span></span><br></pre></td></tr></table></figure><p>上面的配置，在实测时并没有生效，不知道应该修改哪里的配置，留个坑。<br>新增节点时，最终采用的方案是先改回原密码<code>passw0rd</code>，新增节点后密码再改回。</p><p>对于4.2.0之前的版本，如果想要手动修改密码的话，所有机器的 registry.yml 还有 image-shim 以及 containerd 的配置应该都需要改，比较麻烦。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>原文链接：</strong> <a href="https://www.voidking.com/dev-sealos-hub/" title="好好学Sealos：Sealos Hub私有容器镜像仓库">https://www.voidking.com/dev-sealos-hub/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本文采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议，转载请注明出处！源站会即时更新知识点并修正错误，欢迎访问~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/docker/" rel="tag"># docker</a> <a href="/tags/k8s/" rel="tag"># k8s</a> <a href="/tags/%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/" rel="tag"># 问题排查</a> <a href="/tags/sealos/" rel="tag"># sealos</a> <a href="/tags/%E5%A5%BD%E5%A5%BD%E5%AD%A6Sealos/" rel="tag"># 好好学Sealos</a> <a href="/tags/htpasswd/" rel="tag"># htpasswd</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-sealos-start/" rel="prev" title="好好学Sealos：Sealos入门篇"><i class="fa fa-chevron-left"></i> 好好学Sealos：Sealos入门篇</a></div><div class="post-nav-item"> <a href="/dev-sealos-cloud/" rel="next" title="好好学Sealos：Sealos Cloud">好好学Sealos：Sealos Cloud<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#sealos-hub%E7%AE%80%E4%BB%8B"><span class="nav-text">1. sealos hub简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sealos-hub%E9%83%A8%E7%BD%B2%E6%96%B9%E5%BC%8F"><span class="nav-text">2. sealos hub部署方式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sealos-hub%E5%8E%9F%E7%90%86"><span class="nav-text">3. sealos hub原理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F"><span class="nav-text">3.1. 存储容器镜像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F"><span class="nav-text">3.2. 下载容器镜像</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sealos-hub%E5%BC%B1%E5%AF%86%E7%A0%81%E9%97%AE%E9%A2%98"><span class="nav-text">4. sealos hub弱密码问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="nav-text">4.1. 问题描述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95%EF%BC%88%E9%94%99%E8%AF%AF%EF%BC%89"><span class="nav-text">4.2. 解决办法（错误）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">4.3. 新的问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95%EF%BC%88%E6%AD%A3%E7%A1%AE%EF%BC%89"><span class="nav-text">4.4. 解决办法（正确）</span></a></li></ol></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">一个计算机技术爱好者与学习者</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">776</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">33</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">269</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2026</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://cdn.staticfile.net/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://cdn.staticfile.net/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: '045737a72a80f856c6764d9f864f85d7',
      title: '好好学Sealos：Sealos Hub私有容器镜像仓库',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>