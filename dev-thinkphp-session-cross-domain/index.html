<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//qiniu-cdn.voidking.com/doc/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="问题描述《thinkphp实现短信验证注册》中，郝同学不止记录了短信验证码的实现方法，同时还记录了图片验证码的实现方法。本地使用，一切正常；后端项目和前端项目都部署到服务器，一切正常；后端项目部署到服务器，并设置允许跨域访问后，本地前端项目使用服务器上后端项目接口时，问题来了：首先，使用postman测试获取图片验证码接口和验证图片验证码接口，正常。然后，在html中使用获取图片验证码接口，正常；"><meta property="og:type" content="article"><meta property="og:title" content="好好学PHP：thinkphp中session跨域问题"><meta property="og:url" content="https://www.voidking.com/dev-thinkphp-session-cross-domain/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="问题描述《thinkphp实现短信验证注册》中，郝同学不止记录了短信验证码的实现方法，同时还记录了图片验证码的实现方法。本地使用，一切正常；后端项目和前端项目都部署到服务器，一切正常；后端项目部署到服务器，并设置允许跨域访问后，本地前端项目使用服务器上后端项目接口时，问题来了：首先，使用postman测试获取图片验证码接口和验证图片验证码接口，正常。然后，在html中使用获取图片验证码接口，正常；"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com/img/session-cross-domain/compare.jpg"><meta property="article:published_time" content="2016-11-27T12:42:38.000Z"><meta property="article:modified_time" content="2016-11-27T12:42:38.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="nginx"><meta property="article:tag" content="好好学PHP"><meta property="article:tag" content="thinkphp"><meta property="article:tag" content="session"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com/img/session-cross-domain/compare.jpg"><link rel="canonical" href="https://www.voidking.com/dev-thinkphp-session-cross-domain/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>好好学PHP：thinkphp中session跨域问题 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">一个计算机技术爱好者与学习者</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-thinkphp-session-cross-domain/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="一个计算机技术爱好者与学习者"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> 好好学PHP：thinkphp中session跨域问题</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2016-11-27 12:42:38" itemprop="dateCreated datePublished" datetime="2016-11-27T12:42:38+00:00">2016-11-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/php/" itemprop="url" rel="index"><span itemprop="name">php</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="问题描述"><span class="post-title-index">1.</span><a href="#问题描述" class="headerlink" title="问题描述"></a> 问题描述</h1><p>《thinkphp实现短信验证注册》中，郝同学不止记录了短信验证码的实现方法，同时还记录了图片验证码的实现方法。<br>本地使用，一切正常；后端项目和前端项目都部署到服务器，一切正常；后端项目部署到服务器，并设置允许跨域访问后，本地前端项目使用服务器上后端项目接口时，问题来了：<br>首先，使用postman测试获取图片验证码接口和验证图片验证码接口，正常。<br>然后，在html中使用获取图片验证码接口，正常；最后，在JS中使用验证图片验证码接口，出错！！！</p><span id="more"></span><h1 id="分析"><span class="post-title-index">2.</span><a href="#分析" class="headerlink" title="分析"></a> 分析</h1><p>通过问题描述，我们看出，问题出现在跨域上。那么，有两种可能，一种是因为跨域设置不正确；一种是因为thinkphp本身的问题。</p><p>采用另外一种跨域配置，问题依然存在。那就是thinkphp本身的问题了，经查找资料，问题定位在thinkphp的session跨域上。</p><h1 id="跨子域解决办法"><span class="post-title-index">3.</span><a href="#跨子域解决办法" class="headerlink" title="跨子域解决办法"></a> 跨子域解决办法</h1><p>其实不管是ThinkPHP还是php本身，在解决session跨域问题的时候都需要设置session.cookie_domain。<br>针对session跨域这一问题的解决方法主要有以下几种：<br>第一种情况：如果目录下没有.htaccess这个文件，也就是没有采取url伪静态的话，那么，在conf/config.php的第一行加上：</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ini_set<span class="punctuation">(</span>&#x27;session.cookie_domain&#x27;<span class="punctuation">,</span><span class="string">&quot;.domain.com&quot;</span><span class="punctuation">)</span><span class="punctuation">;</span><span class="comment">//跨域访问Session</span></span><br></pre></td></tr></table></figure><p>这时如果你开启了调试，那么可以用！但关闭了调试，就不管用了！</p><p>第二种情况：如果你目录下有.htaccess这个文件，那么你在根目录，index.php的第一行加入：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.cookie_domain&#x27;</span>,<span class="string">&quot;.domain.com&quot;</span>);<span class="comment">//跨域访问Session</span></span><br><span class="line"><span class="comment">// 应用入口文件</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这种方法不管开不开启调试都管用！</p><p>然而，我们的问题并不是跨子域的问题，而是完全跨域，所以上述方法无效。</p><h1 id="完全跨域解决办法"><span class="post-title-index">4.</span><a href="#完全跨域解决办法" class="headerlink" title="完全跨域解决办法"></a> 完全跨域解决办法</h1><h2 id="获取图片验证码请求"><span class="post-title-index">4.1.</span><a href="#获取图片验证码请求" class="headerlink" title="获取图片验证码请求"></a> 获取图片验证码请求</h2><p>查看获取图片验证码的请求信息，Request Headers为：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Accept</span>:image/webp,image/*,*/*;q=<span class="number">0</span>.<span class="number">8</span></span><br><span class="line"><span class="attribute">Accept</span>-Encoding:gzip, deflate, sdch</span><br><span class="line"><span class="attribute">Accept</span>-Language:zh-CN,zh;q=<span class="number">0</span>.<span class="number">8</span>,en-US;q=<span class="number">0</span>.<span class="number">6</span>,en;q=<span class="number">0</span>.<span class="number">4</span></span><br><span class="line"><span class="attribute">Connection</span>:keep-alive</span><br><span class="line"><span class="attribute">Cookie</span>:pma_lang=zh_CN; pma_collation_connection=utf8_unicode_ci; pma_iv-<span class="number">1</span>=wnpO4gv0eQRW1AMHmGr2ww%<span class="number">3</span>D%<span class="number">3</span>D; pmaUser-<span class="number">1</span>=weZPqS0%<span class="number">2</span>BW7nzFUVHRdqcfA%<span class="number">3</span>D%<span class="number">3</span>D</span><br><span class="line"><span class="attribute">Host</span>:api.voidking.com</span><br><span class="line"><span class="attribute">Referer</span>:http://localhost/ajax/ajax.html</span><br><span class="line"><span class="attribute">User</span>-Agent:Mozilla/<span class="number">5</span>.<span class="number">0</span> (Windows NT <span class="number">6</span>.<span class="number">3</span>; Win64; x64) AppleWebKit/<span class="number">537</span>.<span class="number">36</span> (KHTML, like Gecko) Chrome/<span class="number">54</span>.<span class="number">0</span>.<span class="number">2840</span>.<span class="number">71</span> Safari/<span class="number">537</span>.<span class="number">36</span></span><br></pre></td></tr></table></figure><p>Response Headers为：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Access</span>-Control-<span class="literal">Allow</span>-Origin:*</span><br><span class="line"><span class="attribute">Cache</span>-Control:post-check=<span class="number">0</span>, pre-check=<span class="number">0</span></span><br><span class="line"><span class="attribute">Cache</span>-Control:private, max-age=<span class="number">0</span>, no-store, no-cache, must-revalidate</span><br><span class="line"><span class="attribute">Connection</span>:keep-alive</span><br><span class="line"><span class="attribute">Content</span>-Type:image/png</span><br><span class="line"><span class="attribute">Date</span>:Sun, <span class="number">27</span> Nov <span class="number">2016</span> <span class="number">12</span>:<span class="number">10</span>:<span class="number">44</span> GMT</span><br><span class="line"><span class="attribute">Expires</span>:Thu, <span class="number">19</span> Nov <span class="number">1981</span> <span class="number">08</span>:<span class="number">52</span>:<span class="number">00</span> GMT</span><br><span class="line"><span class="attribute">Pragma</span>:no-cache</span><br><span class="line"><span class="attribute">Server</span>:nginx</span><br><span class="line"><span class="attribute">Set</span>-Cookie:PHPSESSID=<span class="number">721</span>t4sqanvsii550m1dk8gq1o3; path=/; domain=.voidking.com</span><br><span class="line"><span class="attribute">Transfer</span>-Encoding:chunked</span><br></pre></td></tr></table></figure><h2 id="验证验证码请求"><span class="post-title-index">4.2.</span><a href="#验证验证码请求" class="headerlink" title="验证验证码请求"></a> 验证验证码请求</h2><p>查看验证验证码的请求信息，Request Headers为：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Accept</span>:application/json, text/javascript, */*; q=<span class="number">0</span>.<span class="number">01</span></span><br><span class="line"><span class="attribute">Accept</span>-Encoding:gzip, deflate</span><br><span class="line"><span class="attribute">Accept</span>-Language:zh-CN,zh;q=<span class="number">0</span>.<span class="number">8</span>,en-US;q=<span class="number">0</span>.<span class="number">6</span>,en;q=<span class="number">0</span>.<span class="number">4</span></span><br><span class="line"><span class="attribute">Connection</span>:keep-alive</span><br><span class="line"><span class="attribute">Content</span>-Length:<span class="number">9</span></span><br><span class="line"><span class="attribute">Content</span>-Type:application/x-www-form-urlencoded; charset=UTF-<span class="number">8</span></span><br><span class="line"><span class="attribute">Host</span>:api.voidking.com</span><br><span class="line"><span class="attribute">Origin</span>:http://localhost</span><br><span class="line"><span class="attribute">Referer</span>:http://localhost/ajax/ajax.html</span><br><span class="line"><span class="attribute">User</span>-Agent:Mozilla/<span class="number">5</span>.<span class="number">0</span> (Windows NT <span class="number">6</span>.<span class="number">3</span>; Win64; x64) AppleWebKit/<span class="number">537</span>.<span class="number">36</span> (KHTML, like Gecko) Chrome/<span class="number">54</span>.<span class="number">0</span>.<span class="number">2840</span>.<span class="number">71</span> Safari/<span class="number">537</span>.<span class="number">36</span></span><br></pre></td></tr></table></figure><p>Response Headers为：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Access</span>-Control-<span class="literal">Allow</span>-Origin:*</span><br><span class="line"><span class="attribute">Cache</span>-Control:no-store, no-cache, must-revalidate, post-check=<span class="number">0</span>, pre-check=<span class="number">0</span></span><br><span class="line"><span class="attribute">Connection</span>:keep-alive</span><br><span class="line"><span class="attribute">Content</span>-Encoding:gzip</span><br><span class="line"><span class="attribute">Content</span>-Type:text/html; charset=UTF-<span class="number">8</span></span><br><span class="line"><span class="attribute">Date</span>:Sun, <span class="number">27</span> Nov <span class="number">2016</span> <span class="number">12</span>:<span class="number">13</span>:<span class="number">21</span> GMT</span><br><span class="line"><span class="attribute">Expires</span>:Thu, <span class="number">19</span> Nov <span class="number">1981</span> <span class="number">08</span>:<span class="number">52</span>:<span class="number">00</span> GMT</span><br><span class="line"><span class="attribute">Pragma</span>:no-cache</span><br><span class="line"><span class="attribute">Server</span>:nginx</span><br><span class="line"><span class="attribute">Set</span>-Cookie:PHPSESSID=<span class="number">149</span>t0hhs2icqaaemvp39onkgp4; path=/; domain=.voidking.com</span><br><span class="line"><span class="attribute">Transfer</span>-Encoding:chunked</span><br><span class="line"><span class="attribute">Vary</span>:Accept-Encoding</span><br></pre></td></tr></table></figure><h2 id="再次获取图片验证码请求"><span class="post-title-index">4.3.</span><a href="#再次获取图片验证码请求" class="headerlink" title="再次获取图片验证码请求"></a> 再次获取图片验证码请求</h2><p>Request Headers为：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Accept</span>:image/webp,image/*,*/*;q=<span class="number">0</span>.<span class="number">8</span></span><br><span class="line"><span class="attribute">Accept</span>-Encoding:gzip, deflate, sdch</span><br><span class="line"><span class="attribute">Accept</span>-Language:zh-CN,zh;q=<span class="number">0</span>.<span class="number">8</span>,en-US;q=<span class="number">0</span>.<span class="number">6</span>,en;q=<span class="number">0</span>.<span class="number">4</span></span><br><span class="line"><span class="attribute">Cache</span>-Control:max-age=<span class="number">0</span></span><br><span class="line"><span class="attribute">Connection</span>:keep-alive</span><br><span class="line"><span class="attribute">Cookie</span>:pma_lang=zh_CN; pma_collation_connection=utf8_unicode_ci; pma_iv-<span class="number">1</span>=wnpO4gv0eQRW1AMHmGr2ww%<span class="number">3</span>D%<span class="number">3</span>D; pmaUser-<span class="number">1</span>=weZPqS0%<span class="number">2</span>BW7nzFUVHRdqcfA%<span class="number">3</span>D%<span class="number">3</span>D; PHPSESSID=<span class="number">721</span>t4sqanvsii550m1dk8gq1o3</span><br><span class="line"><span class="attribute">Host</span>:api.voidking.com</span><br><span class="line"><span class="attribute">Referer</span>:http://localhost/ajax/ajax.html</span><br><span class="line"><span class="attribute">User</span>-Agent:Mozilla/<span class="number">5</span>.<span class="number">0</span> (Windows NT <span class="number">6</span>.<span class="number">3</span>; Win64; x64) AppleWebKit/<span class="number">537</span>.<span class="number">36</span> (KHTML, like Gecko) Chrome/<span class="number">54</span>.<span class="number">0</span>.<span class="number">2840</span>.<span class="number">71</span> Safari/<span class="number">537</span>.<span class="number">36</span></span><br></pre></td></tr></table></figure><p>Response Headers为：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Access</span>-<span class="title class_">Control</span>-<span class="title class_">Allow</span>-<span class="title class_">Origin</span><span class="symbol">:*</span></span><br><span class="line"><span class="title class_">Cache</span>-<span class="title class_">Control</span><span class="symbol">:private</span>, max-age=<span class="number">0</span>, no-store, no-cache, must-revalidate</span><br><span class="line"><span class="title class_">Cache</span>-<span class="title class_">Control</span><span class="symbol">:post-check=</span><span class="number">0</span>, pre-check=<span class="number">0</span></span><br><span class="line"><span class="title class_">Connection</span><span class="symbol">:keep-alive</span></span><br><span class="line"><span class="title class_">Content</span>-<span class="title class_">Type</span><span class="symbol">:image/png</span></span><br><span class="line"><span class="title class_">Date</span><span class="symbol">:Sun</span>, <span class="number">27</span> <span class="title class_">Nov</span> <span class="number">2016</span> <span class="number">13</span><span class="symbol">:</span><span class="number">26</span><span class="symbol">:</span><span class="number">21</span> <span class="variable constant_">GMT</span></span><br><span class="line"><span class="title class_">Expires</span><span class="symbol">:Thu</span>, <span class="number">19</span> <span class="title class_">Nov</span> <span class="number">1981</span> 08<span class="symbol">:</span><span class="number">52</span><span class="symbol">:</span><span class="number">00</span> <span class="variable constant_">GMT</span></span><br><span class="line"><span class="title class_">Pragma</span><span class="symbol">:no-cache</span></span><br><span class="line"><span class="title class_">Server</span><span class="symbol">:nginx</span></span><br><span class="line"><span class="title class_">Transfer</span>-<span class="title class_">Encoding</span><span class="symbol">:chunked</span></span><br></pre></td></tr></table></figure><h2 id="三次请求比较"><span class="post-title-index">4.4.</span><a href="#三次请求比较" class="headerlink" title="三次请求比较"></a> 三次请求比较</h2><p><img src="http://cdn.voidking.com/img/session-cross-domain/compare.jpg"></p><p>第一次获取图片验证码请求，Cookie中没有PHPSESSID，所以，返回信息中有Set-Cookie。第二次获取图片验证码请求，Cookie中含有PHPSESSID，所以，返回信息中没有了Set-Cookie。而且第一次请求返回信息Set-Cookie中的PHPSESSID，和第二次请求请求信息Cookie中的PHPSESSID是相同的。</p><p>而验证图片验证码的ajax请求，没有Cookie，自然也没有PHPSESSID，所以，返回信息中也有Set-Cookie。</p><p>可见，我们需要在前端做一些修改，使之发送请求时带着Cookie。</p><h2 id="前端jquery设置"><span class="post-title-index">4.5.</span><a href="#前端jquery设置" class="headerlink" title="前端jquery设置"></a> 前端jquery设置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://api.voidking.com/owner-bd/index.php/Home/CheckCode/getPicCode&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;picCode&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;send&quot;</span> <span class="attr">value</span>=<span class="string">&quot;验证&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;#send&#x27;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//console.log(document.cookie);</span></span></span><br><span class="line"><span class="language-javascript">            $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">url</span>: <span class="string">&#x27;http://api.voidking.com/owner-bd/index.php/Home/CheckCode/checkPicCode&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">crossDomain</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">xhrFields</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">withCredentials</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: &#123;<span class="attr">code</span>: $(<span class="string">&#x27;#picCode&#x27;</span>).<span class="title function_">val</span>()&#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">error</span>: <span class="keyword">function</span>(<span class="params">xhr</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>请求时报错如下：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A wildcard <span class="string">&#x27;*&#x27;</span> cannot be used <span class="keyword">in</span> the <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="keyword">header</span> <span class="keyword">when</span> the credentials flag <span class="keyword">is</span> <span class="keyword">true</span>. Origin <span class="string">&#x27;http://localhost&#x27;</span> <span class="keyword">is</span> therefore <span class="keyword">not</span> allowed <span class="keyword">access</span>. The credentials mode <span class="keyword">of</span> an XMLHttpRequest <span class="keyword">is</span> controlled <span class="keyword">by</span> the withCredentials <span class="keyword">attribute</span>.</span><br></pre></td></tr></table></figure><p>出现了跨域报错，可见后端也需要做一些修改，使之可以接收跨域Cookie。</p><h2 id="后端nginx设置"><span class="post-title-index">4.6.</span><a href="#后端nginx设置" class="headerlink" title="后端nginx设置"></a> 后端nginx设置</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">add_header</span> Access-Control-Allow-Origin http://localhost;</span><br><span class="line"><span class="attribute">add_header</span> Access-Control-Allow-Credentials <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><p>注意：<br>服务器端Access-Control-Allow-Credentials参数为true时，Access-Control-Allow-Origin参数的值不能为*。</p><p>后端nginx设置后，jquery的ajax请求正常了，可以携带Cookie，后端正常接收数据并返回数据。</p><p>由于angular的ajax请求不同于jquery，所以，我们还需要研究一下angular怎么发送携带Cookie的跨域请求。</p><h2 id="前端angular设置"><span class="post-title-index">4.7.</span><a href="#前端angular设置" class="headerlink" title="前端angular设置"></a> 前端angular设置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>angular<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.static.runoob.com/libs/angular.js/1.4.6/angular.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">&quot;myApp&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">ng-controller</span>=<span class="string">&quot;myCtrl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://api.voidking.com/owner-bd/index.php/Home/CheckCode/getPicCode&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;picCode&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;picCode&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">ng-click</span>=<span class="string">&quot;send()&quot;</span>  <span class="attr">value</span>=<span class="string">&quot;验证&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> app = angular.<span class="title function_">module</span>(<span class="string">&#x27;myApp&#x27;</span>, []);</span></span><br><span class="line"><span class="language-javascript">    app.<span class="title function_">controller</span>(<span class="string">&#x27;myCtrl&#x27;</span>, <span class="keyword">function</span>(<span class="params">$scope, $http, $httpParamSerializer</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        $scope.<span class="property">send</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            $http(&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">method</span>:<span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">url</span>:<span class="string">&#x27;http://api.voidking.com/owner-bd/index.php/Home/CheckCode/checkPicCode&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">headers</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">withCredentials</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: $httpParamSerializer(&#123;<span class="attr">code</span>: $scope.<span class="property">picCode</span>&#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> <span class="title function_">successCallback</span>(<span class="params">response</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">                $scope.<span class="property">username</span> = response.<span class="property">data</span>.<span class="property">username</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;, <span class="keyword">function</span> <span class="title function_">errorCallback</span>(<span class="params">response</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="nginx配置文件"><span class="post-title-index">5.</span><a href="#nginx配置文件" class="headerlink" title="nginx配置文件"></a> nginx配置文件</h1><p>结合《thinkphp部署到nginx服务器》中nginx的配置，最终nginx配置配置文件nginx.conf文件内容如下：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">error_log</span>  logs/<span class="literal">error</span>.log  <span class="literal">error</span> ;</span><br><span class="line"><span class="attribute">pid</span> logs/nginx.pid;</span><br><span class="line"><span class="attribute">user</span>  www;</span><br><span class="line"><span class="attribute">worker_processes</span>  auto;</span><br><span class="line"><span class="attribute">worker_rlimit_nofile</span> <span class="number">51200</span>;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">use</span> <span class="literal">epoll</span>;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">51200</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">client_body_buffer_size</span> <span class="number">32k</span>;</span><br><span class="line">    <span class="attribute">client_header_buffer_size</span> <span class="number">2k</span>;</span><br><span class="line">    <span class="attribute">client_max_body_size</span> <span class="number">2m</span>;</span><br><span class="line">    <span class="attribute">default_type</span> application/octet-stream;</span><br><span class="line">    <span class="attribute">log_not_found</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">server_tokens</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">gzip_min_length</span>  <span class="number">1k</span>;</span><br><span class="line">    <span class="attribute">gzip_buffers</span>     <span class="number">4</span> <span class="number">16k</span>;</span><br><span class="line">    <span class="attribute">gzip_http_version</span> <span class="number">1</span>.<span class="number">0</span>;</span><br><span class="line">    <span class="attribute">gzip_comp_level</span> <span class="number">2</span>;</span><br><span class="line">    <span class="attribute">gzip_types</span>       text/plain text/css text/xml text/javascript application/x-javascript application/xml application/rss+xml application/xhtml+xml application/atom_xml;</span><br><span class="line">    <span class="attribute">gzip_vary</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="comment">#error_page   500 502 503 504  /50x.html; </span></span><br><span class="line">    <span class="attribute">log_format</span>  access  <span class="string">&#x27;<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] &quot;<span class="variable">$request</span>&quot; &#x27;</span></span><br><span class="line">              <span class="string">&#x27;<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> &quot;<span class="variable">$http_referer</span>&quot; &#x27;</span></span><br><span class="line">              <span class="string">&#x27;&quot;<span class="variable">$http_user_agent</span>&quot; <span class="variable">$http_x_forwarded_for</span>&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span> default_server;</span><br><span class="line">        <span class="attribute">server_name</span> localhost api.voidking.com;</span><br><span class="line">        <span class="attribute">root</span> /home/wwwroot/;</span><br><span class="line">        <span class="attribute">index</span> index.php index.html index.htm;</span><br><span class="line">    </span><br><span class="line">        <span class="attribute">add_header</span> Access-Control-Allow-Origin http://localhost;</span><br><span class="line">        <span class="attribute">add_header</span> Access-Control-Allow-Credentials <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> <span class="regexp">~ \.php</span> &#123;</span><br><span class="line">        <span class="attribute">root</span> /home/wwwroot/;</span><br><span class="line">            <span class="attribute">fastcgi_pass</span>   <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">            <span class="attribute">fastcgi_index</span>  index.php;</span><br><span class="line">        <span class="attribute">fastcgi_split_path_info</span><span class="regexp"> ^(.+\.php)(.*)$</span>;</span><br><span class="line">            <span class="attribute">fastcgi_param</span> PATH_INFO <span class="variable">$fastcgi_path_info</span>;</span><br><span class="line">            <span class="attribute">fastcgi_param</span>  SCRIPT_FILENAME  <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">            <span class="attribute">fastcgi_param</span>  PHP_VALUE        open_basedir=<span class="variable">$document_root</span>:/tmp/:/proc/;</span><br><span class="line">            <span class="attribute">include</span>        fastcgi_params;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">include</span> vhost/<span class="regexp">*.conf</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="后记"><span class="post-title-index">6.</span><a href="#后记" class="headerlink" title="后记"></a> 后记</h1><p>至此，大功告成，session跨域问题完美解决。</p><h1 id="书签"><span class="post-title-index">7.</span><a href="#书签" class="headerlink" title="书签"></a> 书签</h1><ul><li><a target="_blank" rel="noopener" href="http://www.jb51.net/article/51722.htm">ThinkPHP框架实现session跨域问题的解决方法</a></li><li><a target="_blank" rel="noopener" href="http://www.thinkphp.cn/topic/6380.html">ThinkPHP二级域名session共享问题</a></li><li><a target="_blank" rel="noopener" href="http://blog.csdn.net/kylinbl/article/details/7634075">php 跨域、跨子域，跨服务器读取session</a></li><li><a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/blog_5f3d71430100jv7q.html">跨服务器Session共享的四种方法</a></li><li><a target="_blank" rel="noopener" href="https://my.oschina.net/blogshi/blog/303758">Angular通过CORS实现跨域方案</a></li></ul></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>原文链接：</strong> <a href="https://www.voidking.com/dev-thinkphp-session-cross-domain/" title="好好学PHP：thinkphp中session跨域问题">https://www.voidking.com/dev-thinkphp-session-cross-domain/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本文采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议，转载请注明出处！源站会即时更新知识点并修正错误，欢迎访问~</li><li> <img width="200" height="200" src="/images/avatar.jpg"><p style="text-align:center;margin-bottom:0">微信公众号同步更新，欢迎关注~</p></li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/nginx/" rel="tag"># nginx</a> <a href="/tags/%E5%A5%BD%E5%A5%BD%E5%AD%A6PHP/" rel="tag"># 好好学PHP</a> <a href="/tags/thinkphp/" rel="tag"># thinkphp</a> <a href="/tags/session/" rel="tag"># session</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-thinkphp-nginx/" rel="prev" title="好好学Nginx：ThinkPHP部署到Nginx服务器"><i class="fa fa-chevron-left"></i> 好好学Nginx：ThinkPHP部署到Nginx服务器</a></div><div class="post-nav-item"> <a href="/dev-hexo-sitemap/" rel="next" title="好好学Hexo：Hexo生成sitemap">好好学Hexo：Hexo生成sitemap<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3284447971731414" data-ad-slot="9697986181"></ins><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="nav-text">1. 问题描述</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%86%E6%9E%90"><span class="nav-text">2. 分析</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B7%A8%E5%AD%90%E5%9F%9F%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="nav-text">3. 跨子域解决办法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%8C%E5%85%A8%E8%B7%A8%E5%9F%9F%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="nav-text">4. 完全跨域解决办法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%B7%E6%B1%82"><span class="nav-text">4.1. 获取图片验证码请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%B7%E6%B1%82"><span class="nav-text">4.2. 验证验证码请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%8D%E6%AC%A1%E8%8E%B7%E5%8F%96%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%B7%E6%B1%82"><span class="nav-text">4.3. 再次获取图片验证码请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E6%AC%A1%E8%AF%B7%E6%B1%82%E6%AF%94%E8%BE%83"><span class="nav-text">4.4. 三次请求比较</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E7%AB%AFjquery%E8%AE%BE%E7%BD%AE"><span class="nav-text">4.5. 前端jquery设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8E%E7%AB%AFnginx%E8%AE%BE%E7%BD%AE"><span class="nav-text">4.6. 后端nginx设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E7%AB%AFangular%E8%AE%BE%E7%BD%AE"><span class="nav-text">4.7. 前端angular设置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">5. nginx配置文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E8%AE%B0"><span class="nav-text">6. 后记</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B9%A6%E7%AD%BE"><span class="nav-text">7. 书签</span></a></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">一个计算机技术爱好者与学习者</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">748</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">32</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">259</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: '0aec5cba70db5dc74d44a0bf719430d2',
      title: '好好学PHP：thinkphp中session跨域问题',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>