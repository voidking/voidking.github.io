<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="内网穿透《微信本地调试》一文中，郝同学提到了使用ngrok、natapp和花生壳进行内网穿透。但是，想要使用自定义域名，都是要收费的。 本文中，我们要搭建一个免费的内网穿透服务器。内网穿透服务器，可选的软件有lanproxy、frp、n2n等等，今天我们选择的是lanproxy。"><meta property="og:type" content="article"><meta property="og:title" content="使用lanproxy进行内网穿透"><meta property="og:url" content="https://www.voidking.com/dev-lanproxy/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="内网穿透《微信本地调试》一文中，郝同学提到了使用ngrok、natapp和花生壳进行内网穿透。但是，想要使用自定义域名，都是要收费的。 本文中，我们要搭建一个免费的内网穿透服务器。内网穿透服务器，可选的软件有lanproxy、frp、n2n等等，今天我们选择的是lanproxy。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com//imgs/lanproxy/login.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/lanproxy/key.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/lanproxy/list.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/lanproxy/addproxy.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/lanproxy/remote.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/lanproxy/local.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/lanproxy/addproxy2.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/lanproxy/node-local.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/lanproxy/node-remote.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/lanproxy/node-domain.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/lanproxy/vkphp-local.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/lanproxy/vkphp-remote.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/lanproxy/vkphp-domain.jpg?imageView2/0/w/700"><meta property="article:published_time" content="2017-09-13T09:00:00.000Z"><meta property="article:modified_time" content="2017-09-13T09:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="nginx"><meta property="article:tag" content="apache"><meta property="article:tag" content="内网穿透"><meta property="article:tag" content="代理"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com//imgs/lanproxy/login.jpg?imageView2/0/w/700"><link rel="canonical" href="https://www.voidking.com/dev-lanproxy/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>使用lanproxy进行内网穿透 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-lanproxy/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> 使用lanproxy进行内网穿透</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2017-09-13 09:00:00" itemprop="dateCreated datePublished" datetime="2017-09-13T09:00:00+00:00">2017-09-13</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/network/" itemprop="url" rel="index"><span itemprop="name">network</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="内网穿透"><a href="#内网穿透" class="headerlink" title="内网穿透"></a>内网穿透</h1><p><a href="http://www.voidking.com/dev-weixin-localhost-debug/">《微信本地调试》</a>一文中，郝同学提到了使用ngrok、natapp和花生壳进行内网穿透。但是，想要使用自定义域名，都是要收费的。</p><p>本文中，我们要搭建一个免费的内网穿透服务器。内网穿透服务器，可选的软件有lanproxy、frp、n2n等等，今天我们选择的是lanproxy。</p><span id="more"></span><h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><p>1、一台公网服务器（运行proxy-server）。<br>2、一台内网pc或服务器（运行proxy-client）。</p><h1 id="服务端配置"><a href="#服务端配置" class="headerlink" title="服务端配置"></a>服务端配置</h1><h2 id="安装java"><a href="#安装java" class="headerlink" title="安装java"></a>安装java</h2><p>参考<a href="https://www.voidking.com/dev-install-jdk-on-all-platforms/">《全平台安装JDK》</a>。</p><h2 id="安装lanproxy"><a href="#安装lanproxy" class="headerlink" title="安装lanproxy"></a>安装lanproxy</h2><p>1、访问<a target="_blank" rel="noopener" href="https://github.com/ffay/lanproxy/releases">lanproxy下载地址</a>，下载proxy-server-0.1.zip，上传到公网服务器。</p><p>或者，直接在服务器上下载</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="regexp">//gi</span>thub.com<span class="regexp">/ffay/</span>lanproxy<span class="regexp">/files/</span><span class="number">1274739</span>/proxy-server-<span class="number">0.1</span>.zip</span><br><span class="line">curl -C - -O -L https:<span class="regexp">//gi</span>thub.com<span class="regexp">/ffay/</span>lanproxy<span class="regexp">/files/</span><span class="number">1274739</span>/proxy-server-<span class="number">0.1</span>.zip</span><br></pre></td></tr></table></figure><p>2、解压安装</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">unzip</span> proxy-server-<span class="number">0</span>.<span class="number">1</span>.zip</span><br><span class="line"><span class="attribute">mv</span> proxy-server-<span class="number">0</span>.<span class="number">1</span> /usr/local/</span><br></pre></td></tr></table></figure><p>3、修改配置文件<br><code>vim /usr/local/proxy-server-0.1/conf/config.properties</code><br>修改管理员的用户名和密码。</p><p>4、启动服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/proxy-server-0.1/bin</span><br><span class="line"><span class="built_in">chmod</span> +x startup.sh</span><br><span class="line">./startup.sh</span><br></pre></td></tr></table></figure><p>5、访问 <a target="_blank" rel="noopener" href="http://host_ip:8090/">http://host_ip:8090</a> ，即可看到登录界面。<br><img src="http://cdn.voidking.com//imgs/lanproxy/login.jpg?imageView2/0/w/700"></p><h2 id="nginx反向代理"><a href="#nginx反向代理" class="headerlink" title="nginx反向代理"></a>nginx反向代理</h2><p>1、添加域名解析<code>local</code>到公网ip。</p><p>2、在nginx虚拟主机配置目录中，添加local.voidking.com.conf，内容如下：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> local.voidking.com;</span><br><span class="line">    <span class="attribute">charset</span> utf-<span class="number">8</span>;</span><br><span class="line">    <span class="section">location</span> /&#123;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>   Host             <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>   X-Real-IP        <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>  X-Forwarded-For  <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">client_max_body_size</span>       <span class="number">1024m</span>;</span><br><span class="line">        <span class="attribute">client_body_buffer_size</span>    <span class="number">128k</span>;</span><br><span class="line">        <span class="attribute">client_body_temp_path</span>      data/client_body_temp;</span><br><span class="line">        <span class="attribute">proxy_connect_timeout</span>      <span class="number">90</span>;</span><br><span class="line">        <span class="attribute">proxy_send_timeout</span>         <span class="number">90</span>;</span><br><span class="line">        <span class="attribute">proxy_read_timeout</span>         <span class="number">90</span>;</span><br><span class="line">        <span class="attribute">proxy_buffer_size</span>          <span class="number">4k</span>;</span><br><span class="line">        <span class="attribute">proxy_buffers</span>              <span class="number">4</span> <span class="number">32k</span>;</span><br><span class="line">        <span class="attribute">proxy_busy_buffers_size</span>    <span class="number">64k</span>;</span><br><span class="line">        <span class="attribute">proxy_temp_file_write_size</span> <span class="number">64k</span>;</span><br><span class="line">        <span class="attribute">proxy_temp_path</span>            data/proxy_temp;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:8090;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3、测试nginx<br><code>./nginx -t</code>，也许会提示缺少目录，那么新建目录。<br><code>mkdir -p /usr/local/nginx/data/client_body_temp</code></p><p><code>mkdir -p /usr/local/nginx/data/proxy_temp</code></p><p>4、重启nginx<br><code>./nginx -s reload</code></p><p>5、访问 <a target="_blank" rel="noopener" href="http://local.voidking.com/">http://local.voidking.com/</a> ，即可看到登录界面。</p><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="服务端配置-1"><a href="#服务端配置-1" class="headerlink" title="服务端配置"></a>服务端配置</h2><p>1、登录lanproxy，添加客户端，输入客户端备注名称，生成随机密钥，提交添加。<br><img src="http://cdn.voidking.com//imgs/lanproxy/key.jpg?imageView2/0/w/700"></p><p>2、客户端列表中，配置管理中，都会出现新添加的客户端。<br><img src="http://cdn.voidking.com//imgs/lanproxy/list.jpg?imageView2/0/w/700"></p><p>3、单击配置管理中的客户端，添加配置（每个客户端可以添加多个配置）。<br><img src="http://cdn.voidking.com//imgs/lanproxy/addproxy.jpg?imageView2/0/w/700"></p><ul><li>代理名称，推荐输入客户端要代理出去的端口，或者是客户端想要发布到公网的项目名称。</li><li>公网端口，填入一个服务器空闲端口，用来转发请求给客户端。</li><li>代理IP端口，填入客户端端口，公网会转发请求给该客户端端口。</li></ul><h2 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h2><p>1、访问<a target="_blank" rel="noopener" href="https://github.com/ffay/lanproxy/releases">lanproxy下载地址</a>，下载proxy-client-0.1.zip，解压到喜欢的目录。</p><p>2、进入proxy-client-0.1/conf目录，修改config.properties为：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#与在proxy-server配置后台创建客户端时填写的秘钥保持一致；没有服务器可以登录 https://lanproxy.org/ 创建客户端获取秘钥</span></span><br><span class="line"><span class="attr">client.key</span>=<span class="number">7533</span>f855416741d88732954991668715</span><br><span class="line"><span class="attr">ssl.enable</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">ssl.jksPath</span>=test.jks</span><br><span class="line"><span class="attr">ssl.keyStorePassword</span>=<span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#这里填写实际的proxy-server地址；没有服务器默认即可，自己有服务器的更换为自己的proxy-server（IP）地址</span></span><br><span class="line"><span class="attr">server.host</span>=local.voidking.com</span><br><span class="line"></span><br><span class="line"><span class="comment">#proxy-server ssl默认端口4993，默认普通端口4900</span></span><br><span class="line"><span class="comment">#ssl.enable=true时这里填写ssl端口，ssl.enable=false时这里填写普通端口</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="number">4993</span></span><br></pre></td></tr></table></figure><p>3、进入proxy-client-0.1/bin目录，双击startup.bat，即可启动lanproxy客户端。</p><p>如果启动失败，一般是因为jdk没有安装配置成功，参考<a href="http://www.voidking.com/dev-idea-config/">《IDEA的常用配置》</a>中的安装jdk，安装配置jdk后再次启动即可。</p><p>4、访问地址 <a target="_blank" rel="noopener" href="http://local.voidking.com:50000/">http://local.voidking.com:50000/</a> ，即可看到本地访问客户端80端口相同的页面。<br><img src="http://cdn.voidking.com//imgs/lanproxy/remote.jpg?imageView2/0/w/700"><br><img src="http://cdn.voidking.com//imgs/lanproxy/local.jpg?imageView2/0/w/700"></p><p>至此，代理成功！</p><h1 id="进阶配置"><a href="#进阶配置" class="headerlink" title="进阶配置"></a>进阶配置</h1><h2 id="一个端口一个项目"><a href="#一个端口一个项目" class="headerlink" title="一个端口一个项目"></a>一个端口一个项目</h2><p>假设，我们本地的4000端口开启了node服务。那么，怎么把这个服务优雅地提供给整个互联网？</p><p>1、服务端添加配置<br><img src="http://cdn.voidking.com//imgs/lanproxy/addproxy2.jpg?imageView2/0/w/700"></p><p>2、启动本地node服务<br><img src="http://cdn.voidking.com//imgs/lanproxy/node-local.jpg?imageView2/0/w/700"></p><p>3、已经启动lanproxy客户端，访问 <a target="_blank" rel="noopener" href="http://local.voidking.com:50001/">http://local.voidking.com:50001/</a><br><img src="http://cdn.voidking.com//imgs/lanproxy/node-remote.jpg?imageView2/0/w/700"></p><p>此时，整个互联网都能访问到这个node项目，但是，带着端口号很不友好。那么，我们就给这个项目添加一个单独的域名。</p><p>1、添加域名解析<code>node.local</code>到公网ip。</p><p>2、在nginx虚拟主机配置目录中，添加node.local.voidking.com.conf，内容如下：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> node.local.voidking.com;</span><br><span class="line">    <span class="attribute">charset</span> utf-<span class="number">8</span>;</span><br><span class="line">    <span class="section">location</span> /&#123;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>   Host             <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>   X-Real-IP        <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>  X-Forwarded-For  <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">client_max_body_size</span>       <span class="number">1024m</span>;</span><br><span class="line">        <span class="attribute">client_body_buffer_size</span>    <span class="number">128k</span>;</span><br><span class="line">        <span class="attribute">client_body_temp_path</span>      data/client_body_temp;</span><br><span class="line">        <span class="attribute">proxy_connect_timeout</span>      <span class="number">90</span>;</span><br><span class="line">        <span class="attribute">proxy_send_timeout</span>         <span class="number">90</span>;</span><br><span class="line">        <span class="attribute">proxy_read_timeout</span>         <span class="number">90</span>;</span><br><span class="line">        <span class="attribute">proxy_buffer_size</span>          <span class="number">4k</span>;</span><br><span class="line">        <span class="attribute">proxy_buffers</span>              <span class="number">4</span> <span class="number">32k</span>;</span><br><span class="line">        <span class="attribute">proxy_busy_buffers_size</span>    <span class="number">64k</span>;</span><br><span class="line">        <span class="attribute">proxy_temp_file_write_size</span> <span class="number">64k</span>;</span><br><span class="line">        <span class="attribute">proxy_temp_path</span>            data/proxy_temp;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:50001;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3、重启nginx<br><code>./nginx -s reload</code></p><p>4、访问地址 <a target="_blank" rel="noopener" href="http://node.local.voidking.com/">http://node.local.voidking.com/</a> ，即可看到本地node服务。<br><img src="http://cdn.voidking.com//imgs/lanproxy/node-domain.jpg?imageView2/0/w/700"></p><h2 id="一个端口多个项目"><a href="#一个端口多个项目" class="headerlink" title="一个端口多个项目"></a>一个端口多个项目</h2><p>1、通过我们开放出的80端口，可以访问web根目录下的很多项目，比如在其他文章中提到过的basic项目和vkphp项目，下文以vkphp项目为例。</p><p>2、当前，vkphp项目首页是简单的文字显示。<br><img src="http://cdn.voidking.com//imgs/lanproxy/vkphp-local.jpg?imageView2/0/w/700"></p><p>3、通过外网访问的地址为 <a target="_blank" rel="noopener" href="http://local.voidking.com:50000/vkphp">http://local.voidking.com:50000/vkphp</a><br><img src="http://cdn.voidking.com//imgs/lanproxy/vkphp-remote.jpg?imageView2/0/w/700"></p><p>此时，整个互联网都能访问到这个vkphp项目，但是，带着端口号和项目名，感觉像是个欺诈网站。那么，我们能否给这个项目添加一个单独的域名呢？当然也是可以的。</p><p>1、添加域名解析<code>vkphp.local</code>到公网ip。</p><p>2、在nginx虚拟主机配置目录中，添加vkphp.local.voidking.com.conf，内容如下：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> vkphp.local.voidking.com;</span><br><span class="line">    <span class="attribute">charset</span> utf-<span class="number">8</span>;</span><br><span class="line">    <span class="section">location</span> /&#123;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>   Host             <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>   X-Real-IP        <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>  X-Forwarded-For  <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">client_max_body_size</span>       <span class="number">1024m</span>;</span><br><span class="line">        <span class="attribute">client_body_buffer_size</span>    <span class="number">128k</span>;</span><br><span class="line">        <span class="attribute">client_body_temp_path</span>      data/client_body_temp;</span><br><span class="line">        <span class="attribute">proxy_connect_timeout</span>      <span class="number">90</span>;</span><br><span class="line">        <span class="attribute">proxy_send_timeout</span>         <span class="number">90</span>;</span><br><span class="line">        <span class="attribute">proxy_read_timeout</span>         <span class="number">90</span>;</span><br><span class="line">        <span class="attribute">proxy_buffer_size</span>          <span class="number">4k</span>;</span><br><span class="line">        <span class="attribute">proxy_buffers</span>              <span class="number">4</span> <span class="number">32k</span>;</span><br><span class="line">        <span class="attribute">proxy_busy_buffers_size</span>    <span class="number">64k</span>;</span><br><span class="line">        <span class="attribute">proxy_temp_file_write_size</span> <span class="number">64k</span>;</span><br><span class="line">        <span class="attribute">proxy_temp_path</span>            data/proxy_temp;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:50000;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3、重启nginx<br><code>./nginx -s reload</code></p><p>4、打开本地apache的http-vhosts.conf，添加配置：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:<span class="number">80</span>&gt; <span class="selector-id">#laragon</span> magic!</span><br><span class="line">    DocumentRoot <span class="string">&quot;C:/laragon/www/vkphp/&quot;</span></span><br><span class="line">    ServerName vkphp<span class="selector-class">.local</span><span class="selector-class">.voidking</span><span class="selector-class">.com</span></span><br><span class="line">    ServerAlias vkphp<span class="selector-class">.local</span><span class="selector-class">.voidking</span><span class="selector-class">.com</span></span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure><p>5、重启本地apache</p><p>6、访问地址 <a target="_blank" rel="noopener" href="http://vkphp.local.voidking.com/">http://vkphp.local.voidking.com/</a> ，即可看到本地vkphp项目。<br><img src="http://cdn.voidking.com//imgs/lanproxy/vkphp-domain.jpg?imageView2/0/w/700"></p><p>有趣的是，访问时该地址会自动在后面加上<code>vkphp</code>，成为 <a target="_blank" rel="noopener" href="http://vkphp.local.voidking.com/vkphp/">http://vkphp.local.voidking.com/vkphp/</a></p><h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>由上配置我们发现，nginx的反向代理非常好用。稍微调整，便可以适应大多数项目，实在是美化url的神器，哇咔咔。</p><p>需要说明的是，在使用centos7作为lanproxy外网服务器的时候，无法代理内网服务器的22端口。所有的ssh连接请求都被centos7当做恶意请求自己处理了，并不会转发到内网。而使用ubuntu16作为lanproxy外网服务器，就没有这个问题。很神奇，没有找到原因。</p><h1 id="书签"><a href="#书签" class="headerlink" title="书签"></a>书签</h1><p><a target="_blank" rel="noopener" href="https://github.com/ffay/lanproxy">lanproxy源码地址</a></p><p><a target="_blank" rel="noopener" href="http://blog.csdn.net/xmtblog/article/details/77943159">业余草推荐一款局域网（内网）穿透工具lanproxy</a></p><p><a target="_blank" rel="noopener" href="https://github.com/fatedier/frp/">frp源码地址</a></p><p><a target="_blank" rel="noopener" href="https://github.com/fatedier/frp/blob/master/README_zh.md">frp中文文档</a></p><p><a target="_blank" rel="noopener" href="http://www.sunnyrx.com/simple-to-use-frp/">使用frp实现内网穿透</a></p><p><a target="_blank" rel="noopener" href="https://github.com/meyerd/n2n">n2n源码地址</a></p><p><a target="_blank" rel="noopener" href="http://lib.csdn.net/article/embeddeddevelopment/26888">n2n内网穿透神器(一条命令实现穿透)</a></p><p><a target="_blank" rel="noopener" href="https://www.phpbulo.com/archives/655.html">n2n内网穿透神器</a></p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-lanproxy/" title="使用lanproxy进行内网穿透">https://www.voidking.com/dev-lanproxy/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/nginx/" rel="tag"># nginx</a> <a href="/tags/apache/" rel="tag"># apache</a> <a href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" rel="tag"># 内网穿透</a> <a href="/tags/%E4%BB%A3%E7%90%86/" rel="tag"># 代理</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-vkphp-3/" rel="prev" title="从零开始打造自己的PHP框架——第3章"><i class="fa fa-chevron-left"></i> 从零开始打造自己的PHP框架——第3章</a></div><div class="post-nav-item"> <a href="/dev-vkphp-4/" rel="next" title="从零开始打造自己的PHP框架——第4章">从零开始打造自己的PHP框架——第4章<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F"><span class="nav-number">1.</span> <span class="nav-text">内网穿透</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%87%86%E5%A4%87"><span class="nav-number">2.</span> <span class="nav-text">准备</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE"><span class="nav-number">3.</span> <span class="nav-text">服务端配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85java"><span class="nav-number">3.1.</span> <span class="nav-text">安装java</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85lanproxy"><span class="nav-number">3.2.</span> <span class="nav-text">安装lanproxy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="nav-number">3.3.</span> <span class="nav-text">nginx反向代理</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-number">4.</span> <span class="nav-text">使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE-1"><span class="nav-number">4.1.</span> <span class="nav-text">服务端配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE"><span class="nav-number">4.2.</span> <span class="nav-text">客户端配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%9B%E9%98%B6%E9%85%8D%E7%BD%AE"><span class="nav-number">5.</span> <span class="nav-text">进阶配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E4%B8%AA%E7%AB%AF%E5%8F%A3%E4%B8%80%E4%B8%AA%E9%A1%B9%E7%9B%AE"><span class="nav-number">5.1.</span> <span class="nav-text">一个端口一个项目</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E4%B8%AA%E7%AB%AF%E5%8F%A3%E5%A4%9A%E4%B8%AA%E9%A1%B9%E7%9B%AE"><span class="nav-number">5.2.</span> <span class="nav-text">一个端口多个项目</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%93%E8%AF%AD"><span class="nav-number">6.</span> <span class="nav-text">结语</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B9%A6%E7%AD%BE"><span class="nav-number">7.</span> <span class="nav-text">书签</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">630</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">29</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">233</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>