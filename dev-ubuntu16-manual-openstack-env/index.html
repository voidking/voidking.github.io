<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言《Ubuntu16安装OpenStack》一文中，使用devstack在物理机上安装了OpenStack的Queens版本。但是，在后来的《OpenStack添加镜像》实验中，遇到了很多奇怪的问题，遂决定重装OpenStack。 本次安装，计划采用一步步手动安装的方式，在两个节点上，最小安装OpenStack的Queens版本。主要参考OpenStack Queens Installation"><meta property="og:type" content="article"><meta property="og:title" content="Ubuntu16手动安装OpenStack——环境篇"><meta property="og:url" content="https://www.voidking.com/dev-ubuntu16-manual-openstack-env/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言《Ubuntu16安装OpenStack》一文中，使用devstack在物理机上安装了OpenStack的Queens版本。但是，在后来的《OpenStack添加镜像》实验中，遇到了很多奇怪的问题，遂决定重装OpenStack。 本次安装，计划采用一步步手动安装的方式，在两个节点上，最小安装OpenStack的Queens版本。主要参考OpenStack Queens Installation"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-env/chrony-ctrl.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-env/chrony-com.jpg?imageView2/0/w/700"><meta property="article:published_time" content="2018-06-29T01:10:00.000Z"><meta property="article:modified_time" content="2018-06-29T01:10:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="openstack"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-env/chrony-ctrl.jpg?imageView2/0/w/700"><link rel="canonical" href="https://www.voidking.com/dev-ubuntu16-manual-openstack-env/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Ubuntu16手动安装OpenStack——环境篇 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-ubuntu16-manual-openstack-env/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Ubuntu16手动安装OpenStack——环境篇</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-06-29 09:10:00" itemprop="dateCreated datePublished" datetime="2018-06-29T09:10:00+08:00">2018-06-29</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/" itemprop="url" rel="index"><span itemprop="name">专业</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><a href="https://www.voidking.com/dev-ubuntu16-openstack/">《Ubuntu16安装OpenStack》</a>一文中，使用devstack在物理机上安装了OpenStack的Queens版本。但是，在后来的<a href="https://www.voidking.com/dev-openstack-add-mirror/">《OpenStack添加镜像》</a>实验中，遇到了很多奇怪的问题，遂决定重装OpenStack。</p><p>本次安装，计划采用一步步手动安装的方式，在两个节点上，最小安装OpenStack的Queens版本。主要参考<a href="https://docs.openstack.org/queens/install/" target="_blank" rel="noopener">OpenStack Queens Installation Guides</a>，首先配置环境，然后安装必要的组件，包括keystone、glance、nova、neutron。再之后，选择安装horizon、cinder和swift。</p><p>本文，就记录一下配置环境的过程。</p><a id="more"></a><h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><p>本次安装使用两台VirtualBox虚拟机，一个控制节点和一个计算节点，系统均为ubuntu-16.04.4-server-amd64。控制节点1核4G内存40G存储，计算节点1核2G内存40G存储。</p><p>这两台虚拟机，都有三块网卡。eth0负责主机间相互通信，eth1负责上网，eth2负责neutron网络服务。两张eth0网卡在同一网络，两张eth2网卡在同一网络。</p><h2 id="IP配置"><a href="#IP配置" class="headerlink" title="IP配置"></a>IP配置</h2><p>参考<a href="https://www.voidking.com/dev-virtualbox-centos-ubuntu-network/">VirtualBox下CentOS7和Ubuntu16.04网络配置</a>，修改网卡名，然后配置静态IP。控制节点eth0配置为192.168.56.110，计算节点eth0配置为192.168.56.111。</p><h2 id="主机名配置"><a href="#主机名配置" class="headerlink" title="主机名配置"></a>主机名配置</h2><p>参考<a href="https://www.voidking.com/dev-virtualbox-centos-ubuntu-network/">VirtualBox下CentOS7和Ubuntu16.04网络配置</a>，配置控制节点主机名为controller，计算节点主机名为compute。</p><p>然后编辑/etc/hosts，添加：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192.168.56.110</span>  controller</span><br><span class="line"><span class="number">192.168.56.111</span>  compute</span><br></pre></td></tr></table></figure><h2 id="设置sudo免密"><a href="#设置sudo免密" class="headerlink" title="设置sudo免密"></a>设置sudo免密</h2><p>编辑sudoers，<code>vim /etc/sudoers</code><br>在最后添加一行：</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">test </span>ALL = NOPASSWD: ALL</span><br></pre></td></tr></table></figure><h2 id="更换源列表"><a href="#更换源列表" class="headerlink" title="更换源列表"></a>更换源列表</h2><p>修改/etc/apt/sources.list，参考<a href="https://www.voidking.com/dev-ubuntu-change-sources/">Ubuntu更换源列表</a>，更换为Ubuntu官方中国的源列表。</p><p>最后重启主机，<code>sudo reboot</code>。</p><h2 id="root用户"><a href="#root用户" class="headerlink" title="root用户"></a>root用户</h2><p>为了避免权限问题，建议切换到root用户进行操作（否则要加很多sudo）。<br><code>sudo -i</code></p><h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>在安装openstack之前，需要先安装好必须的环境，包括：</p><ul><li>Security</li><li>Host networking</li><li>Network Time Protocol (NTP)</li><li>OpenStack packages</li><li>SQL database</li><li>Message queue</li><li>Memcached</li><li>Etcd</li></ul><p>安装方法参考<a href="https://docs.openstack.org/install-guide/environment.html" target="_blank" rel="noopener">Environment</a>。</p><h2 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h2><p>OpenStack服务支持各种安全方法，包括密码，策略和加密。</p><p>本节没有什么安装操作，过。</p><h2 id="Host-networking"><a href="#Host-networking" class="headerlink" title="Host networking"></a>Host networking</h2><p>在选择部署的体系结构的每个节点上安装操作系统后，必须配置网络接口。openstack官方建议禁用任何自动网络管理工具，并手动编辑网络配置文件。</p><p>本文准备工作中已经配置好了IP，过。</p><h2 id="NTP"><a href="#NTP" class="headerlink" title="NTP"></a>NTP</h2><p>NTP服务主要用来各节点之间同步时间。</p><h3 id="控制节点"><a href="#控制节点" class="headerlink" title="控制节点"></a>控制节点</h3><p>1、安装chrony<br><code>apt -y install chrony</code></p><p>2、配置chrony<br><code>vim /etc/chrony/chrony.conf</code></p><p>取消两处注释：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">allow <span class="number">0</span>/<span class="number">0</span></span><br><span class="line">allow ::/<span class="number">0</span></span><br></pre></td></tr></table></figure><p>3、重启chrony<br><code>service chrony restart</code></p><h3 id="计算节点"><a href="#计算节点" class="headerlink" title="计算节点"></a>计算节点</h3><p>1、安装chrony<br><code>apt -y install chrony</code></p><p>2、配置chrony<br><code>vim /etc/chrony/chrony.conf</code><br>注释修改如下：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pool 2.debian.pool.ntp.org offline iburst</span></span><br><span class="line">server controller iburst</span><br></pre></td></tr></table></figure><p>3、重启chrony<br><code>service chrony restart</code></p><h3 id="验证安装"><a href="#验证安装" class="headerlink" title="验证安装"></a>验证安装</h3><p>官方建议在继续操作之前验证NTP同步。某些节点，尤其是那些引用控制器节点的节点，可能需要几分钟才能同步。<br>1、在控制节点执行<br><code>chronyc sources</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-env/chrony-ctrl.jpg?imageView2/0/w/700" alt=""></p><p>“Name/IP”列中的内容表示NTP服务器的主机名或IP地址。MS列中的内容，<code>*</code>代表当前NTP服务器同步成功。</p><p>2、在计算节点执行<br><code>chronyc sources</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-env/chrony-com.jpg?imageView2/0/w/700" alt=""><br>“Name/IP”列中的内容应该表示控制器节点的主机名。</p><h2 id="OpenStack-packages"><a href="#OpenStack-packages" class="headerlink" title="OpenStack packages"></a>OpenStack packages</h2><p>由于发布计划不同，发行版将OpenStack软件包作为发行版的一部分或使用其他方法发布。在所有节点上执行这些操作。</p><p>1、安装openstack queens仓库<br><code>apt install software-properties-common</code></p><p><code>add-apt-repository cloud-archive:queens</code></p><p>2、更新软件包<br><code>apt update &amp;&amp; apt dist-upgrade</code></p><p>3、安装openstack-client<br><code>apt -y install python-openstackclient</code></p><h2 id="SQL-database"><a href="#SQL-database" class="headerlink" title="SQL database"></a>SQL database</h2><p>大多数OpenStack服务使用SQL数据库来存储信息，数据库通常在控制器节点上运行。本文使用MariaDB（MySQL），OpenStack服务还支持其他SQL数据库，包括PostgreSQL。</p><p>1、安装mariadb和连接工具<br><code>apt -y install mariadb-server python-pymysql</code></p><p>2、编辑50-server.cnf<br><code>vim /etc/mysql/mariadb.conf.d/50-server.cnf</code></p><p>命令模式下输入<code>:set nu</code>显示行号：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># line 29: change</span></span><br><span class="line"><span class="attr">bind-address</span> = <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="comment"># line 105: change</span></span><br><span class="line"><span class="attr">character-set-server</span> = utf8 </span><br><span class="line"><span class="comment">#collation-server = utf8mb4_general_ci</span></span><br></pre></td></tr></table></figure><p>3、重启mariadb<br>关闭mariadb，<code>service mysql stop</code>。<br>然后查看<code>netstat -an | grep 3306</code>，确认3306已经关闭。</p><p>启动mariadb，<code>service mysql start</code>。</p><p>4、设置mariadb密码<br><code>mysql_secure_installation</code></p><p>按照提示设置密码为openstack。如果设置后无法登录，那么参考<a href="https://www.voidking.com/dev-mysql-reset-password/">MySQL重置密码</a>。</p><h2 id="Message-queue"><a href="#Message-queue" class="headerlink" title="Message queue"></a>Message queue</h2><p>OpenStack使用消息队列来协调服务之间的操作和状态信息。消息队列服务通常在控制器节点上运行。OpenStack支持多种消息队列服务，包括RabbitMQ，Qpid和ZeroMQ。这里我们安装RabbitMQ，因为大多数发行版都支持它。</p><p>1、安装rabbitmsq<br><code>apt -y install rabbitmq-server</code></p><p>2、创建openstack用户，密码为openstack<br><code>rabbitmqctl add_user openstack openstack</code></p><p>3、允许openstack用户配置和读写<br><code>rabbitmqctl set_permissions openstack &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</code></p><h2 id="Memcached"><a href="#Memcached" class="headerlink" title="Memcached"></a>Memcached</h2><p>OpenStack的各个服务的身份认证服务使用Memcached缓存令牌。memcached服务通常在控制器节点上运行。对于生产部署，我们建议启用防火墙，身份验证和加密的组合来保护它。</p><p>1、安装memcached<br><code>apt -y install memcached python-memcache</code></p><p>2、编辑/etc/memcached.conf文件<br><code>-l 127.0.0.1</code>修改为<code>-l 0.0.0.0</code></p><p>3、重启memcached<br><code>service memcached restart</code></p><p>4、测试</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">telnet controller <span class="number">11211</span></span><br><span class="line">stats</span><br><span class="line">quit</span><br></pre></td></tr></table></figure><h2 id="Etcd"><a href="#Etcd" class="headerlink" title="Etcd"></a>Etcd</h2><p>OpenStack服务可能使用Etcd，它是一个可靠的分布式键值存储工具。用于分布式密钥锁定，存储配置，跟踪服务的实时性等。同样安装在控制节点即可。</p><p>1、安装etcd<br><code>apt -y install etcd</code></p><p>2、查看版本<br><code>etcd -version</code>，这里看到是2.2.5。按照<a href="https://docs.openstack.org/install-guide/environment-etcd-ubuntu.html" target="_blank" rel="noopener">Etcd for Ubuntu</a>文档配置的话，最终会失败，所以，我们换一种配置方法。</p><p>3、查看服务状态<br><code>etcdctl member list</code></p><p>应该会看到：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ce2a822cea30bfca: <span class="attribute">name</span>=controller <span class="attribute">peerURLs</span>=http://localhost:2380,http://localhost:7001 <span class="attribute">clientURLs</span>=http://localhost:2379,http://localhost:4001</span><br></pre></td></tr></table></figure><p>4、官方文档给出的/etc/etcd/etcd.conf.yml文件内容为：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">name:</span> controller</span><br><span class="line">data-<span class="string">dir:</span> <span class="regexp">/var/</span>lib/etcd</span><br><span class="line">initial-cluster-<span class="string">state:</span> <span class="string">'new'</span></span><br><span class="line">initial-cluster-<span class="string">token:</span> <span class="string">'etcd-cluster-01'</span></span><br><span class="line">initial-<span class="string">cluster:</span> controller=<span class="string">http:</span><span class="comment">//controller:2380</span></span><br><span class="line">initial-advertise-peer-<span class="string">urls:</span> <span class="string">http:</span><span class="comment">//controller:2380</span></span><br><span class="line">advertise-client-<span class="string">urls:</span> <span class="string">http:</span><span class="comment">//controller:2379</span></span><br><span class="line">listen-peer-<span class="string">urls:</span> <span class="string">http:</span><span class="comment">//0.0.0.0:2380</span></span><br><span class="line">listen-client-<span class="string">urls:</span> <span class="string">http:</span><span class="comment">//controller:2379</span></span><br></pre></td></tr></table></figure><p>参考etcd.conf.yml，我们在/etc/default/etcd的最后添加：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ETCD_NAME</span>=<span class="string">"controller"</span></span><br><span class="line"><span class="attr">ETCD_DATA_DIR</span>=<span class="string">"/var/lib/etcd/default"</span></span><br><span class="line"><span class="attr">ETCD_INITIAL_CLUSTER_STATE</span>=<span class="string">"new"</span></span><br><span class="line"><span class="attr">ETCD_INITIAL_CLUSTER_TOKEN</span>=<span class="string">"etcd-cluster-01"</span></span><br><span class="line"><span class="attr">ETCD_INITIAL_CLUSTER</span>=<span class="string">"controller=http://controller:2380"</span></span><br><span class="line"><span class="attr">ETCD_INITIAL_ADVERTISE_PEER_URLS</span>=<span class="string">"http://controller:2380"</span></span><br><span class="line"><span class="attr">ETCD_ADVERTISE_CLIENT_URLS</span>=<span class="string">"http://controller:2379,http://127.0.0.1:2379"</span></span><br><span class="line"><span class="attr">ETCD_LISTEN_PEER_URLS</span>=<span class="string">"http://0.0.0.0:2380"</span></span><br><span class="line"><span class="attr">ETCD_LISTEN_CLIENT_URLS</span>=<span class="string">"http://controller:2379,http://127.0.0.1:2379"</span></span><br></pre></td></tr></table></figure><p>5、设置开机启动<br><code>systemctl enable etcd</code></p><p>6、重启etcd<br><code>systemctl restart etcd</code></p><p>7、查看服务状态<br><code>etcdctl member list</code></p><p>会看到发生了变化：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ce2a822cea30bfca: <span class="attribute">name</span>=controller <span class="attribute">peerURLs</span>=http://localhost:2380,http://localhost:7001 <span class="attribute">clientURLs</span>=http://127.0.0.1:2379,http://controller:2379</span><br></pre></td></tr></table></figure><p>8、在控制节点和计算节点测试<br><code>curl http://controller:2379/v2/stats/leader</code></p><p>可以看到：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"leader"</span>:<span class="string">"ce2a822cea30bfca"</span>,<span class="attr">"followers"</span>:&#123;&#125;&#125;</span><br></pre></td></tr></table></figure><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>如果修改了/etc/hosts中的controller对应的IP，那么需要重启memcached和etcd，因为它们的配置中使用了主机名而不是IP。</p><p>至此，两台虚拟机上，openstack需要的环境已经安装完成。接下来，准备安装keystone。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-ubuntu16-manual-openstack-env/" title="Ubuntu16手动安装OpenStack——环境篇">https://www.voidking.com/dev-ubuntu16-manual-openstack-env/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/ubuntu/" rel="tag"># ubuntu</a> <a href="/tags/openstack/" rel="tag"># openstack</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-openstack-add-mirror/" rel="prev" title="OpenStack添加镜像"><i class="fa fa-chevron-left"></i> OpenStack添加镜像</a></div><div class="post-nav-item"> <a href="/dev-ubuntu16-manual-openstack-keystone/" rel="next" title="Ubuntu16手动安装OpenStack——keystone篇">Ubuntu16手动安装OpenStack——keystone篇<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#准备"><span class="nav-number">2.</span> <span class="nav-text">准备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#IP配置"><span class="nav-number">2.1.</span> <span class="nav-text">IP配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#主机名配置"><span class="nav-number">2.2.</span> <span class="nav-text">主机名配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设置sudo免密"><span class="nav-number">2.3.</span> <span class="nav-text">设置sudo免密</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更换源列表"><span class="nav-number">2.4.</span> <span class="nav-text">更换源列表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#root用户"><span class="nav-number">2.5.</span> <span class="nav-text">root用户</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#环境"><span class="nav-number">3.</span> <span class="nav-text">环境</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Security"><span class="nav-number">3.1.</span> <span class="nav-text">Security</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Host-networking"><span class="nav-number">3.2.</span> <span class="nav-text">Host networking</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NTP"><span class="nav-number">3.3.</span> <span class="nav-text">NTP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#控制节点"><span class="nav-number">3.3.1.</span> <span class="nav-text">控制节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#计算节点"><span class="nav-number">3.3.2.</span> <span class="nav-text">计算节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#验证安装"><span class="nav-number">3.3.3.</span> <span class="nav-text">验证安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenStack-packages"><span class="nav-number">3.4.</span> <span class="nav-text">OpenStack packages</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL-database"><span class="nav-number">3.5.</span> <span class="nav-text">SQL database</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Message-queue"><span class="nav-number">3.6.</span> <span class="nav-text">Message queue</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Memcached"><span class="nav-number">3.7.</span> <span class="nav-text">Memcached</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Etcd"><span class="nav-number">3.8.</span> <span class="nav-text">Etcd</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#后记"><span class="nav-number">4.</span> <span class="nav-text">后记</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">620</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">50</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">198</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2021</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://www.beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>