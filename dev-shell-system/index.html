<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="查看硬件配置123456789101112cat &#x2F;proc&#x2F;cpuinfo | grep &quot;cpu cores&quot;free -hfree -mcat &#x2F;proc&#x2F;meminfolsblkdf -hlspci | grep -i vga # 最前面的序号是显卡代号lspci | grep -i nvidialspci -v -s 00:02.0"><meta property="og:type" content="article"><meta property="og:title" content="shell命令之系统管理"><meta property="og:url" content="https://www.voidking.com/dev-shell-system/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="查看硬件配置123456789101112cat &#x2F;proc&#x2F;cpuinfo | grep &quot;cpu cores&quot;free -hfree -mcat &#x2F;proc&#x2F;meminfolsblkdf -hlspci | grep -i vga # 最前面的序号是显卡代号lspci | grep -i nvidialspci -v -s 00:02.0"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2017-06-02T00:00:00.000Z"><meta property="article:modified_time" content="2022-12-23T02:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="问题排查"><meta property="article:tag" content="linux"><meta property="article:tag" content="shell"><meta property="article:tag" content="iperf"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-shell-system/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>shell命令之系统管理 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-shell-system/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> shell命令之系统管理</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2017-06-02 08:00:00" itemprop="dateCreated datePublished" datetime="2017-06-02T08:00:00+08:00">2017-06-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-12-23 10:00:00" itemprop="dateModified" datetime="2022-12-23T10:00:00+08:00">2022-12-23</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/shell/" itemprop="url" rel="index"><span itemprop="name">shell</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/troubleshooting/" itemprop="url" rel="index"><span itemprop="name">troubleshooting</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="查看硬件配置"><a href="#查看硬件配置" class="headerlink" title="查看硬件配置"></a>查看硬件配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/cpuinfo | grep <span class="string">"cpu cores"</span></span><br><span class="line"></span><br><span class="line">free -h</span><br><span class="line">free -m</span><br><span class="line">cat /proc/meminfo</span><br><span class="line"></span><br><span class="line">lsblk</span><br><span class="line">df -h</span><br><span class="line"></span><br><span class="line">lspci | grep -i vga <span class="comment"># 最前面的序号是显卡代号</span></span><br><span class="line">lspci | grep -i nvidia</span><br><span class="line">lspci -v -s 00:02.0</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="查看系统版本"><a href="#查看系统版本" class="headerlink" title="查看系统版本"></a>查看系统版本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lsb_release -a</span><br><span class="line">cat /etc/issue</span><br><span class="line">cat /etc/os-release</span><br><span class="line">cat /etc/centos-release</span><br></pre></td></tr></table></figure><h2 id="查看系统位数"><a href="#查看系统位数" class="headerlink" title="查看系统位数"></a>查看系统位数</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br><span class="line">file /bin/ls</span><br><span class="line">getconf LONG_BIT</span><br></pre></td></tr></table></figure><h2 id="查看是否是物理机"><a href="#查看是否是物理机" class="headerlink" title="查看是否是物理机"></a>查看是否是物理机</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmidecode -s system-product-name</span><br></pre></td></tr></table></figure><h2 id="查看系统日志"><a href="#查看系统日志" class="headerlink" title="查看系统日志"></a>查看系统日志</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dmesg -T</span><br><span class="line">journalctl -xb</span><br></pre></td></tr></table></figure><h2 id="修改默认shell"><a href="#修改默认shell" class="headerlink" title="修改默认shell"></a>修改默认shell</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$SHELL</span></span><br><span class="line">cat /etc/shells</span><br><span class="line"><span class="built_in">which</span> bash</span><br><span class="line">chsh -s /bin/bash</span><br></pre></td></tr></table></figure><h2 id="查看命令属于哪个包"><a href="#查看命令属于哪个包" class="headerlink" title="查看命令属于哪个包"></a>查看命令属于哪个包</h2><p>1、centos</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum makecache fast</span><br><span class="line">yum whatprovides lsb_release</span><br></pre></td></tr></table></figure><p>2、ubuntu</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-get install -y apt-file</span><br><span class="line">apt-file update</span><br><span class="line">apt-file search ifconfig</span><br></pre></td></tr></table></figure><h2 id="EPEL源"><a href="#EPEL源" class="headerlink" title="EPEL源"></a>EPEL源</h2><p>EPEL（ExtraPackagesforEnterpriseLinux）是基于Fedora的一个项目，为RedHat系的操作系统提供额外的高质量软件包。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release</span><br></pre></td></tr></table></figure><p>安装epel源之后，可以安装很多原本 No package xxx available 的软件，比如jq：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install jq</span><br></pre></td></tr></table></figure><h2 id="查看包管理器有哪些软件版本"><a href="#查看包管理器有哪些软件版本" class="headerlink" title="查看包管理器有哪些软件版本"></a>查看包管理器有哪些软件版本</h2><p>centos</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list docker-ce --showduplicates | sort -r</span><br></pre></td></tr></table></figure><p>ubuntu</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-cache madison docker-ce | awk <span class="string">'&#123; print $3 &#125;'</span></span><br></pre></td></tr></table></figure><p>参考文档<a href="https://www.voidking.com/dev-docker-start/">《Docker入门篇》</a></p><h2 id="查看磁盘资源占用"><a href="#查看磁盘资源占用" class="headerlink" title="查看磁盘资源占用"></a>查看磁盘资源占用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">du -sh *</span><br><span class="line"></span><br><span class="line">du -sh .[!.]*</span><br></pre></td></tr></table></figure><h2 id="查看进程和线程"><a href="#查看进程和线程" class="headerlink" title="查看进程和线程"></a>查看进程和线程</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看所有进程</span></span><br><span class="line">ps -ef</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">ps aux</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有进程，并且显示进程启动的全部命令</span></span><br><span class="line">ps auxww</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有进程，并且显示进程的线程</span></span><br><span class="line">ps -efL</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看某个进程的线程</span></span><br><span class="line">ps -T -p 12345</span><br></pre></td></tr></table></figure><h2 id="根据端口找进程"><a href="#根据端口找进程" class="headerlink" title="根据端口找进程"></a>根据端口找进程</h2><p>已知某进程监听22端口，怎样找到该进程的pid？怎样找到该进程启动命令？</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lsof -i:22</span><br><span class="line">netstat -npt | grep <span class="string">":22"</span></span><br><span class="line">netstat -nlpt | grep <span class="string">":22"</span></span><br><span class="line">ps -ef |grep 12345</span><br></pre></td></tr></table></figure><h2 id="查看端口是否可以正常连接"><a href="#查看端口是否可以正常连接" class="headerlink" title="查看端口是否可以正常连接"></a>查看端口是否可以正常连接</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nc -v 192.168.56.101 8080</span><br><span class="line">nc -zv -w 5 192.168.56.101 8080</span><br><span class="line"><span class="comment"># 成功返回0，5s超时失败返回1</span></span><br><span class="line"></span><br><span class="line">telnet 192.168.56.101 8080</span><br><span class="line"><span class="built_in">echo</span> <span class="string">''</span> | timeout --signal=9 5 telnet 192.168.56.101 8080</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'q'</span> | timeout --signal=9 5 telnet -e <span class="string">'q'</span> 192.168.56.101 8080</span><br><span class="line"><span class="comment"># 成功返回1，5s超时失败返回137</span></span><br></pre></td></tr></table></figure><h2 id="查看进程资源占用"><a href="#查看进程资源占用" class="headerlink" title="查看进程资源占用"></a>查看进程资源占用</h2><p>1、查看进程的实时资源占用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">top -p 12234</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">cat /proc/12345/status</span><br></pre></td></tr></table></figure><p>2、查看进程从启动到此刻的资源占用平均值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep 12345</span><br></pre></td></tr></table></figure><p>参考文档：</p><ul><li><a href="https://xiaorui.cc/archives/4470" target="_blank" rel="noopener">纠结ps和top的cpu占用率不一致问题</a></li><li><a href="https://www.cnblogs.com/arnoldlu/p/12162860.html" target="_blank" rel="noopener">/proc/pid/status简要分析</a></li><li><a href="https://blog.csdn.net/beckdon/article/details/48491909" target="_blank" rel="noopener">Linux下进程信息/proc/pid/status的深入分析</a></li></ul><h2 id="查看本机IP地址"><a href="#查看本机IP地址" class="headerlink" title="查看本机IP地址"></a>查看本机IP地址</h2><p>1、查看本机当前namespace所有IP地址<br><code>ifconfig</code> 或者 <code>ip address</code></p><p>2、获取某个网卡的IP地址<br><code>ifconfig eth0 | awk &#39;NR==2{print $2}&#39;</code></p><h2 id="查看外网出口IP"><a href="#查看外网出口IP" class="headerlink" title="查看外网出口IP"></a>查看外网出口IP</h2><p><code>curl myip.ipip.net</code></p><h2 id="查看局域网所有IP"><a href="#查看局域网所有IP" class="headerlink" title="查看局域网所有IP"></a>查看局域网所有IP</h2><p>需求：查看当前局域网已经分配的IP，已知局域网为<code>192.168.56.0/24</code><br>1、通过扫描获取最新的arp信息<br><code>nmap -sP 192.168.56.0/24</code></p><p>2、查看本地arp缓存<br><code>cat /proc/net/arp | awk &#39;{print $1}&#39; | grep &#39;192.168&#39; | sort</code><br>或者<br><code>arp -a | awk &#39;{print $2}&#39; | grep &#39;192.168&#39; | sort</code></p><h2 id="根据IP排序"><a href="#根据IP排序" class="headerlink" title="根据IP排序"></a>根据IP排序</h2><p>需求：/proc/net/arp中的内容，根据IP进行排序</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/net/arp | grep 192.168.56 | sort -t<span class="string">'.'</span> -k1n,1 -k2n,2 -k3n,3 -k4n,4</span><br></pre></td></tr></table></figure><h2 id="测试mtu值"><a href="#测试mtu值" class="headerlink" title="测试mtu值"></a>测试mtu值</h2><p>MTU是Maximum Transmission Unit的缩写，表示最大传输单元，MTU的单位是字节。大部分网络设备的MTU都是1500。<br>把本机的MTU设成比网关的MTU小或相同，就可以减少丢包。如果本机的MTU比网关的MTU大，大的数据包就会被拆开来传送，这样会产生很多数据包碎片，增加丢包率。<br>把数据包长度加上数据包头28字节，就得到MTU的值。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping -c 3 -s 1472 -M <span class="keyword">do</span> www.baidu.com</span><br><span class="line">ping -c 3 -s 1473 -M <span class="keyword">do</span> www.baidu.com</span><br></pre></td></tr></table></figure><h2 id="带宽测试"><a href="#带宽测试" class="headerlink" title="带宽测试"></a>带宽测试</h2><p>1、安装测试工具iperf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y iperf</span><br></pre></td></tr></table></figure><p>2、启动iperf服务端</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iperf -s</span><br></pre></td></tr></table></figure><p>3、使用iperf客户端测试网速</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iperf -c 192.168.56.112 -i 3</span><br></pre></td></tr></table></figure><h2 id="时间和时间戳"><a href="#时间和时间戳" class="headerlink" title="时间和时间戳"></a>时间和时间戳</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输出时间</span></span><br><span class="line">date</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出时间并格式化</span></span><br><span class="line">date <span class="string">"+%Y-%m-%d %H:%M:%S"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 时间转时间戳（秒）</span></span><br><span class="line">date <span class="string">"+%s"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 时间转时间戳（微秒）</span></span><br><span class="line">microsecond=$(($(date <span class="string">"+%s%N"</span>)/1000000))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 时间戳（秒）转时间</span></span><br><span class="line">date -d @1612351314 <span class="string">"+%Y-%m-%d %H:%M:%S"</span></span><br></pre></td></tr></table></figure><h2 id="还原history"><a href="#还原history" class="headerlink" title="还原history"></a>还原history</h2><p>万万没想到，centos4.3的<code>history -c</code>命令，不止会清除当前登录的操作历史记录，还会清除 .bash_history 中的内容。</p><p>如果不小心清除了 .bash_history 中的内容，该怎么办？如果屏幕上还残留着history的历史记录，那么还有得救。<br>拷贝屏幕上的内容，到 history.txt，假设内容为：</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">244486 </span> <span class="number">2021</span>-<span class="number">01</span>-<span class="number">08</span> <span class="number">17</span>:<span class="number">35</span>:<span class="number">18</span> cd haojin</span><br><span class="line"><span class="symbol">244487 </span> <span class="number">2021</span>-<span class="number">01</span>-<span class="number">08</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">01</span> vim main.py</span><br><span class="line"><span class="symbol">244488 </span> <span class="number">2021</span>-<span class="number">01</span>-<span class="number">08</span> <span class="number">17</span>:<span class="number">38</span>:<span class="number">33</span> python main.py</span><br></pre></td></tr></table></figure><p>怎么恢复成标准的 .bash_history 格式呢？使用如下脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">cat /dev/null &gt; bash_history</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  time=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">'&#123;print $2" "$3&#125;'</span>)</span><br><span class="line">  <span class="comment">#cmd=$(echo $line | awk '&#123;$1="";$2="";$3="";print $0&#125;')</span></span><br><span class="line">  cmd=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk -F <span class="string">" "</span>  <span class="string">'&#123;for (i=4;i&lt;=NF;i++)printf("%s ", $i);print ""&#125;'</span>)</span><br><span class="line">  timestamp=$(date -d <span class="string">"<span class="variable">$time</span>"</span> +%s)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"#"</span><span class="variable">$timestamp</span> &gt;&gt; bash_history</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$cmd</span> &gt;&gt; bash_history</span><br><span class="line"><span class="keyword">done</span> &lt; history.txt</span><br></pre></td></tr></table></figure><p>执行完成，使用 bash_history 替换 .bash_history 即可。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-shell-system/" title="shell命令之系统管理">https://www.voidking.com/dev-shell-system/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/" rel="tag"># 问题排查</a> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/shell/" rel="tag"># shell</a> <a href="/tags/iperf/" rel="tag"># iperf</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-iftop/" rel="prev" title="iftop命令"><i class="fa fa-chevron-left"></i> iftop命令</a></div><div class="post-nav-item"> <a href="/dev-shell-ssh/" rel="next" title="shell命令之ssh">shell命令之ssh<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#查看硬件配置"><span class="nav-number">1.</span> <span class="nav-text">查看硬件配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看系统版本"><span class="nav-number">2.</span> <span class="nav-text">查看系统版本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看系统位数"><span class="nav-number">3.</span> <span class="nav-text">查看系统位数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看是否是物理机"><span class="nav-number">4.</span> <span class="nav-text">查看是否是物理机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看系统日志"><span class="nav-number">5.</span> <span class="nav-text">查看系统日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改默认shell"><span class="nav-number">6.</span> <span class="nav-text">修改默认shell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看命令属于哪个包"><span class="nav-number">7.</span> <span class="nav-text">查看命令属于哪个包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EPEL源"><span class="nav-number">8.</span> <span class="nav-text">EPEL源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看包管理器有哪些软件版本"><span class="nav-number">9.</span> <span class="nav-text">查看包管理器有哪些软件版本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看磁盘资源占用"><span class="nav-number">10.</span> <span class="nav-text">查看磁盘资源占用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看进程和线程"><span class="nav-number">11.</span> <span class="nav-text">查看进程和线程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#根据端口找进程"><span class="nav-number">12.</span> <span class="nav-text">根据端口找进程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看端口是否可以正常连接"><span class="nav-number">13.</span> <span class="nav-text">查看端口是否可以正常连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看进程资源占用"><span class="nav-number">14.</span> <span class="nav-text">查看进程资源占用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看本机IP地址"><span class="nav-number">15.</span> <span class="nav-text">查看本机IP地址</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看外网出口IP"><span class="nav-number">16.</span> <span class="nav-text">查看外网出口IP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看局域网所有IP"><span class="nav-number">17.</span> <span class="nav-text">查看局域网所有IP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#根据IP排序"><span class="nav-number">18.</span> <span class="nav-text">根据IP排序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#测试mtu值"><span class="nav-number">19.</span> <span class="nav-text">测试mtu值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#带宽测试"><span class="nav-number">20.</span> <span class="nav-text">带宽测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#时间和时间戳"><span class="nav-number">21.</span> <span class="nav-text">时间和时间戳</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#还原history"><span class="nav-number">22.</span> <span class="nav-text">还原history</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">674</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">224</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>