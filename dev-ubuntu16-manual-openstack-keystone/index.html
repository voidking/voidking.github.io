<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="目标紧接着《Ubuntu16手动安装OpenStack——环境篇》，本文我们来安装keystone，主要参考Keystone Installation Tutorial for Ubuntu。"><meta property="og:type" content="article"><meta property="og:title" content="Ubuntu16手动安装OpenStack——keystone篇"><meta property="og:url" content="https://www.voidking.com/dev-ubuntu16-manual-openstack-keystone/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="目标紧接着《Ubuntu16手动安装OpenStack——环境篇》，本文我们来安装keystone，主要参考Keystone Installation Tutorial for Ubuntu。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-keystone/token1.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-keystone/token2.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-keystone/token3.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-keystone/token4.jpg?imageView2/0/w/700"><meta property="article:published_time" content="2018-06-30T02:30:00.000Z"><meta property="article:modified_time" content="2018-06-30T02:30:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="openstack"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-keystone/token1.jpg?imageView2/0/w/700"><link rel="canonical" href="https://www.voidking.com/dev-ubuntu16-manual-openstack-keystone/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Ubuntu16手动安装OpenStack——keystone篇 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-ubuntu16-manual-openstack-keystone/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Ubuntu16手动安装OpenStack——keystone篇</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-06-30 10:30:00" itemprop="dateCreated datePublished" datetime="2018-06-30T10:30:00+08:00">2018-06-30</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>紧接着<a href="http://www.voidking.com/dev-ubuntu16-manual-openstack-env/">《Ubuntu16手动安装OpenStack——环境篇》</a>，本文我们来安装keystone，主要参考<a href="https://docs.openstack.org/keystone/queens/install/index-ubuntu.html" target="_blank" rel="noopener">Keystone Installation Tutorial for Ubuntu</a>。</p><a id="more"></a><h1 id="keystone简介"><a href="#keystone简介" class="headerlink" title="keystone简介"></a>keystone简介</h1><p>OpenStack身份识别服务集成了身份验证，授权和服务目录。</p><p>身份服务通常是用户与之交互的第一个服务。一旦通过身份验证，终端用户就可以使用他们的身份访问其他OpenStack服务。同样，其他OpenStack服务利用身份服务来确保用户是他们所说的人，并发现其他服务的位置。身份识别服务还可以与一些外部用户管理系统（如LDAP）集成。</p><p>用户和服务可以通过使用由身份服务管理的服务目录来定位其他服务。顾名思义，服务目录是OpenStack部署中可用服务的集合。每个服务可以有一个或多个端点，每个端点可以是以下三种类型之一：admin，internal或public。在生产环境中，出于安全原因，不同类型的终端类型可能会驻留在暴露给不同类型用户的单独网络中。例如，公共API网络可能从互联网上可见，因此客户可以管理他们的云。管理API网络可能仅限于管理云基础架构的组织中的运营商。内部API网络可能仅限于包含OpenStack服务的主机。另外，OpenStack支持多个区域的可伸缩性。为简单起见，本指南针对所有端点类型和默认的RegionOne区域使用管理网络。在身份服务中创建的区域，服务和端点一起构成部署的服务目录。部署中的每个OpenStack服务都需要一个服务条目，并在Identity服务中存储相应的端点。这可以在Identity Service安装和配置完成后完成。</p><p>身份服务包含以下组件：<br><strong>服务器</strong><br>集中式服务器使用RESTful接口提供认证和授权服务。</p><p><strong>驱动程序</strong><br>驱动程序或服务后端集成到中央服务器。它们用于访问OpenStack外部存储库中的身份信息，并且可能已存在于部署OpenStack的基础架构中（例如，SQL数据库或LDAP服务器）。</p><p><strong>模块</strong><br>中间件模块运行在使用Identity服务的OpenStack组件的地址空间中。这些模块拦截服务请求，提取用户凭据并将其发送到中央服务器进行授权。中间件模块和OpenStack组件之间的集成使用Python Web服务器网关接口。</p><h1 id="安装记录"><a href="#安装记录" class="headerlink" title="安装记录"></a>安装记录</h1><p>本节记录如何在控制节点上安装和配置代号为keystone的OpenStack Identity服务。出于可伸缩性的目的，此配置会部署Fernet令牌和Apache HTTP服务器来处理请求。</p><h2 id="root用户"><a href="#root用户" class="headerlink" title="root用户"></a>root用户</h2><p>为了避免权限问题，建议切换到root用户进行操作（否则要加很多sudo）。<br><code>sudo -i</code></p><h2 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h2><p>1、登录mariadb<br><code>mysql -uroot -p</code>，密码为openstack。</p><p>2、创建keystone数据库<br><code>CREATE DATABASE keystone;</code></p><p>3、创建keystone用户，密码为openstack，并授权访问keystone数据库<br><code>GRANT ALL PRIVILEGES ON keystone.* TO &#39;keystone&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;openstack&#39;;</code></p><p><code>GRANT ALL PRIVILEGES ON keystone.* TO &#39;keystone&#39;@&#39;%&#39; IDENTIFIED BY &#39;openstack&#39;;</code></p><p>4、退出<br><code>exit;</code></p><p>5、测试登录</p><p><code>mysql -h localhost -ukeystone -p</code></p><p><code>mysql -h controller -ukeystone -p</code></p><h2 id="安装组件"><a href="#安装组件" class="headerlink" title="安装组件"></a>安装组件</h2><p>1、安装keystone、apache2和libapache2-mod-wsgi<br><code>apt -y install keystone apache2 libapache2-mod-wsgi</code></p><p>2、<code>vim /etc/keystone/keystone.conf</code><br>编辑配置：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># line 606: uncomment and specify Memcache Server</span></span><br><span class="line"><span class="attr">memcache_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="comment"># line 740: change ( MariaDB connection info )</span></span><br><span class="line"><span class="attr">connection</span> = mysql+pymysql://keystone:openstack@controller/keystone</span><br><span class="line"><span class="comment"># line 2891: add</span></span><br><span class="line"><span class="section">[token]</span></span><br><span class="line"><span class="attr">provider</span> = fernet</span><br></pre></td></tr></table></figure><p>3、生成keystone数据库的数据</p><p><code>su -s /bin/bash keystone -c &quot;keystone-manage db_sync&quot;</code></p><p>（非root用户执行<code>sudo keystone-manage db_sync</code>）</p><p>查看日志：<code>tail /var/log/keystone/keystone-manage.log</code>，看到done说明执行成功。</p><p>不放心的话，可以登录mariadb查看keystone数据库的数据，有数据的话说明执行成功。</p><p>如果在日志中看到报错：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-30</span> <span class="number">18</span>:<span class="number">37</span>:<span class="number">40.845</span> <span class="number">4964</span> WARNING oslo_db.sqlalchemy.engines [-] SQL connection failed. <span class="number">6</span> attempts left.: DBConnectionError: (pymysql.err.OperationalError) (<span class="number">2003</span>, <span class="string">"Can't connect to MySQL server on 'controller' ([Errno 111] Connection refused)"</span>) (Background on <span class="keyword">this</span> error at: http:<span class="comment">//sqlalche.me/e/e3q8)</span></span><br></pre></td></tr></table></figure><p>这是因为，mysql可能绑定了IP。<br>执行<code>netstat -an | grep 3306</code>查看，如果只看到127.0.0.1，那么说明确实绑定了IP。</p><p>解决办法是编辑50-server.cnf，把<code>bind-address = 127.0.0.1</code>注释掉，然后重启mariadb，重新执行命令。</p><p>4、初始化Fernet密钥存储库<br><code>keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</code></p><p><code>keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</code></p><p>5、引导身份服务，管理密码为openstack</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">keystone</span>-manage <span class="keyword">bootstrap </span>--<span class="keyword">bootstrap-password </span>openstack \</span><br><span class="line">  --<span class="keyword">bootstrap-admin-url </span>http://controller:<span class="number">5000</span>/<span class="built_in">v3</span>/ \</span><br><span class="line">  --<span class="keyword">bootstrap-internal-url </span>http://controller:<span class="number">5000</span>/<span class="built_in">v3</span>/ \</span><br><span class="line">  --<span class="keyword">bootstrap-public-url </span>http://controller:<span class="number">5000</span>/<span class="built_in">v3</span>/ \</span><br><span class="line">  --<span class="keyword">bootstrap-region-id </span>RegionOne</span><br></pre></td></tr></table></figure><h2 id="配置apache"><a href="#配置apache" class="headerlink" title="配置apache"></a>配置apache</h2><p>1、<code>vim /etc/apache2/apache2.conf</code>，添加：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="type">line</span> <span class="number">70</span>: specify <span class="keyword">server</span> <span class="type">name</span></span><br><span class="line">ServerName controller</span><br></pre></td></tr></table></figure><p>2、重启apache<br><code>service apache2 restart</code></p><p>3、新建环境变量配置keystonerc</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USERNAME</span>=admin</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PASSWORD</span>=openstack</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_NAME</span>=admin</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USER_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_AUTH_URL</span>=http://controller:5000/v3</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_IDENTITY_API_VERSION</span>=3</span><br></pre></td></tr></table></figure><p>4、使环境变量生效<br><code>source keystonerc</code></p><p>5、测试<br><code>echo $OS_USERNAME</code></p><h1 id="使用记录"><a href="#使用记录" class="headerlink" title="使用记录"></a>使用记录</h1><h2 id="创建域"><a href="#创建域" class="headerlink" title="创建域"></a>创建域</h2><p>Identity服务为每个OpenStack服务提供身份验证服务。身份验证服务使用域，项目，用户和角色的组合。</p><p>1、引导身份服务步骤中已存在“默认”域，但创建新域的正式方法是：<br><code>openstack domain create --description &quot;An Example Domain&quot; example</code></p><p>虚拟机中执行成功，但是实体机报错：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Failed <span class="keyword">to</span> discover available <span class="keyword">identity</span> versions <span class="keyword">when</span> contacting http://controller:<span class="number">5000</span>/v3. Attempting <span class="keyword">to</span> parse <span class="keyword">version</span> <span class="keyword">from</span> URL.</span><br><span class="line"><span class="type">Internal</span> <span class="keyword">Server</span> Error (HTTP <span class="number">500</span>)</span><br></pre></td></tr></table></figure><p><code>netstat -an | grep 5000</code>，发现5000端口服务已经启动。</p><p>查看keystone日志，没有新的内容，说明根本没有连接成功。</p><p>尝试了重新导入数据，重新安装数据库，都失败了。</p><p>如果看到同样的错误，那么极有可能之前安装devstack遗留的问题，最终重装系统后再次安装，执行成功。</p><p>2、在default域下创建service项目：<br><code>openstack project create --domain default --description &quot;Service Project&quot; service</code></p><p>3、常规（非管理员）任务应使用非特权项目和用户。创建demo项目：<br><code>openstack project create --domain default --description &quot;Demo Project&quot; demo</code></p><p>4、创建demo用户：<br><code>openstack user create --domain default --password-prompt demo</code></p><p>按照提示设置密码为openstack。</p><p>5、创建user角色：<br><code>openstack role create user</code></p><p>6、将user角色添加到demo项目和demo用户<br><code>openstack role add --project demo --user demo user</code></p><p>7、查看域、项目、角色、用户</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openstack domain list</span><br><span class="line">openstack project list</span><br><span class="line">openstack role list</span><br><span class="line">openstack<span class="built_in"> user </span>list</span><br></pre></td></tr></table></figure><h1 id="验证操作"><a href="#验证操作" class="headerlink" title="验证操作"></a>验证操作</h1><p>在安装其他服务之前验证Identity服务的操作。</p><p>1、取消设置临时OS_AUTH_URL和OS_PASSWORD环境变量：<br><code>unset OS_AUTH_URL OS_PASSWORD</code></p><p>2、作为admin用户，请求身份验证令牌：</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openstack --os-auth-url http:<span class="comment">//controller:5000/v3 \</span></span><br><span class="line">  --os-project-domain-<span class="built_in">name</span> <span class="keyword">Default</span> --os-user-domain-<span class="built_in">name</span> <span class="keyword">Default</span> \</span><br><span class="line">  --os-project-<span class="built_in">name</span> <span class="built_in">admin</span> --os-username <span class="built_in">admin</span> token issue</span><br></pre></td></tr></table></figure><p>按照提示输入密码openstack。<br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-keystone/token1.jpg?imageView2/0/w/700" alt=""></p><p>3、作为demo用户，请求身份验证令牌：</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openstack --os-auth-url http:<span class="comment">//controller:5000/v3 \</span></span><br><span class="line">  --os-project-domain-<span class="keyword">name</span> <span class="keyword">Default</span> --os-user-domain-<span class="keyword">name</span> <span class="keyword">Default</span> \</span><br><span class="line">  --os-project-<span class="keyword">name</span> demo --os-username demo token issue</span><br></pre></td></tr></table></figure><p>按照提示输入密码openstack。<br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-keystone/token2.jpg?imageView2/0/w/700" alt=""></p><h1 id="创建OpenStack客户端环境脚本"><a href="#创建OpenStack客户端环境脚本" class="headerlink" title="创建OpenStack客户端环境脚本"></a>创建OpenStack客户端环境脚本</h1><p>前面几节使用了环境变量和命令选项的组合，通过openstack客户端与Identity服务进行交互。为了提高客户端操作的效率，OpenStack支持简单的客户端环境脚本，也称为OpenRC文件。这些脚本通常包含所有客户端的常用选项，但也支持独特的选项。</p><h2 id="创建脚本"><a href="#创建脚本" class="headerlink" title="创建脚本"></a>创建脚本</h2><p>为admin和demo项目和用户创建客户端环境脚本。接下来引用这些脚本来加载客户端操作的适当凭据。这些脚本在控制节点和计算节点都适用。</p><p>1、创建并编辑admin-openrc文件并添加以下内容：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USER_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_NAME</span>=admin</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USERNAME</span>=admin</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PASSWORD</span>=openstack</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_AUTH_URL</span>=http://controller:5000/v3</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_IDENTITY_API_VERSION</span>=3</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_IMAGE_API_VERSION</span>=2</span><br></pre></td></tr></table></figure><p>2、创建并编辑demo-openrc文件并添加以下内容：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USER_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_NAME</span>=demo</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USERNAME</span>=demo</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PASSWORD</span>=openstack</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_AUTH_URL</span>=http://controller:5000/v3</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_IDENTITY_API_VERSION</span>=3</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_IMAGE_API_VERSION</span>=2</span><br></pre></td></tr></table></figure><h2 id="使用脚本"><a href="#使用脚本" class="headerlink" title="使用脚本"></a>使用脚本</h2><p>要将客户端作为特定项目和用户运行，只需在运行它们之前加载关联的客户端环境脚本即可。例如：</p><p>1、加载admin-openrc文件以使用Identity服务的位置以及管理项目和用户凭据填充环境变量：<br><code>. admin-openrc</code>或者<code>source admin-openrc</code></p><p>2、请求身份验证令牌：<br><code>openstack token issue</code></p><p><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-keystone/token3.jpg?imageView2/0/w/700" alt=""></p><p><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-keystone/token4.jpg?imageView2/0/w/700" alt=""></p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-ubuntu16-manual-openstack-keystone/" title="Ubuntu16手动安装OpenStack——keystone篇">https://www.voidking.com/dev-ubuntu16-manual-openstack-keystone/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/ubuntu/" rel="tag"># ubuntu</a> <a href="/tags/openstack/" rel="tag"># openstack</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-ubuntu16-manual-openstack-env/" rel="prev" title="Ubuntu16手动安装OpenStack——环境篇"><i class="fa fa-chevron-left"></i> Ubuntu16手动安装OpenStack——环境篇</a></div><div class="post-nav-item"> <a href="/dev-ubuntu16-manual-openstack-glance/" rel="next" title="Ubuntu16手动安装OpenStack——glance篇">Ubuntu16手动安装OpenStack——glance篇<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#目标"><span class="nav-number">1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#keystone简介"><span class="nav-number">2.</span> <span class="nav-text">keystone简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装记录"><span class="nav-number">3.</span> <span class="nav-text">安装记录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#root用户"><span class="nav-number">3.1.</span> <span class="nav-text">root用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库配置"><span class="nav-number">3.2.</span> <span class="nav-text">数据库配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装组件"><span class="nav-number">3.3.</span> <span class="nav-text">安装组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置apache"><span class="nav-number">3.4.</span> <span class="nav-text">配置apache</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用记录"><span class="nav-number">4.</span> <span class="nav-text">使用记录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建域"><span class="nav-number">4.1.</span> <span class="nav-text">创建域</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#验证操作"><span class="nav-number">5.</span> <span class="nav-text">验证操作</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建OpenStack客户端环境脚本"><span class="nav-number">6.</span> <span class="nav-text">创建OpenStack客户端环境脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建脚本"><span class="nav-number">6.1.</span> <span class="nav-text">创建脚本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用脚本"><span class="nav-number">6.2.</span> <span class="nav-text">使用脚本</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">656</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">205</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://www.beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>