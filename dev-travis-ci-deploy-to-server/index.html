<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言《Hexo配置Travis CI自动发布》一文中，我们学习了使用travis-ci构建发布hexo项目的方法。 因为项目的特殊性，所以发布时只是把代码push到了git仓库，并没有把代码发布到我们自己的服务。本文，我们就来学习一下怎样通过travis-ci，把项目发布到我们自己的服务器。 需求：已知hexo项目部署在github，百度抓取不到github的内容，因此我们想要在自己的服务器也部署"><meta property="og:type" content="article"><meta property="og:title" content="使用Travis CI部署项目到服务器"><meta property="og:url" content="https://www.voidking.com/dev-travis-ci-deploy-to-server/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言《Hexo配置Travis CI自动发布》一文中，我们学习了使用travis-ci构建发布hexo项目的方法。 因为项目的特殊性，所以发布时只是把代码push到了git仓库，并没有把代码发布到我们自己的服务。本文，我们就来学习一下怎样通过travis-ci，把项目发布到我们自己的服务器。 需求：已知hexo项目部署在github，百度抓取不到github的内容，因此我们想要在自己的服务器也部署"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com/@/imgs/travis-ci-deploy-to-server/success.png?imageView2/0/w/800"><meta property="article:published_time" content="2021-04-11T16:00:00.000Z"><meta property="article:modified_time" content="2021-08-22T10:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="hexo"><meta property="article:tag" content="cicd"><meta property="article:tag" content="travis-ci"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com/@/imgs/travis-ci-deploy-to-server/success.png?imageView2/0/w/800"><link rel="canonical" href="https://www.voidking.com/dev-travis-ci-deploy-to-server/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>使用Travis CI部署项目到服务器 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-travis-ci-deploy-to-server/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> 使用Travis CI部署项目到服务器</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-04-11 16:00:00" itemprop="dateCreated datePublished" datetime="2021-04-11T16:00:00+00:00">2021-04-11</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-08-22 10:00:00" itemprop="dateModified" datetime="2021-08-22T10:00:00+00:00">2021-08-22</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/hexo/" itemprop="url" rel="index"><span itemprop="name">hexo</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><a href="https://www.voidking.com/dev-hexo-travis-ci/">《Hexo配置Travis CI自动发布》</a>一文中，我们学习了使用travis-ci构建发布hexo项目的方法。</p><p>因为项目的特殊性，所以发布时只是把代码push到了git仓库，并没有把代码发布到我们自己的服务。本文，我们就来学习一下怎样通过travis-ci，把项目发布到我们自己的服务器。</p><p>需求：<br>已知hexo项目部署在github，百度抓取不到github的内容，因此我们想要在自己的服务器也部署一份代码，国内的流量打到自己的服务器。实现国内流量 -&gt; 阿里云服务器，国外流量 -&gt; github pages。<br>配置 hexo-deploy ，在发布时会同时发布静态页面到 <a target="_blank" rel="noopener" href="https://github.com/voidking/voidking.github.io.git">voidking.github.io</a> 和 <a target="_blank" rel="noopener" href="https://gitee.com/voidking/voidking.git">voidking</a>。<br>阿里云服务器上有项目 /opt/nginx/work/voidking ，项目仓库为 <a target="_blank" rel="noopener" href="https://gitee.com/voidking/voidking.git">voidking</a>。<br>现在想要实现的是，当使用 hexo-deploy 之后，阿里云服务器上的代码能够自动更新。</p><span id="more"></span><h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><p>给 voidking.github.io 项目配置travis-ci，当静态页面更新完成后，在阿里云服务器上执行 git pull。<br>中间需要解决的主要问题是： travis-ci 访问阿里云服务器的权限问题。</p><p>另外，因为 voidking.github.io 项目是线上项目，所以我们创建一个在github上和travis-ci上分别创建一个 travis-test 项目，用来测试travis-ci的配置。</p><h1 id="配置travis-ci"><a href="#配置travis-ci" class="headerlink" title="配置travis-ci"></a>配置travis-ci</h1><h2 id="服务器密钥配置"><a href="#服务器密钥配置" class="headerlink" title="服务器密钥配置"></a>服务器密钥配置</h2><p>1、创建一个用户专门用来更新代码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useradd -m voidking -s /bin/bash</span><br><span class="line">passwd voidking</span><br><span class="line">chown voidking -R /opt/nginx/work/</span><br></pre></td></tr></table></figure><p>2、生成密钥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su voidking</span><br><span class="line">cd ~</span><br><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure><p>执行完之后，.ssh目录下生成了 id_rsa 和 id_rsa.pub。</p><p>3、使密钥生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALI_IP=&quot;8.136.13.58&quot;</span><br><span class="line">ssh-copy-id -i .ssh/id_rsa.pub voidking@$&#123;ALI_IP&#125;</span><br><span class="line">ssh voidking@$&#123;ALI_IP&#125;</span><br></pre></td></tr></table></figure><h2 id="安装travis-client"><a href="#安装travis-client" class="headerlink" title="安装travis client"></a>安装travis client</h2><p>直接安装travis破坏服务器环境，因此最好使用Docker安装travis。<br>1、运行travis容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull ruby:slim</span><br><span class="line">docker run --name travis -it -d ruby:slim /bin/bash</span><br><span class="line">docker exec -it travis /bin/bash</span><br></pre></td></tr></table></figure><p>2、容器内安装travis client</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gem sources --add https://gems.ruby-china.com/ --remove https://rubygems.org/</span></span><br><span class="line">gem install travis</span><br><span class="line">travis -h</span><br></pre></td></tr></table></figure><h2 id="travis-ci密钥配置"><a href="#travis-ci密钥配置" class="headerlink" title="travis-ci密钥配置"></a>travis-ci密钥配置</h2><p>1、拷贝密钥到容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker cp /home/voidking/.ssh/id_rsa travis:/tmp</span><br><span class="line">docker exec -it travis /bin/bash</span><br></pre></td></tr></table></figure><p>2、登录travis-ci</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">travis login --com --github-token xxxxxx</span><br></pre></td></tr></table></figure><p>3、对id_rsa加密，生成id_rsa.enc；同时生成服务端解密命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch .travis.yml</span><br><span class="line">travis encrypt-file id_rsa --add --com --repo=voidking/travis-test</span><br></pre></td></tr></table></figure><p>详情参考<a target="_blank" rel="noopener" href="https://docs.travis-ci.com/user/encrypting-files">Encrypting Files</a>。</p><p>执行完命令，会生成加密文件 id_rsa.enc，.travis.yml 中会被写入解密命令：</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">before_install:</span></span><br><span class="line">- openssl aes-<span class="number">256</span>-cbc -K <span class="variable">$encrypted_f217180e22ee_key</span> -iv <span class="variable">$encrypted_f217180e22ee_iv</span> -in id_rsa.enc -<span class="keyword">out</span> id_rsa -d</span><br></pre></td></tr></table></figure><p>并且，变量 <code>encrypted_f217180e22ee_key</code> 和 <code>encrypted_f217180e22ee_iv</code> 会填入travis-ci上travis-test项目中的环境变量配置中。</p><h2 id="travis-yml配置"><a href="#travis-yml配置" class="headerlink" title="travis.yml配置"></a>travis.yml配置</h2><p>1、访问<a target="_blank" rel="noopener" href="https://travis-ci.com/">Travis CI Pro</a>，找到 travis-test 项目，Settings，在Environment Variables一栏填入Name为GITEE_TOKEN，VALUE为gitee的access token。</p><p>2、在github上 travis-test 项目中放入 id_rsa.enc</p><p>3、在github上 travis-test 项目中创建 .travis.yml，内容为</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo</span><span class="punctuation">:</span> <span class="string">false</span></span><br><span class="line"><span class="attribute">language</span><span class="punctuation">:</span> <span class="string">python</span></span><br><span class="line"><span class="attribute">python</span><span class="punctuation">:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">3.6</span></span><br><span class="line"><span class="attribute">branches</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">only</span><span class="punctuation">:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">main # build main branch only</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">env</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">global</span><span class="punctuation">:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ALI_IP: 8.136.13.58</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">GIT_USER: voidking</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">GITEE_PAGES_REPO: gitee.com/voidking/voidking.git</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">addons</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">ssh_known_hosts</span><span class="punctuation">: </span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">8.136.13.58</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">before_install</span><span class="punctuation">:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">openssl aes-256-cbc -K $encrypted_f217180e22ee_key -iv $encrypted_f217180e22ee_iv -in id_rsa.enc -out ~/.ssh/id_rsa -d</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">chmod 600 ~/.ssh/id_rsa</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">script</span><span class="punctuation">:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">ssh voidking@$&#123;ALI_IP&#125; &quot;cd /opt/nginx/work/voidking/ &amp;&amp; git pull --force --quiet \&quot;https://$&#123;GIT_USER&#125;:$&#123;GITEE_TOKEN&#125;@$&#123;GITEE_PAGES_REPO&#125;\&quot; master:master&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">after_success</span><span class="punctuation">:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">echo &quot;deploy success&quot;</span></span><br></pre></td></tr></table></figure><p>4、提交代码</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">add</span> .</span><br><span class="line">git commmit -m <span class="string">&quot;添加travis.yml&quot;</span></span><br><span class="line">git <span class="keyword">push</span></span><br></pre></td></tr></table></figure><p>5、验证<br>打开<a target="_blank" rel="noopener" href="https://travis-ci.com/github/voidking/travis-test">travis voidking/travis-test</a> ，可以看到脚本已经成功执行。<br><img src="http://cdn.voidking.com/@/imgs/travis-ci-deploy-to-server/success.png?imageView2/0/w/800"></p><p>登录阿里云服务器，git log查看代码版本，确实也已经更新到了最新版。nice！</p><p>最后，同样的步骤配置到 voidking.github.io 项目上即可。</p><h1 id="配置travis-ci简化版"><a href="#配置travis-ci简化版" class="headerlink" title="配置travis-ci简化版"></a>配置travis-ci简化版</h1><p>上面的流程，安全性较高，但是整个流程很麻烦，有没有更简单的办法？必须是有的。<br>方法一：安装sshpass，直接使用密码登录服务器执行命令。<br>方法二：把私钥作为参数配置到travis-ci，使用时写入到文件中。</p><p>本节中我们研究一下方法二的配置方法。</p><h2 id="服务器密钥配置-1"><a href="#服务器密钥配置-1" class="headerlink" title="服务器密钥配置"></a>服务器密钥配置</h2><p>1、创建一个用户专门用来更新代码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useradd -m voidking -s /bin/bash</span><br><span class="line">passwd voidking</span><br><span class="line">chown voidking -R /opt/nginx/work/</span><br></pre></td></tr></table></figure><p>2、生成密钥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su voidking</span><br><span class="line">cd ~</span><br><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure><p>执行完之后，.ssh目录下生成了 id_rsa 和 id_rsa.pub。</p><p>3、使密钥生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALI_IP=&quot;8.136.13.58&quot;</span><br><span class="line">ssh-copy-id -i .ssh/id_rsa.pub voidking@$&#123;ALI_IP&#125;</span><br><span class="line">ssh voidking@$&#123;ALI_IP&#125;</span><br></pre></td></tr></table></figure><h2 id="travis-ci密钥配置-1"><a href="#travis-ci密钥配置-1" class="headerlink" title="travis-ci密钥配置"></a>travis-ci密钥配置</h2><p>1、加密私钥<br><code>cat .ssh/id_rsa | base64 | tr -d &#39;\n&#39;</code></p><p>2、访问<a target="_blank" rel="noopener" href="https://travis-ci.com/">Travis CI Pro</a>，找到 travis-test 项目，Settings，Environment Variables。创建两组环境变量：</p><ul><li>Name为<code>GITEE_TOKEN</code>，VALUE为gitee的access token。</li><li>Name为<code>ID_RSA</code>，VALUE为加密后的私钥。</li></ul><h2 id="travis-yml配置-1"><a href="#travis-yml配置-1" class="headerlink" title="travis.yml配置"></a>travis.yml配置</h2><p>1、在github上 travis-test 项目中创建 .travis.yml，内容为</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo</span><span class="punctuation">:</span> <span class="string">false</span></span><br><span class="line"><span class="attribute">language</span><span class="punctuation">:</span> <span class="string">python</span></span><br><span class="line"><span class="attribute">python</span><span class="punctuation">:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">3.6</span></span><br><span class="line"><span class="attribute">branches</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">only</span><span class="punctuation">:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">main # build main branch only</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">env</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">global</span><span class="punctuation">:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ALI_IP: 8.136.13.58</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">GIT_USER: voidking</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">GITEE_PAGES_REPO: gitee.com/voidking/voidking.git</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">addons</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">ssh_known_hosts</span><span class="punctuation">: </span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">8.136.13.58</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">before_install</span><span class="punctuation">:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">echo $&#123;ID_RSA&#125; | base64 -d &gt; ~/.ssh/id_rsa</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">chmod 600 ~/.ssh/id_rsa</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">script</span><span class="punctuation">:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">ssh voidking@$&#123;ALI_IP&#125; &quot;cd /opt/nginx/work/voidking/ &amp;&amp; git pull --force --quiet \&quot;https://$&#123;GIT_USER&#125;:$&#123;GITEE_TOKEN&#125;@$&#123;GITEE_PAGES_REPO&#125;\&quot; master:master&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">after_success</span><span class="punctuation">:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">echo &quot;deploy success&quot;</span></span><br></pre></td></tr></table></figure><p>2、提交代码</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">add</span> .</span><br><span class="line">git commmit -m <span class="string">&quot;简化travis.yml&quot;</span></span><br><span class="line">git <span class="keyword">push</span></span><br></pre></td></tr></table></figure><p>3、验证<br>打开<a target="_blank" rel="noopener" href="https://travis-ci.com/github/voidking/travis-test">travis voidking/travis-test</a> ，查看脚本执行日志。<br>登录阿里云服务器，git log查看代码版本。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-travis-ci-deploy-to-server/" title="使用Travis CI部署项目到服务器">https://www.voidking.com/dev-travis-ci-deploy-to-server/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/hexo/" rel="tag"># hexo</a> <a href="/tags/cicd/" rel="tag"># cicd</a> <a href="/tags/travis-ci/" rel="tag"># travis-ci</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-how-to-name-better/" rel="prev" title="怎样给文件、变量和函数命名？"><i class="fa fa-chevron-left"></i> 怎样给文件、变量和函数命名？</a></div><div class="post-nav-item"> <a href="/dev-hexo-next-update-time/" rel="next" title="Hexo Next主题显示文章更新时间">Hexo Next主题显示文章更新时间<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><div class="_xduxciwe4ao"></div><script type="text/javascript">(window.slotbydup=window.slotbydup||[]).push({id:"u6920911",container:"_xduxciwe4ao",async:!0}),(window.slotbydup=window.slotbydup||[]).push({id:"u6920919",container:"_053ydasmd31h",async:!0})</script><script type="text/javascript" src="//cpro.baidustatic.com/cpro/ui/cm.js" async="async" defer="defer"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF"><span class="nav-number">2.</span> <span class="nav-text">思路</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEtravis-ci"><span class="nav-number">3.</span> <span class="nav-text">配置travis-ci</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AF%86%E9%92%A5%E9%85%8D%E7%BD%AE"><span class="nav-number">3.1.</span> <span class="nav-text">服务器密钥配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85travis-client"><span class="nav-number">3.2.</span> <span class="nav-text">安装travis client</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#travis-ci%E5%AF%86%E9%92%A5%E9%85%8D%E7%BD%AE"><span class="nav-number">3.3.</span> <span class="nav-text">travis-ci密钥配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#travis-yml%E9%85%8D%E7%BD%AE"><span class="nav-number">3.4.</span> <span class="nav-text">travis.yml配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEtravis-ci%E7%AE%80%E5%8C%96%E7%89%88"><span class="nav-number">4.</span> <span class="nav-text">配置travis-ci简化版</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AF%86%E9%92%A5%E9%85%8D%E7%BD%AE-1"><span class="nav-number">4.1.</span> <span class="nav-text">服务器密钥配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#travis-ci%E5%AF%86%E9%92%A5%E9%85%8D%E7%BD%AE-1"><span class="nav-number">4.2.</span> <span class="nav-text">travis-ci密钥配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#travis-yml%E9%85%8D%E7%BD%AE-1"><span class="nav-number">4.3.</span> <span class="nav-text">travis.yml配置</span></a></li></ol></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="_053ydasmd31h"></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">645</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">242</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>