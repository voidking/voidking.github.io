<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//qiniu.cdn.voidking.com/doc/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="问题描述大部分用户能够正常登录和使用ks，但是个别用户（voidking01）登录ks后报错。用户登录ks，正常；登录后查看工作台，正常；查看host集群和只包含host集群的企业空间，正常。 但是，选择一个非host集群或者选择一个包含非host集群的企业空间后，页面就会弹出错误提示：Session timeout or this account is logged in elsewhere,"><meta property="og:type" content="article"><meta property="og:title" content="KubeSphere登录后报错Session Timeout"><meta property="og:url" content="https://www.voidking.com/dev-kubesphere-session-timeout/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="问题描述大部分用户能够正常登录和使用ks，但是个别用户（voidking01）登录ks后报错。用户登录ks，正常；登录后查看工作台，正常；查看host集群和只包含host集群的企业空间，正常。 但是，选择一个非host集群或者选择一个包含非host集群的企业空间后，页面就会弹出错误提示：Session timeout or this account is logged in elsewhere,"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2022-10-10T15:00:00.000Z"><meta property="article:modified_time" content="2022-11-02T11:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="k8s"><meta property="article:tag" content="问题排查"><meta property="article:tag" content="存储"><meta property="article:tag" content="kubesphere"><meta property="article:tag" content="storageclass"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-kubesphere-session-timeout/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>KubeSphere登录后报错Session Timeout | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">一个计算机技术爱好者与学习者</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-kubesphere-session-timeout/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="一个计算机技术爱好者与学习者"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> KubeSphere登录后报错Session Timeout</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2022-10-10 15:00:00" itemprop="dateCreated datePublished" datetime="2022-10-10T15:00:00+00:00">2022-10-10</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-11-02 11:00:00" itemprop="dateModified" datetime="2022-11-02T11:00:00+00:00">2022-11-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/cloudnative/" itemprop="url" rel="index"><span itemprop="name">cloudnative</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/troubleshooting/" itemprop="url" rel="index"><span itemprop="name">troubleshooting</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/storage/" itemprop="url" rel="index"><span itemprop="name">storage</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="问题描述"><span class="post-title-index">1.</span><a href="#问题描述" class="headerlink" title="问题描述"></a> 问题描述</h1><p>大部分用户能够正常登录和使用ks，但是个别用户（voidking01）登录ks后报错。<br>用户登录ks，正常；登录后查看工作台，正常；查看host集群和只包含host集群的企业空间，正常。</p><p>但是，选择一个非host集群或者选择一个包含非host集群的企业空间后，页面就会弹出错误提示：<br>Session timeout or this account is logged in elsewhere, please login again</p><p>然后转到登录页面，再次登录，继续弹出上面的错误提示。循环往复。</p><span id="more"></span><h1 id="权限问题？"><span class="post-title-index">2.</span><a href="#权限问题？" class="headerlink" title="权限问题？"></a> 权限问题？</h1><p>更改用户权限为admin，问题依旧。</p><p>重新给用户授权，问题依旧。</p><h1 id="ks版本问题？"><span class="post-title-index">3.</span><a href="#ks版本问题？" class="headerlink" title="ks版本问题？"></a> ks版本问题？</h1><p>ks版本从3.2.1升级到了3.3.1，问题依旧。</p><h1 id="kube-events组件问题？"><span class="post-title-index">4.</span><a href="#kube-events组件问题？" class="headerlink" title="kube-events组件问题？"></a> kube-events组件问题？</h1><p>参考文档<a target="_blank" rel="noopener" href="https://kubesphere.com.cn/forum/d/1501">登录成功后，总是提示会话超时或此账户在其他登录地方登录，请重新登录</a></p><p>经检查，并没有kube-events失败日志，不是它的问题。</p><h1 id="ks配置问题？"><span class="post-title-index">5.</span><a href="#ks配置问题？" class="headerlink" title="ks配置问题？"></a> ks配置问题？</h1><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://kubesphere.io/docs/v3.3/faq/access-control/session-timeout/">Session Timeout</a></li><li><a target="_blank" rel="noopener" href="https://kubesphere.io/docs/v3.3/access-control-and-account-management/external-authentication/set-up-external-authentication/">Set Up External Authentication</a></li></ul><p>阅读ks文档，怀疑是ks配置不对引起的。那就按照官方文档重新配置一下试试。</p><h2 id="host集群"><span class="post-title-index">5.1.</span><a href="#host集群" class="headerlink" title="host集群"></a> host集群</h2><p>1、编辑ks-installer配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kubesphere-system edit cc ks-installer</span><br></pre></td></tr></table></figure><p>2、修改authentication部分配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">authentication:</span></span><br><span class="line">    <span class="attr">jwtSecret:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="attr">authenticateRateLimiterMaxTries:</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">authenticateRateLimiterDuration:</span> <span class="string">10m0s</span></span><br><span class="line">    <span class="attr">loginHistoryRetentionPeriod:</span> <span class="string">168h</span></span><br><span class="line">    <span class="attr">maximumClockSkew:</span> <span class="string">10s</span></span><br><span class="line">    <span class="attr">multipleLogin:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">oauthOptions:</span></span><br><span class="line">      <span class="attr">accessTokenMaxAge:</span> <span class="string">1h</span></span><br><span class="line">      <span class="attr">accessTokenInactivityTimeout:</span> <span class="string">30m</span></span><br><span class="line">      <span class="attr">identityProviders:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">LDAP</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">LDAPIdentityProvider</span></span><br><span class="line">        <span class="attr">mappingMethod:</span> <span class="string">auto</span></span><br><span class="line">        <span class="attr">provider:</span></span><br><span class="line">          <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.2</span><span class="string">:389</span></span><br><span class="line">          <span class="attr">managerDN:</span> <span class="string">uid=root,cn=users,dc=nas</span></span><br><span class="line">          <span class="attr">managerPassword:</span> <span class="string">********</span></span><br><span class="line">          <span class="attr">userSearchBase:</span> <span class="string">cn=users,dc=nas</span></span><br><span class="line">          <span class="attr">loginAttribute:</span> <span class="string">uid</span></span><br><span class="line">          <span class="attr">mailAttribute:</span> <span class="string">mail</span></span><br></pre></td></tr></table></figure><h2 id="member集群"><span class="post-title-index">5.2.</span><a href="#member集群" class="headerlink" title="member集群"></a> member集群</h2><p>member集群只要配置<code>jwtSecret</code>即可，和host集群保持一致。详情参考<a target="_blank" rel="noopener" href="https://kubesphere.io/docs/v3.3/multicluster-management/enable-multicluster/direct-connection/">Direct Connection</a></p><p>修改完成，ks pod重建后，问题依旧。</p><h1 id="删除用户重建？"><span class="post-title-index">6.</span><a href="#删除用户重建？" class="headerlink" title="删除用户重建？"></a> 删除用户重建？</h1><p>删除用户，用户重新登录，重新授权，问题依旧。</p><h1 id="时钟问题？"><span class="post-title-index">7.</span><a href="#时钟问题？" class="headerlink" title="时钟问题？"></a> 时钟问题？</h1><p>参考<a target="_blank" rel="noopener" href="https://kubesphere.io/docs/v3.3/faq/access-control/session-timeout/">Session Timeout</a>文档，还有一种可能是节点时钟偏差。</p><blockquote><p>The node clock skew affects time-sensitive operations such as validating the expiration time of a user token. You can configure the server time synchronization with an NTP server. MaximumClockSkew can also be set, which defaults to 10 seconds.</p></blockquote><p>分别登录host集群和member集群的apiserver pod，执行<code>date</code>命令查看时间。<br>发现不同集群的时区配置不同，啊哈，大概率是这个问题了！！！</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure><p>统一所有集群节点时区为<code>Asia/Shanghai</code>，然后重建ks pod。问题依旧。</p><p>把<code>maximumClockSkew</code>也调大一些，默认10s，调整到60s试试。问题依旧。</p><h1 id="查看日志"><span class="post-title-index">8.</span><a href="#查看日志" class="headerlink" title="查看日志"></a> 查看日志</h1><p>参考文档<a target="_blank" rel="noopener" href="https://kubesphere.com.cn/docs/v3.3/faq/multi-cluster-management/host-cluster-access-member-cluster/">恢复主集群对成员集群的访问权限</a>，查看member集群的api-server日志。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kubesphere-system logs ks-apiserver-7c9c9456bd-qv6bs</span><br></pre></td></tr></table></figure><p>出现报错信息：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">W1104 11:13:28.432457       1 clusterroles.go:117] invalid aggregation role found: cluster-admin, role-template-manage-configmaps</span><br><span class="line">W1104 11:13:28.432464       1 clusterroles.go:117] invalid aggregation role found: cluster-admin, role-template-view-secrets</span><br><span class="line">W1104 11:13:28.432469       1 clusterroles.go:117] invalid aggregation role found: cluster-admin, role-template-manage-secrets</span><br><span class="line">W1104 11:13:28.432475       1 clusterroles.go:117] invalid aggregation role found: cluster-admin, role-template-view-service-accounts</span><br><span class="line">W1104 11:13:28.432484       1 clusterroles.go:117] invalid aggregation role found: cluster-admin, role-template-manage-service-accounts</span><br><span class="line">E1104 11:13:51.879574       1 upgradeaware.go:401] Error proxying data from backend to client: readfrom tcp 10.244.161.166:9090-&gt;192.168.50.74:34540: write tcp 10.244.161.166:9090-&gt;192.168.50.74:34540: write: connection reset by peer</span><br></pre></td></tr></table></figure><p>顺着这个日志，在kubesphere社区找到了一个相同的问题<a target="_blank" rel="noopener" href="https://kubesphere.com.cn/forum/d/7394-kubesphere-member">kubesphere使用子账户…会跳转到登录界面</a></p><blockquote><p>看起来是多集群同步出问题了，看下 host 集群 kube-federation-system 这个 namespace 下的 pod 是否都正常</p></blockquote><p>根据论坛大佬的提示，检查kube-federation-system 这个 namespace 下的pod信息。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod -n kube-federation-system</span><br><span class="line">kubectl logs --<span class="built_in">tail</span>=100 kubefed-admission-webhook-657959d4d6-2sx5f -n kube-federation-system</span><br><span class="line">kubectl logs --<span class="built_in">tail</span>=100 kubefed-controller-manager-54fbd87f7f-6t7jq -n kube-federation-system</span><br><span class="line">kubectl logs --<span class="built_in">tail</span>=100 kubefed-controller-manager-54fbd87f7f-fh9pk -n kube-federation-system</span><br></pre></td></tr></table></figure><p>看着也没有什么明显的报错信息。</p><p>根据论坛的提示，有两个解决办法：一个是替换kubeconfig，一个是升级kubefed controller。</p><ul><li><a target="_blank" rel="noopener" href="https://github.com/kubesphere/kubesphere/issues/4891">Update the version of kubefed controller</a></li><li><a target="_blank" rel="noopener" href="https://github.com/kubernetes-sigs/kubefed/pull/1505">fix: controller-manager panic when kubeconfig set filed insecure-skip-tls-verify</a></li></ul><p>这里我们选择升级kubefed controller。</p><h1 id="升级kubefed-controller"><span class="post-title-index">9.</span><a href="#升级kubefed-controller" class="headerlink" title="升级kubefed controller"></a> 升级kubefed controller</h1><p>1、查看当前kubefed controller版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deployment.apps/kubefed-controller-manager -n kube-federation-system -oyaml| grep image</span><br></pre></td></tr></table></figure><p>查看到当前版本v0.8.1</p><p>2、查看kubefed controller最新版本<br>访问<a target="_blank" rel="noopener" href="https://hub.docker.com/r/kubesphere/kubefed/tags">dockerhub - kubesphere/kubefed</a><br>找到当前最新版本，也是v0.8.1</p><p>莫非不是版本问题？再对比本地镜像和线上镜像的DIGEST，发现它们是不同的。看来是修复bug后，使用了原来的镜像tag。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect kubesphere/kubefed:v0.8.1 | grep -i <span class="built_in">id</span></span><br></pre></td></tr></table></figure><p>3、缩容kubefed controller</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl scale --replicas=0 deployment.apps/kubefed-controller-manager -n kube-federation-system</span><br></pre></td></tr></table></figure><p>4、删除宿主机本地镜像&amp;拉取最新镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker rmi kubesphere/kubefed:v0.8.1 </span><br><span class="line">docker pull kubesphere/kubefed:v0.8.1</span><br></pre></td></tr></table></figure><p>5、重新拉起kubefed controller</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl scale --replicas=1 deployment.apps/kubefed-controller-manager -n kube-federation-system</span><br></pre></td></tr></table></figure><p>问题依旧。。。</p><h1 id="废弃集群的问题？"><span class="post-title-index">10.</span><a href="#废弃集群的问题？" class="headerlink" title="废弃集群的问题？"></a> 废弃集群的问题？</h1><p>再次查看kubefed-controller-manager的日志，感觉像是废弃集群引起的问题。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">E1104 08:10:15.107249       1 controller.go:512] failed to delete FederatedGlobalRoleBinding &quot;voidking01-platform-regular&quot;: the following clusters were not ready: vk-dev, edge-cluster</span><br><span class="line">I1104 08:10:15.702028       1 controller.go:471] Ensuring deletion of FederatedGlobalRoleBinding &quot;voidking01-platform-admin&quot;</span><br><span class="line">I1104 08:10:15.702064       1 controller.go:500] Deserializing delete options of FederatedGlobalRoleBinding &quot;voidking01-platform-admin&quot;</span><br><span class="line">I1104 08:10:15.702072       1 controller.go:508] Deleting resources managed by FederatedGlobalRoleBinding &quot;voidking01-platform-admin&quot; from member clusters.</span><br><span class="line">E1104 08:10:15.702117       1 controller.go:512] failed to delete FederatedGlobalRoleBinding &quot;voidking01-platform-admin&quot;: the following clusters were not ready: vk-dev, edge-cluster</span><br></pre></td></tr></table></figure><p>删除废弃的集群后（未就绪的集群），问题解决。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>原文链接：</strong> <a href="https://www.voidking.com/dev-kubesphere-session-timeout/" title="KubeSphere登录后报错Session Timeout">https://www.voidking.com/dev-kubesphere-session-timeout/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本文采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议，转载请注明出处！源站会即时更新知识点并修正错误，欢迎访问~</li><li> <img width="200" height="200" src="/images/avatar.jpg"><p style="text-align:center;margin-bottom:0">微信公众号同步更新，欢迎关注~</p></li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/k8s/" rel="tag"># k8s</a> <a href="/tags/%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/" rel="tag"># 问题排查</a> <a href="/tags/%E5%AD%98%E5%82%A8/" rel="tag"># 存储</a> <a href="/tags/kubesphere/" rel="tag"># kubesphere</a> <a href="/tags/storageclass/" rel="tag"># storageclass</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-multi-tenancy-in-kubesphere/" rel="prev" title="KubeSphere中的多租户管理"><i class="fa fa-chevron-left"></i> KubeSphere中的多租户管理</a></div><div class="post-nav-item"> <a href="/dev-k8s-kubesphere/" rel="next" title="好好学K8S：K8S中安装配置KubeSphere">好好学K8S：K8S中安装配置KubeSphere<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3284447971731414" data-ad-slot="9697986181"></ins><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="nav-text">1. 问题描述</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="nav-text">2. 权限问题？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ks%E7%89%88%E6%9C%AC%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="nav-text">3. ks版本问题？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#kube-events%E7%BB%84%E4%BB%B6%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="nav-text">4. kube-events组件问题？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ks%E9%85%8D%E7%BD%AE%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="nav-text">5. ks配置问题？</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#host%E9%9B%86%E7%BE%A4"><span class="nav-text">5.1. host集群</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#member%E9%9B%86%E7%BE%A4"><span class="nav-text">5.2. member集群</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7%E9%87%8D%E5%BB%BA%EF%BC%9F"><span class="nav-text">6. 删除用户重建？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%97%B6%E9%92%9F%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="nav-text">7. 时钟问题？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97"><span class="nav-text">8. 查看日志</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%87%E7%BA%A7kubefed-controller"><span class="nav-text">9. 升级kubefed controller</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BA%9F%E5%BC%83%E9%9B%86%E7%BE%A4%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="nav-text">10. 废弃集群的问题？</span></a></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">一个计算机技术爱好者与学习者</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">723</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">31</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">254</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: '84c5517ebb4716b8e0e191d5ad4893a7',
      title: 'KubeSphere登录后报错Session Timeout',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>