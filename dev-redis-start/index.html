<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="Redis简介 Redis: The open source, in-memory data store used by millions of developers as a database, cache, streaming engine, and message broker.  Redis是被数百万开发人员用作数据库、缓存、流引擎和消息代理的开源内存数据存储。 Redis特点：  Red"><meta property="og:type" content="article"><meta property="og:title" content="Redis入门篇"><meta property="og:url" content="https://www.voidking.com/dev-redis-start/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="Redis简介 Redis: The open source, in-memory data store used by millions of developers as a database, cache, streaming engine, and message broker.  Redis是被数百万开发人员用作数据库、缓存、流引擎和消息代理的开源内存数据存储。 Redis特点：  Red"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2019-11-03T13:00:00.000Z"><meta property="article:modified_time" content="2022-11-29T08:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="docker"><meta property="article:tag" content="数据库"><meta property="article:tag" content="redis"><meta property="article:tag" content="缓存"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-redis-start/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Redis入门篇 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-redis-start/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Redis入门篇</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-11-03 21:00:00" itemprop="dateCreated datePublished" datetime="2019-11-03T21:00:00+08:00">2019-11-03</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-11-29 16:00:00" itemprop="dateModified" datetime="2022-11-29T16:00:00+08:00">2022-11-29</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/database/" itemprop="url" rel="index"><span itemprop="name">database</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/cloudnative/" itemprop="url" rel="index"><span itemprop="name">cloudnative</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="Redis简介"><a href="#Redis简介" class="headerlink" title="Redis简介"></a>Redis简介</h1><blockquote><p>Redis: The open source, in-memory data store used by millions of developers as a database, cache, streaming engine, and message broker.</p></blockquote><p>Redis是被数百万开发人员用作数据库、缓存、流引擎和消息代理的开源内存数据存储。</p><p>Redis特点：</p><ul><li>Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。</li><li>Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。</li><li>Redis支持数据的备份，即master-slave模式的数据备份。</li></ul><p>Redis优势：</p><ul><li>性能极高 – Redis能读的速度是110000次/s，写的速度是81000次/s 。</li><li>丰富的数据类型 – Redis支持二进制案例的 Strings， Lists， Hashes， Sets 及 Ordered Sets 数据类型操作。</li><li>原子 – Redis的所有操作都是原子性的，意思就是要么成功执行要么失败完全不执行。单个操作是原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。</li><li>丰富的特性 – Redis还支持 publish/subscribe， 通知， key 过期等等特性。</li></ul><p>参考文档：</p><ul><li><a href="https://redis.io/" target="_blank" rel="noopener">Redis官网</a></li><li><a href="https://github.com/redis/redis" target="_blank" rel="noopener">Redis源码</a></li><li><a href="http://try.redis.io/" target="_blank" rel="noopener">Redis在线测试</a></li><li><a href="http://doc.redisfans.com/" target="_blank" rel="noopener">Redis命令参考</a></li><li><a href="https://www.runoob.com/redis/redis-tutorial.html" target="_blank" rel="noopener">Redis教程</a></li></ul><a id="more"></a><h1 id="安装Redis"><a href="#安装Redis" class="headerlink" title="安装Redis"></a>安装Redis</h1><p>本节中，我们使用docker安装一个redis节点。</p><p>1、下载<a href="https://hub.docker.com/_/redis" target="_blank" rel="noopener">redis镜像</a>，这里选择版本 redis:5.0.14-alpine3.15</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis:5.0.14-alpine3.15</span><br></pre></td></tr></table></figure><p>2、启动redis</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run --name redis -d \</span><br><span class="line">-p 6379:6379 \</span><br><span class="line">redis:5.0.14-alpine3.15</span><br></pre></td></tr></table></figure><p>参考文档：</p><ul><li><a href="https://redis.io/docs/getting-started/installation/" target="_blank" rel="noopener">Installing Redis</a></li><li><a href="https://www.voidking.com/dev-k8s-redis/">《K8S中安装Redis》</a></li></ul><h1 id="自定义redis配置"><a href="#自定义redis配置" class="headerlink" title="自定义redis配置"></a>自定义redis配置</h1><p>1、准备redis5.0的配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/redis/</span><br><span class="line">vim /opt/redis/redis.conf</span><br></pre></td></tr></table></figure><p>配置内容参考<a href="https://github.com/redis/redis/blob/5.0/redis.conf" target="_blank" rel="noopener">github redis.conf</a>，按需修改</p><p>2、使用配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run --name redis -d \</span><br><span class="line">-p 6379:6379 \</span><br><span class="line">-v /opt/redis/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">redis:5.0.14-alpine3.15 \</span><br><span class="line">redis-server /etc/redis/redis.conf</span><br></pre></td></tr></table></figure><h1 id="测试Redis"><a href="#测试Redis" class="headerlink" title="测试Redis"></a>测试Redis</h1><h2 id="容器内测试"><a href="#容器内测试" class="headerlink" title="容器内测试"></a>容器内测试</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it redis /bin/sh</span><br><span class="line">redis-cli</span><br><span class="line">&gt; ping</span><br></pre></td></tr></table></figure><h2 id="宿主机测试"><a href="#宿主机测试" class="headerlink" title="宿主机测试"></a>宿主机测试</h2><p>1、启动测试容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run --name redis-client -d \</span><br><span class="line">redis:5.0.14-alpine3.15</span><br></pre></td></tr></table></figure><p>2、测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it redis-client redis-cli -h 192.168.56.102 -p 6379</span><br><span class="line">&gt; ping</span><br></pre></td></tr></table></figure><h1 id="重启Redis"><a href="#重启Redis" class="headerlink" title="重启Redis"></a>重启Redis</h1><h2 id="docker-redis"><a href="#docker-redis" class="headerlink" title="docker redis"></a>docker redis</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart redis</span><br></pre></td></tr></table></figure><h2 id="bin-redis"><a href="#bin-redis" class="headerlink" title="bin redis"></a>bin redis</h2><p>方法一：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/bin/redis-server stop</span><br><span class="line">/usr/<span class="built_in">local</span>/bin/redis-server start /opt/redis/redis.conf</span><br><span class="line"><span class="comment"># /usr/local/bin/redis-server restart</span></span><br></pre></td></tr></table></figure><p>方法二：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 127.0.0.1 -p 6379 shutdown</span><br><span class="line">redis-server</span><br></pre></td></tr></table></figure><p>方法三：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep redis</span><br><span class="line"><span class="built_in">kill</span> -9 xxx</span><br><span class="line">redis-server</span><br></pre></td></tr></table></figure><h1 id="Redis常用命令"><a href="#Redis常用命令" class="headerlink" title="Redis常用命令"></a>Redis常用命令</h1><p>参考文档：<a href="http://doc.redisfans.com/" target="_blank" rel="noopener">Redis命令参考</a></p><p>特别注意：redis命令不区分大小写。</p><h2 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h2><p>使用客户端向 Redis 服务器发送一个 PING ，如果服务器运作正常的话，会返回一个 PONG 。<br>通常用于测试与服务器的连接是否仍然生效，或者用于测量延迟值。</p><h2 id="echo"><a href="#echo" class="headerlink" title="echo"></a>echo</h2><p>打印一个特定的信息 message ，测试时使用。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"test"</span></span><br></pre></td></tr></table></figure><h2 id="select"><a href="#select" class="headerlink" title="select"></a>select</h2><p>切换到指定的数据库，数据库索引号 index 用数字值指定，以 0 作为起始索引值。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SET db_number 0</span><br><span class="line">SELECT 1 </span><br><span class="line">GET db_number</span><br><span class="line">SET db_number 1</span><br><span class="line">GET db_number</span><br></pre></td></tr></table></figure><h2 id="quit"><a href="#quit" class="headerlink" title="quit"></a>quit</h2><p>请求服务器关闭与当前客户端的连接。<br>一旦所有等待中的回复(如果有的话)顺利写入到客户端，连接就会被关闭。</p><h2 id="auth"><a href="#auth" class="headerlink" title="auth"></a>auth</h2><p>通过设置配置文件中 requirepass 项的值(使用命令 CONFIG SET requirepass password )，可以使用密码来保护 Redis 服务器。</p><p>如果开启了密码保护的话，在每次连接 Redis 服务器之后，就要使用 AUTH 命令解锁，解锁之后才能使用其他 Redis 命令。</p><p>如果 AUTH 命令给定的密码 password 和配置文件中的密码相符的话，服务器会返回 OK 并开始接受命令输入。</p><p>另一方面，假如密码不匹配的话，服务器将返回一个错误，并要求客户端需重新输入密码。</p><p>1、设置密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">config <span class="built_in">set</span> requirepass secret_password   <span class="comment"># 将密码设置为 secret_password</span></span><br><span class="line">quit</span><br></pre></td></tr></table></figure><p>2、使用密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ping</span><br><span class="line">auth secret_password                     <span class="comment"># 输入正确的密码</span></span><br><span class="line">ping</span><br></pre></td></tr></table></figure><p>设置了密码保护之后，如果想要直接通过redis-cli直接执行redis命令，可以加上-a参数。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it redis-client redis-cli -h 192.168.56.102 -p 6379 -a <span class="string">'secret_password'</span> ping</span><br></pre></td></tr></table></figure><h2 id="设置key"><a href="#设置key" class="headerlink" title="设置key"></a>设置key</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select 3</span><br><span class="line"><span class="built_in">set</span> key_name key_value</span><br></pre></td></tr></table></figure><h2 id="查询key"><a href="#查询key" class="headerlink" title="查询key"></a>查询key</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select 3</span><br><span class="line">get key_name</span><br><span class="line">keys *</span><br></pre></td></tr></table></figure><h2 id="info"><a href="#info" class="headerlink" title="info"></a>info</h2><p>以一种易于解释（parse）且易于阅读的格式，返回关于 Redis 服务器的各种信息和统计数值。<br>通过给定可选的参数 section ，可以让命令只返回某一部分的信息：</p><ul><li>server: 一般 Redis 服务器信息</li><li>clients: 已连接客户端信息</li><li>memory: 内存信息</li><li>persistence : RDB 和 AOF 的相关信息</li><li>persistence : RDB 和 AOF 的相关信息</li><li>stats : 一般统计信息</li><li>replication : 主/从复制信息</li><li>cpu : CPU 计算量统计信息</li><li>commandstats : Redis 命令统计信息</li><li>cluster : Redis 集群信息</li><li>keyspace : 数据库相关的统计信息</li><li>all : 返回所有信息</li><li>default : 返回默认选择的信息</li></ul><p>当不带参数直接调用 INFO 命令时，使用 default 作为默认参数。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">info memory</span><br><span class="line">info stats</span><br></pre></td></tr></table></figure><h1 id="内存碎片率"><a href="#内存碎片率" class="headerlink" title="内存碎片率"></a>内存碎片率</h1><p>使用<code>info memory</code>可以查看内存碎片率，内存碎片率计算方法为：<br><code>mem_fragmentation_ratio = used_memory_rss / used_memory</code></p><p>内存碎片率大小说明：</p><ul><li>mem_fragmentation_ratio &lt; 1 表示Redis内存分配超出了物理内存，操作系统正在进行内存交换，内存交换会引起非常明显的响应延迟；</li><li>mem_fragmentation_ratio &gt; 1 是合理的；</li><li>mem_fragmentation_ratio &gt; 1.5 说明Redis消耗了实际需要物理内存的150%以上，其中50%是内存碎片率，可能是操作系统或Redis实例中内存管理变差的表现</li></ul><p>手动清理内存碎片方法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">memory purge</span><br></pre></td></tr></table></figure><p>但是，对于redis5.0.14，这个内存碎片率的说明并不适用，经测试查看到的内存碎片率为13-15，远大于1。<br>参考文档<a href="https://github.com/redis/redis/issues/9256" target="_blank" rel="noopener">Redis 5.0.11 high memory fragmentation ratio</a>可知：</p><blockquote><p>you are looking at mem_fragmentation_ratio which is not actually fragmentation. It’s the ratio of used memory to RSS (resident physical memory), We don’t rename if for the sake of backwards compatibility.<br>RSS includes shared libraries, code, stack and other things, so while this metric is useful, it’s not actually fragmentation (which has risk of rising to high values).<br>If you wanna look at fragmentation, you should look at allocator_frag_ratio instead.<br>But another point is that your db is nearly empty, so although the ratio seems high, it’s not actually a lot of memory.<br>allocator_frag_bytes shows just about 400kb.<br>You only wanna be concerned if that number is high, and in that case you can enable activedefrag</p></blockquote><p>因此，对于redis5.0.14，内存碎片率应该查看 <code>allocator_frag_ratio</code> 而不是 <code>mem_fragmentation_ratio</code>。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-redis-start/" title="Redis入门篇">https://www.voidking.com/dev-redis-start/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/docker/" rel="tag"># docker</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"># 数据库</a> <a href="/tags/redis/" rel="tag"># redis</a> <a href="/tags/%E7%BC%93%E5%AD%98/" rel="tag"># 缓存</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-docker-compose/" rel="prev" title="Docker-Compose入门篇"><i class="fa fa-chevron-left"></i> Docker-Compose入门篇</a></div><div class="post-nav-item"> <a href="/dev-ldap-start/" rel="next" title="ldap入门篇">ldap入门篇<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis简介"><span class="nav-number">1.</span> <span class="nav-text">Redis简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装Redis"><span class="nav-number">2.</span> <span class="nav-text">安装Redis</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#自定义redis配置"><span class="nav-number">3.</span> <span class="nav-text">自定义redis配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#测试Redis"><span class="nav-number">4.</span> <span class="nav-text">测试Redis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#容器内测试"><span class="nav-number">4.1.</span> <span class="nav-text">容器内测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#宿主机测试"><span class="nav-number">4.2.</span> <span class="nav-text">宿主机测试</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#重启Redis"><span class="nav-number">5.</span> <span class="nav-text">重启Redis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#docker-redis"><span class="nav-number">5.1.</span> <span class="nav-text">docker redis</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#bin-redis"><span class="nav-number">5.2.</span> <span class="nav-text">bin redis</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis常用命令"><span class="nav-number">6.</span> <span class="nav-text">Redis常用命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ping"><span class="nav-number">6.1.</span> <span class="nav-text">ping</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#echo"><span class="nav-number">6.2.</span> <span class="nav-text">echo</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#select"><span class="nav-number">6.3.</span> <span class="nav-text">select</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#quit"><span class="nav-number">6.4.</span> <span class="nav-text">quit</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#auth"><span class="nav-number">6.5.</span> <span class="nav-text">auth</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设置key"><span class="nav-number">6.6.</span> <span class="nav-text">设置key</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查询key"><span class="nav-number">6.7.</span> <span class="nav-text">查询key</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#info"><span class="nav-number">6.8.</span> <span class="nav-text">info</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#内存碎片率"><span class="nav-number">7.</span> <span class="nav-text">内存碎片率</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">659</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">211</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>