<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//qiniu-cdn.voidking.com/doc/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="sealos简介2018年8月，方海涛大佬提交了sealos的一个commit，最初的目标是把kubernetes安装做进一条命令。如今，sealos 是以 kubernetes 为内核的云操作系统发行版。单机操作系统如同 linux 发行版本可以在上面安装和使用各种单机应用，如 PPT，Word，Excel 等。 云操作系统只需要把这些单机应用替换成各种云应用，如数据库，对象存储，消息队列等，就"><meta property="og:type" content="article"><meta property="og:title" content="好好学Sealos：Sealos入门篇"><meta property="og:url" content="https://www.voidking.com/dev-sealos-start/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="sealos简介2018年8月，方海涛大佬提交了sealos的一个commit，最初的目标是把kubernetes安装做进一条命令。如今，sealos 是以 kubernetes 为内核的云操作系统发行版。单机操作系统如同 linux 发行版本可以在上面安装和使用各种单机应用，如 PPT，Word，Excel 等。 云操作系统只需要把这些单机应用替换成各种云应用，如数据库，对象存储，消息队列等，就"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2023-01-04T10:00:00.000Z"><meta property="article:modified_time" content="2024-05-04T08:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="网络"><meta property="article:tag" content="k8s"><meta property="article:tag" content="问题排查"><meta property="article:tag" content="ipvs"><meta property="article:tag" content="sealos"><meta property="article:tag" content="sealer"><meta property="article:tag" content="好好学Sealos"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-sealos-start/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>好好学Sealos：Sealos入门篇 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">一个计算机技术爱好者与学习者</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-sealos-start/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="一个计算机技术爱好者与学习者"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> 好好学Sealos：Sealos入门篇</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-01-04 10:00:00" itemprop="dateCreated datePublished" datetime="2023-01-04T10:00:00+00:00">2023-01-04</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-05-04 08:00:00" itemprop="dateModified" datetime="2024-05-04T08:00:00+00:00">2024-05-04</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/network/" itemprop="url" rel="index"><span itemprop="name">network</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/cloudnative/" itemprop="url" rel="index"><span itemprop="name">cloudnative</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/troubleshooting/" itemprop="url" rel="index"><span itemprop="name">troubleshooting</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="sealos简介"><span class="post-title-index">1.</span><a href="#sealos简介" class="headerlink" title="sealos简介"></a> sealos简介</h1><p>2018年8月，方海涛大佬提交了sealos的一个commit，最初的目标是把kubernetes安装做进一条命令。<br>如今，sealos 是以 kubernetes 为内核的云操作系统发行版。单机操作系统如同 linux 发行版本可以在上面安装和使用各种单机应用，如 PPT，Word，Excel 等。 云操作系统只需要把这些单机应用替换成各种云应用，如数据库，对象存储，消息队列等，就很容易理解了，这些应用都是分布式高可用的。 sealos 就是能支撑运行各种分布式应用的云操作系统。有了 sealos 就拥有了一朵云。</p><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://github.com/labring/sealos">labring/sealos</a></li><li><a target="_blank" rel="noopener" href="https://www.sealyun.com/docs/lifecycle-management/">Sealos - 集群生命周期管理</a></li><li><a target="_blank" rel="noopener" href="https://sealos.io/docs/lifecycle-management/reference/sealos/commands/">Sealos 命令说明</a></li><li><a target="_blank" rel="noopener" href="https://icloudnative.io/posts/sealos/">kubernetes 高可用部署工具：sealos</a></li><li><a target="_blank" rel="noopener" href="http://javajun.net/posts/112225/index.html">使用Sealos一键安装K8S</a></li><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/551106063">使用 sealos 一键开启 Kubernetes 应用的可观测性</a></li><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/555378842">sealos 作者创业心路历程</a></li><li><a target="_blank" rel="noopener" href="https://nsddd.top/zh/posts/read-openim-project-sealos-openim-source-code">速读开源项目 Sealos 的源码</a></li></ul><span id="more"></span><h1 id="sealos原理简介"><span class="post-title-index">2.</span><a href="#sealos原理简介" class="headerlink" title="sealos原理简介"></a> sealos原理简介</h1><h2 id="高可用"><span class="post-title-index">2.1.</span><a href="#高可用" class="headerlink" title="高可用"></a> 高可用</h2><p>通过内核 ipvs 对 apiserver 进行负载均衡，并且带 apiserver 健康检测。</p><h2 id="定制kubeadm"><span class="post-title-index">2.2.</span><a href="#定制kubeadm" class="headerlink" title="定制kubeadm"></a> 定制kubeadm</h2><p>首先是由于 kubeadm 把证书过期时间写死了，所以需要定制把它改成 99 年，虽然大部分人可以自己去签个新证书，但是我们还是不想再依赖个别的工具，就直接改源码了。</p><p>其次就是做本地负载时修改 kubeadm 代码是最方便的，因为在 join 时我们需要做两个事，第一是 join 之前先创建好 ipvs 规则，第二是创建 static pod。如果这块不去定制 kubeadm 就把报静态 pod 目录已存在的错误，忽略这个错误很不优雅。 而且 kubeadm 中已经提供了一些很好用的 sdk 供我们去实现这个功能。</p><p>且这样做之后最核心的功能都集成到 kubeadm 中了，sealos 就单单变成分发和执行上层命令的轻量级工具了，增加节点时我们也就可以直接用 kubeadm 了。</p><h2 id="k8s安装流程"><span class="post-title-index">2.3.</span><a href="#k8s安装流程" class="headerlink" title="k8s安装流程"></a> k8s安装流程</h2><p>1、通过 sftp或者 wget 把离线安装包拷贝到目标机器上（masters 和 nodes）。<br>2、在 master0 上执行 kubeadm init。<br>3、在其它 master 上执行 kubeadm join 并设置控制面，这个过程会在其它 master 上起动 etcd 并与 master0 的 etcd 组成集群，并启动控制平面的组件（apiserver、controller 等）。<br>4、join node 节点，会在 node 上配置 ipvs 规则，配置 /etc/hosts 等。</p><h1 id="安装使用sealos"><span class="post-title-index">3.</span><a href="#安装使用sealos" class="headerlink" title="安装使用sealos"></a> 安装使用sealos</h1><h2 id="安装sealos"><span class="post-title-index">3.1.</span><a href="#安装sealos" class="headerlink" title="安装sealos"></a> 安装sealos</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/labring/sealos/releases/download/v4.2.3/sealos_4.2.3_linux_amd64.tar.gz</span><br><span class="line">tar -zxvf sealos_4.2.3_linux_amd64.tar.gz sealos &amp;&amp;  <span class="built_in">chmod</span> +x sealos &amp;&amp; <span class="built_in">mv</span> sealos /usr/bin </span><br></pre></td></tr></table></figure><h2 id="安装k8s集群"><span class="post-title-index">3.2.</span><a href="#安装k8s集群" class="headerlink" title="安装k8s集群"></a> 安装k8s集群</h2><p>参考文档：<a target="_blank" rel="noopener" href="https://www.sealyun.com/docs/lifecycle-management/reference/sealos/commands/run">Run: Execute Cluster Images</a></p><p>1、安装k8s集群</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /data/k8s/docker</span><br><span class="line">sealos run labring/kubernetes-docker:v1.24.8 labring/helm:v3.8.2 labring/calico:v3.24.1 \</span><br><span class="line">    --<span class="built_in">env</span> criData=/data/k8s/docker \</span><br><span class="line">    --masters 192.168.56.100 \</span><br><span class="line">    --nodes 192.168.56.101 -p voidking</span><br></pre></td></tr></table></figure><p>注意：<br>（1）不要安装<code>labring/kubernetes:v1.24.8</code>，这种版本默认使用的CRI是containerd，而不是docker。<br>否则，安装软件时pod调度完成后可能会报错：<br>Error: failed to create containerd container: error unpacking image: failed to extract layer sha256:xxx: failed to get reader from content store: content digest sha256:xxx: not found</p><p>（2）calico和kubernetes版本要对应，否则calico可能无法正常启动。<br>对应关系参考文档<a target="_blank" rel="noopener" href="https://projectcalico.docs.tigera.io/getting-started/kubernetes/requirements">Kubernetes requirements</a>和<a target="_blank" rel="noopener" href="https://projectcalico.docs.tigera.io/archive/v3.23/getting-started/kubernetes/requirements">Calico3.23 - Kubernetes requirements</a>等。</p><p>更多k8s版本，请访问<a target="_blank" rel="noopener" href="https://hub.sealos.cn/detail?imageName=labring/kubernetes-docker:v1.20.14">hub.sealos.cn</a>获取。</p><p>2、查看安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line">kubectl get nodes</span><br><span class="line">kubectl get all -n kube-system</span><br><span class="line">kubectl get all -n calico-system</span><br></pre></td></tr></table></figure><p>安装速度太快了，真的是一键安装！！！不用做各种初始化，这一点吊打kubeadm（sealos底层也是使用的kubeadm）。<br>另外，sealos安装的k8s集群，证书是100年，不用考虑证书续期问题，也是省了很多事情。</p><p>3、去掉master节点污点（可选）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl taint nodes 192.168.56.100 node-role.kubernetes.io/master:NoSchedule-</span><br><span class="line">kubectl taint nodes 192.168.56.100 node-role.kubernetes.io/control-plane:NoSchedule-</span><br></pre></td></tr></table></figure><h2 id="安装失败处理办法"><span class="post-title-index">3.3.</span><a href="#安装失败处理办法" class="headerlink" title="安装失败处理办法"></a> 安装失败处理办法</h2><p>如果安装失败，再次安装时可能会报错：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error Applied to cluster error: failed to init runtime, cluster image kubernetes version cannot be empty</span><br></pre></td></tr></table></figure><p>这时需要先重置一下sealos，然后重新安装。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sealos reset</span><br><span class="line"><span class="built_in">rm</span> /root/.sealos -rf</span><br></pre></td></tr></table></figure><h2 id="添加节点"><span class="post-title-index">3.4.</span><a href="#添加节点" class="headerlink" title="添加节点"></a> 添加节点</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sealos add --nodes 192.168.56.200</span><br><span class="line">sealos add --masters 192.168.56.101 --nodes 192.168.56.200</span><br><span class="line">sealos add --masters 192.168.56.101-192.168.56.102 --nodes 192.168.56.200-192.168.56.203</span><br></pre></td></tr></table></figure><h2 id="删除节点"><span class="post-title-index">3.5.</span><a href="#删除节点" class="headerlink" title="删除节点"></a> 删除节点</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sealos delete --nodes 192.168.56.202,192.168.56.203 </span><br><span class="line">sealos delete --masters 192.168.56.101,192.168.56.102</span><br></pre></td></tr></table></figure><h2 id="自定义安装k8s集群"><span class="post-title-index">3.6.</span><a href="#自定义安装k8s集群" class="headerlink" title="自定义安装k8s集群"></a> 自定义安装k8s集群</h2><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://www.sealyun.com/docs/lifecycle-management/operations/run-cluster/gen-apply-cluster">Sealos - 自定义配置安装</a></li><li><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-config/">kubeadm config</a></li></ul><p>1、生成集群配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /data/k8s/docker</span><br><span class="line">sealos gen labring/kubernetes-docker:v1.24.8 labring/helm:v3.8.2 labring/calico:v3.24.1 \</span><br><span class="line">    --<span class="built_in">env</span> criData=/data/k8s/docker \</span><br><span class="line">    --masters 192.168.56.100 \</span><br><span class="line">    --nodes 192.168.56.101 -p voidking &gt; Clusterfile</span><br></pre></td></tr></table></figure><p>2、修改POD和SVC的CIDR<br>搜索<code>kubeadm.k8s.io</code>，Networking部分修改为：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kubeadm.k8s.io/v1beta3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterConfiguration</span></span><br><span class="line"><span class="attr">Networking:</span></span><br><span class="line">  <span class="attr">PodSubnet:</span> <span class="number">172.16</span><span class="number">.0</span><span class="number">.0</span><span class="string">/16</span></span><br><span class="line">  <span class="attr">ServiceSubnet:</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.0</span><span class="string">/16</span></span><br></pre></td></tr></table></figure><p>3、安装k8s集群</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sealos apply -f Clusterfile</span><br></pre></td></tr></table></figure><p>集群运行成功后会把 Clusterfile 保存到 <code>.sealos/default/Clusterfile</code> 文件中，可以修改其中字段来重新 apply 对集群进行变更。</p><h1 id="sealos问题记录"><span class="post-title-index">4.</span><a href="#sealos问题记录" class="headerlink" title="sealos问题记录"></a> sealos问题记录</h1><h2 id="docker版本coredns启动失败"><span class="post-title-index">4.1.</span><a href="#docker版本coredns启动失败" class="headerlink" title="docker版本coredns启动失败"></a> docker版本coredns启动失败</h2><p>系统环境：sealos4.1.3，系统CentOS7，内核Linux 3.10.0-957.el7.x86_64</p><p><code>labring/kubernetes:v1.22.3</code>版本，可以正常安装运行。</p><p><code>labring/kubernetes-docker:v1.22.3</code>版本，coredns pod无法启动，一直处于Blocked状态。切换ubuntu18系统，也存在同样的问题。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Status:         Pending</span><br><span class="line">Reason:         NoNewPrivs</span><br><span class="line">Message:        Cannot enforce NoNewPrivs: illegal version string &quot;v1alpha2&quot;</span><br><span class="line">Containers:</span><br><span class="line">  coredns:</span><br><span class="line">    Container ID:</span><br><span class="line">    Image:         k8s.gcr.io/coredns:1.7.0</span><br><span class="line">    Image ID:</span><br><span class="line">    Ports:         53/UDP, 53/TCP, 9153/TCP</span><br><span class="line">    Host Ports:    0/UDP, 0/TCP, 0/TCP</span><br><span class="line">    Args:</span><br><span class="line">      -conf</span><br><span class="line">      /etc/coredns/Corefile</span><br><span class="line">    State:          Waiting</span><br><span class="line">      Reason:       Blocked</span><br><span class="line">    Ready:          False</span><br></pre></td></tr></table></figure><p>no_new_privs相关概念参考文档<a target="_blank" rel="noopener" href="https://icloudnative.io/posts/linux-capabilities-in-practice-1/">Linux Capabilities 入门教程：基础实战篇</a></p><p>经过多次尝试，发现<code>labring/kubernetes-docker:v1.24.8</code>版本可以安装成功，再低的版本都会有这个问题。</p><p>请教方海涛大佬得知，sealos4.1.4 之后修复了这个问题，实际验证确实可以。</p><p>一个验证可行的K8S和Calico匹配版本为：<code>labring/kubernetes-docker:v1.20.14</code> 和 <code>labring/calico:v3.22.1</code></p><h2 id="一键安装软件"><span class="post-title-index">4.2.</span><a href="#一键安装软件" class="headerlink" title="一键安装软件"></a> 一键安装软件</h2><p>参考文档<a target="_blank" rel="noopener" href="https://docs.sealos.io/zh-Hans/docs/getting-started/kuberentes-life-cycle">sealos - Kubernetes 生命周期管理</a></p><p>一键安装软件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sealos run labring/minio-operator:v4.4.16 labring/ingress-nginx:4.1.0 \</span><br><span class="line">    labring/mysql-operator:8.0.23-14.1 labring/redis-operator:3.1.4</span><br></pre></td></tr></table></figure><p>安装时卡住了，报错：<br>Error: INSTALLATION FAILED: failed pre-install: timed out waiting for the condition<br>2023-01-06T16:22:50 error Applied to cluster error: exit status 1</p><p>再次安装，没有报错，但是软件并没有安装成功。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe  pod/ingress-nginx-admission-create-xsnmg -n ingress-nginx</span><br></pre></td></tr></table></figure><p>Pod处于Blocked状态。<br>这个问题，和上面的coredns问题本质是相同的问题，只不过表现形式不同。</p><h2 id="自定义软件配置？"><span class="post-title-index">4.3.</span><a href="#自定义软件配置？" class="headerlink" title="自定义软件配置？"></a> 自定义软件配置？</h2><p>一键安装软件很方便，但是，怎样对这些软件进行自定义配置？<br>答：逐个软件安装，使用<code>--cmd</code>自定义安装命令和配置。</p><h2 id="卸载软件？"><span class="post-title-index">4.4.</span><a href="#卸载软件？" class="headerlink" title="卸载软件？"></a> 卸载软件？</h2><p>怎样卸载软件？<br>答：sealos不考虑软件卸载，如果有需要卸载，直接执行<code>helm uninstall</code>即可。</p><h2 id="怎样指定Calico使用的网卡？"><span class="post-title-index">4.5.</span><a href="#怎样指定Calico使用的网卡？" class="headerlink" title="怎样指定Calico使用的网卡？"></a> 怎样指定Calico使用的网卡？</h2><p>在使用Calico作为Kubernetes集群的CNI（容器网络接口）时，节点上可能具有多个网络接口和IP地址。Calico需要为每个节点选择一个IP地址以便于在集群内的节点之间建立隧道（如使用IPIP或VXLAN隧道技术）以及通信。<br>如果没有做任何配置，Calico将自动选择节点的默认路由出口的IP地址。这是最常用的网口IP地址。但是，这可能会导致calico建立tun时使用的是不同的网段，最终导致节点间通信产生问题。</p><p>因此，为保证稳定性，最好是能够指定Calico使用的网卡。<br>在使用sealos已经安装好的K8s集群中，Calico本质上是通过helm的方式安装的，chart路径为：<code>/var/lib/sealos/data/default/rootfs/charts/calico</code><br>指定Calico使用的网卡，方法为修改Calico配置，然后更新Calico：<br>1、修改Calico配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/lib/sealos/data/default/rootfs/charts/calico</span><br><span class="line">vim values.yaml</span><br></pre></td></tr></table></figure><p>修改 installation.calicoNetwork 部分的配置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">installation:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">kubernetesProvider:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">calicoNetwork:</span></span><br><span class="line">    <span class="attr">nodeAddressAutodetectionV4:</span></span><br><span class="line">      <span class="comment">#interface: eth.*|en.*</span></span><br><span class="line">      <span class="attr">interface:</span> <span class="string">ens5f2|ens9f2</span></span><br></pre></td></tr></table></figure><p>2、更新Calico</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm upgrade calico . -n tigera-operator</span><br></pre></td></tr></table></figure><p>3、确认效果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route -n</span><br></pre></td></tr></table></figure><p>检查 tunl0 的网关IP是否符合预期。</p><h1 id="sealos和sealer是什么关系？"><span class="post-title-index">5.</span><a href="#sealos和sealer是什么关系？" class="headerlink" title="sealos和sealer是什么关系？"></a> sealos和sealer是什么关系？</h1><p>参考文档：<a href="https://www.voidking.com/dev-sealer-start/">《sealer入门篇》</a></p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>原文链接：</strong> <a href="https://www.voidking.com/dev-sealos-start/" title="好好学Sealos：Sealos入门篇">https://www.voidking.com/dev-sealos-start/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本文采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议，转载请注明出处！源站会即时更新知识点并修正错误，欢迎访问~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag"># 网络</a> <a href="/tags/k8s/" rel="tag"># k8s</a> <a href="/tags/%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/" rel="tag"># 问题排查</a> <a href="/tags/ipvs/" rel="tag"># ipvs</a> <a href="/tags/sealos/" rel="tag"># sealos</a> <a href="/tags/sealer/" rel="tag"># sealer</a> <a href="/tags/%E5%A5%BD%E5%A5%BD%E5%AD%A6Sealos/" rel="tag"># 好好学Sealos</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-shell-htpasswd/" rel="prev" title="shell命令之htpasswd"><i class="fa fa-chevron-left"></i> shell命令之htpasswd</a></div><div class="post-nav-item"> <a href="/dev-sealos-hub/" rel="next" title="好好学Sealos：Sealos Hub私有容器镜像仓库">好好学Sealos：Sealos Hub私有容器镜像仓库<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#sealos%E7%AE%80%E4%BB%8B"><span class="nav-text">1. sealos简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sealos%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B"><span class="nav-text">2. sealos原理简介</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="nav-text">2.1. 高可用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E5%88%B6kubeadm"><span class="nav-text">2.2. 定制kubeadm</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#k8s%E5%AE%89%E8%A3%85%E6%B5%81%E7%A8%8B"><span class="nav-text">2.3. k8s安装流程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8sealos"><span class="nav-text">3. 安装使用sealos</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85sealos"><span class="nav-text">3.1. 安装sealos</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4"><span class="nav-text">3.2. 安装k8s集群</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E5%A4%B1%E8%B4%A5%E5%A4%84%E7%90%86%E5%8A%9E%E6%B3%95"><span class="nav-text">3.3. 安装失败处理办法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E8%8A%82%E7%82%B9"><span class="nav-text">3.4. 添加节点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E8%8A%82%E7%82%B9"><span class="nav-text">3.5. 删除节点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4"><span class="nav-text">3.6. 自定义安装k8s集群</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sealos%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95"><span class="nav-text">4. sealos问题记录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#docker%E7%89%88%E6%9C%ACcoredns%E5%90%AF%E5%8A%A8%E5%A4%B1%E8%B4%A5"><span class="nav-text">4.1. docker版本coredns启动失败</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6"><span class="nav-text">4.2. 一键安装软件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BD%AF%E4%BB%B6%E9%85%8D%E7%BD%AE%EF%BC%9F"><span class="nav-text">4.3. 自定义软件配置？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%B8%E8%BD%BD%E8%BD%AF%E4%BB%B6%EF%BC%9F"><span class="nav-text">4.4. 卸载软件？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%8E%E6%A0%B7%E6%8C%87%E5%AE%9ACalico%E4%BD%BF%E7%94%A8%E7%9A%84%E7%BD%91%E5%8D%A1%EF%BC%9F"><span class="nav-text">4.5. 怎样指定Calico使用的网卡？</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sealos%E5%92%8Csealer%E6%98%AF%E4%BB%80%E4%B9%88%E5%85%B3%E7%B3%BB%EF%BC%9F"><span class="nav-text">5. sealos和sealer是什么关系？</span></a></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">一个计算机技术爱好者与学习者</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">780</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">34</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">272</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2026</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://cdn.staticfile.net/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://cdn.staticfile.net/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: 'c1a2ce731e685b1220a47bef25f339da',
      title: '好好学Sealos：Sealos入门篇',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>