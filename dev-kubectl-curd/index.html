<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="K8S资源对象是啥？在 Kubernetes 系统中，Kubernetes 对象 是持久化的实体。 Kubernetes 使用这些实体去表示整个集群的状态，具体包括pod、replicaset、deployment、service、configmap、secret等等。 参考文档：  理解 Kubernetes 对象 Kubernetes 对象管理"><meta property="og:type" content="article"><meta property="og:title" content="kubectl命令——资源对象增删查改篇"><meta property="og:url" content="https://www.voidking.com/dev-kubectl-curd/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="K8S资源对象是啥？在 Kubernetes 系统中，Kubernetes 对象 是持久化的实体。 Kubernetes 使用这些实体去表示整个集群的状态，具体包括pod、replicaset、deployment、service、configmap、secret等等。 参考文档：  理解 Kubernetes 对象 Kubernetes 对象管理"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2019-09-15T13:00:00.000Z"><meta property="article:modified_time" content="2023-03-25T08:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="k8s"><meta property="article:tag" content="kubectl"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-kubectl-curd/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>kubectl命令——资源对象增删查改篇 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-kubectl-curd/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> kubectl命令——资源对象增删查改篇</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-09-15 13:00:00" itemprop="dateCreated datePublished" datetime="2019-09-15T13:00:00+00:00">2019-09-15</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2023-03-25 08:00:00" itemprop="dateModified" datetime="2023-03-25T08:00:00+00:00">2023-03-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/cloudnative/" itemprop="url" rel="index"><span itemprop="name">cloudnative</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="K8S资源对象是啥？"><a href="#K8S资源对象是啥？" class="headerlink" title="K8S资源对象是啥？"></a>K8S资源对象是啥？</h1><p>在 Kubernetes 系统中，Kubernetes 对象 是持久化的实体。 Kubernetes 使用这些实体去表示整个集群的状态，具体包括pod、replicaset、deployment、service、configmap、secret等等。</p><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/kubernetes-objects/">理解 Kubernetes 对象</a></li><li><a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/object-management/">Kubernetes 对象管理</a></li></ul><span id="more"></span><h1 id="资源对象管理方式"><a href="#资源对象管理方式" class="headerlink" title="资源对象管理方式"></a>资源对象管理方式</h1><p>资源对象的管理有三种方式：指令式命令、指令式对象配置和声明式对象配置。<br>其中，指令式对象配置和声明式对象配置都要依赖资源对象的yaml/json定义文件。</p><h2 id="指令式命令"><a href="#指令式命令" class="headerlink" title="指令式命令"></a>指令式命令</h2><p>使用指令式命令时，用户可以在集群中的活动对象上进行操作。用户将操作传给 kubectl 命令作为参数或标志。<br>这是开始或者在集群中运行一次性任务的推荐方法。因为这种方式直接在活跃对象上操作，所以它不提供以前配置的历史记录。<br>例如，创建一个nginx deployment：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create deployment nginx --image nginx</span><br></pre></td></tr></table></figure><h2 id="指令式对象配置"><a href="#指令式对象配置" class="headerlink" title="指令式对象配置"></a>指令式对象配置</h2><p>在指令式对象配置中，kubectl 命令指定操作（创建、更新和删除），可选标志和至少一个文件名。指定的文件必须包含 YAML 或 JSON 格式的对象的完整定义。<br>例如，创建配置文件中定义的对象（前提是写好了nginx.yaml）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f nginx.yaml</span><br></pre></td></tr></table></figure><p>通过覆盖更新配置文件中定义的对象：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl replace -f nginx.yaml</span><br></pre></td></tr></table></figure><p>删除两个配置文件中定义的对象：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f nginx.yaml -f redis.yaml</span><br></pre></td></tr></table></figure><h2 id="声明式对象配置"><a href="#声明式对象配置" class="headerlink" title="声明式对象配置"></a>声明式对象配置</h2><p>使用声明式对象配置时，用户对本地存储的对象配置文件进行操作，但是用户未定义要对该文件执行的操作。 kubectl 会自动检测每个文件的创建、更新和删除操作。这使得配置可以在目录上工作，根据目录中配置文件对不同的对象执行不同的操作。<br>例如，处理 configs 目录中的所有对象配置文件，创建并更新活跃对象。<br>可以首先使用 diff 子命令查看将要进行的更改，然后再进行应用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl diff -f configs/</span><br><span class="line">kubectl apply -f configs/</span><br></pre></td></tr></table></figure><p>与指令式对象配置相比的优点：</p><ul><li>对活动对象所做的更改即使未合并到配置文件中，也会被保留下来。</li><li>声明性对象配置更好地支持对目录进行操作并自动检测每个文件的操作类型（创建，更新，删除）。</li></ul><p>与指令式对象配置相比的缺点：</p><ul><li>声明式对象配置难于调试并且出现异常时结果难以理解。</li><li>使用 diff 产生的部分更新会创建复杂的合并和补丁操作。</li></ul><h1 id="资源对象的yaml-json文件详解"><a href="#资源对象的yaml-json文件详解" class="headerlink" title="资源对象的yaml/json文件详解"></a>资源对象的yaml/json文件详解</h1><h2 id="yaml-json文件构成"><a href="#yaml-json文件构成" class="headerlink" title="yaml/json文件构成"></a>yaml/json文件构成</h2><p>k8s资源对象的yaml文件分成四部分，apiVersion、kind、metadata和spec。</p><ul><li>apiVersion和kind是关联的，参考<code>kubectl api-resources</code>。</li><li>metadata必填name、namespace、labels。</li><li>pod.spec主要填containers的name和image；deployment.spec主要填replicas、template和selector；service.spec主要填selector、ports和type。</li></ul><h2 id="yaml-json文件编写"><a href="#yaml-json文件编写" class="headerlink" title="yaml/json文件编写"></a>yaml/json文件编写</h2><p>编写k8s资源对象的yaml/json文件，有三种方法：</p><ul><li>纯手工编写（难度最高）</li><li>使用<code>--dry-run</code>生成yaml/json文件，然后修改</li><li>从线上导出yaml/json文件，然后修改</li></ul><h2 id="生成文件模板"><a href="#生成文件模板" class="headerlink" title="生成文件模板"></a>生成文件模板</h2><p>生成deployment的yaml/json文件模板（推荐）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl create deployment vk-deploy --image=nginx --dry-run -o yaml &gt; deploy-name.yaml</span><br><span class="line">kubectl create deployment vk-deploy --image=nginx --dry-run -o json &gt; deploy-name.json</span><br></pre></td></tr></table></figure><p>更多内容，参考<a target="_blank" rel="noopener" href="http://docs.kubernetes.org.cn/535.html">Kubernetes kubectl create deployment 命令详解</a>。</p><p>注意，我们并不需要在deployment中指定容器对外暴露的ports，因为该字段只是一个提示作用。</p><blockquote><p>List of ports to expose from the container. Exposing a port here gives the system additional information about the network connections a container uses, but is primarily informational. Not specifying a port here DOES NOT prevent that port from being exposed. Any port which is listening on the default “0.0.0.0” address inside a container will be accessible from the network. Cannot be updated.</p></blockquote><p><del>生成deployment的yaml文件模板（即将废弃）：</del></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run vk-deploy --image=nginx --dry-run -o yaml</span><br></pre></td></tr></table></figure><p>会出现提示：<br>kubectl run –generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run –generator=run-pod/v1 or kubectl create instead.<br>因为官方不推荐使用 run-pod/v1 以外的其他生成器，其他生成器不久后就会弃用。更多内容参考<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/kubectl/conventions/#kubectl-run">kubectl run</a>。</p><h2 id="导出文件模板"><a href="#导出文件模板" class="headerlink" title="导出文件模板"></a>导出文件模板</h2><p><del>从K8S集群中导出已经存在的资源对象的yaml文件（即将废弃）：</del></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deploy/deployment-name -o yaml --<span class="built_in">export</span> &gt; deploy-name.yaml</span><br></pre></td></tr></table></figure><p>也会出现提示：<br>Flag –export has been deprecated, This flag is deprecated and will be removed in future.<br>很尴尬，–export 也要弃用了，且用且珍惜吧。</p><h2 id="h帮助"><a href="#h帮助" class="headerlink" title="-h帮助"></a>-h帮助</h2><p>在生成yaml文件的过程中，如果忘记了参数，可以使用<code>kubectl xxx -h</code>命令来获取帮助。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl -h</span><br><span class="line">kubectl create -h</span><br><span class="line">kubectl create deployment -h</span><br></pre></td></tr></table></figure><p><code>-h</code>除了可以查看生成yaml文件的命令帮助，还可以用来查看所有<code>kubectl</code>子命令的帮助，非常实用。</p><h2 id="explain帮助"><a href="#explain帮助" class="headerlink" title="explain帮助"></a>explain帮助</h2><p>编写yaml文件的过程中，如果忘记了某些结构和字段，可以使用<code>kubectl explain</code>命令来获取帮助。</p><p>1、查看资源包含哪些字段<br>以查看deployment的yaml包含哪些字段为例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl explain deployment</span><br><span class="line">kubectl explain deployment --api-version=apps/v1</span><br><span class="line">kubectl explain deployment --api-version=apps/v1 --recursive=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>2、查看子字段<br>以查看节点亲和性字段为例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl explain deployment.spec.template.spec.affinity</span><br><span class="line">kubectl explain deployment.spec.template.spec.affinity.nodeAffinity</span><br><span class="line">...</span><br><span class="line">kubectl explain deployment.spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms.matchExpressions</span><br></pre></td></tr></table></figure><p>必须说明的是，explain不止可以查看k8s内置资源结构，还可以查看crd资源结构，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl explain milvus --api-version=milvus.io/v1beta1</span><br><span class="line">kubectl explain milvus.spec --api-version=milvus.io/v1beta1</span><br><span class="line">kubectl explain milvus.spec.components --api-version=milvus.io/v1beta1</span><br><span class="line">kubectl explain milvus.spec.dependencies --api-version=milvus.io/v1beta1</span><br></pre></td></tr></table></figure><p>milvus安装配置方法，参考<a href="https://www.voidking.com/dev-k8s-milvus/">《K8S中安装配置Milvus》</a></p><h2 id="yaml-json文件验证"><a href="#yaml-json文件验证" class="headerlink" title="yaml/json文件验证"></a>yaml/json文件验证</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create --validate -f deploy-name.yaml --dry-run=client</span><br></pre></td></tr></table></figure><p>需要注意的是，<code>--dry-run=client</code>参数要带着，否则验证成功后，这个文件直接就提交给k8s了。</p><h1 id="pod-yaml"><a href="#pod-yaml" class="headerlink" title="pod yaml"></a>pod yaml</h1><p>生成pod的yaml文件模板比较常用，这里单独做一下记录。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl run vkpod --image=busybox --restart=Never --dry-run=client -oyaml</span><br><span class="line"></span><br><span class="line">kubectl run vk-pod --image=busybox --dry-run=client -o yaml --<span class="built_in">command</span> -- <span class="built_in">sleep</span> 1000</span><br><span class="line"></span><br><span class="line">kubectl run vk-pod --image=busybox -l <span class="string">&#x27;name=vk-pod,env=dev&#x27;</span> --dry-run=client -o yaml</span><br><span class="line">kubectl run vk-pod --image=busybox --labels=<span class="string">&#x27;name=vk-pod,env=dev&#x27;</span> --dry-run=client -o yaml</span><br></pre></td></tr></table></figure><p>更多内容，参考<a target="_blank" rel="noopener" href="http://docs.kubernetes.org.cn/468.html">Kubernetes kubectl run 命令详解</a>和<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/kubectl/conventions/">kubectl 的用法约定</a>。</p><h1 id="查看资源对象"><a href="#查看资源对象" class="headerlink" title="查看资源对象"></a>查看资源对象</h1><h2 id="查看可用api版本"><a href="#查看可用api版本" class="headerlink" title="查看可用api版本"></a>查看可用api版本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl api-versions</span><br></pre></td></tr></table></figure><h2 id="查看资源缩写"><a href="#查看资源缩写" class="headerlink" title="查看资源缩写"></a>查看资源缩写</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe</span><br><span class="line">kubectl api-resources</span><br></pre></td></tr></table></figure><p>建议记住常用资源的SHORTNAMES，可以提升输入效率。<br>此外，记住常用资源的APIGROUP，可以提高编写yaml文件时的效率。</p><h2 id="查看所有资源对象"><a href="#查看所有资源对象" class="headerlink" title="查看所有资源对象"></a>查看所有资源对象</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get all</span><br><span class="line">kubectl get all -o wide</span><br></pre></td></tr></table></figure><h2 id="根据label筛选资源对象"><a href="#根据label筛选资源对象" class="headerlink" title="根据label筛选资源对象"></a>根据label筛选资源对象</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get all -l <span class="string">&#x27;env=dev&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="查看指定的资源对象"><a href="#查看指定的资源对象" class="headerlink" title="查看指定的资源对象"></a>查看指定的资源对象</h2><p>以deployment资源对象为例，其他资源对象操作方法相同。</p><p>查看所有空间的所有deployment，deployment可以缩写为deploy</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deployment --all-namespaces</span><br></pre></td></tr></table></figure><p>查看指定空间下的所有deployment，默认空间default</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deploy</span><br><span class="line">kubectl get deploy -n voidking</span><br><span class="line">kubectl get deploy -n voidking -o wide</span><br></pre></td></tr></table></figure><p>查看deployment，显示label</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deploy --show-labels</span><br></pre></td></tr></table></figure><p>根据label筛选deployment</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deploy -l <span class="string">&#x27;env=dev&#x27;</span></span><br><span class="line">kubectl get deploy --selector=<span class="string">&#x27;env=dev&#x27;</span></span><br><span class="line">kubectl get deploy --selector=<span class="string">&quot;env=dev,type=frontend&quot;</span></span><br></pre></td></tr></table></figure><p>查看指定的deployment</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deploy/deployment-name</span><br><span class="line">kubectl get deploy/deployment-name -o wide</span><br><span class="line">kubectl get deploy/deployment-name -o yaml</span><br></pre></td></tr></table></figure><p>查看deployment详细信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe deploy/deployment-name</span><br></pre></td></tr></table></figure><p>查看deployment实时变化</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deploy/deployment-name --watch</span><br></pre></td></tr></table></figure><h1 id="创建资源对象"><a href="#创建资源对象" class="headerlink" title="创建资源对象"></a>创建资源对象</h1><p>以deployment资源对象为例，其他资源对象操作方法相同。</p><h2 id="指令式命令-1"><a href="#指令式命令-1" class="headerlink" title="指令式命令"></a>指令式命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create deployment vk-deploy --image=nginx</span><br></pre></td></tr></table></figure><h2 id="指令式对象配置-1"><a href="#指令式对象配置-1" class="headerlink" title="指令式对象配置"></a>指令式对象配置</h2><p>指令式对象配置，需要依赖定义好的资源对象yaml文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f deploy.yaml</span><br></pre></td></tr></table></figure><h2 id="声明式对象配置-1"><a href="#声明式对象配置-1" class="headerlink" title="声明式对象配置"></a>声明式对象配置</h2><p>和指令式对象配置唯一不同的是，<code>kubectl create</code> 改为 <code>kubectl apply</code>。</p><h1 id="更新资源对象"><a href="#更新资源对象" class="headerlink" title="更新资源对象"></a>更新资源对象</h1><p>以deployment资源对象为例，其他资源对象操作方法相同。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑集群中的资源</span></span><br><span class="line">kubectl edit deployment deployment-name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 比较manifest与集群中当前资源的不同</span></span><br><span class="line">kubectl diff -f deploy.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用最新定义</span></span><br><span class="line">kubectl replace -f deploy.yaml</span><br><span class="line">kubectl apply -f deploy.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加label</span></span><br><span class="line">kubectl label deployment deployment-name new-label=awesome</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加annotation</span></span><br><span class="line">kubectl annotate deployment deployment-name icon-url=http://goo.gl/XXBTWq </span><br><span class="line"></span><br><span class="line"><span class="comment"># 部分修改deployment</span></span><br><span class="line">kubectl patch deployment deployment-name --<span class="built_in">type</span> json \</span><br><span class="line">    -p=<span class="string">&#x27;[&#123;&quot;op&quot;: &quot;remove&quot;, &quot;path&quot;: &quot;/spec/template/spec/containers/0/livenessProbe&quot;&#125;]&#x27;</span></span><br></pre></td></tr></table></figure><h1 id="删除资源对象"><a href="#删除资源对象" class="headerlink" title="删除资源对象"></a>删除资源对象</h1><p>以deployment资源对象为例，其他资源对象操作方法相同。</p><p>删除单个deployment：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete deployment deployment-name</span><br></pre></td></tr></table></figure><p>批量删除deployment：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deployment -n &lt;your-namespace&gt; -oname | \</span><br><span class="line">    xargs kubectl delete -n &lt;your-namespace&gt;</span><br></pre></td></tr></table></figure><h1 id="扩缩容"><a href="#扩缩容" class="headerlink" title="扩缩容"></a>扩缩容</h1><p>扩缩容针对pod对象，需要操作deployment对象。</p><p>方法一：扩缩容命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl scale --replicas=2 deployment deployment-name</span><br></pre></td></tr></table></figure><p>方法二：更新yaml文件。</p><h1 id="重启pod"><a href="#重启pod" class="headerlink" title="重启pod"></a>重启pod</h1><p>k8s中，没有pod重启命令，只有pod重建命理。<br>而我们配置的pod重启策略，本质上也是重建pod，只不过pod名称相同，保留了event记录。</p><p>验证方法：<br>创建一个100秒重启的pod，启动后在其中创建一个文件。<br>当pod重启后，文件消失，pod在宿主机上对应的容器id也全部改变了。</p><h1 id="重建pod"><a href="#重建pod" class="headerlink" title="重建pod"></a>重建pod</h1><p>参考文档<a target="_blank" rel="noopener" href="https://www.containiq.com/post/using-kubectl-to-restart-a-kubernetes-pod">Using Kubectl to Restart a Kubernetes Pod</a></p><p>方法一：删除pod并重建</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod &lt;pod_name&gt; -n &lt;namespace&gt; -o yaml | kubectl replace --force -f -</span><br></pre></td></tr></table></figure><p>方法二：删除pod利用保活重建（前提是有replicaset）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod &lt;pod_name&gt; -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure><p>方法三：通过扩缩实现重建pod</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl scale deployment &lt;deployment_name&gt; --replicas=0 -n &lt;namespace&gt;</span><br><span class="line">kubectl scale deployment &lt;deployment_name&gt; --replicas=2 -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure><p>方法四：通过rollout实现重建pod</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout restart deployment &lt;deployment_name&gt; -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure><p>方法五：通过docker停止容器实现重建pod<br>前提是保证pod的重启策略是Always。<br>登录到pod所在宿主机，通过docker命令停止pod的pause容器。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker ps | grep xxx</span><br><span class="line">docker stop yyy</span><br></pre></td></tr></table></figure><p>pause容器被停止后，<code>kubectl get pods xxx</code>看到的是pod重启。<br><code>kubectl describe pod xxx</code>会看到：<br>Pod xxx changed, it will be killed and re-created.<br>是的，实际上pod的所有容器都会被重建。</p><h1 id="创建service-暴露服务"><a href="#创建service-暴露服务" class="headerlink" title="创建service/暴露服务"></a>创建service/暴露服务</h1><h2 id="命令式指令"><a href="#命令式指令" class="headerlink" title="命令式指令"></a>命令式指令</h2><p>为deployment创建clusterip，暴露clusterip的80端口，对应pod的80端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl expose deployment deployment-name --port=80 --name svc-name</span><br></pre></td></tr></table></figure><p>为deployment创建clusterip，暴露clusterip的6789端口，对应pod的80端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl expose deployment deployment-name --target-port=80 --port=6789</span><br><span class="line">kubectl expose -f vk-deploy.yaml --target-port=80 --port=6789</span><br></pre></td></tr></table></figure><p>创建nodeport，暴露clusterip的80端口，对应pod的80端口，暴露node的随机端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl expose deployment deployment-name --port=80 --<span class="built_in">type</span>=NodePort --name svc-name</span><br></pre></td></tr></table></figure><p>创建clusterip，暴露clusterip的80端口，对应pod的80端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create service clusterip svc-name --tcp=80:80</span><br></pre></td></tr></table></figure><p>创建nodeport，暴露clusterip的80端口，对应pod的pod端口，暴露node的30080端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create service nodeport svc-name --tcp=80:80 --node-port=30080</span><br></pre></td></tr></table></figure><h2 id="命令式配置文件"><a href="#命令式配置文件" class="headerlink" title="命令式配置文件"></a>命令式配置文件</h2><p>生成service的yaml文件模板（推荐方法）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create service clusterip vk-svc --tcp=<span class="string">&quot;5678:80&quot;</span> --dry-run -o yaml &gt; service.yaml</span><br></pre></td></tr></table></figure><p>创建service</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f service.yaml</span><br></pre></td></tr></table></figure><p>更多内容，参考<a target="_blank" rel="noopener" href="http://docs.kubernetes.org.cn/564.html">Kubernetes kubectl create service 命令详解</a>和<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/services-networking/service/">Service</a>。</p><h2 id="声明式配置文件"><a href="#声明式配置文件" class="headerlink" title="声明式配置文件"></a>声明式配置文件</h2><p>创建service</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f service.yaml</span><br></pre></td></tr></table></figure><h1 id="kubectl-port-forward"><a href="#kubectl-port-forward" class="headerlink" title="kubectl port-forward"></a>kubectl port-forward</h1><p>对外暴露服务，我们会使用nodeport或者loadbalance类型的service。<br>如果是临时测试，还可以使用<code>kubectl port-forward</code>。</p><p><code>kubectl port-forward</code> 通过端口转发映射本地端口到指定的应用端口，从而访问集群中的应用程序。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 本地端口映射pod端口</span></span><br><span class="line">kubectl port-forward pod/<span class="variable">$pod_name</span> -n <span class="variable">$namespace</span> <span class="variable">$node_port</span>:<span class="variable">$pod_port</span></span><br><span class="line">kubectl port-forward pod/<span class="variable">$pod_name</span> -n <span class="variable">$namespace</span> --address 0.0.0.0 <span class="variable">$node_port</span>:<span class="variable">$pod_port</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 本地端口映射service端口</span></span><br><span class="line">kubectl port-forward service/<span class="variable">$service_name</span> -n <span class="variable">$namespace</span> <span class="variable">$node_port</span>:<span class="variable">$service_port</span></span><br><span class="line">kubectl port-forward service/<span class="variable">$service_name</span> -n <span class="variable">$namespace</span> --address 0.0.0.0 <span class="variable">$node_port</span>:<span class="variable">$service_port</span></span><br></pre></td></tr></table></figure><p>注意：使用该转发功能依赖socat，需要提前安装<br>否则会报错：unable to do port forwarding: socat not found</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y socat</span><br></pre></td></tr></table></figure><h1 id="版本回退"><a href="#版本回退" class="headerlink" title="版本回退"></a>版本回退</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看发布历史</span></span><br><span class="line">kubectl rollout <span class="built_in">history</span> deployment deployment-name</span><br><span class="line"><span class="comment"># 查看发布状态</span></span><br><span class="line">kubectl rollout status deployment deployment-name</span><br><span class="line"><span class="comment"># 回退到上一个版本</span></span><br><span class="line">kubectl rollout undo deployment deployment-name</span><br></pre></td></tr></table></figure><p>rollout表示roll out，这里翻译为发布</p><h1 id="configmap和secret"><a href="#configmap和secret" class="headerlink" title="configmap和secret"></a>configmap和secret</h1><p>1、创建configmap</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl create configmap special-config --from-literal=special.how=very --from-literal=special.type=charm</span><br><span class="line">kubectl create configmap game-config-3 --from-file=&lt;my-key-name&gt;=&lt;path-to-file&gt;</span><br></pre></td></tr></table></figure><p>2、创建secret</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在命令中指定key和value</span></span><br><span class="line">kubectl create secret generic db-user-pass --from-literal=username=voidking --from-literal=password=<span class="string">&#x27;vkpassword&#x27;</span></span><br><span class="line">kubectl get secret db-user-pass -o yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在文件中指定value</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&#x27;voidking&#x27;</span> &gt; ./username.txt</span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&#x27;vkpassword&#x27;</span> &gt; ./password.txt</span><br><span class="line">kubectl create secret generic db-user-pass --from-file=./username.txt --from-file=./password.txt</span><br><span class="line">kubectl create secret generic db-user-pass --from-file=username=./username.txt --from-file=password=./password.txt</span><br><span class="line">kubectl get secret db-user-pass -o yaml</span><br></pre></td></tr></table></figure><p>在yaml文件中看到的username和password，都是经过base64加密的字符串。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加密</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&#x27;voidking&#x27;</span> | <span class="built_in">base64</span></span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;dm9pZGtpbmc=&#x27;</span> | <span class="built_in">base64</span> --decode</span><br></pre></td></tr></table></figure><h1 id="创建多个资源"><a href="#创建多个资源" class="headerlink" title="创建多个资源"></a>创建多个资源</h1><p>如果要创建ns，然后在ns中创建configmap，最后创建deployment（依赖configmap），该怎么操作？<br>方法一：挨个apply</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f ns.yaml</span><br><span class="line">kubectl apply -f cm.yaml</span><br><span class="line">kubectl apply -f deploy.yaml</span><br></pre></td></tr></table></figure><p>方法二：按顺序合并，然后apply</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> ns.yaml &lt;(<span class="built_in">echo</span> <span class="string">&quot;---&quot;</span>) cm.yaml &lt;(<span class="built_in">echo</span> <span class="string">&quot;---&quot;</span>) deploy.yaml &gt; ns-cm-deploy.yaml</span><br><span class="line">kubecl apply -f ns-cm-deploy.yaml</span><br></pre></td></tr></table></figure><p>方法三：多次apply</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f .</span><br><span class="line">kubectl apply -f .</span><br></pre></td></tr></table></figure><p>方法四：添加编号</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> ns.yaml 00-ns.yaml</span><br><span class="line"><span class="built_in">mv</span> cm.yaml 01-cm.yaml</span><br><span class="line"><span class="built_in">mv</span> deploy.yaml 02-deploy.yaml</span><br><span class="line">kubectl apply -f .</span><br></pre></td></tr></table></figure><h1 id="强制删除namspace"><a href="#强制删除namspace" class="headerlink" title="强制删除namspace"></a>强制删除namspace</h1><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>有时，通过kubectl删除了一个namespace之后，namespace并不会消失，而是一直处于Terminating状态。</p><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>方法一：先删除namespace中的资源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl get ns &lt;your-namespace&gt; -oyaml</span><br><span class="line"></span><br><span class="line">kubectl api-resources --verbs=list --namespaced -o name | \</span><br><span class="line">    xargs -n 1 kubectl get --show-kind --ignore-not-found -n &lt;your-namespace&gt;</span><br><span class="line"></span><br><span class="line">kubectl delete &lt;resource-type&gt; &lt;resource-name&gt; --namespace=&lt;your-namespace&gt;</span><br></pre></td></tr></table></figure><p>方法二：强制删除</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete ns &lt;your-namespace&gt; --force --grace-period=0</span><br></pre></td></tr></table></figure><p>方法三：强制删除plus</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl patch namespace &lt;your-namespace&gt; -p <span class="string">&#x27;&#123;&quot;metadata&quot;:&#123;&quot;finalizers&quot;: []&#125;&#125;&#x27;</span> --<span class="built_in">type</span>=merge</span><br></pre></td></tr></table></figure><p>方法四：方法三的API调用版</p><p>1、获取namepace配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get ns &lt;your-namespace&gt; -o json &gt; namespace.json</span><br></pre></td></tr></table></figure><p>2、编辑namespace配置<br>编辑namespace.json，从 finalizers 字段中删除 kubernetes。</p><p>3、提交namespace配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl proxy --port=6880 &amp;</span><br><span class="line">curl -k -H <span class="string">&quot;Content-Type: application/json&quot;</span> -X  PUT --data-binary @namespace.json http://127.0.0.1:6880/api/v1/namespaces/<span class="variable">$&#123;NAMESPACE&#125;</span>/finalize</span><br><span class="line">kubectl get ns</span><br></pre></td></tr></table></figure></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-kubectl-curd/" title="kubectl命令——资源对象增删查改篇">https://www.voidking.com/dev-kubectl-curd/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/k8s/" rel="tag"># k8s</a> <a href="/tags/kubectl/" rel="tag"># kubectl</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-kubectl-config/" rel="prev" title="kubectl命令——配置篇"><i class="fa fa-chevron-left"></i> kubectl命令——配置篇</a></div><div class="post-nav-item"> <a href="/dev-kubectl-kustomize/" rel="next" title="Kustomize工具">Kustomize工具<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#K8S%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1%E6%98%AF%E5%95%A5%EF%BC%9F"><span class="nav-number">1.</span> <span class="nav-text">K8S资源对象是啥？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1%E7%AE%A1%E7%90%86%E6%96%B9%E5%BC%8F"><span class="nav-number">2.</span> <span class="nav-text">资源对象管理方式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E5%BC%8F%E5%91%BD%E4%BB%A4"><span class="nav-number">2.1.</span> <span class="nav-text">指令式命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E5%BC%8F%E5%AF%B9%E8%B1%A1%E9%85%8D%E7%BD%AE"><span class="nav-number">2.2.</span> <span class="nav-text">指令式对象配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A3%B0%E6%98%8E%E5%BC%8F%E5%AF%B9%E8%B1%A1%E9%85%8D%E7%BD%AE"><span class="nav-number">2.3.</span> <span class="nav-text">声明式对象配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1%E7%9A%84yaml-json%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="nav-number">3.</span> <span class="nav-text">资源对象的yaml&#x2F;json文件详解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#yaml-json%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90"><span class="nav-number">3.1.</span> <span class="nav-text">yaml&#x2F;json文件构成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#yaml-json%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99"><span class="nav-number">3.2.</span> <span class="nav-text">yaml&#x2F;json文件编写</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E6%96%87%E4%BB%B6%E6%A8%A1%E6%9D%BF"><span class="nav-number">3.3.</span> <span class="nav-text">生成文件模板</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%BC%E5%87%BA%E6%96%87%E4%BB%B6%E6%A8%A1%E6%9D%BF"><span class="nav-number">3.4.</span> <span class="nav-text">导出文件模板</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#h%E5%B8%AE%E5%8A%A9"><span class="nav-number">3.5.</span> <span class="nav-text">-h帮助</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#explain%E5%B8%AE%E5%8A%A9"><span class="nav-number">3.6.</span> <span class="nav-text">explain帮助</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#yaml-json%E6%96%87%E4%BB%B6%E9%AA%8C%E8%AF%81"><span class="nav-number">3.7.</span> <span class="nav-text">yaml&#x2F;json文件验证</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#pod-yaml"><span class="nav-number">4.</span> <span class="nav-text">pod yaml</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1"><span class="nav-number">5.</span> <span class="nav-text">查看资源对象</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%8F%AF%E7%94%A8api%E7%89%88%E6%9C%AC"><span class="nav-number">5.1.</span> <span class="nav-text">查看可用api版本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E8%B5%84%E6%BA%90%E7%BC%A9%E5%86%99"><span class="nav-number">5.2.</span> <span class="nav-text">查看资源缩写</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1"><span class="nav-number">5.3.</span> <span class="nav-text">查看所有资源对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%B9%E6%8D%AElabel%E7%AD%9B%E9%80%89%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1"><span class="nav-number">5.4.</span> <span class="nav-text">根据label筛选资源对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9A%E7%9A%84%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1"><span class="nav-number">5.5.</span> <span class="nav-text">查看指定的资源对象</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1"><span class="nav-number">6.</span> <span class="nav-text">创建资源对象</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E5%BC%8F%E5%91%BD%E4%BB%A4-1"><span class="nav-number">6.1.</span> <span class="nav-text">指令式命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E5%BC%8F%E5%AF%B9%E8%B1%A1%E9%85%8D%E7%BD%AE-1"><span class="nav-number">6.2.</span> <span class="nav-text">指令式对象配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A3%B0%E6%98%8E%E5%BC%8F%E5%AF%B9%E8%B1%A1%E9%85%8D%E7%BD%AE-1"><span class="nav-number">6.3.</span> <span class="nav-text">声明式对象配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1"><span class="nav-number">7.</span> <span class="nav-text">更新资源对象</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1"><span class="nav-number">8.</span> <span class="nav-text">删除资源对象</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%89%A9%E7%BC%A9%E5%AE%B9"><span class="nav-number">9.</span> <span class="nav-text">扩缩容</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%87%8D%E5%90%AFpod"><span class="nav-number">10.</span> <span class="nav-text">重启pod</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%87%8D%E5%BB%BApod"><span class="nav-number">11.</span> <span class="nav-text">重建pod</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAservice-%E6%9A%B4%E9%9C%B2%E6%9C%8D%E5%8A%A1"><span class="nav-number">12.</span> <span class="nav-text">创建service&#x2F;暴露服务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E5%BC%8F%E6%8C%87%E4%BB%A4"><span class="nav-number">12.1.</span> <span class="nav-text">命令式指令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E5%BC%8F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">12.2.</span> <span class="nav-text">命令式配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A3%B0%E6%98%8E%E5%BC%8F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">12.3.</span> <span class="nav-text">声明式配置文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#kubectl-port-forward"><span class="nav-number">13.</span> <span class="nav-text">kubectl port-forward</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%89%88%E6%9C%AC%E5%9B%9E%E9%80%80"><span class="nav-number">14.</span> <span class="nav-text">版本回退</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#configmap%E5%92%8Csecret"><span class="nav-number">15.</span> <span class="nav-text">configmap和secret</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%B8%AA%E8%B5%84%E6%BA%90"><span class="nav-number">16.</span> <span class="nav-text">创建多个资源</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%BA%E5%88%B6%E5%88%A0%E9%99%A4namspace"><span class="nav-number">17.</span> <span class="nav-text">强制删除namspace</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="nav-number">17.1.</span> <span class="nav-text">问题描述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="nav-number">17.2.</span> <span class="nav-text">解决办法</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">643</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">29</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">238</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>