<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="部署要求宿主机为CentOS7，上面安装了docker、nginx和mysql。 1、把已经开发好的JavaWeb项目（pandawork-start）部署到docker容器里。2、该JavaWeb项目使用宿主机的mysql。3、容器设置静态ip为192.168.34.10，80端口映射为宿主机28080端口。4、nginx配置可以通过网址pandawork.voidking.com访问该Java"><meta property="og:type" content="article"><meta property="og:title" content="Docker部署JavaWeb项目"><meta property="og:url" content="https://www.voidking.com/dev-docker-deploy-javaweb/index.html"><meta property="og:site_name" content="VoidKing"><meta property="og:description" content="部署要求宿主机为CentOS7，上面安装了docker、nginx和mysql。 1、把已经开发好的JavaWeb项目（pandawork-start）部署到docker容器里。2、该JavaWeb项目使用宿主机的mysql。3、容器设置静态ip为192.168.34.10，80端口映射为宿主机28080端口。4、nginx配置可以通过网址pandawork.voidking.com访问该Java"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2017-05-11T14:00:00.000Z"><meta property="article:modified_time" content="2020-02-20T08:24:30.757Z"><meta property="article:author" content="VoidKing"><meta property="article:tag" content="docker"><meta property="article:tag" content="tomcat"><meta property="article:tag" content="centos"><meta property="article:tag" content="nginx"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="jdk"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-docker-deploy-javaweb/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Docker部署JavaWeb项目 | VoidKing</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="VoidKing" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">VoidKing</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-docker-deploy-javaweb/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="VoidKing"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="VoidKing"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Docker部署JavaWeb项目</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2017-05-11 14:00:00" itemprop="dateCreated datePublished" datetime="2017-05-11T14:00:00+00:00">2017-05-11</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/" itemprop="url" rel="index"><span itemprop="name">专业</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/centos/" itemprop="url" rel="index"><span itemprop="name">centos</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="部署要求"><a href="#部署要求" class="headerlink" title="部署要求"></a>部署要求</h1><p>宿主机为CentOS7，上面安装了docker、nginx和mysql。</p><p>1、把已经开发好的JavaWeb项目（pandawork-start）部署到docker容器里。<br>2、该JavaWeb项目使用宿主机的mysql。<br>3、容器设置静态ip为192.168.34.10，80端口映射为宿主机28080端口。<br>4、nginx配置可以通过网址<code>pandawork.voidking.com</code>访问该JavaWeb项目。</p><a id="more"></a><h1 id="软件准备"><a href="#软件准备" class="headerlink" title="软件准备"></a>软件准备</h1><p>1、《Docker安装tomcat服务》一文中配置好的ubuntu/tomcat镜像。</p><p>2、假设宿主机中的mysql数据库密码为voidking，那么需要修改pandawork-start项目中的数据库配置文件（mybatis-config.xml），主机修改为192.168.34.1，密码修改为voidking。</p><p>3、打包JavaWeb项目的war包一份。<br>在pom.xml所在文件夹，执行<code>mvn package -Dmaven.test.skip=true</code>命令，在target目录下就会生成war包。（把该war包放到tomcat的webapps文件夹里，会自动解压。）</p><p>4、使用xftp，上传war包到CentOS7的/download目录下。</p><h1 id="数据库准备"><a href="#数据库准备" class="headerlink" title="数据库准备"></a>数据库准备</h1><p>1、使用navicat连接到宿主机mysql。<br>2、创建数据库pandawork，数据库名为pandawork，字符集选择utf8–UTF-8 Unicode，排序规则选择utf8_general_ci。<br>3、导入pandawork-start项目中的pandawork.sql文件。</p><h1 id="部署项目"><a href="#部署项目" class="headerlink" title="部署项目"></a>部署项目</h1><h2 id="部署war包"><a href="#部署war包" class="headerlink" title="部署war包"></a>部署war包</h2><p>1、启动ubuntu/tomcat镜像。<br><code>docker run -i -t -v /download/:/mnt/software/ ubuntu/tomcat /bin/bash</code></p><p>2、移动war包到webapps。<br><code>cd /mnt/software</code></p><p><code>mv pandawork-start.war /opt/apache-tomcat-8.0.44/webapps/</code></p><p>3、启动tomcat，自动解压war包。<br><code>source /etc/profile</code></p><p><code>cd /opt/apache-tomcat-8.0.44/bin/</code></p><p><code>./startup.sh</code></p><p>4、测试访问。<br><code>curl localhost:8080/pandawork-start/hello</code></p><p>5、关闭tomcat。<br><code>./shutdown.sh</code></p><h2 id="tomcat配置"><a href="#tomcat配置" class="headerlink" title="tomcat配置"></a>tomcat配置</h2><p>1、配置tomcat端口为80。<br><code>cd /opt/apache-tomcat-8.0.44/conf/</code></p><p><code>vi server.xml</code></p><p>找到：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector <span class="attribute">port</span>=<span class="string">"8080"</span> <span class="attribute">protocol</span>=<span class="string">"HTTP/1.1"</span></span><br><span class="line">               <span class="attribute">connectionTimeout</span>=<span class="string">"20000"</span></span><br><span class="line">               <span class="attribute">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span><br></pre></td></tr></table></figure><p>修改为：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector <span class="attribute">port</span>=<span class="string">"80"</span> <span class="attribute">protocol</span>=<span class="string">"HTTP/1.1"</span></span><br><span class="line">               <span class="attribute">connectionTimeout</span>=<span class="string">"20000"</span></span><br><span class="line">               <span class="attribute">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span><br></pre></td></tr></table></figure><p>2、配置域名访问。<br>找到：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Engine <span class="attribute">name</span>=<span class="string">"Catalina"</span> <span class="attribute">defaultHost</span>=<span class="string">"localhost"</span>&gt;</span><br></pre></td></tr></table></figure><p>修改为：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Engine <span class="attribute">name</span>=<span class="string">"Catalina"</span> <span class="attribute">defaultHost</span>=<span class="string">"pandawork.voidking.com"</span>&gt;</span><br></pre></td></tr></table></figure><p>找到：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">"localhost"</span>  <span class="attr">appBase</span>=<span class="string">"webapps"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">unpackWARs</span>=<span class="string">"true"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- SingleSignOn valve, share authentication between web applications</span></span><br><span class="line"><span class="comment">       Documentation at: /docs/config/valve.html --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  &lt;Valve className="org.apache.catalina.authenticator.SingleSignOn" /&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Access log processes all example.</span></span><br><span class="line"><span class="comment">       Documentation at: /docs/config/valve.html</span></span><br><span class="line"><span class="comment">       <span class="doctag">Note:</span> The pattern used is equivalent to using pattern="common" --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.valves.AccessLogValve"</span> <span class="attr">directory</span>=<span class="string">"logs"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">prefix</span>=<span class="string">"localhost_access_log"</span> <span class="attr">suffix</span>=<span class="string">".txt"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">pattern</span>=<span class="string">"%h %l %u %t <span class="symbol">&amp;quot;</span>%r<span class="symbol">&amp;quot;</span> %s %b"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">Host</span>&gt;</span></span><br></pre></td></tr></table></figure><p>修改为：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">"pandawork.voidking.com"</span>  <span class="attr">appBase</span>=<span class="string">"webapps"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">unpackWARs</span>=<span class="string">"true"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">""</span> <span class="attr">docBase</span>=<span class="string">"pandawork-start"</span> <span class="attr">reloadable</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- SingleSignOn valve, share authentication between web applications</span></span><br><span class="line"><span class="comment">       Documentation at: /docs/config/valve.html --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  &lt;Valve className="org.apache.catalina.authenticator.SingleSignOn" /&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Access log processes all example.</span></span><br><span class="line"><span class="comment">       Documentation at: /docs/config/valve.html</span></span><br><span class="line"><span class="comment">       <span class="doctag">Note:</span> The pattern used is equivalent to using pattern="common" --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.valves.AccessLogValve"</span> <span class="attr">directory</span>=<span class="string">"logs"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">prefix</span>=<span class="string">"localhost_access_log"</span> <span class="attr">suffix</span>=<span class="string">".txt"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">pattern</span>=<span class="string">"%h %l %u %t <span class="symbol">&amp;quot;</span>%r<span class="symbol">&amp;quot;</span> %s %b"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">Host</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="测试启动"><a href="#测试启动" class="headerlink" title="测试启动"></a>测试启动</h2><p>1、启动tomcat。<br><code>cd /opt/apache-tomcat-8.0.44/bin/</code></p><p><code>./startup.sh</code></p><p>2、在/etc/hosts文件中，添加</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1</span>       pandawork.voidking.com</span><br></pre></td></tr></table></figure><p>3、测试访问。<br><code>curl pandawork.voidking.com</code></p><p>4、关闭tomcat。<br><code>./shutdown.sh</code></p><h2 id="保存容器"><a href="#保存容器" class="headerlink" title="保存容器"></a>保存容器</h2><p>1、退出容器<br><code>exit</code></p><p>2、查看dockerid<br><code>docker ps -l</code></p><p>3、保存容器为ubuntu/pandawork镜像。<br><code>docker commit 87be ubuntu/pandawork</code></p><h1 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h1><p>1、创建自定义网络，选取192.168.34.0网段。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker<span class="built_in"> network </span>create <span class="attribute">--subnet</span>=192.168.34.0/24 voidkingnet</span><br></pre></td></tr></table></figure><p>2、选取192.168.34.10作为静态IP地址，启动ubuntu/pandawork镜像。</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p <span class="number">28080</span>:<span class="number">80</span> --name pandawork1<span class="number">.0</span> --add-host pandawork.<span class="built_in">void</span>king.com:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> --net <span class="built_in">void</span>kingnet --ip <span class="number">192.168</span><span class="number">.34</span><span class="number">.10</span> ubuntu/pandawork /run.sh</span><br></pre></td></tr></table></figure><p>我们已经在容器中修改了/etc/hosts文件，为什么还需要–add-host参数？<br>这是因为容器中的hosts文件，在重启后会恢复初始设置，改了也没用。</p><p>实际上，在容器中配置tomcat的时候，如果</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Engine <span class="attribute">name</span>=<span class="string">"Catalina"</span> <span class="attribute">defaultHost</span>=<span class="string">"localhost"</span>&gt;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">"localhost"</span>  <span class="attr">appBase</span>=<span class="string">"webapps"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">unpackWARs</span>=<span class="string">"true"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">""</span> <span class="attr">docBase</span>=<span class="string">"pandawork-start"</span> <span class="attr">reloadable</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- SingleSignOn valve, share authentication between web applications</span></span><br><span class="line"><span class="comment">       Documentation at: /docs/config/valve.html --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  &lt;Valve className="org.apache.catalina.authenticator.SingleSignOn" /&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Access log processes all example.</span></span><br><span class="line"><span class="comment">       Documentation at: /docs/config/valve.html</span></span><br><span class="line"><span class="comment">       <span class="doctag">Note:</span> The pattern used is equivalent to using pattern="common" --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.valves.AccessLogValve"</span> <span class="attr">directory</span>=<span class="string">"logs"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">prefix</span>=<span class="string">"localhost_access_log"</span> <span class="attr">suffix</span>=<span class="string">".txt"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">pattern</span>=<span class="string">"%h %l %u %t <span class="symbol">&amp;quot;</span>%r<span class="symbol">&amp;quot;</span> %s %b"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">Host</span>&gt;</span></span><br></pre></td></tr></table></figure><p>那么，–add-host参数不加也可以。貌似画蛇添足，实际上不然，有些项目可移植性比较差，必须配置本地hosts。</p><p>3、查看运行状态。<br><code>docker ps</code></p><p>4、测试访问。<br><code>curl 192.168.34.10</code>或者<code>curl localhost:28080</code></p><p>5、关闭容器<br><code>docker kill pandawork1.0</code></p><p>6、再次启动容器<br><code>docker start pandawork1.0</code></p><h1 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h1><p>1、在宿主机中，找到nginx安装位置<br><code>ps aux | grep nginx</code></p><p>2、进入nginx配置目录<br>在<a href="http://www.voidking.com/dev-centos-php-envirenment/">《在CentOS7上配置PHP运行环境》</a>一文中，小编的nginx是通过EZHTTP安装的。</p><p><code>cd /usr/local/nginx/conf</code>，进入nginx配置文件目录。<br><code>cd vhost</code>，具体的某个站点的目录，都在vhost目录下。</p><p>3、修改nginx配置文件<br>参照项目：<a href="https://github.com/voidking/nginx-conf" target="_blank" rel="noopener">https://github.com/voidking/nginx-conf</a> ，在vhost目录下，新建pandawork.voidking.com.conf文件，内容如下：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">upstream pandawork&#123;</span><br><span class="line">    server <span class="number">192.168</span><span class="number">.34</span><span class="number">.10</span>;</span><br><span class="line">    #server <span class="number">192.168</span><span class="number">.34</span><span class="number">.11</span>;用来负载均衡</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">    listen <span class="number">80</span>;</span><br><span class="line">    server_name pandawork.<span class="built_in">void</span>king.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http:<span class="comment">//pandawork;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4、重新加载nginx配置文件<br><code>cd /usr/local/nginx/sbin</code>，<code>./nginx -s reload</code></p><p>报错：</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx: [<span class="keyword">error</span>] <span class="keyword">open</span>() <span class="string">"/usr/local/nginx/logs/nginx.pid"</span> failed (2: <span class="keyword">No</span> such <span class="keyword">file</span> or directory)</span><br></pre></td></tr></table></figure><p>解决办法：<br><code>/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</code></p><p>然后重新执行<code>./nginx -s reload</code>。</p><h1 id="hosts配置"><a href="#hosts配置" class="headerlink" title="hosts配置"></a>hosts配置</h1><p>1、在宿主机中，修改/etc/hosts文件，添加：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1</span>       pandawork.voidking.com</span><br></pre></td></tr></table></figure><p>2、测试访问。<br>在宿主机中，<code>curl pandawork.voidking.com</code>。</p><h1 id="最终测试"><a href="#最终测试" class="headerlink" title="最终测试"></a>最终测试</h1><p>1、在宿主机中关闭防火墙，<code>systemctl stop firewalld.service</code>。</p><p>2、假设宿主机IP为192.168.56.101，那么在宿主机同局域网PC中配置hosts：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192.168.56.101</span>    pandawork.voidking.com</span><br></pre></td></tr></table></figure><p>3、浏览器中输入<code>http://pandawork.voidking.com</code>，看到“Hello World!”。</p><p>4、验证注册登录等功能，全部正常。此次，大功告成。</p><h1 id="重启宿主机后报错"><a href="#重启宿主机后报错" class="headerlink" title="重启宿主机后报错"></a>重启宿主机后报错</h1><p>重新启动宿主机后，启动docker，启动pandawork容器。<br>执行<code>docker start pandawork1.0</code>时，报错如下：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">Error</span> response <span class="keyword">from</span> daemon: driver failed programming external connectivity on endpoint pandawork1.0 (9f3cbc9ebc5030c0cbbbbbac81628ce48374fd392f6995f4d75ac20bce9d2a30):  (iptables failed: iptables --wait -t<span class="built_in"> nat </span>-A DOCKER -p tcp -d 0/0 --dport 28080 -j DNAT --to-destination 192.168.34.10:80 ! -i br-024154a13bb1: iptables: <span class="literal">No</span> chain/target/match by that name.</span><br><span class="line"> (exit status 1))</span><br></pre></td></tr></table></figure><p>解决办法：<br><code>pkill docker</code></p><p><code>iptables -t nat -F</code></p><p><code>ifconfig docker0 down</code></p><p>最后重启docker，<code>docker restart docker</code>。</p><h1 id="书签"><a href="#书签" class="headerlink" title="书签"></a>书签</h1><p><a href="http://blog.csdn.net/evankaka/article/details/50722788" target="_blank" rel="noopener">Docker部署JavaWeb项目实战</a></p><p><a href="http://www.cnblogs.com/zengkefu/p/5667046.html" target="_blank" rel="noopener">使用 Docker 搭建 Java Web 运行环境</a></p><p><a href="http://www.cnblogs.com/z-belief/p/6148463.html" target="_blank" rel="noopener">解决docker容器中文乱码，修改docker容器编码格式</a></p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/docker/" rel="tag"># docker</a> <a href="/tags/tomcat/" rel="tag"># tomcat</a> <a href="/tags/centos/" rel="tag"># centos</a> <a href="/tags/nginx/" rel="tag"># nginx</a> <a href="/tags/ubuntu/" rel="tag"># ubuntu</a> <a href="/tags/jdk/" rel="tag"># jdk</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-docker-ubuntu-tomcat/" rel="prev" title="Docker安装tomcat服务"><i class="fa fa-chevron-left"></i> Docker安装tomcat服务</a></div><div class="post-nav-item"> <a href="/hobby-aria2-download/" rel="next" title="使用aria2离线下载">使用aria2离线下载<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#部署要求"><span class="nav-number">1.</span> <span class="nav-text">部署要求</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#软件准备"><span class="nav-number">2.</span> <span class="nav-text">软件准备</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据库准备"><span class="nav-number">3.</span> <span class="nav-text">数据库准备</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#部署项目"><span class="nav-number">4.</span> <span class="nav-text">部署项目</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#部署war包"><span class="nav-number">4.1.</span> <span class="nav-text">部署war包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tomcat配置"><span class="nav-number">4.2.</span> <span class="nav-text">tomcat配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#测试启动"><span class="nav-number">4.3.</span> <span class="nav-text">测试启动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#保存容器"><span class="nav-number">4.4.</span> <span class="nav-text">保存容器</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#网络配置"><span class="nav-number">5.</span> <span class="nav-text">网络配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nginx配置"><span class="nav-number">6.</span> <span class="nav-text">nginx配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#hosts配置"><span class="nav-number">7.</span> <span class="nav-text">hosts配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#最终测试"><span class="nav-number">8.</span> <span class="nav-text">最终测试</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#重启宿主机后报错"><span class="nav-number">9.</span> <span class="nav-text">重启宿主机后报错</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#书签"><span class="nav-number">10.</span> <span class="nav-text">书签</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="VoidKing" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">VoidKing</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">584</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">40</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">189</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://twitter.com/voidking_com" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;voidking_com" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i> Twitter</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">VoidKing</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://www.beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>