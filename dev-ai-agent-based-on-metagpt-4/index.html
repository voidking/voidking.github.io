<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//qiniu-cdn.voidking.com/doc/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言本章任务：  了解订阅智能体 了解爬虫 了解MetaGPT订阅模块 实现订阅智能体"><meta property="og:type" content="article"><meta property="og:title" content="基于MetaGPT实现一个订阅智能体：第四章 OSS订阅智能体"><meta property="og:url" content="https://www.voidking.com/dev-ai-agent-based-on-metagpt-4/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言本章任务：  了解订阅智能体 了解爬虫 了解MetaGPT订阅模块 实现订阅智能体"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2024-01-13T08:00:00.000Z"><meta property="article:modified_time" content="2024-03-23T08:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="python"><meta property="article:tag" content="chatgpt"><meta property="article:tag" content="aigc"><meta property="article:tag" content="metagpt"><meta property="article:tag" content="discord"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-ai-agent-based-on-metagpt-4/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>基于MetaGPT实现一个订阅智能体：第四章 OSS订阅智能体 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">一个计算机技术爱好者与学习者</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-ai-agent-based-on-metagpt-4/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="一个计算机技术爱好者与学习者"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> 基于MetaGPT实现一个订阅智能体：第四章 OSS订阅智能体</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2024-01-13 08:00:00" itemprop="dateCreated datePublished" datetime="2024-01-13T08:00:00+00:00">2024-01-13</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-03-23 08:00:00" itemprop="dateModified" datetime="2024-03-23T08:00:00+00:00">2024-03-23</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/aigc/" itemprop="url" rel="index"><span itemprop="name">aigc</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><span class="post-title-index">1.</span><a href="#前言" class="headerlink" title="前言"></a> 前言</h1><p>本章任务：</p><ul><li>了解订阅智能体</li><li>了解爬虫</li><li>了解MetaGPT订阅模块</li><li>实现订阅智能体</li></ul><span id="more"></span><h1 id="什么是订阅智能体？"><span class="post-title-index">2.</span><a href="#什么是订阅智能体？" class="headerlink" title="什么是订阅智能体？"></a> 什么是订阅智能体？</h1><p>MetaGPT提供了Agent的开发能力，Agent可以协助我们解决日常的一些问题，其中一个应用场景就是我们可以让Agent为我们关注某些想关注的信息，当有我们关注的事件发生时，Agent获取信息并进行处理，然后通过一些如邮件、微信、discord等通知渠道将处理后的信息发送给我们，我们将这类Agent称为订阅智能体。</p><p>在这里，Agent的Role是以一个“资讯订阅员”的身份为你服务，而Agent中包含的Action则主要有两种：从外界信息源中搜集信息和对搜集得到的信息进行总结。</p><p>完成上述任务后，我们可以为这个Agent开发更多额外功能：定时运行的功能和发送到通知渠道的功能。</p><h1 id="什么是爬虫？"><span class="post-title-index">3.</span><a href="#什么是爬虫？" class="headerlink" title="什么是爬虫？"></a> 什么是爬虫？</h1><p>本文中所说的爬虫是可以抓取网页内容的程序工具。<br>想要让Agent获取网络中的信息，需要实现爬虫进行抓取。</p><p>实现爬虫时常用的 Python 工具：</p><ul><li>aiohttp：使用 aiohttp ，发起网络请求</li><li>beautifulsoup：使用 beautifulsoup，从HTML中提取信息</li></ul><h1 id="MetaGPT订阅模块"><span class="post-title-index">4.</span><a href="#MetaGPT订阅模块" class="headerlink" title="MetaGPT订阅模块"></a> MetaGPT订阅模块</h1><p>在MetaGPT中，metagpt.subscription模块提供了SubscriptionRunner类，与metagpt.team.Team类似，SubscriptionRunner类是提供了一个Role的运行方式，基于SubscriptionRunner类，我们可以定时触发运行一个Role，然后将Role的执行输出通知给用户，例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> metagpt.subscription <span class="keyword">import</span> SubscriptionRunner</span><br><span class="line"><span class="keyword">from</span> metagpt.roles <span class="keyword">import</span> Searcher</span><br><span class="line"><span class="keyword">from</span> metagpt.schema <span class="keyword">import</span> Message</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">trigger</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> Message(<span class="string">&quot;the latest news about OpenAI&quot;</span>)</span><br><span class="line">        <span class="keyword">await</span> asyncio.sleep(<span class="number">3600</span> * <span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">callback</span>(<span class="params">msg: Message</span>):</span><br><span class="line">    <span class="built_in">print</span>(msg.content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    pb = SubscriptionRunner()</span><br><span class="line">    <span class="keyword">await</span> pb.subscribe(Searcher(), trigger(), callback)</span><br><span class="line">    <span class="keyword">await</span> pb.run()</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure><p>从例子可以知道订阅智能体的实现主要有3个要素，分别是Role、Trigger、Pusher，即智能体本身、触发器、数据推送器。</p><p>这里的Role就是我们的Agent的实际代码实现，所以订阅智能体在代码实现上并没有什么特别的地方，可以看到上面的例子实际运行的就是MetaGPT中的Searcher Role，它早就存在了我们的MetaGPT仓库中。</p><p>不过需要注意的是，我们虽然不对订阅智能体的Role做限制，但是不是所有的Role都适合用来做订阅智能体，比如MetaGPT软件公司中的几个角色，例如产品经理、架构师、工程师等，因为当给这些Role一个需求输入时，它们的产出往往是类似的，并没有定时执行然后发送给我们的必要。所以从应用的角度出发，订阅智能体的输出应该具有实时性，相同的一个需求描述输入，输出的内容一般是会随着时间的变化而不同，例如新闻资讯、技术前沿进展、热门的开源项目等。</p><p>这里的Trigger是指Role运行的触发条件，可以是定时触发或者是某个网站有更新时触发。Trigger是个异步生成器，详情参考 <a target="_blank" rel="noopener" href="https://peps.python.org/pep-0525/">https://peps.python.org/pep-0525/</a><br>这里的Pusher用于处理Role生成的信息，我们可以将数据发送到微信或者discord。</p><h1 id="实现OSS订阅智能体"><span class="post-title-index">5.</span><a href="#实现OSS订阅智能体" class="headerlink" title="实现OSS订阅智能体"></a> 实现OSS订阅智能体</h1><h2 id="本节任务"><span class="post-title-index">5.1.</span><a href="#本节任务" class="headerlink" title="本节任务"></a> 本节任务</h2><p>实现一个OSS（Open Source Software）订阅智能体，它要能够从github获取热门开源项目的信息，并进行汇总分析。</p><h2 id="需求拆解"><span class="post-title-index">5.2.</span><a href="#需求拆解" class="headerlink" title="需求拆解"></a> 需求拆解</h2><p>订阅智能体的实现主要有3个要素，分别是Role、Trigger、Pusher。<br>因此，我们可以订阅智能体进行拆解：<br>1、实现一个 OSSWatcher Role：OSS 即 Open source software，我们对OSS 智能体定位是，帮我们关注并分析热门的开源项目，当有相关信息时将信息推送给我们，这里需要确定让 OSS 从哪个网页获取信息<br>2、实现Trigger：指这个OSSWatcher角色运行的触发条件，可以是定时触发或者是某个网站有更新时触发<br>3、实现Pusher：处理OSSWatcher角色运行生成的信息，我们可以将数据发送到微信或者discord</p><h2 id="网络需求"><span class="post-title-index">5.3.</span><a href="#网络需求" class="headerlink" title="网络需求"></a> 网络需求</h2><p>教程涉中需要访问到一些国外的网站，可能会遇到网络问题，因为 aiohttp 默认不走系统代理，所以需要代理配置。<br>MetaGPT中已经提供了GLOBAL_PROXY参数用来表示全局代理配置，教程中遇到使用aiohttp进行请求的地方，都会将代理设置为GLOBAL_PROXY的值。<br>通过在config/key.yaml配置文件中，添加自己代理服务器的配置，以解决网络问题，例如：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">GLOBAL_PROXY:</span> <span class="string">http://127.0.0.1:7890</span>  <span class="comment"># 改成自己的代理服务器地址</span></span><br></pre></td></tr></table></figure><p>如果配置 GLOBAL_PROXY 无效，可以尝试使用全局代理。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7890</span><br></pre></td></tr></table></figure><p>注意：中国大陆地区无法访问Discord，使用代理也不行，暂未找到解决办法。详情参考<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/51158310/how-to-connect-a-discord-bot-through-proxy">how to connect a discord bot through proxy</a></p><h2 id="实现OSSWatcher-Role"><span class="post-title-index">5.4.</span><a href="#实现OSSWatcher-Role" class="headerlink" title="实现OSSWatcher Role"></a> 实现OSSWatcher Role</h2><p>实现OSSWatcher的Role前，需要先确定我们要 OSSWatcher 做哪些事情，即需要实现哪些 Action。<br>OSSWatcher可以拆分出两个Action，爬取热门开源项目数据和分析热门开源项目数据。</p><h3 id="爬取数据Action"><span class="post-title-index">5.4.1.</span><a href="#爬取数据Action" class="headerlink" title="爬取数据Action"></a> 爬取数据Action</h3><p>爬虫部分的代码可以借助ChatGPT来辅助开发，询问ChatGPT之前，建议先对html代码进行精简。Prompt参考<a target="_blank" rel="noopener" href="https://chat.openai.com/share/6c8046d3-e363-40bd-9412-8d859e7b3854">爬虫解析GitHub数据</a>。</p><p>爬取热门开源项目数据 Action ，实现代码 <a target="_blank" rel="noopener" href="https://github.com/voidking/hexo-storage/tree/main/ai-agent-based-on-metagpt/oss-agent/crawl_data.py">crawl_data.py</a></p><h3 id="分析数据Action"><span class="post-title-index">5.4.2.</span><a href="#分析数据Action" class="headerlink" title="分析数据Action"></a> 分析数据Action</h3><p>网页爬取的Action实现后，我们就可以让LLM基于爬取的网页内容进行分析了，这个Action实现比较简单，主要是写提示词。<br>在提示词中我们可以要求LLM从几个角度进行分析，并按照一定的格式进行输出，例如：</p><ul><li>今天榜单的整体趋势，例如哪几个编程语言比较热门、最热门的项目是哪些、主要集中在哪些领域</li><li>榜单的仓库分类</li><li>推荐进一步关注哪些仓库，推荐原因是什么</li></ul><p>分析热门开源项目数据 Action，代码文件 <a target="_blank" rel="noopener" href="https://github.com/voidking/hexo-storage/tree/main/ai-agent-based-on-metagpt/oss-agent/analyze_data.py">analyze_data.py</a></p><h3 id="关注者Role"><span class="post-title-index">5.4.3.</span><a href="#关注者Role" class="headerlink" title="关注者Role"></a> 关注者Role</h3><p>热门开源项目关注者 Role，代码文件 <a target="_blank" rel="noopener" href="https://github.com/voidking/hexo-storage/tree/main/ai-agent-based-on-metagpt/oss-agent/oss_watcher.py">oss_watcher.py</a></p><h2 id="实现Trigger"><span class="post-title-index">5.5.</span><a href="#实现Trigger" class="headerlink" title="实现Trigger"></a> 实现Trigger</h2><p>Trigger即触发器，代表了OSSWatcher角色的执行时机，最简单的触发方式即定时触发。<br>Github Trending不是实时更新的，参考 <a target="_blank" rel="noopener" href="https://github.com/orgs/community/discussions/64295">Do you know when trending repositories on GitHub are usually updated?</a>，可以了解到Github Trending更新时间大约是在 10:00 AM UTC，实测更新时间不是很准时，所以我们可以一天触发一次，选取一个比较适合自己的推送时间即可，比如每天早上9点。</p><p>基于aiocron实现Trigger，代码文件 <a target="_blank" rel="noopener" href="https://github.com/voidking/hexo-storage/tree/main/ai-agent-based-on-metagpt/oss-agent/trigger.py">trigger.py</a></p><h2 id="实现Pusher"><span class="post-title-index">5.6.</span><a href="#实现Pusher" class="headerlink" title="实现Pusher"></a> 实现Pusher</h2><p>Pusher就是定义了如何处理智能体生成的信息，本示例中将智能体产生的数据发送到Discord和微信。</p><h3 id="配置Discord"><span class="post-title-index">5.6.1.</span><a href="#配置Discord" class="headerlink" title="配置Discord"></a> 配置Discord</h3><p>在<a target="_blank" rel="noopener" href="https://discord.com/developers/applications">Discord开发者面板</a>添加BOT，并将BOT添加到某个服务器中，并获取到Bot的Token，Bot的Token对应接下来代码中的 DISCORD_TOKEN。<br>具体操作步骤参考<a target="_blank" rel="noopener" href="https://discordpy.readthedocs.io/en/stable/discord.html">Creating a Bot Account</a>或者<a href="https://www.voidking.com/dev-forward-discord-message-to-feishu/">《转发Discord消息到飞书》</a>。</p><h3 id="配置微信"><span class="post-title-index">5.6.2.</span><a href="#配置微信" class="headerlink" title="配置微信"></a> 配置微信</h3><p>之前MetaGPT有尝试通过微信机器人同步不同社区群的消息，不过由于引起了过大的讨论，最终关闭了该功能，当时是使用wechaty实现的，但是使用该方式较为繁琐，而且由于我们的内容是markdown格式的，直接发送微信消息阅读体验较差，所以我们需要寻找合适的微信消息发送方式。<br>公众号可以发送富本文消息，比较符合我们的场景，但是为了个推送的功能，开发个公众号的成本也是比较大，但是如果可以通过已有的一个公众号给我们发送消息，那实现将会非常简单。虽然微信官方没有提供类似的功能，但是已有许多的第三方公众号提供了消息推送的功能，例如server酱、wxpusher、Pushplus等，我们可以选择其中之一，例如wxpusher，它的代码是开源的，也有详细的文档，开发文档参考<a target="_blank" rel="noopener" href="https://wxpusher.zjiecode.com/docs/#/">WxPusher微信推送服务</a>。</p><p>参考文档<a target="_blank" rel="noopener" href="https://wxpusher.zjiecode.com/docs/#/?id=%e8%8e%b7%e5%8f%96apptoken">获取appToken</a>，appToken 对应接下来代码中的 WXPUSHER_TOKEN。</p><h3 id="Discord和微信Pusher"><span class="post-title-index">5.6.3.</span><a href="#Discord和微信Pusher" class="headerlink" title="Discord和微信Pusher"></a> Discord和微信Pusher</h3><p>调用Discord API发送消息到Discord，调用WXPusher发送消息到微信，代码文件 <a target="_blank" rel="noopener" href="https://github.com/voidking/hexo-storage/tree/main/ai-agent-based-on-metagpt/oss-agent/pusher.py">pusher.py</a></p><h2 id="运行代码"><span class="post-title-index">5.7.</span><a href="#运行代码" class="headerlink" title="运行代码"></a> 运行代码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> DISCORD_TOKEN=xxx.xxx.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line"><span class="built_in">export</span> DISCORD_CHANNEL_ID=xxxxxx</span><br><span class="line"><span class="built_in">export</span> WXPUSHER_TOKEN=AT_xxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line"><span class="built_in">export</span> WXPUSHER_UIDS=UID_xxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line">python main.py</span><br></pre></td></tr></table></figure><h2 id="完整代码"><span class="post-title-index">5.8.</span><a href="#完整代码" class="headerlink" title="完整代码"></a> 完整代码</h2><p>本节完整代码，请参阅<a target="_blank" rel="noopener" href="https://github.com/voidking/hexo-storage/tree/main/ai-agent-based-on-metagpt/oss-agent">ai-agent-based-on-metagpt/oss-agent</a><br>关于代码的解释，请参阅<a target="_blank" rel="noopener" href="https://deepwisdom.feishu.cn/wiki/KhCcweQKmijXi6kDwnicM0qpnEf">《MetaGPT智能体开发入门》教程</a>，写的非常详细了。</p><h1 id="本章作业"><span class="post-title-index">6.</span><a href="#本章作业" class="headerlink" title="本章作业"></a> 本章作业</h1><p>根据上面教程的介绍，你已经学会了如何针对具体场景开发一个实用的资讯收集助手。<br>现在，你可以试着完成一个能订阅自己感兴趣的资讯的Agent。</p><ul><li>根据前面你所学习的爬虫基本知识（如果你对写爬虫代码感到不熟练，使用GPT帮助你），为你的Agent自定义两个获取资讯的Action类<ul><li>Action 1：独立实现对<a target="_blank" rel="noopener" href="https://github.com/trending">Github Trending</a>页面的爬取，并获取每一个项目的 名称、URL链接、描述</li><li>Action 2：独立完成对<a target="_blank" rel="noopener" href="https://huggingface.co/papers">Huggingface Papers</a>页面的爬取，先获取到每一篇Paper的链接（提示：标题元素中的href标签），并通过链接访问标题的描述页面（例如：<a target="_blank" rel="noopener" href="https://huggingface.co/papers/2312.03818">https://huggingface.co/papers/2312.03818</a> ），在页面中获取一篇Paper的 标题、摘要</li></ul></li><li>参考第三章【实现一个更复杂的Agent：技术文档助手】的内容，重写有关方法，使你的Agent能自动生成总结内容的目录，然后根据二级标题进行分块，每块内容做出对应的总结，形成一篇资讯文档</li><li>自定义Agent的SubscriptionRunner类，独立实现Trigger、Pusher的功能，让你的Agent定时为通知渠道发送以上总结的资讯文档（尝试实现邮箱发送的功能，这是加分项）</li></ul></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>原文链接：</strong> <a href="https://www.voidking.com/dev-ai-agent-based-on-metagpt-4/" title="基于MetaGPT实现一个订阅智能体：第四章 OSS订阅智能体">https://www.voidking.com/dev-ai-agent-based-on-metagpt-4/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本文采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议，转载请注明出处！源站会即时更新知识点并修正错误，欢迎访问~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/python/" rel="tag"># python</a> <a href="/tags/chatgpt/" rel="tag"># chatgpt</a> <a href="/tags/aigc/" rel="tag"># aigc</a> <a href="/tags/metagpt/" rel="tag"># metagpt</a> <a href="/tags/discord/" rel="tag"># discord</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-ai-agent-based-on-metagpt-5/" rel="prev" title="基于MetaGPT实现一个订阅智能体：第五章 ActionNode"><i class="fa fa-chevron-left"></i> 基于MetaGPT实现一个订阅智能体：第五章 ActionNode</a></div><div class="post-nav-item"> <a href="/dev-ai-agent-based-on-metagpt-2/" rel="next" title="基于MetaGPT实现一个订阅智能体：第二章 AI Agent知识体系结构">基于MetaGPT实现一个订阅智能体：第二章 AI Agent知识体系结构<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3284447971731414" data-ad-slot="9697986181"></ins><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">1. 前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%AE%A2%E9%98%85%E6%99%BA%E8%83%BD%E4%BD%93%EF%BC%9F"><span class="nav-text">2. 什么是订阅智能体？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%88%AC%E8%99%AB%EF%BC%9F"><span class="nav-text">3. 什么是爬虫？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MetaGPT%E8%AE%A2%E9%98%85%E6%A8%A1%E5%9D%97"><span class="nav-text">4. MetaGPT订阅模块</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0OSS%E8%AE%A2%E9%98%85%E6%99%BA%E8%83%BD%E4%BD%93"><span class="nav-text">5. 实现OSS订阅智能体</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E8%8A%82%E4%BB%BB%E5%8A%A1"><span class="nav-text">5.1. 本节任务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9C%80%E6%B1%82%E6%8B%86%E8%A7%A3"><span class="nav-text">5.2. 需求拆解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E9%9C%80%E6%B1%82"><span class="nav-text">5.3. 网络需求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0OSSWatcher-Role"><span class="nav-text">5.4. 实现OSSWatcher Role</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%88%AC%E5%8F%96%E6%95%B0%E6%8D%AEAction"><span class="nav-text">5.4.1. 爬取数据Action</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E6%9E%90%E6%95%B0%E6%8D%AEAction"><span class="nav-text">5.4.2. 分析数据Action</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E6%B3%A8%E8%80%85Role"><span class="nav-text">5.4.3. 关注者Role</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0Trigger"><span class="nav-text">5.5. 实现Trigger</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0Pusher"><span class="nav-text">5.6. 实现Pusher</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEDiscord"><span class="nav-text">5.6.1. 配置Discord</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%BE%AE%E4%BF%A1"><span class="nav-text">5.6.2. 配置微信</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Discord%E5%92%8C%E5%BE%AE%E4%BF%A1Pusher"><span class="nav-text">5.6.3. Discord和微信Pusher</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E4%BB%A3%E7%A0%81"><span class="nav-text">5.7. 运行代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="nav-text">5.8. 完整代码</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%AC%E7%AB%A0%E4%BD%9C%E4%B8%9A"><span class="nav-text">6. 本章作业</span></a></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">一个计算机技术爱好者与学习者</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">776</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">33</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">269</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2026</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: '98ed4d61fc0dcfe78758eee418350f0b',
      title: '基于MetaGPT实现一个订阅智能体：第四章 OSS订阅智能体',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>