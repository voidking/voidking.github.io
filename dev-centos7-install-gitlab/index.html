<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//qiniu.cdn.voidking.com/doc/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="GitLab简介GitLab是GitLab公司开发的基于Rails的开源存储库管理器。它是一个基于Web的git存储库管理器，允许团队协作编写、测试和部署应用程序。GitLab提供了多种功能，包括wiki、问题跟踪、代码审查和活动源。GitLab Inc提供5种产品：  Gitlab CE（社区版）：自托管和免费，社区论坛的支持。 Gitlab EE（企业版）：自托管和付费，附带其他功能。 Git"><meta property="og:type" content="article"><meta property="og:title" content="好好学GitLab：CentOS7安装配置GitLab"><meta property="og:url" content="https://www.voidking.com/dev-centos7-install-gitlab/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="GitLab简介GitLab是GitLab公司开发的基于Rails的开源存储库管理器。它是一个基于Web的git存储库管理器，允许团队协作编写、测试和部署应用程序。GitLab提供了多种功能，包括wiki、问题跟踪、代码审查和活动源。GitLab Inc提供5种产品：  Gitlab CE（社区版）：自托管和免费，社区论坛的支持。 Gitlab EE（企业版）：自托管和付费，附带其他功能。 Git"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com/img/centos7-install-gitlab/result.jpg?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com/img/centos7-install-gitlab/login.jpg?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com/img/centos7-install-gitlab/success.jpg?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com/img/centos7-install-gitlab/secret.jpg?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com/img/centos7-install-gitlab/safe.jpg?imageView2/0/w/600"><meta property="article:published_time" content="2019-07-31T21:00:00.000Z"><meta property="article:modified_time" content="2023-03-08T11:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="git"><meta property="article:tag" content="centos"><meta property="article:tag" content="gitlab"><meta property="article:tag" content="https"><meta property="article:tag" content="加密"><meta property="article:tag" content="好好学GitLab"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com/img/centos7-install-gitlab/result.jpg?imageView2/0/w/600"><link rel="canonical" href="https://www.voidking.com/dev-centos7-install-gitlab/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>好好学GitLab：CentOS7安装配置GitLab | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">一个计算机技术爱好者与学习者</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-centos7-install-gitlab/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="一个计算机技术爱好者与学习者"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> 好好学GitLab：CentOS7安装配置GitLab</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-07-31 21:00:00" itemprop="dateCreated datePublished" datetime="2019-07-31T21:00:00+00:00">2019-07-31</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2023-03-08 11:00:00" itemprop="dateModified" datetime="2023-03-08T11:00:00+00:00">2023-03-08</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/troubleshooting/" itemprop="url" rel="index"><span itemprop="name">troubleshooting</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/git/" itemprop="url" rel="index"><span itemprop="name">git</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="GitLab简介"><span class="post-title-index">1.</span><a href="#GitLab简介" class="headerlink" title="GitLab简介"></a> GitLab简介</h1><p>GitLab是GitLab公司开发的基于Rails的开源存储库管理器。它是一个基于Web的git存储库管理器，允许团队协作编写、测试和部署应用程序。GitLab提供了多种功能，包括wiki、问题跟踪、代码审查和活动源。GitLab Inc提供5种产品：</p><ul><li>Gitlab CE（社区版）：自托管和免费，社区论坛的支持。</li><li>Gitlab EE（企业版）：自托管和付费，附带其他功能。</li><li>Gitlab JH（企业级中国发行版）：极狐，自托管和付费，附带其他功能。</li><li>GitLab.com：SaaS和免费。</li><li>GitLab.io：由GitLab Inc.管理的私有GitLab实例。</li></ul><p>在本文中，我们将在具有2GB RAM的CentOS7服务器上逐步安装GitLab CE（Community Edition），服务器IP为192.168.56.103。</p><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://www.howtoforge.com/tutorial/how-to-install-and-configure-gitlab-ce-on-centos-7/">How to Install and Configure GitLab CE on CentOS 7</a></li><li><a target="_blank" rel="noopener" href="https://www.tecmint.com/install-and-configure-gitlab-on-centos-7/">How to Install and Configure GitLab on CentOS 7</a></li><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/bigdevilking/p/9434444.html">CentOS 7 搭建CA认证中心实现https取证</a></li></ul><span id="more"></span><h1 id="环境准备"><span class="post-title-index">2.</span><a href="#环境准备" class="headerlink" title="环境准备"></a> 环境准备</h1><p>首先安装GitLab依赖的相关软件。</p><p>1、软件安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install curl policycoreutils openssh-server openssh-clients postfix</span><br></pre></td></tr></table></figure><p>2、postfix设置开机自启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl start postfix</span><br><span class="line">systemctl <span class="built_in">enable</span> postfix</span><br><span class="line">systemctl status postfix</span><br></pre></td></tr></table></figure><h1 id="安装GitLab"><span class="post-title-index">3.</span><a href="#安装GitLab" class="headerlink" title="安装GitLab"></a> 安装GitLab</h1><p>1、添加GitLab CE repository</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash</span><br></pre></td></tr></table></figure><p>2、安装gitlab</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gitlab-ce</span><br></pre></td></tr></table></figure><p>软件642M，需要下载一会，耐心等待，安装完成会出现提示。<br><img src="http://cdn.voidking.com/img/centos7-install-gitlab/result.jpg?imageView2/0/w/600"></p><p>3、配置gitlab url</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/gitlab/gitlab.rb</span><br></pre></td></tr></table></figure><p>修改external_url为：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">external_url &#x27;http://gitlab.voidking.com&#x27;</span><br></pre></td></tr></table></figure><p>这个配置的作用，当用户在gitlab项目页面点击Clone时，展示出的URL为 <code>http://gitlab.voidking.com/&lt;group&gt;/&lt;project&gt;.git</code></p><p>4、使gitlab配置生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure><p>但是，这个命令执行时间特别久，因此建议在安装的时候就指定external_url：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXTERNAL_URL=<span class="string">&quot;http://gitlab.voidking.com&quot;</span> yum -y install gitlab-ce</span><br></pre></td></tr></table></figure><p>5、开放端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-port=80/tcp --permanent</span><br><span class="line">firewall-cmd --add-port=443/tcp --permanent</span><br><span class="line">systemctl reload firewalld</span><br></pre></td></tr></table></figure><p>6、测试访问<br>已知gitlab主机IP为 192.169.56.103 ，浏览器访问 <a target="_blank" rel="noopener" href="http://192.169.56.103/">http://192.169.56.103</a> ，即可跳转到gitlab登录页面。<br><img src="http://cdn.voidking.com/img/centos7-install-gitlab/login.jpg?imageView2/0/w/600"><br>首次登录会提示重新修改密码。修改密码之后，使用 root 用户登录，即可进入 dashboard 管理页面。</p><h1 id="通过域名访问GitLab"><span class="post-title-index">4.</span><a href="#通过域名访问GitLab" class="headerlink" title="通过域名访问GitLab"></a> 通过域名访问GitLab</h1><h2 id="单机配置hosts"><span class="post-title-index">4.1.</span><a href="#单机配置hosts" class="headerlink" title="单机配置hosts"></a> 单机配置hosts</h2><p>修改同一局域网内某台设备的 /etc/hosts，添加：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.56.103  gitlab.voidking.com</span><br></pre></td></tr></table></figure><p>然后，这台设备就可以通过域名 <a target="_blank" rel="noopener" href="http://gitlab.voidking.com/">http://gitlab.voidking.com</a> 访问gitlab服务了。</p><h2 id="本地DNS配置域名解析"><span class="post-title-index">4.2.</span><a href="#本地DNS配置域名解析" class="headerlink" title="本地DNS配置域名解析"></a> 本地DNS配置域名解析</h2><p>本地DNS配置域名解析：gitlab.voidking.com -&gt; 192.168.56.103<br>然后，同一局域网内所有使用本地DNS的设备就可以通过域名 <a target="_blank" rel="noopener" href="http://gitlab.voidking.com/">http://gitlab.voidking.com</a> 访问gitlab服务了。</p><h1 id="使用GitLab"><span class="post-title-index">5.</span><a href="#使用GitLab" class="headerlink" title="使用GitLab"></a> 使用GitLab</h1><p>1、创建项目<br>Create a Project，Project name填入voidking，选择Public，勾选Initialize repository with a README。</p><p>2、clone项目</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.sslVerify <span class="literal">false</span></span><br><span class="line">git <span class="built_in">clone</span> https://gitlab.voidking.com/root/voidking.git</span><br></pre></td></tr></table></figure><p>3、上传代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加test.txt文件</span></span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;add new file&quot;</span></span><br><span class="line">git push</span><br></pre></td></tr></table></figure><p>查看项目，代码已经上传成功。<br><img src="http://cdn.voidking.com/img/centos7-install-gitlab/success.jpg?imageView2/0/w/600"></p><h1 id="配置HTTPS访问GitLab"><span class="post-title-index">6.</span><a href="#配置HTTPS访问GitLab" class="headerlink" title="配置HTTPS访问GitLab"></a> 配置HTTPS访问GitLab</h1><p>HTTPS(SSL/TLS)加密原理，参考文档<a href="https://www.voidking.com/dev-encryption-algorithm/">《浅谈数据加密》</a>。</p><h2 id="自建CA并颁发域名证书"><span class="post-title-index">6.1.</span><a href="#自建CA并颁发域名证书" class="headerlink" title="自建CA并颁发域名证书"></a> 自建CA并颁发域名证书</h2><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://ywnz.com/linuxyffq/4232.html">安装及使用mkcert在Linux和macOS中创建本地受信任的SSL证书</a></li><li><a target="_blank" rel="noopener" href="https://github.com/FiloSottile/mkcert">mkcert githut</a></li><li><a target="_blank" rel="noopener" href="https://www.yuanjies.com/?p=539">基于OpenSSL自建CA和颁发SSL证书</a></li><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/34788439">使用 OpenSSL 自建 CA 并签发证书</a></li></ul><p>本节中，安装mkcert并使用它生成本地SSL证书。</p><p>1、安装nss-tools工具</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install nss-tools</span><br></pre></td></tr></table></figure><p>2、下载二进制包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O mkcert https://github.com/FiloSottile/mkcert/releases/download/v1.3.0/mkcert-v1.3.0-linux-amd64</span><br></pre></td></tr></table></figure><p>3、添加执行权限并移入bin</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x  mkcert</span><br><span class="line"><span class="built_in">mv</span> mkcert /usr/local/bin</span><br></pre></td></tr></table></figure><p>4、获取CA根目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkcert -CAROOT</span><br></pre></td></tr></table></figure><p>5、安装本地CA</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkcert -install</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Using the local CA at &quot;/root/.local/share/mkcert&quot; ✨</span><br><span class="line">The local CA is now installed in the system trust store! ⚡</span><br><span class="line">ERROR: no Firefox and/or Chrome/Chromium security databases found</span><br><span class="line">The local CA is now installed in Java&#x27;s trust store! ☕</span><br></pre></td></tr></table></figure><p>6、生成证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkcert gitlab.voidking.com localhost 127.0.0.1</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Using the local CA at &quot;/root/.local/share/mkcert&quot; ✨</span><br><span class="line">Warning: the local CA is not installed in the Firefox and/or Chrome/Chromium trust store! ⚠</span><br><span class="line">Run &quot;mkcert -install&quot; to avoid verification errors ‼ </span><br><span class="line"></span><br><span class="line">Created a new certificate valid for the following names 📜</span><br><span class="line"> - &quot;gitlab.voidking.com&quot;</span><br><span class="line"> - &quot;localhost&quot;</span><br><span class="line"> - &quot;127.0.0.1&quot;</span><br><span class="line"></span><br><span class="line">The certificate is at &quot;./gitlab.voidking.com+2.pem&quot; and the key at &quot;./gitlab.voidking.com+2-key.pem&quot; ✅</span><br></pre></td></tr></table></figure><p>7、创建证书目录并且移动证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/gitlab/ssl/</span><br><span class="line"><span class="built_in">mv</span> gitlab.voidking.com* /etc/gitlab/ssl/</span><br></pre></td></tr></table></figure><h2 id="生成DHPARAM证书"><span class="post-title-index">6.2.</span><a href="#生成DHPARAM证书" class="headerlink" title="生成DHPARAM证书"></a> 生成DHPARAM证书</h2><p>1、使用OpenSSL生成DHPARAM证书pem文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl dhparam -out /etc/gitlab/ssl/dhparams.pem 2048</span><br></pre></td></tr></table></figure><p>2、将证书文件的权限更改为600</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 600 /etc/gitlab/ssl/dhparams.pem</span><br></pre></td></tr></table></figure><h2 id="使用域名证书和DHPARAM证书"><span class="post-title-index">6.3.</span><a href="#使用域名证书和DHPARAM证书" class="headerlink" title="使用域名证书和DHPARAM证书"></a> 使用域名证书和DHPARAM证书</h2><p>1、修改gitlab url</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/gitlab/gitlab.rb</span><br></pre></td></tr></table></figure><p>如下修改：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">external_url &#x27;https://gitlab.voidking.com&#x27;</span><br><span class="line">nginx[&#x27;redirect_http_to_https&#x27;] = true</span><br><span class="line">nginx[&#x27;ssl_certificate&#x27;] = &quot;/etc/gitlab/ssl/gitlab.voidking.com+2.pem&quot;</span><br><span class="line">nginx[&#x27;ssl_certificate_key&#x27;] = &quot;/etc/gitlab/ssl/gitlab.voidking.com+2-key.pem&quot;</span><br><span class="line">nginx[&#x27;ssl_dhparam&#x27;] = &quot;/etc/gitlab/ssl/dhparams.pem&quot;</span><br></pre></td></tr></table></figure><p>2、重新配置gitlab</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure><p>3、测试访问<br>服务器上测试，<code>curl localhost -L</code>，正常。<br>本地浏览器访问 <a target="_blank" rel="noopener" href="https://gitlab.voidking.com/users/sign_in">https://gitlab.voidking.com/users/sign_in</a> ，出现安全提示。<br><img src="http://cdn.voidking.com/img/centos7-install-gitlab/secret.jpg?imageView2/0/w/600"><br>这是因为浏览器不信任刚才自建的CA，解决办法是安装rootCA，更多内容参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/byg184244735/article/details/84433385">https 以及内网如何使用</a>。</p><p>4、下载rootCA.pem<br>从<code>/root/.local/share/mkcert</code>目录中下载 rootCA.pem 到本地。</p><p>5、添加证书信任<br>（1）Chrome添加证书信任<br>设置，高级设置，管理证书，导入，选择rootCA.pem，证书存储选择受信任的根证书颁发机构，完成，出现警告点确定。重启Chrome，再次访问就没有警告了。<br><img src="http://cdn.voidking.com/img/centos7-install-gitlab/safe.jpg?imageView2/0/w/600"></p><p>（2）Firefox添加证书新人<br>选项，隐私与安全，证书，查看证书，导入，选择rootCA.pem。重启Firefox，再次访问就没有警告了。</p><p>（3）Linux中添加证书信任<br>拷贝 rootCA.pem 到 <code>/etc/pki/ca-trust/source/anchors/</code> 目录，然后执行 <code>update-ca-trust</code></p><h1 id="错误排查"><span class="post-title-index">7.</span><a href="#错误排查" class="headerlink" title="错误排查"></a> 错误排查</h1><p>关闭服务器之后重启，发现无法访问gitlab服务。<br>1、关闭防火墙</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure><p>关闭防火墙之后，依然无法访问。</p><p>2、查看服务和端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep nginx</span><br><span class="line">netstat -nlpt | grep 80</span><br></pre></td></tr></table></figure><p>没有找到nginx服务，说明nginx出了问题。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl restart nginx</span><br></pre></td></tr></table></figure><p>无效，80端口依然没有监听。</p><p>3、查看gitlab日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl <span class="built_in">tail</span></span><br></pre></td></tr></table></figure><p>这次定位到了问题，缺少pem文件。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2019-08-06_09:26:08.31983 nginx: [emerg] BIO_new_file(&quot;/etc/gitlab/ssl/gitlab.voidking.com+2.pem&quot;) failed (SSL: error:02001002:system library:fopen:No such file or directory:fopen(&#x27;/etc/gitlab/ssl/gitlab.voidking.com+2.pem&#x27;,&#x27;r&#x27;) error:2006D080:BIO routines:BIO_new_file:no such file)</span><br></pre></td></tr></table></figure><p>查看/etc/gitlab/ssl/目录，发现gitlab.voidking.com+2.pem变成了gitlab.voidking.com+3.pem！虽然不知道为什么2变成了3，但是改回来应该就可以了。改回原文件名，问题解决。</p><h1 id="后记"><span class="post-title-index">8.</span><a href="#后记" class="headerlink" title="后记"></a> 后记</h1><p>至此，局域网的gitlab安装配置完成，可以正常使用了。</p><p>在公网环境下，HTTPS的配置更加简单，gitlab.rb 中配置证书颁发机构颁发的SSL证书即可。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>原文链接：</strong> <a href="https://www.voidking.com/dev-centos7-install-gitlab/" title="好好学GitLab：CentOS7安装配置GitLab">https://www.voidking.com/dev-centos7-install-gitlab/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本文采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议，转载请注明出处！源站会即时更新知识点并修正错误，欢迎访问~</li><li> <img width="200" height="200" src="/images/avatar.jpg"><p style="text-align:center;margin-bottom:0">微信公众号同步更新，欢迎关注~</p></li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/git/" rel="tag"># git</a> <a href="/tags/centos/" rel="tag"># centos</a> <a href="/tags/gitlab/" rel="tag"># gitlab</a> <a href="/tags/https/" rel="tag"># https</a> <a href="/tags/%E5%8A%A0%E5%AF%86/" rel="tag"># 加密</a> <a href="/tags/%E5%A5%BD%E5%A5%BD%E5%AD%A6GitLab/" rel="tag"># 好好学GitLab</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-elk-with-filebeat/" rel="prev" title="ELK配置FileBeat"><i class="fa fa-chevron-left"></i> ELK配置FileBeat</a></div><div class="post-nav-item"> <a href="/dev-centos7-install-jenkins/" rel="next" title="好好学Linux：CentOS7安装部署Jenkins">好好学Linux：CentOS7安装部署Jenkins<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3284447971731414" data-ad-slot="9697986181"></ins><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#GitLab%E7%AE%80%E4%BB%8B"><span class="nav-text">1. GitLab简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="nav-text">2. 环境准备</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85GitLab"><span class="nav-text">3. 安装GitLab</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AEGitLab"><span class="nav-text">4. 通过域名访问GitLab</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%95%E6%9C%BA%E9%85%8D%E7%BD%AEhosts"><span class="nav-text">4.1. 单机配置hosts</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0DNS%E9%85%8D%E7%BD%AE%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90"><span class="nav-text">4.2. 本地DNS配置域名解析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8GitLab"><span class="nav-text">5. 使用GitLab</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEHTTPS%E8%AE%BF%E9%97%AEGitLab"><span class="nav-text">6. 配置HTTPS访问GitLab</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%BB%BACA%E5%B9%B6%E9%A2%81%E5%8F%91%E5%9F%9F%E5%90%8D%E8%AF%81%E4%B9%A6"><span class="nav-text">6.1. 自建CA并颁发域名证书</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90DHPARAM%E8%AF%81%E4%B9%A6"><span class="nav-text">6.2. 生成DHPARAM证书</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%9F%9F%E5%90%8D%E8%AF%81%E4%B9%A6%E5%92%8CDHPARAM%E8%AF%81%E4%B9%A6"><span class="nav-text">6.3. 使用域名证书和DHPARAM证书</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E6%8E%92%E6%9F%A5"><span class="nav-text">7. 错误排查</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E8%AE%B0"><span class="nav-text">8. 后记</span></a></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">一个计算机技术爱好者与学习者</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">707</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">31</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">253</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: '2bde844555968fd96b14e6b9c4465d73',
      title: '好好学GitLab：CentOS7安装配置GitLab',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>