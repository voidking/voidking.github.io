<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.voidking.com/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="awk注意事项awk命令格式：awk [选项参数] &#39;script&#39; var&#x3D;value file(s) 这里需要特别注意的是，包裹script的是单引号，单引号，单引号！参考文档Linux awk 命令"><meta property="og:type" content="article"><meta property="og:title" content="shell命令之grep&#x2F;awk&#x2F;sed"><meta property="og:url" content="https://www.voidking.com/dev-shell-grep-awk-sed/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="awk注意事项awk命令格式：awk [选项参数] &#39;script&#39; var&#x3D;value file(s) 这里需要特别注意的是，包裹script的是单引号，单引号，单引号！参考文档Linux awk 命令"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2017-06-02T08:00:00.000Z"><meta property="article:modified_time" content="2022-12-12T15:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="问题排查"><meta property="article:tag" content="shell"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-shell-grep-awk-sed/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>shell命令之grep/awk/sed | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-shell-grep-awk-sed/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> shell命令之grep/awk/sed</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2017-06-02 08:00:00" itemprop="dateCreated datePublished" datetime="2017-06-02T08:00:00+00:00">2017-06-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-12-12 15:00:00" itemprop="dateModified" datetime="2022-12-12T15:00:00+00:00">2022-12-12</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/network/" itemprop="url" rel="index"><span itemprop="name">network</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/shell/" itemprop="url" rel="index"><span itemprop="name">shell</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/troubleshooting/" itemprop="url" rel="index"><span itemprop="name">troubleshooting</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="awk注意事项"><span class="post-title-index">.1.</span><a href="#awk注意事项" class="headerlink" title="awk注意事项"></a> awk注意事项</h2><p>awk命令格式：<br><code>awk [选项参数] &#39;script&#39; var=value file(s)</code></p><p>这里需要特别注意的是，包裹script的是单引号，单引号，单引号！<br>参考文档<a target="_blank" rel="noopener" href="https://www.runoob.com/linux/linux-comm-awk.html">Linux awk 命令</a></p><span id="more"></span><h2 id="删除空行"><span class="post-title-index">.2.</span><a href="#删除空行" class="headerlink" title="删除空行"></a> 删除空行</h2><p>过滤hostlist.txt中的空行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> hostlist.txt |<span class="built_in">tr</span> -s <span class="string">&#x27;\n&#x27;</span></span><br><span class="line"><span class="built_in">cat</span> hostlist.txt |sed <span class="string">&#x27;/^$/d&#x27;</span></span><br><span class="line"><span class="built_in">cat</span> hostlist.txt |awk <span class="string">&#x27;&#123;if($0!=&quot;&quot;)print&#125;&#x27;</span></span><br><span class="line"><span class="built_in">cat</span> hostlist.txt |awk <span class="string">&#x27;&#123;if(length!=0) print $0&#125;&#x27;</span></span><br><span class="line">grep -v <span class="string">&quot;^$&quot;</span> hostlist.txt</span><br><span class="line"><span class="comment"># 终极方法（linux和windows空行都适用）</span></span><br><span class="line">grep -v -e <span class="string">&#x27;^[[:space:]]*$&#x27;</span> hostlist.txt</span><br></pre></td></tr></table></figure><h2 id="过滤windows换行符"><span class="post-title-index">.3.</span><a href="#过滤windows换行符" class="headerlink" title="过滤windows换行符"></a> 过滤windows换行符</h2><p>在windows里编辑好的文件，上传到linux后发现多了^M。以过滤hostlist.txt中的^M为例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/^M//g&#x27;</span> hostlist.txt</span><br></pre></td></tr></table></figure><p>注意，直接复制粘贴上面的命令是无效的。^M的输入方式是 Ctrl + V ，然后 Ctrl + M 。</p><h2 id="去除空格"><span class="post-title-index">.4.</span><a href="#去除空格" class="headerlink" title="去除空格"></a> 去除空格</h2><p>去除test.txt文本中的空格：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> test.txt | <span class="built_in">tr</span> -d <span class="string">&#x27; &#x27;</span></span><br></pre></td></tr></table></figure><h2 id="空格转换行"><span class="post-title-index">.5.</span><a href="#空格转换行" class="headerlink" title="空格转换行"></a> 空格转换行</h2><p>把test.txt文本中的空格变成换行符。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> test.txt | <span class="built_in">tr</span> <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;\n&#x27;</span></span><br><span class="line"><span class="built_in">cat</span> test.txt | sed <span class="string">&#x27;s/ /\n/g&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="查找并插入一行"><span class="post-title-index">.6.</span><a href="#查找并插入一行" class="headerlink" title="查找并插入一行"></a> 查找并插入一行</h2><p>查找包含<code>- [engineering,subject0]</code>的文件，<code>- [engineering,subject0]</code>之后紧接着插入一行<code>- [engineering,subject1]</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/- \[engineering,subject0\]/- \[engineering,subject0\]\n- \[engineering,subject1\]/g&#x27;</span> *</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;s/- \[engineering,subject0\]/- \[engineering,subject0\]\n- \[engineering,subject1\]/g&#x27;</span> `grep -e <span class="string">&#x27;- \[engineering,subject0\]&#x27;</span> -rl .`</span><br></pre></td></tr></table></figure><h2 id="大小写字符转换"><span class="post-title-index">.7.</span><a href="#大小写字符转换" class="headerlink" title="大小写字符转换"></a> 大小写字符转换</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 大写转小写</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;192.168.56.101 MASTER&quot;</span> | <span class="built_in">tr</span> <span class="string">&#x27;[A-Z]&#x27;</span> <span class="string">&#x27;[a-z]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 小写转大写</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;192.168.56.101 master&quot;</span> | <span class="built_in">tr</span> <span class="string">&#x27;[a-z]&#x27;</span> <span class="string">&#x27;[A-Z]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 某一列大写转小写</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;192.168.56.101 MASTER&quot;</span> | awk <span class="string">&#x27;$3=tolower($2) &#123;print $1&quot; &quot;$2&quot; &quot;$3&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 某一列小写转大写</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;192.168.56.101 master&quot;</span> | awk <span class="string">&#x27;$3=toupper($2) &#123;print $1&quot; &quot;$2&quot; &quot;$3&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>PS：对于<code>/etc/hosts</code>中的主机名和域名，只保留大写或者只保留小写就可以了，因为主机名和域名不区分大小写。</p><h2 id="读取某一列"><span class="post-title-index">.8.</span><a href="#读取某一列" class="headerlink" title="读取某一列"></a> 读取某一列</h2><p>读取第一列，读取最后一列。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;www.voidking.com&quot;</span> | awk -F<span class="string">&#x27;.&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;www.voidking.com&quot;</span> | awk -F<span class="string">&#x27;.&#x27;</span> <span class="string">&#x27;&#123;print $3&#125;&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;www.voidking.com&quot;</span> | awk -F<span class="string">&#x27;.&#x27;</span> <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="第一列换到最后一列"><span class="post-title-index">.9.</span><a href="#第一列换到最后一列" class="headerlink" title="第一列换到最后一列"></a> 第一列换到最后一列</h2><p>已知namelist.txt：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">haojin</span> <span class="number">70</span> <span class="number">80</span></span><br><span class="line"><span class="attribute">voidking</span> <span class="number">90</span> <span class="number">100</span></span><br></pre></td></tr></table></figure><p>需求：第一列name，在显示时放到最后一列。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> namelist.txt | awk <span class="string">&#x27;&#123;for(i=2;i&lt;=NF;i++)printf(&quot;%s &quot;, $i);print $1&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="循环读取单列文本"><span class="post-title-index">.10.</span><a href="#循环读取单列文本" class="headerlink" title="循环读取单列文本"></a> 循环读取单列文本</h2><p>已知hostlist.txt为：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">www<span class="selector-class">.baidu</span><span class="selector-class">.com</span></span><br><span class="line">www<span class="selector-class">.voidking</span>.com</span><br></pre></td></tr></table></figure><p>需求：批量查询主机名或者主机IP</p><p>脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">cat</span> hostlist.txt`;<span class="keyword">do</span> host <span class="variable">$i</span>;<span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="文本比较"><span class="post-title-index">.11.</span><a href="#文本比较" class="headerlink" title="文本比较"></a> 文本比较</h2><p>需求：两个姓名列表，需要对比出两个文件中相同的姓名和不同的姓名。</p><p>脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> file1 &gt; file.txt</span><br><span class="line"><span class="built_in">cat</span> file2 &gt;&gt; file.txt</span><br><span class="line"><span class="built_in">cat</span> file.txt | <span class="built_in">sort</span> |<span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -n &gt; result.txt</span><br></pre></td></tr></table></figure><h2 id="联合查询"><span class="post-title-index">.12.</span><a href="#联合查询" class="headerlink" title="联合查询"></a> 联合查询</h2><p>使用shell，能否实现类似于SQL的联合查询？必须可以。</p><p>已知file1的内容为：</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1 </span>realname</span><br><span class="line"><span class="symbol">2 </span>nickname</span><br></pre></td></tr></table></figure><p>file2的内容为：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">void</span>king nickname</span><br><span class="line">haojin realname</span><br><span class="line">hankin nickname</span><br><span class="line">jinhao realname</span><br><span class="line">vk nickname  </span><br></pre></td></tr></table></figure><p>需求：根据file1和file2的第二列，把file1和file2合并成一个文件。</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">2 </span>voidking nickname</span><br><span class="line"><span class="symbol">1 </span>haojin realname</span><br><span class="line"><span class="symbol">2 </span>hankin nickname</span><br><span class="line"><span class="symbol">1 </span>jinhao realname</span><br><span class="line"><span class="symbol">2 </span>vk nickname</span><br></pre></td></tr></table></figure><p>这个需求使用awk命令来实现。<br>NR，表示awk开始执行程序后所读取的数据行数。<br>FNR，与NR功用类似，不同的是awk每打开一个新文件，FNR便从0重新累计。<br>NR==FNR：用于在读取两个或两个以上的文件时，判断是不是在读取第一个文件。<br>awk处理多个文件的语法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F 分隔符 <span class="string">&#x27;BEGIN &#123; 初始化 &#125; &#123; 循环执行部分 &#125; END &#123; 结束处理 &#125;&#x27;</span> file_list1 file_list2</span><br></pre></td></tr></table></figure><p>其中BEGIN和END可以省略，-F也可以使用默认，循环执行部分，是按行对文件进行处理的。</p><p>脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk -F <span class="string">&quot; &quot;</span> <span class="string">&#x27;NR==FNR&#123;a[$2]=$0;next&#125;&#123;print a[$2]&quot; &quot;$1&#125;&#x27;</span> file1 file2 \</span><br><span class="line">| awk <span class="string">&#x27;&#123;print $1&quot; &quot;$3&quot; &quot;$2&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>由NR=FNR为真时，判断当前读入的是第一个文件file1，执行第一个花括号内的内容。<br>把file1中每行记录都存入数组a，并使用file1的第2个字段作为下标。</p><p>由NR=FNR为假时，判断当前读入了第二个文件file2，执行第二个花括号内的内容。<br>file2中的每行，根据file2的第2个字段打印数组a中的内容，同时打印file2中的第一列。</p><h2 id="求交集"><span class="post-title-index">.13.</span><a href="#求交集" class="headerlink" title="求交集"></a> 求交集</h2><p>已知file1内容为：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">haojin</span><br><span class="line"><span class="built_in">void</span>king</span><br><span class="line">vk</span><br></pre></td></tr></table></figure><p>file2内容为：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">haoshuai</span> <span class="number">95</span> <span class="number">93</span> <span class="number">80</span></span><br><span class="line"><span class="attribute">vk</span> <span class="number">99</span> <span class="number">99</span> <span class="number">100</span></span><br><span class="line"><span class="attribute">haojin</span> <span class="number">100</span> <span class="number">100</span> <span class="number">99</span></span><br><span class="line"><span class="attribute">baidu</span> <span class="number">100</span> <span class="number">100</span> <span class="number">100</span></span><br><span class="line"><span class="attribute">voidking</span> <span class="number">99</span> <span class="number">99</span> <span class="number">99</span></span><br></pre></td></tr></table></figure><p>需求：file1第一列和file2第一列求交集，显示file2中交集的内容。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;&#123;if(NR==FNR)&#123;a[$1]=$1&#125;else if($1 in a)&#123;print $0&#125;&#125;&#x27;</span> file1 file2</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">awk <span class="string">&#x27;&#123;if(NR==FNR)a[$1]=$1;else if($1 in a)print $0&#125;&#x27;</span> file1 file2</span><br></pre></td></tr></table></figure><h2 id="每两行合成一行"><span class="post-title-index">.14.</span><a href="#每两行合成一行" class="headerlink" title="每两行合成一行"></a> 每两行合成一行</h2><p>已知ip-port.txt内容为：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1</span></span><br><span class="line"><span class="number">80</span></span><br><span class="line"><span class="number">127.0.0.1</span></span><br><span class="line"><span class="number">8080</span></span><br><span class="line"><span class="number">192.168.56.101</span></span><br><span class="line"><span class="number">3306</span></span><br></pre></td></tr></table></figure><p>需求：把ip和对应端口放在同一行。</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1</span> <span class="number">80</span></span><br><span class="line"><span class="number">127.0.0.1</span> <span class="number">8080</span></span><br><span class="line"><span class="number">192.168.56.101</span> <span class="number">3306</span></span><br></pre></td></tr></table></figure><p>脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&quot;N;s/\n/ /p&quot;</span> ip-port.txt</span><br><span class="line">awk <span class="string">&#x27;NR%2&#123;printf &quot;%s &quot;,$0;next;&#125;1&#x27;</span> ip-port.txt</span><br><span class="line">awk <span class="string">&#x27;ORS=NR%2?FS:RS&#x27;</span> ip-port.txt</span><br><span class="line">awk <span class="string">&#x27;&#123; ORS = (NR%2 ? FS : RS) &#125; 1&#x27;</span> ip-port.txt</span><br><span class="line">awk <span class="string">&#x27;&#123; ORS = (NR%2 ? &quot;,&quot; : RS) &#125; 1&#x27;</span> ip-port.txt</span><br></pre></td></tr></table></figure><h2 id="计算一列的和"><span class="post-title-index">.15.</span><a href="#计算一列的和" class="headerlink" title="计算一列的和"></a> 计算一列的和</h2><p>已知fruit.txt内容为：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">apple</span> <span class="number">10</span></span><br><span class="line"><span class="attribute">orange</span> <span class="number">7</span></span><br><span class="line"><span class="attribute">banana</span> <span class="number">0</span></span><br><span class="line"><span class="attribute">watermelon</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>第一列是水果名称，第二列是水果数量。</p><p>需求1：计算水果的总数。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;&#123;sum += $2&#125;;END &#123;print sum&#125;&#x27;</span> fruit.txt</span><br><span class="line"><span class="built_in">cat</span> fruit.txt | awk <span class="string">&#x27;&#123;sum += $2&#125;;END &#123;print sum&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>需求2：计算存在多少种水果。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> fruit.txt | awk <span class="string">&#x27;&#123;if ($2&gt;0) (sum += 1); else (sum += 0)&#125;;END&#123;print sum&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="根据时间筛选日志"><span class="post-title-index">.16.</span><a href="#根据时间筛选日志" class="headerlink" title="根据时间筛选日志"></a> 根据时间筛选日志</h2><p>筛选11月10日和11月11日的14:30到18:00的日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grep -E <span class="string">&#x27;1[0,1]/Nov/2022:14:[3,4,5][0-9]|1[0,1]/Nov/2022:1[5-7]|1[0,1]/Nov/2022:18:00&#x27;</span> access.log</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">grep -E <span class="string">&#x27;10/Nov/2022&#x27;</span> access.log | sed -n <span class="string">&#x27;/2022:14:30/,/2022:18:00/p&#x27;</span> &gt; tmp.log</span><br><span class="line">grep -E <span class="string">&#x27;11/Nov/2022&#x27;</span> access.log | sed -n <span class="string">&#x27;/2022:14:30/,/2022:18:00/p&#x27;</span> &gt;&gt; tmp.log</span><br></pre></td></tr></table></figure><p>grep筛选出的日志，包含18:00:00-18:00:59内的日志。<br>sed筛选出的日志，只包含第一个匹配上2022:18:00的日志，不包含18:00:00-18:00:59内的日志。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-shell-grep-awk-sed/" title="shell命令之grep&#x2F;awk&#x2F;sed">https://www.voidking.com/dev-shell-grep-awk-sed/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/" rel="tag"># 问题排查</a> <a href="/tags/shell/" rel="tag"># shell</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-shell-journalctl/" rel="prev" title="shell命令之journalctl"><i class="fa fa-chevron-left"></i> shell命令之journalctl</a></div><div class="post-nav-item"> <a href="/dev-shell-file/" rel="next" title="shell命令之文件管理">shell命令之文件管理<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3284447971731414" data-ad-slot="9697986181"></ins><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#awk%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-text">.1. awk注意事项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E7%A9%BA%E8%A1%8C"><span class="nav-text">.2. 删除空行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4windows%E6%8D%A2%E8%A1%8C%E7%AC%A6"><span class="nav-text">.3. 过滤windows换行符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8E%BB%E9%99%A4%E7%A9%BA%E6%A0%BC"><span class="nav-text">.4. 去除空格</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A9%BA%E6%A0%BC%E8%BD%AC%E6%8D%A2%E8%A1%8C"><span class="nav-text">.5. 空格转换行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E6%89%BE%E5%B9%B6%E6%8F%92%E5%85%A5%E4%B8%80%E8%A1%8C"><span class="nav-text">.6. 查找并插入一行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E5%B0%8F%E5%86%99%E5%AD%97%E7%AC%A6%E8%BD%AC%E6%8D%A2"><span class="nav-text">.7. 大小写字符转换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%BB%E5%8F%96%E6%9F%90%E4%B8%80%E5%88%97"><span class="nav-text">.8. 读取某一列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E5%88%97%E6%8D%A2%E5%88%B0%E6%9C%80%E5%90%8E%E4%B8%80%E5%88%97"><span class="nav-text">.9. 第一列换到最后一列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BE%AA%E7%8E%AF%E8%AF%BB%E5%8F%96%E5%8D%95%E5%88%97%E6%96%87%E6%9C%AC"><span class="nav-text">.10. 循环读取单列文本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E6%9C%AC%E6%AF%94%E8%BE%83"><span class="nav-text">.11. 文本比较</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="nav-text">.12. 联合查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B1%82%E4%BA%A4%E9%9B%86"><span class="nav-text">.13. 求交集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AF%8F%E4%B8%A4%E8%A1%8C%E5%90%88%E6%88%90%E4%B8%80%E8%A1%8C"><span class="nav-text">.14. 每两行合成一行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E4%B8%80%E5%88%97%E7%9A%84%E5%92%8C"><span class="nav-text">.15. 计算一列的和</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%B9%E6%8D%AE%E6%97%B6%E9%97%B4%E7%AD%9B%E9%80%89%E6%97%A5%E5%BF%97"><span class="nav-text">.16. 根据时间筛选日志</span></a></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">650</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">29</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">242</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: '9742720430d88939a9f57ec20dd5c95b',
      title: 'shell命令之grep/awk/sed',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>