<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言本文中会整理一些工作学习中常用的virsh命令，备忘。 参考文档：  libvirt Domain XML format libguestfs virt-builder virsh常用命令篇 KVM 虚拟机 XML 配置文件详解"><meta property="og:type" content="article"><meta property="og:title" content="virsh常用命令"><meta property="og:url" content="https://www.voidking.com/dev-virsh-command/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言本文中会整理一些工作学习中常用的virsh命令，备忘。 参考文档：  libvirt Domain XML format libguestfs virt-builder virsh常用命令篇 KVM 虚拟机 XML 配置文件详解"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2018-12-21T11:30:00.000Z"><meta property="article:modified_time" content="2023-02-07T18:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="libvirt"><meta property="article:tag" content="virsh"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-virsh-command/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>virsh常用命令 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-virsh-command/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> virsh常用命令</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-12-21 11:30:00" itemprop="dateCreated datePublished" datetime="2018-12-21T11:30:00+00:00">2018-12-21</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2023-02-07 18:00:00" itemprop="dateModified" datetime="2023-02-07T18:00:00+00:00">2023-02-07</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本文中会整理一些工作学习中常用的virsh命令，备忘。</p><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://libvirt.org/">libvirt</a></li><li><a target="_blank" rel="noopener" href="https://libvirt.org/formatdomain.html">Domain XML format</a></li><li><a target="_blank" rel="noopener" href="https://libguestfs.org/">libguestfs</a></li><li><a target="_blank" rel="noopener" href="https://libguestfs.org/virt-builder.1.html">virt-builder</a></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39730587/article/details/111857013">virsh常用命令篇</a></li><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/liujunjun/p/14672328.html">KVM 虚拟机 XML 配置文件详解</a></li></ul><span id="more"></span><h1 id="创建虚拟机"><a href="#创建虚拟机" class="headerlink" title="创建虚拟机"></a>创建虚拟机</h1><p>本节以创建ubuntu18.04.6的虚拟机为例，ubuntu镜像下载地址为<a target="_blank" rel="noopener" href="https://releases.ubuntu.com/">Ubuntu Release</a></p><h2 id="常规创建"><a href="#常规创建" class="headerlink" title="常规创建"></a>常规创建</h2><p>1、下载镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/iso/</span><br><span class="line">wget https://releases.ubuntu.com/18.04.6/ubuntu-18.04.6-live-server-amd64.iso</span><br></pre></td></tr></table></figure><p>2、创建虚拟机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">virt-install \</span><br><span class="line">    --virt-type=kvm \</span><br><span class="line">    --name=ubuntu18.04 \</span><br><span class="line">    --vcpus=2 \</span><br><span class="line">    --ram=4096 \</span><br><span class="line">    --cdrom=/opt/iso/ubuntu-18.04.6-live-server-amd64.iso \</span><br><span class="line">    --disk path=/opt/kvm/ubuntu18.04.qcow2,device=disk,format=qcow2,bus=virtio,cache=writeback,size=100 \</span><br><span class="line">    --network default,model=virtio \</span><br><span class="line">    --os-type=linux \</span><br><span class="line">    --os-variant=ubuntu18.04 \</span><br><span class="line">    --graphics vnc,listen=0.0.0.0 \</span><br><span class="line">    --noautoconsole \</span><br><span class="line">    --accelerate</span><br></pre></td></tr></table></figure><p><code>model=virtio</code> 可以换成 <code>model=e1000</code>或者<code>model=rtl8139</code>。<br>但是这里建议使用virtio，因为使用virtio要比使用e1000或者rtl8139网络吞吐性能要高出2倍左右。</p><p>详情参考：</p><ul><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/41258581">QEMU新的-nic选项</a></li><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/tcicy/p/10193614.html">KVM总结-KVM性能优化之网络性能优化</a></li></ul><p>3、查看虚拟机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">virsh list</span><br><span class="line">virsh list --all</span><br></pre></td></tr></table></figure><p>4、查看vnc端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh vncdisplay ubuntu18.04</span><br></pre></td></tr></table></figure><p>使用vnc client连接虚拟机完成安装。</p><h2 id="单独创建磁盘"><a href="#单独创建磁盘" class="headerlink" title="单独创建磁盘"></a>单独创建磁盘</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">qemu-img create -f qcow2 /opt/kvm/ubuntu18.04.qcow2  100G</span><br><span class="line"></span><br><span class="line">virt-install --disk path=/opt/kvm/ubuntu18.04.qcow2 ...</span><br></pre></td></tr></table></figure><h2 id="使用桥接"><a href="#使用桥接" class="headerlink" title="使用桥接"></a>使用桥接</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br><span class="line">ip a</span><br><span class="line"></span><br><span class="line">virt-install --network bridge=br0,model=virtio ...</span><br></pre></td></tr></table></figure><h1 id="查看虚拟机IP"><a href="#查看虚拟机IP" class="headerlink" title="查看虚拟机IP"></a>查看虚拟机IP</h1><p>方法一：通过VNC登录虚拟机后查看</p><p>方法二：通过mac地址查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.56.0/24</span><br><span class="line">virsh dumpxml ubuntu18.04 | grep <span class="string">&quot;mac a&quot;</span></span><br><span class="line">arp -a | grep grep <span class="string">&quot;52:54:00:46:98:a7&quot;</span></span><br><span class="line"><span class="built_in">cat</span> /proc/net/arp | grep <span class="string">&quot;52:54:00:46:98:a7&quot;</span></span><br></pre></td></tr></table></figure><h1 id="网络优化"><a href="#网络优化" class="headerlink" title="网络优化"></a>网络优化</h1><p>vhost-net是对virtio的优化，在内核中加入了vhost-net.ko模块，使得对网络数据可以在内核态得到处理。<br>数据包从虚拟网卡出来后，直接跳到内核那一层中。这里要注意的是，如果要使用vhost-net那么，虚拟机的网卡类型必须是virtio。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">virsh destroy ubuntu18.04</span><br><span class="line">virsh edit ubuntu18.04</span><br></pre></td></tr></table></figure><p>添加dirver配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">interface</span> <span class="attr">type</span>=<span class="string">&#x27;bridge&#x27;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mac</span> <span class="attr">address</span>=<span class="string">&#x27;52:54:00:46:98:a7&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">bridge</span>=<span class="string">&#x27;br0&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">model</span> <span class="attr">type</span>=<span class="string">&#x27;virtio&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">driver</span> <span class="attr">name</span>=<span class="string">&#x27;vhost&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">&#x27;pci&#x27;</span> <span class="attr">domain</span>=<span class="string">&#x27;0x0000&#x27;</span> <span class="attr">bus</span>=<span class="string">&#x27;0x00&#x27;</span> <span class="attr">slot</span>=<span class="string">&#x27;0x03&#x27;</span> <span class="attr">function</span>=<span class="string">&#x27;0x0&#x27;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interface</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="修改虚拟机配置"><a href="#修改虚拟机配置" class="headerlink" title="修改虚拟机配置"></a>修改虚拟机配置</h1><h2 id="安装virt-customize"><a href="#安装virt-customize" class="headerlink" title="安装virt-customize"></a>安装virt-customize</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install libguestfs-tools</span><br></pre></td></tr></table></figure><h2 id="关闭虚拟机"><a href="#关闭虚拟机" class="headerlink" title="关闭虚拟机"></a>关闭虚拟机</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh shutdown ubuntu18.04</span><br></pre></td></tr></table></figure><p>在使用virt-customize修改虚拟机配置之前，需要先关闭虚拟机，否则修改不会生效，还可能发生非预期问题。</p><h2 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virt-customize -a /opt/kvm/ubuntu18.04.qcow2 --hostname node01</span><br></pre></td></tr></table></figure><h2 id="启用root-ssh登录"><a href="#启用root-ssh登录" class="headerlink" title="启用root ssh登录"></a>启用root ssh登录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virt-customize -a /opt/kvm/ubuntu18.04.qcow2 --run-command <span class="string">&#x27;echo &quot;PermitRootLogin yes&quot; &gt;&gt; /etc/ssh/sshd_config&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="修改root密码"><a href="#修改root密码" class="headerlink" title="修改root密码"></a>修改root密码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">virt-customize -a /opt/kvm/ubuntu18.04.qcow2 --root-password password:voidking</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">virt-customize -a /opt/kvm/ubuntu18.04.qcow2 --password root:voidking</span><br></pre></td></tr></table></figure><h2 id="添加authorized-keys"><a href="#添加authorized-keys" class="headerlink" title="添加authorized_keys"></a>添加authorized_keys</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virt-customize -a /opt/kvm/ubuntu18.04.qcow2 --ssh-inject root:string:<span class="string">&quot;ssh-rsa xxx vk@macpro.lan&quot;</span></span><br></pre></td></tr></table></figure><h2 id="安装软件包"><a href="#安装软件包" class="headerlink" title="安装软件包"></a>安装软件包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">virt-customize -a /opt/kvm/ubuntu18.04.qcow2 --install vim,wget,curl,unzip</span><br><span class="line">virt-customize -v -x -a /opt/kvm/ubuntu18.04.qcow2 --install vim,wget,curl,unzip</span><br></pre></td></tr></table></figure><h2 id="手动配置静态IP"><a href="#手动配置静态IP" class="headerlink" title="手动配置静态IP"></a>手动配置静态IP</h2><p>ubuntu18之前在<code>/etc/network/interfaces</code>进行配置，ubuntu18及之后版本在<code>/etc/netplan/*.yaml</code>中进行配置。</p><p>提前手动配置好一台虚拟机的静态IP，然后，其他的克隆出来的主机可以使用virt-customize调用sed命令修改IP。</p><p>1、查看当前网关</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">route -n</span><br><span class="line">ip route</span><br><span class="line">netstat -rn</span><br></pre></td></tr></table></figure><p>2、配置静态IP<br>配置 /etc/netplan/00-installer-config.yaml 内容为：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This is the network config written by &#x27;subiquity&#x27;</span></span><br><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">ens3:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">false</span>                         <span class="comment"># 禁止动态IP</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="number">192.168</span><span class="number">.56</span><span class="number">.200</span><span class="string">/24</span>]       <span class="comment"># IP地址和掩码</span></span><br><span class="line">      <span class="attr">gateway4:</span> <span class="number">192.168</span><span class="number">.56</span><span class="number">.1</span>               <span class="comment"># 网关</span></span><br><span class="line">      <span class="attr">nameservers:</span></span><br><span class="line">        <span class="attr">addresses:</span> [<span class="number">192.168</span><span class="number">.56</span><span class="number">.1</span>,<span class="number">114.114</span><span class="number">.114</span><span class="number">.114</span>]   <span class="comment">#DNS服务器</span></span><br></pre></td></tr></table></figure><p>3、使配置生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netplan apply</span><br><span class="line">ip a</span><br></pre></td></tr></table></figure><h2 id="手动配置静态IP2-0"><a href="#手动配置静态IP2-0" class="headerlink" title="手动配置静态IP2.0"></a>手动配置静态IP2.0</h2><p>1、提前准备 00-installer-config.yaml 内容为：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This is the network config written by &#x27;subiquity&#x27;</span></span><br><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">ens3:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">false</span>                         <span class="comment"># 禁止动态IP</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="number">192.168</span><span class="number">.56</span><span class="number">.200</span><span class="string">/24</span>]       <span class="comment"># IP地址和掩码</span></span><br><span class="line">      <span class="attr">gateway4:</span> <span class="number">192.168</span><span class="number">.56</span><span class="number">.1</span>               <span class="comment"># 网关</span></span><br><span class="line">      <span class="attr">nameservers:</span></span><br><span class="line">        <span class="attr">addresses:</span> [<span class="number">192.168</span><span class="number">.56</span><span class="number">.1</span>,<span class="number">114.114</span><span class="number">.114</span><span class="number">.114</span>]   <span class="comment">#DNS服务器</span></span><br></pre></td></tr></table></figure><p>2、拷贝到宿主机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virt-customize -a /opt/kvm/ubuntu18.04.qcow2 --copy-in 00-installer-config.yaml:/etc/netplan/00-installer-config.yaml</span><br></pre></td></tr></table></figure><h2 id="自动配置静态IP"><a href="#自动配置静态IP" class="headerlink" title="自动配置静态IP"></a>自动配置静态IP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virt-customize -a /opt/kvm/ubuntu18.04.qcow2 --run-command <span class="string">&quot;sed -i \&quot;s#addresses: \[.*/24\]#addresses: \[192.168.56.201/24\]#\&quot; /etc/netplan/00-installer-config.yaml&quot;</span></span><br></pre></td></tr></table></figure><h1 id="启停虚拟机"><a href="#启停虚拟机" class="headerlink" title="启停虚拟机"></a>启停虚拟机</h1><p>1、停止虚拟机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># smooth shutdown</span></span><br><span class="line">virsh shutdown ubuntu18.04</span><br><span class="line"><span class="comment"># forced shutdown</span></span><br><span class="line">virsh destroy ubuntu18.04</span><br></pre></td></tr></table></figure><p>2、开启虚拟机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh start ubuntu18.04</span><br></pre></td></tr></table></figure><h1 id="销毁虚拟机"><a href="#销毁虚拟机" class="headerlink" title="销毁虚拟机"></a>销毁虚拟机</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">virsh list --all</span><br><span class="line">virsh destroy ubuntu18.04</span><br><span class="line">virsh snapshot-list ubuntu18.04</span><br><span class="line">virsh snapshot-delete ubuntu18.04 1627446728</span><br><span class="line">virsh undefine ubuntu18.04</span><br><span class="line"><span class="comment">#rm /etc/libvirt/qemu/ubuntu18.04.xml</span></span><br><span class="line"><span class="built_in">rm</span> /opt/kvm/ubuntu18.04.qcow2</span><br></pre></td></tr></table></figure><h1 id="开机自动启动"><a href="#开机自动启动" class="headerlink" title="开机自动启动"></a>开机自动启动</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">virsh autostart ubuntu18.04</span><br><span class="line">virsh autostart --<span class="built_in">disable</span> ubuntu18.04</span><br></pre></td></tr></table></figure><h1 id="调整虚拟机CPU和内存"><a href="#调整虚拟机CPU和内存" class="headerlink" title="调整虚拟机CPU和内存"></a>调整虚拟机CPU和内存</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">virsh destroy ubuntu18.04</span><br><span class="line">virsh edit ubuntu18.04</span><br></pre></td></tr></table></figure><p>调整相关配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">memory</span> <span class="attr">unit</span>=<span class="string">&#x27;KiB&#x27;</span>&gt;</span>4194304<span class="tag">&lt;/<span class="name">memory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">currentMemory</span> <span class="attr">unit</span>=<span class="string">&#x27;KiB&#x27;</span>&gt;</span>4194304<span class="tag">&lt;/<span class="name">currentMemory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">vcpu</span> <span class="attr">placement</span>=<span class="string">&#x27;static&#x27;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">vcpu</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里需要注意的是，vcpu的最小值是1，详情参考<a target="_blank" rel="noopener" href="https://libvirt.org/formatdomain.html#cpu-allocation">CPU Allocation</a></p><h1 id="根据xml导出创建虚拟机的命令"><a href="#根据xml导出创建虚拟机的命令" class="headerlink" title="根据xml导出创建虚拟机的命令"></a>根据xml导出创建虚拟机的命令</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">virsh list --all</span><br><span class="line">virsh dumpxml ubuntu18.04 &gt; ubuntu18.04.xml</span><br></pre></td></tr></table></figure><h1 id="克隆虚拟机"><a href="#克隆虚拟机" class="headerlink" title="克隆虚拟机"></a>克隆虚拟机</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">virt-clone -o ubuntu18.04 -n ubuntu18.04-tmp -f /opt/kvm/ubuntu18.04-tmp.qcow2</span><br><span class="line">virsh dominfo ubuntu18.04-tmp</span><br><span class="line">virsh domstate ubuntu18.04-tmp</span><br></pre></td></tr></table></figure><h1 id="拷贝虚拟机到其他宿主机"><a href="#拷贝虚拟机到其他宿主机" class="headerlink" title="拷贝虚拟机到其他宿主机"></a>拷贝虚拟机到其他宿主机</h1><p>1、拷贝虚拟机磁盘文件和配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp /opt/kvm/ubuntu18.04.qcow2 192.168.56.102:/opt/kvm/ubuntu18.04.qcow2</span><br><span class="line">scp /etc/libvirt/qemu/ubuntu18.04.xml 192.168.56.102:/etc/libvirt/qemu/ubuntu18.04.xml</span><br></pre></td></tr></table></figure><p>2、拉起虚拟机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh 192.168.56.102</span><br><span class="line">virsh define /etc/libvirt/qemu/ubuntu18.04.xml</span><br><span class="line">virsh list --all</span><br><span class="line">virsh start ubuntu18.04</span><br></pre></td></tr></table></figure><p>PS：临时拉起虚拟机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh create /etc/libvirt/qemu/ubuntu18.04.xml</span><br></pre></td></tr></table></figure><h1 id="虚拟机迁移"><a href="#虚拟机迁移" class="headerlink" title="虚拟机迁移"></a>虚拟机迁移</h1><p>参考文档<a href="https://www.voidking.com/dev-libvirt-vm-live-migration/">《使用Libvirt进行虚拟机在线迁移》</a></p><h1 id="虚拟机扩容磁盘"><a href="#虚拟机扩容磁盘" class="headerlink" title="虚拟机扩容磁盘"></a>虚拟机扩容磁盘</h1><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/362/53364">裸数据盘扩展文件系统</a></li><li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/362/54127">在线扩展数据盘分区及文件系统</a></li></ul><h2 id="给虚拟机增加磁盘"><a href="#给虚拟机增加磁盘" class="headerlink" title="给虚拟机增加磁盘"></a>给虚拟机增加磁盘</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">virsh shutdown ubuntu18.04-tmp</span><br><span class="line">virsh domblklist ubuntu18.04-tmp</span><br><span class="line">qemu-img info /opt/kvm/ubuntu18.04-tmp.qcow2</span><br><span class="line">qemu-img resize /opt/kvm/ubuntu18.04-tmp.qcow2 +20G</span><br></pre></td></tr></table></figure><p>PS：qcow2镜像不支持缩容。</p><p>如果给虚拟机增加磁盘后，虚拟机启动时报错：<br>qcow2: Image is corrupt; cannot be opened read/write</p><p>那么说明磁盘出现问题，修复方法如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qemu-img check /opt/kvm/ubuntu18.04-tmp.qcow2</span><br><span class="line">qemu-img check -r all /opt/kvm/ubuntu18.04-tmp.qcow2</span><br></pre></td></tr></table></figure><h2 id="扩容分区和文件系统"><a href="#扩容分区和文件系统" class="headerlink" title="扩容分区和文件系统"></a>扩容分区和文件系统</h2><h3 id="扩容分区"><a href="#扩容分区" class="headerlink" title="扩容分区"></a>扩容分区</h3><p>1、安装扩容分区工具</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centos</span></span><br><span class="line">yum install -y cloud-utils-growpart</span><br><span class="line"></span><br><span class="line"><span class="comment"># ubuntu</span></span><br><span class="line">apt-get install -y cloud-guest-utils</span><br></pre></td></tr></table></figure><p>2、虚拟机内部执行扩容分区</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l</span><br><span class="line">LANG=en_US.UTF-8</span><br><span class="line">growpart /dev/vda 2</span><br><span class="line">fdisk -l</span><br></pre></td></tr></table></figure><h3 id="扩容文件系统"><a href="#扩容文件系统" class="headerlink" title="扩容文件系统"></a>扩容文件系统</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> -h</span><br><span class="line"><span class="built_in">df</span> -ihT</span><br><span class="line"><span class="comment"># ext2/ext3/ext4</span></span><br><span class="line">resize2fs /dev/vda2</span><br><span class="line"><span class="comment"># xfs</span></span><br><span class="line">xfs_growfs /dev/vda2</span><br><span class="line"><span class="built_in">df</span> -h</span><br></pre></td></tr></table></figure><h2 id="裸数据盘扩容文件系统"><a href="#裸数据盘扩容文件系统" class="headerlink" title="裸数据盘扩容文件系统"></a>裸数据盘扩容文件系统</h2><p>所谓裸数据盘，就是没有分区的数据盘。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> -h</span><br><span class="line"><span class="built_in">df</span> -ihT</span><br><span class="line"><span class="comment"># ext2/ext3/ext4</span></span><br><span class="line">resize2fs /dev/vdb</span><br><span class="line"><span class="comment"># xfs</span></span><br><span class="line">xfs_growfs /dev/vdc</span><br><span class="line"><span class="built_in">df</span> -h</span><br></pre></td></tr></table></figure><h1 id="虚拟机增加磁盘"><a href="#虚拟机增加磁盘" class="headerlink" title="虚拟机增加磁盘"></a>虚拟机增加磁盘</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">virsh destroy ubuntu18.04-tmp</span><br><span class="line">qemu-img create -f qcow2 /opt/kvm/ubuntu18.04-tmp_ext.qcow2 100G</span><br><span class="line">virsh edit ubuntu18.04-tmp</span><br></pre></td></tr></table></figure><p>disk部分添加：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">disk</span> <span class="attr">type</span>=<span class="string">&#x27;file&#x27;</span> <span class="attr">device</span>=<span class="string">&#x27;disk&#x27;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">driver</span> <span class="attr">name</span>=<span class="string">&#x27;qemu&#x27;</span> <span class="attr">type</span>=<span class="string">&#x27;qcow2&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">file</span>=<span class="string">&#x27;/opt/kvm/ubuntu18.04-tmp_ext.qcow2&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">target</span> <span class="attr">dev</span>=<span class="string">&#x27;vdb&#x27;</span> <span class="attr">bus</span>=<span class="string">&#x27;virtio&#x27;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">disk</span>&gt;</span></span><br></pre></td></tr></table></figure><p>磁盘格式化和挂载参考<a href="https://www.voidking.com/">《VirtualBox中Ubuntu扩容》</a></p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-virsh-command/" title="virsh常用命令">https://www.voidking.com/dev-virsh-command/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/ubuntu/" rel="tag"># ubuntu</a> <a href="/tags/libvirt/" rel="tag"># libvirt</a> <a href="/tags/virsh/" rel="tag"># virsh</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-vim-advance/" rel="prev" title="Vim进阶"><i class="fa fa-chevron-left"></i> Vim进阶</a></div><div class="post-nav-item"> <a href="/dev-libvirt-create-vm/" rel="next" title="使用Libvirt创建虚拟机">使用Libvirt创建虚拟机<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><div class="_xduxciwe4ao"></div><script type="text/javascript">(window.slotbydup=window.slotbydup||[]).push({id:"u6920911",container:"_xduxciwe4ao",async:!0}),(window.slotbydup=window.slotbydup||[]).push({id:"u6920919",container:"_053ydasmd31h",async:!0})</script><script type="text/javascript" src="//cpro.baidustatic.com/cpro/ui/cm.js" async="async" defer="defer"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="nav-number">2.</span> <span class="nav-text">创建虚拟机</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%84%E5%88%9B%E5%BB%BA"><span class="nav-number">2.1.</span> <span class="nav-text">常规创建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%95%E7%8B%AC%E5%88%9B%E5%BB%BA%E7%A3%81%E7%9B%98"><span class="nav-number">2.2.</span> <span class="nav-text">单独创建磁盘</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%A1%A5%E6%8E%A5"><span class="nav-number">2.3.</span> <span class="nav-text">使用桥接</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E8%99%9A%E6%8B%9F%E6%9C%BAIP"><span class="nav-number">3.</span> <span class="nav-text">查看虚拟机IP</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96"><span class="nav-number">4.</span> <span class="nav-text">网络优化</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%85%8D%E7%BD%AE"><span class="nav-number">5.</span> <span class="nav-text">修改虚拟机配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85virt-customize"><span class="nav-number">5.1.</span> <span class="nav-text">安装virt-customize</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E9%97%AD%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="nav-number">5.2.</span> <span class="nav-text">关闭虚拟机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E4%B8%BB%E6%9C%BA%E5%90%8D"><span class="nav-number">5.3.</span> <span class="nav-text">修改主机名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%AF%E7%94%A8root-ssh%E7%99%BB%E5%BD%95"><span class="nav-number">5.4.</span> <span class="nav-text">启用root ssh登录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9root%E5%AF%86%E7%A0%81"><span class="nav-number">5.5.</span> <span class="nav-text">修改root密码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0authorized-keys"><span class="nav-number">5.6.</span> <span class="nav-text">添加authorized_keys</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="nav-number">5.7.</span> <span class="nav-text">安装软件包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AE%E9%9D%99%E6%80%81IP"><span class="nav-number">5.8.</span> <span class="nav-text">手动配置静态IP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AE%E9%9D%99%E6%80%81IP2-0"><span class="nav-number">5.9.</span> <span class="nav-text">手动配置静态IP2.0</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E9%9D%99%E6%80%81IP"><span class="nav-number">5.10.</span> <span class="nav-text">自动配置静态IP</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%AF%E5%81%9C%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="nav-number">6.</span> <span class="nav-text">启停虚拟机</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%94%80%E6%AF%81%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="nav-number">7.</span> <span class="nav-text">销毁虚拟机</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%80%E6%9C%BA%E8%87%AA%E5%8A%A8%E5%90%AF%E5%8A%A8"><span class="nav-number">8.</span> <span class="nav-text">开机自动启动</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B0%83%E6%95%B4%E8%99%9A%E6%8B%9F%E6%9C%BACPU%E5%92%8C%E5%86%85%E5%AD%98"><span class="nav-number">9.</span> <span class="nav-text">调整虚拟机CPU和内存</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A0%B9%E6%8D%AExml%E5%AF%BC%E5%87%BA%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="nav-number">10.</span> <span class="nav-text">根据xml导出创建虚拟机的命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%8B%E9%9A%86%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="nav-number">11.</span> <span class="nav-text">克隆虚拟机</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8B%B7%E8%B4%9D%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%88%B0%E5%85%B6%E4%BB%96%E5%AE%BF%E4%B8%BB%E6%9C%BA"><span class="nav-number">12.</span> <span class="nav-text">拷贝虚拟机到其他宿主机</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BF%81%E7%A7%BB"><span class="nav-number">13.</span> <span class="nav-text">虚拟机迁移</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%89%A9%E5%AE%B9%E7%A3%81%E7%9B%98"><span class="nav-number">14.</span> <span class="nav-text">虚拟机扩容磁盘</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%99%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%A2%9E%E5%8A%A0%E7%A3%81%E7%9B%98"><span class="nav-number">14.1.</span> <span class="nav-text">给虚拟机增加磁盘</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A9%E5%AE%B9%E5%88%86%E5%8C%BA%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="nav-number">14.2.</span> <span class="nav-text">扩容分区和文件系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A9%E5%AE%B9%E5%88%86%E5%8C%BA"><span class="nav-number">14.2.1.</span> <span class="nav-text">扩容分区</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A9%E5%AE%B9%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="nav-number">14.2.2.</span> <span class="nav-text">扩容文件系统</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A3%B8%E6%95%B0%E6%8D%AE%E7%9B%98%E6%89%A9%E5%AE%B9%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="nav-number">14.3.</span> <span class="nav-text">裸数据盘扩容文件系统</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%A2%9E%E5%8A%A0%E7%A3%81%E7%9B%98"><span class="nav-number">15.</span> <span class="nav-text">虚拟机增加磁盘</span></a></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="_053ydasmd31h"></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">645</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">242</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>