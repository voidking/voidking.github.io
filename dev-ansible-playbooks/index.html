<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="Playbooks简介与ad-hoc任务执行模式相比，Playbooks使用ansible是一种完全不同的方式，并且功能特别强大。 简而言之，playbooks是真正简单的配置管理和多机器部署系统的基础，与已有的系统不同，并且非常适合部署复杂的应用程序。 Playbooks可以声明配置，但它们也可以协调任何手动有序流程的步骤，即使不同的步骤必须按照特定顺序在机器组之间来回跳转。它们可以同步或异步启"><meta property="og:type" content="article"><meta property="og:title" content="Ansible Playbooks"><meta property="og:url" content="https://www.voidking.com/dev-ansible-playbooks/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="Playbooks简介与ad-hoc任务执行模式相比，Playbooks使用ansible是一种完全不同的方式，并且功能特别强大。 简而言之，playbooks是真正简单的配置管理和多机器部署系统的基础，与已有的系统不同，并且非常适合部署复杂的应用程序。 Playbooks可以声明配置，但它们也可以协调任何手动有序流程的步骤，即使不同的步骤必须按照特定顺序在机器组之间来回跳转。它们可以同步或异步启"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com//imgs/ansible-playbooks/chrony.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ansible-playbooks/chronyc.jpg?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com//imgs/ansible-playbooks/site.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ansible-playbooks/chronyc2.jpg?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com//imgs/ansible-playbooks/var.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ansible-playbooks/loop.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ansible-playbooks/dict.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ansible-playbooks/loop2.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ansible-playbooks/loop3.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ansible-playbooks/loopfile.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ansible-playbooks/loop4.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ansible-playbooks/when.jpg?imageView2/0/w/700"><meta property="article:published_time" content="2018-08-07T14:00:00.000Z"><meta property="article:modified_time" content="2022-10-11T11:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="openstack"><meta property="article:tag" content="ansible"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com//imgs/ansible-playbooks/chrony.jpg?imageView2/0/w/700"><link rel="canonical" href="https://www.voidking.com/dev-ansible-playbooks/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Ansible Playbooks | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-ansible-playbooks/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Ansible Playbooks</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-08-07 14:00:00" itemprop="dateCreated datePublished" datetime="2018-08-07T14:00:00+00:00">2018-08-07</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-10-11 11:00:00" itemprop="dateModified" datetime="2022-10-11T11:00:00+00:00">2022-10-11</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="Playbooks简介"><a href="#Playbooks简介" class="headerlink" title="Playbooks简介"></a>Playbooks简介</h1><p>与ad-hoc任务执行模式相比，Playbooks使用ansible是一种完全不同的方式，并且功能特别强大。</p><p>简而言之，playbooks是真正简单的配置管理和多机器部署系统的基础，与已有的系统不同，并且非常适合部署复杂的应用程序。</p><p>Playbooks可以声明配置，但它们也可以协调任何手动有序流程的步骤，即使不同的步骤必须按照特定顺序在机器组之间来回跳转。它们可以同步或异步启动任务。<br>更多playbooks的介绍参考<a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html">官方文档</a>。</p><span id="more"></span><p>Playbooks以YAML格式表示（请参阅<a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html#yaml-syntax">YAML语法</a>），具有最少的语法，它不是编程语言或脚本，而是配置或进程的模型。</p><p>每个剧本由列表中的一个或多个“戏剧”组成。戏剧的目标是将一组主机映射到一些定义明确的角色，由ansible调用任务表示。在基本级别，任务只不过是对ansible模块的调用（请参阅<a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/user_guide/modules.html">使用模块</a>）。</p><p>通过编写多个“戏剧”的剧本，可以编排多机部署，在Web服务器组中的所有计算机上运行某些步骤，然后在数据库服务器组上执行某些步骤，然后在Web服务器组上执行更多命令，等等。。</p><p>你可以有很多戏剧影响你的系统做不同的事情。这并不是说你只是定义了一个特定的状态或模型，而是可以在不同的时间运行不同的戏剧。</p><h1 id="Playbooks-Demo"><a href="#Playbooks-Demo" class="headerlink" title="Playbooks Demo"></a>Playbooks Demo</h1><p>以下是只包含一个戏剧的剧本：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">http_port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">max_clients:</span> <span class="number">200</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ensure</span> <span class="string">apache</span> <span class="string">is</span> <span class="string">at</span> <span class="string">the</span> <span class="string">latest</span> <span class="string">version</span></span><br><span class="line">    <span class="attr">yum:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">      <span class="attr">state:</span> <span class="string">latest</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">write</span> <span class="string">the</span> <span class="string">apache</span> <span class="string">config</span> <span class="string">file</span></span><br><span class="line">    <span class="attr">template:</span></span><br><span class="line">      <span class="attr">src:</span> <span class="string">/srv/httpd.j2</span></span><br><span class="line">      <span class="attr">dest:</span> <span class="string">/etc/httpd.conf</span></span><br><span class="line">    <span class="attr">notify:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">restart</span> <span class="string">apache</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ensure</span> <span class="string">apache</span> <span class="string">is</span> <span class="string">running</span></span><br><span class="line">    <span class="attr">service:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">      <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">  <span class="attr">handlers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">apache</span></span><br><span class="line">      <span class="attr">service:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br></pre></td></tr></table></figure><ul><li>文件开头三个横杠代表yaml文件。</li><li>hosts表示一个主机组。</li><li>tasks表示动作集合。</li><li>name是一个注释说明。</li><li>yum和下面两行，表示使用yum安装最新版的httpd。</li><li>template和下面两行，表示使用ansible的template模块传输/srv/httpd.j2作为客户机的/etc/httpd.conf。和copy相比，template支持jinja语法。</li><li>notify和下面一行，表示传输成功后触发重启apache命令。它需要和handlers组合使用。</li><li>handlers中的name和notify中的信息要完全相同。service和下面两行，表示重启httpd。</li></ul><p>Playbooks可以包含多个戏剧。您可能有一个首先针对Web服务器，然后是数据库服务器的playbook。例如：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ensure</span> <span class="string">apache</span> <span class="string">is</span> <span class="string">at</span> <span class="string">the</span> <span class="string">latest</span> <span class="string">version</span></span><br><span class="line">    <span class="attr">yum:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">      <span class="attr">state:</span> <span class="string">latest</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">write</span> <span class="string">the</span> <span class="string">apache</span> <span class="string">config</span> <span class="string">file</span></span><br><span class="line">    <span class="attr">template:</span></span><br><span class="line">      <span class="attr">src:</span> <span class="string">/srv/httpd.j2</span></span><br><span class="line">      <span class="attr">dest:</span> <span class="string">/etc/httpd.conf</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">databases</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ensure</span> <span class="string">postgresql</span> <span class="string">is</span> <span class="string">at</span> <span class="string">the</span> <span class="string">latest</span> <span class="string">version</span></span><br><span class="line">    <span class="attr">yum:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">postgresql</span></span><br><span class="line">      <span class="attr">state:</span> <span class="string">latest</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ensure</span> <span class="string">that</span> <span class="string">postgresql</span> <span class="string">is</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">service:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">postgresql</span></span><br><span class="line">      <span class="attr">state:</span> <span class="string">started</span></span><br></pre></td></tr></table></figure><h1 id="入门实例"><a href="#入门实例" class="headerlink" title="入门实例"></a>入门实例</h1><p>目标：编写一个playbook，在客户机上安装chrony，然后检查启动情况。</p><p>1、新建chrony.yml，内容为：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">commonservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">chrony</span></span><br><span class="line">    <span class="attr">apt:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">chrony</span></span><br><span class="line">      <span class="attr">state:</span> <span class="string">latest</span></span><br><span class="line">    <span class="attr">notify:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">restart</span> <span class="string">chrony</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ensure</span> <span class="string">chrony</span> <span class="string">is</span> <span class="string">running</span></span><br><span class="line">    <span class="attr">service:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">chrony</span></span><br><span class="line">      <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">  <span class="attr">handlers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">chrony</span></span><br><span class="line">      <span class="attr">service:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">chrony</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br></pre></td></tr></table></figure><p>上面的playbook中用到了apt模块，如果有疑问可以查看帮助，<code>ansible-doc apt</code>。实际上，有一种更加简单的写法，就是把apt模块换成command模块，然后直接写命令。</p><p>2、检查playbook<br><code>ansible-playbook chrony.yml --syntax-check</code></p><p>3、以sudo权限执行playbook<br><code>ansible-playbook chrony.yml --user=voidking --private-key=/home/voidking/.ssh/id_rsa -s</code><br><img src="http://cdn.voidking.com//imgs/ansible-playbooks/chrony.jpg?imageView2/0/w/700"></p><p>4、在客户机测试<br><code>chronyc sources</code><br><img src="http://cdn.voidking.com//imgs/ansible-playbooks/chronyc.jpg?imageView2/0/w/600"></p><h1 id="角色"><a href="#角色" class="headerlink" title="角色"></a>角色</h1><p>如果需要将一个大文件拆分为各个小文件，我们经常使用的就是include，这也是原先ansible拆分文件的做法。如今ansible使用roles来拆分文件，将nginx、mysql等分为各个角色，在各个角色内定义具体的小任务，方便管理。另一方面，类似于php类的自动加载，roles基于一个已知的文件结构，可以自动去加载某些vars_files、tasks、handlers等。</p><p>目标：使用角色的方式，编写配置playbook，在客户机上安装chrony，然后检查启动情况。</p><p>1、创建chrony角色目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p roles/chrony/tasks</span><br><span class="line"><span class="built_in">mkdir</span> -p roles/chrony/handlers</span><br></pre></td></tr></table></figure><p>2、创建总的入口文件site.yml，内容为：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">commonservers</span></span><br><span class="line">  <span class="attr">roles:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">chrony</span></span><br></pre></td></tr></table></figure><p>3、创建安装剧本<br><code>vim roles/chrony/tasks/main.yml</code>，内容为：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">chrony</span></span><br><span class="line">  <span class="attr">apt:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">chrony</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">latest</span></span><br><span class="line">  <span class="attr">notify:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">restart</span> <span class="string">chrony</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ensure</span> <span class="string">chrony</span> <span class="string">is</span> <span class="string">running</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">chrony</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br></pre></td></tr></table></figure><p><code>vim roles/chrony/handlers/main.yml</code>，内容为：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">chrony</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">chrony</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br></pre></td></tr></table></figure><p>4、以sudo权限执行playbook<br><code>ansible-playbook site.yml --user=voidking --private-key=/home/voidking/.ssh/id_rsa -s</code></p><p><img src="http://cdn.voidking.com//imgs/ansible-playbooks/site.jpg?imageView2/0/w/700"></p><p>5、在客户机测试<br><code>chronyc sources</code><br><img src="http://cdn.voidking.com//imgs/ansible-playbooks/chronyc2.jpg?imageView2/0/w/600"></p><h1 id="简单编程"><a href="#简单编程" class="headerlink" title="简单编程"></a>简单编程</h1><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">commonservers</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">pre1:</span> <span class="string">all</span> <span class="string">info</span> <span class="string">is</span> </span><br><span class="line">    <span class="attr">pre2:</span> <span class="string">hostname</span> <span class="string">is</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">register</span> <span class="string">vars</span></span><br><span class="line">    <span class="attr">shell:</span> <span class="string">hostname</span></span><br><span class="line">    <span class="attr">register:</span> <span class="string">info</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">display</span> <span class="string">info</span></span><br><span class="line">    <span class="attr">debug:</span> <span class="string">msg=&quot;&#123;&#123;pre1&#125;&#125;</span> &#123;&#123;<span class="string">info</span>&#125;&#125;<span class="string">&quot;</span></span><br><span class="line"><span class="string">  - name: display hostname</span></span><br><span class="line"><span class="string">    debug: msg=&quot;</span>&#123;&#123;<span class="string">pre2</span>&#125;&#125; &#123;&#123;<span class="string">info.stdout</span>&#125;&#125;<span class="string">&quot;</span></span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com//imgs/ansible-playbooks/var.jpg?imageView2/0/w/700"></p><p>这里涉及到一个知识点：使用ansible-playbook执行命令（使用shell/command模块），默认不显示标准输出/标准失败，只能看到执行成功还是失败。<br>如果想要显示标准输出/标准失败，必须要使用变量，就像上面的这个例子一样。</p><h2 id="基本循环"><a href="#基本循环" class="headerlink" title="基本循环"></a>基本循环</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">commonservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">loops</span> <span class="string">demo</span></span><br><span class="line">    <span class="attr">debug:</span> <span class="string">msg=&quot;&#123;&#123;item&#125;&#125;&quot;</span></span><br><span class="line">    <span class="attr">with_items:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">one</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">two</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">three</span></span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com//imgs/ansible-playbooks/loop.jpg?imageView2/0/w/700"></p><h2 id="循环字典"><a href="#循环字典" class="headerlink" title="循环字典"></a>循环字典</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">commonservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">loops</span> <span class="string">dict</span></span><br><span class="line">    <span class="attr">debug:</span> <span class="string">msg=&quot;key</span> <span class="string">-&gt;</span> &#123;&#123;<span class="string">item.key</span>&#125;&#125;<span class="string">,value</span> <span class="string">-&gt;</span> &#123;&#123;<span class="string">item.value</span>&#125;&#125;<span class="string">&quot;</span></span><br><span class="line"><span class="string">    with_items:</span></span><br><span class="line"><span class="string">      - &#123;key: 1, value: &quot;</span><span class="string">one&quot;&#125;</span></span><br><span class="line">      <span class="bullet">-</span> &#123;<span class="attr">key:</span> <span class="number">2</span>, <span class="attr">value:</span> <span class="string">&quot;two&quot;</span>&#125;</span><br><span class="line">      <span class="bullet">-</span> &#123;<span class="attr">key:</span> <span class="number">3</span>, <span class="attr">value:</span> <span class="string">&quot;three&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com//imgs/ansible-playbooks/dict.jpg?imageView2/0/w/700"></p><h2 id="嵌套循环"><a href="#嵌套循环" class="headerlink" title="嵌套循环"></a>嵌套循环</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">commonservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">loops2</span> </span><br><span class="line">    <span class="attr">debug:</span> <span class="string">msg=&quot;item0</span> <span class="string">-&gt;</span> &#123;&#123;<span class="string">item</span>[<span class="number">0</span>]&#125;&#125;<span class="string">,item1</span> <span class="string">-&gt;</span> &#123;&#123;<span class="string">item</span>[<span class="number">1</span>]&#125;&#125;<span class="string">&quot;</span></span><br><span class="line"><span class="string">    with_nested:</span></span><br><span class="line"><span class="string">      - [&#x27;1&#x27;,&#x27;2&#x27;]</span></span><br><span class="line"><span class="string">      - [&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;]</span></span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com//imgs/ansible-playbooks/loop2.jpg?imageView2/0/w/700"></p><h2 id="散列循环"><a href="#散列循环" class="headerlink" title="散列循环"></a>散列循环</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">commonservers</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">user:</span> </span><br><span class="line">      <span class="attr">voidking:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">voidking</span></span><br><span class="line">        <span class="attr">tel:</span> <span class="number">17600000000</span></span><br><span class="line">      <span class="attr">haojin:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">haojin</span></span><br><span class="line">        <span class="attr">tel:</span> <span class="number">15100000000</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">loops3</span> </span><br><span class="line">    <span class="attr">debug:</span> <span class="string">msg=&quot;key</span> <span class="string">-&gt;</span> &#123;&#123;<span class="string">item.key</span>&#125;&#125;<span class="string">,value</span> <span class="string">-&gt;</span> &#123;&#123;<span class="string">item.value</span>&#125;&#125;<span class="string">&quot;</span></span><br><span class="line"><span class="string">    with_dict:</span></span><br><span class="line"><span class="string">      - &quot;</span>&#123;&#123;<span class="string">user</span>&#125;&#125;<span class="string">&quot;</span></span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com//imgs/ansible-playbooks/loop3.jpg?imageView2/0/w/700"></p><h2 id="文件循环"><a href="#文件循环" class="headerlink" title="文件循环"></a>文件循环</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">commonservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">loop</span> <span class="string">file</span></span><br><span class="line">    <span class="attr">debug:</span> <span class="string">msg=&quot;&#123;&#123;item&#125;&#125;&quot;</span></span><br><span class="line">    <span class="attr">with_fileglob:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/voidking/*.yml</span></span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com//imgs/ansible-playbooks/loopfile.jpg?imageView2/0/w/700"></p><h2 id="命令循环"><a href="#命令循环" class="headerlink" title="命令循环"></a>命令循环</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">commonservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">exec</span> <span class="string">command</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;item&#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">with_items:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">hostname</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">uname</span></span><br><span class="line">      <span class="attr">register:</span> <span class="string">ret</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">display</span> <span class="string">result</span></span><br><span class="line">      <span class="attr">debug:</span> <span class="string">msg=&quot;&#123;%</span> <span class="string">for</span> <span class="string">i</span> <span class="string">in</span> <span class="string">ret.results</span> <span class="string">%&#125;</span> &#123;&#123;<span class="string">i.stdout</span>&#125;&#125; &#123;<span class="string">%</span> <span class="string">endfor</span> <span class="string">%</span>&#125;<span class="string">&quot; </span></span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com//imgs/ansible-playbooks/loop4.jpg?imageView2/0/w/700"></p><h2 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h2><p>ansible的条件判断使用关键字when，有两种方式：</p><ul><li>python语法支持的原生态格式 conditions &gt; 1 or conditions == “ss”，in，not等等</li><li>ansible Jinja2 filters</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">commonservers</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">pre:</span> <span class="string">hostname</span> <span class="string">is</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">register</span> <span class="string">vars</span></span><br><span class="line">    <span class="attr">shell:</span> <span class="string">hostname</span></span><br><span class="line">    <span class="attr">register:</span> <span class="string">info</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">display</span> <span class="string">hostname</span></span><br><span class="line">    <span class="attr">debug:</span> <span class="string">msg=&quot;&#123;&#123;pre&#125;&#125;</span> &#123;&#123;<span class="string">info.stdout</span>&#125;&#125;<span class="string">&quot;</span></span><br><span class="line"><span class="string">  - name: print true</span></span><br><span class="line"><span class="string">    debug: msg=&quot;</span><span class="string">result</span> <span class="string">is</span> <span class="string">ubuntu14&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">info.stdout</span> <span class="string">==</span> <span class="string">&quot;ubuntu14&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">print</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">debug:</span> <span class="string">msg=&quot;result</span> <span class="string">is</span> <span class="string">not</span> <span class="string">ubuntu14&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">info.stdout</span> <span class="type">!=</span> <span class="string">&quot;ubuntu14&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">print</span> <span class="string">warning</span></span><br><span class="line">    <span class="attr">debug:</span> <span class="string">msg=&quot;client</span> <span class="string">OS</span> <span class="string">is</span> <span class="string">ubuntu&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">info[&#x27;stdout&#x27;].startswith(&#x27;u&#x27;)</span></span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com//imgs/ansible-playbooks/when.jpg?imageView2/0/w/700"></p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>至此，playbooks最基础的东西学习完毕。更高级的用法，在使用中再慢慢学习。</p><h1 id="书签"><a href="#书签" class="headerlink" title="书签"></a>书签</h1><ul><li><a target="_blank" rel="noopener" href="https://docs.ansible.com/">Ansible Documentation</a></li><li><a target="_blank" rel="noopener" href="http://www.ansible.com.cn/">Ansible中文权威指南</a></li><li><a target="_blank" rel="noopener" href="http://study.163.com/course/introduction.htm?courseId=1004525015">Ansible精讲</a></li><li><a target="_blank" rel="noopener" href="https://spacelift.io/blog/ansible-tutorial">Ansible Tutorial for Beginners: Ultimate Playbook &amp; Examples</a></li><li><a target="_blank" rel="noopener" href="https://spacelift.io/blog/ansible-playbooks">Working with Ansible Playbooks – Tips &amp; Tricks with Examples</a></li></ul></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-ansible-playbooks/" title="Ansible Playbooks">https://www.voidking.com/dev-ansible-playbooks/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/ubuntu/" rel="tag"># ubuntu</a> <a href="/tags/openstack/" rel="tag"># openstack</a> <a href="/tags/ansible/" rel="tag"># ansible</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-yaml/" rel="prev" title="YAML语言"><i class="fa fa-chevron-left"></i> YAML语言</a></div><div class="post-nav-item"> <a href="/dev-ansible-in-action/" rel="next" title="Ansible实战">Ansible实战<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Playbooks%E7%AE%80%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">Playbooks简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Playbooks-Demo"><span class="nav-number">2.</span> <span class="nav-text">Playbooks Demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%A5%E9%97%A8%E5%AE%9E%E4%BE%8B"><span class="nav-number">3.</span> <span class="nav-text">入门实例</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A7%92%E8%89%B2"><span class="nav-number">4.</span> <span class="nav-text">角色</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E7%BC%96%E7%A8%8B"><span class="nav-number">5.</span> <span class="nav-text">简单编程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%98%E9%87%8F"><span class="nav-number">5.1.</span> <span class="nav-text">变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E5%BE%AA%E7%8E%AF"><span class="nav-number">5.2.</span> <span class="nav-text">基本循环</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BE%AA%E7%8E%AF%E5%AD%97%E5%85%B8"><span class="nav-number">5.3.</span> <span class="nav-text">循环字典</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B5%8C%E5%A5%97%E5%BE%AA%E7%8E%AF"><span class="nav-number">5.4.</span> <span class="nav-text">嵌套循环</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%A3%E5%88%97%E5%BE%AA%E7%8E%AF"><span class="nav-number">5.5.</span> <span class="nav-text">散列循环</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%BE%AA%E7%8E%AF"><span class="nav-number">5.6.</span> <span class="nav-text">文件循环</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E5%BE%AA%E7%8E%AF"><span class="nav-number">5.7.</span> <span class="nav-text">命令循环</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD"><span class="nav-number">5.8.</span> <span class="nav-text">条件判断</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E8%AE%B0"><span class="nav-number">6.</span> <span class="nav-text">后记</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B9%A6%E7%AD%BE"><span class="nav-number">7.</span> <span class="nav-text">书签</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">645</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">242</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="_xduxciwe4ao"></div><script type="text/javascript">(window.slotbydup=window.slotbydup||[]).push({id:"u6920911",container:"_xduxciwe4ao",async:!0})</script><script type="text/javascript" src="//cpro.baidustatic.com/cpro/ui/cm.js" async="async" defer="defer"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>