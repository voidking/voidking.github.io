<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言Helm官方文档写的很棒，本文会摘录Helm官方文档中的一些基础知识和最佳实践，备忘。更细致全面的内容，请移步阅读Helm官方文档。 参考文档：  《Helm入门篇》 Helm - Getting Started"><meta property="og:type" content="article"><meta property="og:title" content="Helm官方文档摘录"><meta property="og:url" content="https://www.voidking.com/dev-helm-doc-extract/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言Helm官方文档写的很棒，本文会摘录Helm官方文档中的一些基础知识和最佳实践，备忘。更细致全面的内容，请移步阅读Helm官方文档。 参考文档：  《Helm入门篇》 Helm - Getting Started"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2022-05-27T08:00:00.000Z"><meta property="article:modified_time" content="2023-05-27T08:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="k8s"><meta property="article:tag" content="helm"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-helm-doc-extract/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Helm官方文档摘录 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-helm-doc-extract/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Helm官方文档摘录</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2022-05-27 08:00:00" itemprop="dateCreated datePublished" datetime="2022-05-27T08:00:00+00:00">2022-05-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2023-05-27 08:00:00" itemprop="dateModified" datetime="2023-05-27T08:00:00+00:00">2023-05-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/cloudnative/" itemprop="url" rel="index"><span itemprop="name">cloudnative</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>Helm官方文档写的很棒，本文会摘录Helm官方文档中的一些基础知识和最佳实践，备忘。<br>更细致全面的内容，请移步阅读<a target="_blank" rel="noopener" href="https://helm.sh/zh/docs/">Helm官方文档</a>。</p><p>参考文档：</p><ul><li><a href="https://www.voidking.com/dev-helm-start/">《Helm入门篇》</a></li><li><a target="_blank" rel="noopener" href="https://helm.sh/zh/docs/chart_template_guide/getting_started/">Helm - Getting Started</a></li></ul><span id="more"></span><h1 id="Helm三大概念"><a href="#Helm三大概念" class="headerlink" title="Helm三大概念"></a>Helm三大概念</h1><p>Chart 代表着 Helm 包。它包含在 Kubernetes 集群内部运行应用程序，工具或服务所需的所有资源定义。你可以把它看作是 Homebrew formula，Apt dpkg，或 Yum RPM 在Kubernetes 中的等价物。</p><p>Repository（仓库） 是用来存放和共享 charts 的地方。它就像 Perl 的 CPAN 档案库网络 或是 Fedora 的 软件包仓库，只不过它是供 Kubernetes 包所使用的。</p><p>Release 是运行在 Kubernetes 集群中的 chart 的实例。一个 chart 通常可以在同一个集群中安装多次。每一次安装都会创建一个新的 release。以 MySQL chart为例，如果你想在你的集群中运行两个数据库，你可以安装该chart两次。每一个数据库都会拥有它自己的 release 和 release name。</p><p>在了解了上述这些概念以后，我们就可以这样来解释 Helm：<br>Helm 安装 charts 到 Kubernetes 集群中，每次安装都会创建一个新的 release。你可以在 Helm 的 chart repositories 中寻找新的 chart。</p><h1 id="Helm安装资源的顺序"><a href="#Helm安装资源的顺序" class="headerlink" title="Helm安装资源的顺序"></a>Helm安装资源的顺序</h1><p>Helm按照以下顺序安装资源：</p><ul><li>Namespace</li><li>NetworkPolicy</li><li>ResourceQuota</li><li>LimitRange</li><li>PodSecurityPolicy</li><li>PodDisruptionBudget</li><li>ServiceAccount</li><li>Secret</li><li>SecretList</li><li>ConfigMap</li><li>StorageClass</li><li>PersistentVolume</li><li>PersistentVolumeClaim</li><li>CustomResourceDefinition</li><li>ClusterRole</li><li>ClusterRoleList</li><li>ClusterRoleBinding</li><li>ClusterRoleBindingList</li><li>Role</li><li>RoleList</li><li>RoleBinding</li><li>RoleBindingList</li><li>Service</li><li>DaemonSet</li><li>Pod</li><li>ReplicationController</li><li>ReplicaSet</li><li>Deployment</li><li>HorizontalPodAutoscaler</li><li>StatefulSet</li><li>Job</li><li>CronJob</li><li>Ingress</li><li>APIService</li></ul><h1 id="Chart模板指南"><a href="#Chart模板指南" class="headerlink" title="Chart模板指南"></a>Chart模板指南</h1><p>内容太多，建议直接阅读<a target="_blank" rel="noopener" href="https://helm.sh/zh/docs/chart_template_guide/getting_started/">Helm官方文档 - Chart模板指南</a>，了解基础概念和语法。</p><p>本节只简单说明几个概念和语法。</p><h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><p><code>templates/</code>目录中的<code>.yaml</code>文件和<code>.tpl</code>文件，就是模板。<br>当Helm评估chart时，会通过模板渲染引擎将所有文件发送到templates/目录中。 然后收集模板的结果并发送给Kubernetes。</p><p>values.yaml 文件也导入到了模板。这个文件包含了chart的 默认值 。这些值会在用户执行helm install 或 helm upgrade时被覆盖。</p><p>Chart.yaml 文件包含了该chart的描述。你可以从模板中访问它。charts/目录 可以 包含其他的chart(称之为 子chart)。</p><p>模板中横线的作用：</p><ul><li><code>&#123;&#123;-`：表示在模板渲染时要去掉前面的空白字符和换行符。 - `-&#125;&#125;</code>：表示在模板渲染时要去掉后面的空白字符和换行符。</li></ul><h2 id="变量和作用域"><a href="#变量和作用域" class="headerlink" title="变量和作用域"></a>变量和作用域</h2><p>Helm模板中，变量是对另一个对象的命名引用。</p><p>变量的作用域一般不是全局的，而是其声明所在的块。所谓块，是指<code>if/else</code>、<code>with</code>、<code>range</code>、<code>define</code>、<code>template</code>、<code>block</code>定义的范围。</p><p><code>.</code>代表对当前作用域的引用，<code>.Values</code>表示在当前作用域查找Values对象。<br>每个模板中，默认可以访问到的内置对象有Release、Values、Chart、Files、Capabilities和Template。<br>如果定义了块，那么在块中不可以通过<code>.Values</code>找到Values对象。</p><p><code>$</code>代表对根作用域的引用，<code>$.Values</code>表示在根作用域查找Values对象。<br>如果定义了块，那么在块中可以通过<code>$.Values</code>找到Values对象。</p><p>变量定义格式示例：<code>&#123;&#123;- $name := .Release.Name -&#125;&#125;</code><br>在模板顶层定义变量，变量的作用域会是整个模板；在块中定义变量，变量的作用域只在块内。</p><h2 id="变量类型"><a href="#变量类型" class="headerlink" title="变量类型"></a>变量类型</h2><p>Helm 模板语言是用强类型Go编程语言实现的。 因此，模板中的变量是 有类型的。大多数情况下，变量将作为以下类型之一显示：</p><ul><li>string: 文本字符串</li><li>bool: true 或 false</li><li>int: 整型值（包含8位，16位，32位，和64有符号和无符号整数）</li><li>float64: 64位浮点数(也有8位，16位，32位类型)</li><li>字节切片([]byte)，一般用于保存（可能的）二进制数据</li><li>struct: 有属性和方法的对象</li><li>上述某种类型的切片(索引列表)</li><li>字符串键map (<code>map[string]interface&#123;&#125;</code>) 值是上述某种类型</li></ul><p>Go里面有很多其他类型，有时你需要在模板里转换。调试对象类型最简便的方式是在模板中传递给printf “%t”，这样会打印类型。 也可以使用 typeOf 和 kindOf 函数。</p><h2 id="命名模板"><a href="#命名模板" class="headerlink" title="命名模板"></a>命名模板</h2><p>命名模板（也被称作一个 部分 或一个 子模板）名称是全局的。<br>一个常见的命名惯例是用chart名称作为模板前缀。使用特定chart名称作为前缀可以避免可能因为 两个不同chart使用了相同名称的模板而引起的冲突。</p><p>用define和template声明和使用模板。<br>按照惯例，define声明的命名模板一般放在<code>_helpers.tpl</code>文件中。因为是模板名称是全局的，因此可以被<code>.yaml</code>文件引用。</p><p>template渲染时，一般传入<code>.</code>作为命名模板可以访问的范围。<br>include是template的替代，只是为了更好地处理YAML文档的输出格式，方便缩进。</p><h2 id="NOTES-txt文件"><a href="#NOTES-txt文件" class="headerlink" title="NOTES.txt文件"></a>NOTES.txt文件</h2><p>在helm install 或 helm upgrade命令的最后，Helm会打印出对用户有用的信息。 使用模板可以高度自定义这部分信息。<br>要在chart添加安装说明，只需创建 templates/NOTES.txt 文件即可。该文件是纯文本，但会像模板一样处理， 所有正常的模板函数和对象都是可用的。</p><h2 id="helmignore-文件"><a href="#helmignore-文件" class="headerlink" title=".helmignore 文件"></a>.helmignore 文件</h2><p><code>.helmignore</code> 文件用来指定你不想包含在你的helm chart中的文件。<br>如果该文件存在，helm package 命令会在打包应用时忽略所有在 <code>.helmignore</code> 文件中匹配的文件。</p><p>一些值得注意的和.gitignore不同之处：</p><ul><li>不支持<code>**</code>语法。</li><li>globbing库是Go的 ‘filepath.Match’，不是fnmatch(3)</li><li>末尾空格总会被忽略(不支持转义序列)</li><li>不支持<code>!</code>作为特殊的引导序列</li><li>默认不会排除自身，需要显式添加 .helmignore</li></ul><h2 id="YAML技术"><a href="#YAML技术" class="headerlink" title="YAML技术"></a>YAML技术</h2><p>参考文档：<a href="https://www.voidking.com/dev-yaml/">《YAML语言》</a></p><h1 id="Chart开发技巧"><a href="#Chart开发技巧" class="headerlink" title="Chart开发技巧"></a>Chart开发技巧</h1><h2 id="模板方法"><a href="#模板方法" class="headerlink" title="模板方法"></a>模板方法</h2><p>Helm使用<a target="_blank" rel="noopener" href="https://pkg.go.dev/text/template">Go模板</a>，同时增加了两个特殊模板方法：<code>include</code>和<code>required</code>。</p><p>include方法允许你引入另一个模板，并将结果传递给其他模板方法。<br>比如，这个模板片段包含了一个叫mytpl的模板，然后将其转成小写，并使用双引号括起来。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value: &#123;&#123; include &quot;mytpl&quot; . | lower | quote &#125;&#125;</span><br></pre></td></tr></table></figure><p>required方法可以让你声明模板渲染所需的特定值。如果这个值是空的，模板渲染会出错并打印用户提交的错误信息。<br>下面这个required方法的例子声明了一个.Values.who需要的条目，并且当这个条目不存在时会打印错误信息：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value: &#123;&#123; required &quot;A valid .Values.who entry required!&quot; .Values.who &#125;&#125;</span><br></pre></td></tr></table></figure><p>tpl方法允许开发者在模板中使用字符串作为模板。将模板字符串作为值传给chart或渲染额外的配置文件时会很有用。<br>语法： <code>&#123;&#123; tpl TEMPLATE_STRING VALUES &#125;&#125;</code></p><h2 id="使用Partials和模板引用"><a href="#使用Partials和模板引用" class="headerlink" title="使用Partials和模板引用"></a>使用Partials和模板引用</h2><p>有时你想在chart中创建可以重复利用的部分，不管是块还是局部模板。通常将这些文件保存在自己的文件中会更干净。</p><p>在 <code>templates/</code> 目录中，任何以下划线(<code>_</code>)开始的文件不希望输出到Kubernetes清单文件中。<br>因此按照惯例，辅助模板和局部模板会被放在<code>_helpers.tpl</code>文件中。</p><h2 id="创建镜像拉取密钥"><a href="#创建镜像拉取密钥" class="headerlink" title="创建镜像拉取密钥"></a>创建镜像拉取密钥</h2><p>1、定义 values.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">imageCredentials:</span></span><br><span class="line">  <span class="attr">registry:</span> <span class="string">quay.io</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">someone</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">sillyness</span></span><br><span class="line">  <span class="attr">email:</span> <span class="string">someone@host.com</span></span><br></pre></td></tr></table></figure><p>2、定义辅助模板（写在 <code>_helpers.tpl</code> 文件里）</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;- define &quot;imagePullSecret&quot; &#125;&#125;</span><br><span class="line">&#123;&#123;- with .Values.imageCredentials &#125;&#125;</span><br><span class="line">&#123;&#123;- printf &quot;&#123;\&quot;auths\&quot;:&#123;\&quot;%s\&quot;:&#123;\&quot;username\&quot;:\&quot;%s\&quot;,\&quot;password\&quot;:\&quot;%s\&quot;,\&quot;email\&quot;:\&quot;%s\&quot;,\&quot;auth\&quot;:\&quot;%s\&quot;&#125;&#125;&#125;&quot; .registry .username .password .email (printf &quot;%s:%s&quot; .username .password | b64enc) | b64enc &#125;&#125;</span><br><span class="line">&#123;&#123;- end &#125;&#125;</span><br><span class="line">&#123;&#123;- end &#125;&#125;</span><br></pre></td></tr></table></figure><p>3、模板中使用辅助模板</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myregistrykey</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">kubernetes.io/dockerconfigjson</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="string">.dockerconfigjson:</span> &#123;&#123; <span class="string">template</span> <span class="string">&quot;imagePullSecret&quot;</span> <span class="string">.</span> &#125;&#125;</span><br></pre></td></tr></table></figure><h2 id="YAML是JSON的超集"><a href="#YAML是JSON的超集" class="headerlink" title="YAML是JSON的超集"></a>YAML是JSON的超集</h2><p>根据YAML规范，YAML是JSON的超集。这意味着任意的合法JSON结构在YAML中应该是合法的。</p><p>这有个优势：有时候模板开发者会发现使用类JSON语法更容易表达数据结构而不是处理YAML的空白敏感度。</p><p>作为最佳实践，模板应遵循类YAML语法 除非 JSON语法大大降低了格式问题的风险。</p><h2 id="构建复杂Chart"><a href="#构建复杂Chart" class="headerlink" title="构建复杂Chart"></a>构建复杂Chart</h2><p>在CNCF的 Artifact Hub 中的很多chart是创建更先进应用的“组成部分”。但是chart可能被用于创建大规模应用实例。 在这种场景中，一个总的chart会有很多子chart，每一个是整体功能的一部分。</p><p>当前从离散组件组成一个复杂应用的最佳实践是创建一个顶层总体chart构建全局配置，然后使用charts子目录嵌入每个组件。</p><h1 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h1><h2 id="一般惯例"><a href="#一般惯例" class="headerlink" title="一般惯例"></a>一般惯例</h2><h3 id="chart名称"><a href="#chart名称" class="headerlink" title="chart名称"></a>chart名称</h3><p>chart名称必须是小写字母和数字。单词之间可以使用横杠分隔(-)。</p><h3 id="版本号"><a href="#版本号" class="headerlink" title="版本号"></a>版本号</h3><p>Helm尽可能使用 <a target="_blank" rel="noopener" href="https://semver.org/">SemVer 2</a>来表示版本号。（注意Docker镜像的tag不一定遵循SemVer， 因此被认为是一个不幸的例外规则。）</p><p>当SemVer版本存储在Kubernetes标签中时，我们通常把+字符改成_，因为标签不允许使用+作为值进行签名。</p><h3 id="格式化YAML"><a href="#格式化YAML" class="headerlink" title="格式化YAML"></a>格式化YAML</h3><p>YAML 文件应该按照 双空格 缩进(绝不要使用tab键)。</p><h3 id="Helm-和-Chart的用法"><a href="#Helm-和-Chart的用法" class="headerlink" title="Helm 和 Chart的用法"></a>Helm 和 Chart的用法</h3><p>以下是几个 Helm 和 helm 的惯用方法。</p><ul><li>Helm 是指整个项目</li><li>helm 是指客户端命令</li><li>chart 不是专有名词，不需要首字母大写</li><li>Chart.yaml 需要首字母大写，因为文件名大小写敏感</li></ul><p>若有疑问，使用 Helm (‘H’大写)。</p><h2 id="Values"><a href="#Values" class="headerlink" title="Values"></a>Values</h2><h3 id="命名规范"><a href="#命名规范" class="headerlink" title="命名规范"></a>命名规范</h3><p>变量名称以小写字母开头，单词按驼峰区分</p><h3 id="扁平或嵌套的Value"><a href="#扁平或嵌套的Value" class="headerlink" title="扁平或嵌套的Value"></a>扁平或嵌套的Value</h3><p>YAML是一种灵活格式，值可以嵌套得很深，也可以是扁平的。<br>大多数场景中，扁平的优于嵌套的。因为对模板开发者和用户来说更加简单。</p><h3 id="类型清楚"><a href="#类型清楚" class="headerlink" title="类型清楚"></a>类型清楚</h3><p>YAML的类型强制规则有时候是很反常的。比如，foo: false 和 foo: “false” 是不一样的。大整型数如：foo: 12345678 有时会被转换成科学计数法。</p><p>避免类型强制规则错误最简单的方式是字符串明确定义，其他都是不明确的。或者，简单来讲， 给所有字符串打引号。</p><p>通常，为了避免整数转换问题，将整型存储为字符串更好，并用 <code>&#123;&#123; int $value &#125;&#125;</code> 在模板中将字符串转回整型。</p><p>在大多数场景中，显式的类型标记更好，所以 <code>foo: !!string 1234</code> 会将1234作为字符串对待。 但是，YAML解析器会消耗标记，因此类型数据在一次解析后会丢失。</p><h3 id="考虑用户使用value"><a href="#考虑用户使用value" class="headerlink" title="考虑用户使用value"></a>考虑用户使用value</h3><p>有三种value来源:</p><ul><li>chart的values.yaml文件</li><li>由<code>helm install -f</code>提供的values文件</li><li>在执行<code>helm install</code> 时传递给–set 或 –set-string 参数的values</li></ul><p>当设计values的结构时，记得你的chart用户可能会通过-f 参数或–set选项覆盖他们。<br>由于–set在表现上更有限，编写你values.yaml文件的第一指导原则是确保它容易被–set覆盖。因此使用map构建values文件更好。</p><h3 id="给values-yaml写文档"><a href="#给values-yaml写文档" class="headerlink" title="给values.yaml写文档"></a>给values.yaml写文档</h3><p>values.yaml中每个定义的属性都应该文档化。文档字符串应该以它要描述的属性开头，并至少给出一句描述。</p><h2 id="模板-1"><a href="#模板-1" class="headerlink" title="模板"></a>模板</h2><h3 id="templates-结构"><a href="#templates-结构" class="headerlink" title="templates 结构"></a>templates 结构</h3><p><code>templates/</code>目录结构应该如下：</p><ul><li>如果生成YAML输出，模板文件应该有扩展名.yaml。 扩展名是.tpl可用于生成非格式化内容的模板文件。</li><li>模板文件名称应该使用横杠符号(my-example-configmap.yaml)，不用驼峰记法。</li><li>每个资源的定义应该在它自己的模板文件中。</li><li>模板文件的名称应该反映名称中的资源类型。比如：foo-pod.yaml， bar-svc.yaml</li></ul><h3 id="定义模板的名称"><a href="#定义模板的名称" class="headerlink" title="定义模板的名称"></a>定义模板的名称</h3><p>定义的模板(在<code>&#123;&#123; define &#125;&#125;</code>命令中定义的模板)是可全局访问的。这就意味着chart和所有的子chart都可以访问用<code>&#123;&#123; define &#125;&#125;</code>创建的所有模板。</p><p>因此， 所有定义的模板名称应该被命名空间化。</p><p>正确的：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;- define &quot;nginx.fullname&quot; &#125;&#125;</span><br><span class="line">&#123;&#123;/* ... */&#125;&#125;</span><br><span class="line">&#123;&#123; end -&#125;&#125;</span><br></pre></td></tr></table></figure><p>不正确的：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;- define &quot;fullname&quot; -&#125;&#125;</span><br><span class="line">&#123;&#123;/* ... */&#125;&#125;</span><br><span class="line">&#123;&#123; end -&#125;&#125;</span><br></pre></td></tr></table></figure><p>强烈建议通过<code>helm create</code>命令创建新chart，因为模板名称是根据此最佳实践自动定义的。</p><h3 id="格式化模板"><a href="#格式化模板" class="headerlink" title="格式化模板"></a>格式化模板</h3><p>模板应该使用两个 空格 缩进（永远不要用tab）。<br>模板命令的大括号前后应该使用空格。<br>正确的：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; .foo &#125;&#125;</span><br><span class="line">&#123;&#123; print &quot;foo&quot; &#125;&#125;</span><br><span class="line">&#123;&#123;- print &quot;bar&quot; -&#125;&#125;</span><br></pre></td></tr></table></figure><p>不正确的：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;.foo&#125;&#125;</span><br><span class="line">&#123;&#123;print &quot;foo&quot;&#125;&#125;</span><br><span class="line">&#123;&#123;-print &quot;bar&quot;-&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="生成模板中的空格"><a href="#生成模板中的空格" class="headerlink" title="生成模板中的空格"></a>生成模板中的空格</h3><p>最好在生成的模板中将空格量保持在最小值。尤其是大量的空行不应该相邻出现。但偶尔有空行（尤其在逻辑块之间）是没问题的。</p><h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><p>YAML和Helm模板都有注释标记符。<br>YAML注释：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># This is a comment</span><br><span class="line">type: sprocket</span><br></pre></td></tr></table></figure><p>模板注释：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;- /*</span><br><span class="line">This is a comment.</span><br><span class="line">*/&#125;&#125;</span><br><span class="line">type: frobnitz</span><br></pre></td></tr></table></figure><h3 id="在模板和模板输出中使用JSON"><a href="#在模板和模板输出中使用JSON" class="headerlink" title="在模板和模板输出中使用JSON"></a>在模板和模板输出中使用JSON</h3><p>YAML是JSON的超集。在某些情况下，使用JSON语法比其他YAML表示更具可读性。</p><p>比如，这个YAML更接近表示列表的普通YAML方法：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">arguments:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;--dirname&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;/foo&quot;</span></span><br></pre></td></tr></table></figure><p>但是折叠成JSON列表样式时会更易阅读:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">arguments:</span> [<span class="string">&quot;--dirname&quot;</span>, <span class="string">&quot;/foo&quot;</span>]</span><br></pre></td></tr></table></figure><p>使用JSON可以很好地提高易读性。然而，JSON语法不应用于表示更复杂的结构。</p><h2 id="标签和注释"><a href="#标签和注释" class="headerlink" title="标签和注释"></a>标签和注释</h2><p>建议使用 <code>helm.sh/chart: NAME-VERSION</code> 作为标签，以便操作员可以找到特定chart的所有实例。</p><p>如果元数据项不是用于查询，就应该设置为注释。</p><p>标准标签参考文档：<a target="_blank" rel="noopener" href="https://helm.sh/zh/docs/chart_best_practices/labels/">标签和注释</a></p><h2 id="Pod和Pod模板"><a href="#Pod和Pod模板" class="headerlink" title="Pod和Pod模板"></a>Pod和Pod模板</h2><p>Pod指的是Pod，Pod模板指的是Deployment、ReplicationController、ReplicaSet、DaemonSet、StatefulSet等。</p><p>容器镜像应该使用固定的tag或镜像SHA。不应该使用latest, head, canary等标签或其他被设计为“浮动的”标签。</p><p>所有的Pod模板部分应该指定一个selector。比如：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">selector:</span></span><br><span class="line">  <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app.kubernetes.io/name:</span> <span class="string">MyName</span></span><br><span class="line"><span class="attr">template:</span></span><br><span class="line">  <span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app.kubernetes.io/name:</span> <span class="string">MyName</span></span><br></pre></td></tr></table></figure><h2 id="基于角色的访问控制"><a href="#基于角色的访问控制" class="headerlink" title="基于角色的访问控制"></a>基于角色的访问控制</h2><p>RBAC 资源有：</p><ul><li>ServiceAccount (namespaced)</li><li>Role (namespaced)</li><li>ClusterRole</li><li>RoleBinding (namespaced)</li><li>ClusterRoleBinding</li></ul><p>RBAC和服务账户配置应该使用独立的key。它们是独立的内容。在YAML中将这两个概念分开可以消除歧义使其更加清晰。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rbac:</span></span><br><span class="line">  <span class="comment"># Specifies whether RBAC resources should be created</span></span><br><span class="line">  <span class="attr">create:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">serviceAccount:</span></span><br><span class="line">  <span class="comment"># Specifies whether a ServiceAccount should be created</span></span><br><span class="line">  <span class="attr">create:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># The name of the ServiceAccount to use.</span></span><br><span class="line">  <span class="comment"># If not set and create is true, a name is generated using the fullname template</span></span><br><span class="line">  <span class="attr">name:</span></span><br></pre></td></tr></table></figure><p>rbac.create 应该是布尔值，用于控制RBAC资源是否被创建。默认是 true。用户想自己管理RBAC访问控制时可以设置为false (示例如下)。</p><p>serviceAccount.name 要设置为由chart创建的访问控制资源的ServiceAccount的名称。 如果serviceAccount.create是true，则使用该名称的ServiceAccount会被创建。如果没有设置名称， 则会使用fullname模板生成一个名称。如果serviceAccount.create是false，则不会被创建，但仍然会与相同的资源关联， 以便后续手动创建的引用它的RBAC资源可以正常工作。如果serviceAccount.create是false且没有指定名称， 会使用默认的ServiceAccount。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;/*</span><br><span class="line">Create the name of the service account to use</span><br><span class="line">*/&#125;&#125;</span><br><span class="line">&#123;&#123;- define &quot;mychart.serviceAccountName&quot; -&#125;&#125;</span><br><span class="line">&#123;&#123;- if .Values.serviceAccount.create -&#125;&#125;</span><br><span class="line">    &#123;&#123; default (include &quot;mychart.fullname&quot; .) .Values.serviceAccount.name &#125;&#125;</span><br><span class="line">&#123;&#123;- else -&#125;&#125;</span><br><span class="line">    &#123;&#123; default &quot;default&quot; .Values.serviceAccount.name &#125;&#125;</span><br><span class="line">&#123;&#123;- end -&#125;&#125;</span><br><span class="line">&#123;&#123;- end -&#125;&#125;</span><br></pre></td></tr></table></figure><h1 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h1><h2 id="语法检查"><a href="#语法检查" class="headerlink" title="语法检查"></a>语法检查</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm lint</span><br></pre></td></tr></table></figure><h2 id="测试本地渲染"><a href="#测试本地渲染" class="headerlink" title="测试本地渲染"></a>测试本地渲染</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm template --debug</span><br></pre></td></tr></table></figure><h2 id="测试服务器渲染"><a href="#测试服务器渲染" class="headerlink" title="测试服务器渲染"></a>测试服务器渲染</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install --dry-run --debug</span><br></pre></td></tr></table></figure><h2 id="忽略检查测试服务器渲染"><a href="#忽略检查测试服务器渲染" class="headerlink" title="忽略检查测试服务器渲染"></a>忽略检查测试服务器渲染</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install --dry-run --disable-openapi-validation</span><br></pre></td></tr></table></figure><h2 id="查看安装在服务上的模板"><a href="#查看安装在服务上的模板" class="headerlink" title="查看安装在服务上的模板"></a>查看安装在服务上的模板</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm get manifest</span><br></pre></td></tr></table></figure></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-helm-doc-extract/" title="Helm官方文档摘录">https://www.voidking.com/dev-helm-doc-extract/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/k8s/" rel="tag"># k8s</a> <a href="/tags/helm/" rel="tag"># helm</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-vscode-shortcut-and-config/" rel="prev" title="VSCode常用快捷键和配置"><i class="fa fa-chevron-left"></i> VSCode常用快捷键和配置</a></div><div class="post-nav-item"> <a href="/dev-ks-clickhouse-problem/" rel="next" title="ks部署clickhouse验证仓库问题">ks部署clickhouse验证仓库问题<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><div class="_xduxciwe4ao"></div><div class="_ft8kcphe7kl"></div><script type="text/javascript">(window.slotbydup=window.slotbydup||[]).push({id:"u6921432",container:"_ft8kcphe7kl",async:!0})</script><script type="text/javascript">(window.slotbydup=window.slotbydup||[]).push({id:"u6920911",container:"_xduxciwe4ao",async:!0}),(window.slotbydup=window.slotbydup||[]).push({id:"u6920919",container:"_053ydasmd31h",async:!0}),(window.slotbydup=window.slotbydup||[]).push({id:"u6921432",container:"_ft8kcphe7kl",async:!0})</script><script type="text/javascript" src="//cpro.baidustatic.com/cpro/ui/cm.js" async="async" defer="defer"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Helm%E4%B8%89%E5%A4%A7%E6%A6%82%E5%BF%B5"><span class="nav-number">2.</span> <span class="nav-text">Helm三大概念</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Helm%E5%AE%89%E8%A3%85%E8%B5%84%E6%BA%90%E7%9A%84%E9%A1%BA%E5%BA%8F"><span class="nav-number">3.</span> <span class="nav-text">Helm安装资源的顺序</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chart%E6%A8%A1%E6%9D%BF%E6%8C%87%E5%8D%97"><span class="nav-number">4.</span> <span class="nav-text">Chart模板指南</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF"><span class="nav-number">4.1.</span> <span class="nav-text">模板</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="nav-number">4.2.</span> <span class="nav-text">变量和作用域</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B"><span class="nav-number">4.3.</span> <span class="nav-text">变量类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%91%BD%E5%90%8D%E6%A8%A1%E6%9D%BF"><span class="nav-number">4.4.</span> <span class="nav-text">命名模板</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NOTES-txt%E6%96%87%E4%BB%B6"><span class="nav-number">4.5.</span> <span class="nav-text">NOTES.txt文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#helmignore-%E6%96%87%E4%BB%B6"><span class="nav-number">4.6.</span> <span class="nav-text">.helmignore 文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#YAML%E6%8A%80%E6%9C%AF"><span class="nav-number">4.7.</span> <span class="nav-text">YAML技术</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chart%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7"><span class="nav-number">5.</span> <span class="nav-text">Chart开发技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95"><span class="nav-number">5.1.</span> <span class="nav-text">模板方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Partials%E5%92%8C%E6%A8%A1%E6%9D%BF%E5%BC%95%E7%94%A8"><span class="nav-number">5.2.</span> <span class="nav-text">使用Partials和模板引用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F%E6%8B%89%E5%8F%96%E5%AF%86%E9%92%A5"><span class="nav-number">5.3.</span> <span class="nav-text">创建镜像拉取密钥</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#YAML%E6%98%AFJSON%E7%9A%84%E8%B6%85%E9%9B%86"><span class="nav-number">5.4.</span> <span class="nav-text">YAML是JSON的超集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E5%A4%8D%E6%9D%82Chart"><span class="nav-number">5.5.</span> <span class="nav-text">构建复杂Chart</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">6.</span> <span class="nav-text">最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E8%88%AC%E6%83%AF%E4%BE%8B"><span class="nav-number">6.1.</span> <span class="nav-text">一般惯例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#chart%E5%90%8D%E7%A7%B0"><span class="nav-number">6.1.1.</span> <span class="nav-text">chart名称</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%88%E6%9C%AC%E5%8F%B7"><span class="nav-number">6.1.2.</span> <span class="nav-text">版本号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96YAML"><span class="nav-number">6.1.3.</span> <span class="nav-text">格式化YAML</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Helm-%E5%92%8C-Chart%E7%9A%84%E7%94%A8%E6%B3%95"><span class="nav-number">6.1.4.</span> <span class="nav-text">Helm 和 Chart的用法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Values"><span class="nav-number">6.2.</span> <span class="nav-text">Values</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83"><span class="nav-number">6.2.1.</span> <span class="nav-text">命名规范</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%81%E5%B9%B3%E6%88%96%E5%B5%8C%E5%A5%97%E7%9A%84Value"><span class="nav-number">6.2.2.</span> <span class="nav-text">扁平或嵌套的Value</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E6%B8%85%E6%A5%9A"><span class="nav-number">6.2.3.</span> <span class="nav-text">类型清楚</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%80%83%E8%99%91%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8value"><span class="nav-number">6.2.4.</span> <span class="nav-text">考虑用户使用value</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%99values-yaml%E5%86%99%E6%96%87%E6%A1%A3"><span class="nav-number">6.2.5.</span> <span class="nav-text">给values.yaml写文档</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF-1"><span class="nav-number">6.3.</span> <span class="nav-text">模板</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#templates-%E7%BB%93%E6%9E%84"><span class="nav-number">6.3.1.</span> <span class="nav-text">templates 结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E6%A8%A1%E6%9D%BF%E7%9A%84%E5%90%8D%E7%A7%B0"><span class="nav-number">6.3.2.</span> <span class="nav-text">定义模板的名称</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%A8%A1%E6%9D%BF"><span class="nav-number">6.3.3.</span> <span class="nav-text">格式化模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E6%A8%A1%E6%9D%BF%E4%B8%AD%E7%9A%84%E7%A9%BA%E6%A0%BC"><span class="nav-number">6.3.4.</span> <span class="nav-text">生成模板中的空格</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E9%87%8A"><span class="nav-number">6.3.5.</span> <span class="nav-text">注释</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E6%A8%A1%E6%9D%BF%E5%92%8C%E6%A8%A1%E6%9D%BF%E8%BE%93%E5%87%BA%E4%B8%AD%E4%BD%BF%E7%94%A8JSON"><span class="nav-number">6.3.6.</span> <span class="nav-text">在模板和模板输出中使用JSON</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%87%E7%AD%BE%E5%92%8C%E6%B3%A8%E9%87%8A"><span class="nav-number">6.4.</span> <span class="nav-text">标签和注释</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pod%E5%92%8CPod%E6%A8%A1%E6%9D%BF"><span class="nav-number">6.5.</span> <span class="nav-text">Pod和Pod模板</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E8%A7%92%E8%89%B2%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="nav-number">6.6.</span> <span class="nav-text">基于角色的访问控制</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B0%83%E8%AF%95"><span class="nav-number">7.</span> <span class="nav-text">调试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%E6%A3%80%E6%9F%A5"><span class="nav-number">7.1.</span> <span class="nav-text">语法检查</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%9C%AC%E5%9C%B0%E6%B8%B2%E6%9F%93"><span class="nav-number">7.2.</span> <span class="nav-text">测试本地渲染</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%B8%B2%E6%9F%93"><span class="nav-number">7.3.</span> <span class="nav-text">测试服务器渲染</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%BD%E7%95%A5%E6%A3%80%E6%9F%A5%E6%B5%8B%E8%AF%95%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%B8%B2%E6%9F%93"><span class="nav-number">7.4.</span> <span class="nav-text">忽略检查测试服务器渲染</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%89%E8%A3%85%E5%9C%A8%E6%9C%8D%E5%8A%A1%E4%B8%8A%E7%9A%84%E6%A8%A1%E6%9D%BF"><span class="nav-number">7.5.</span> <span class="nav-text">查看安装在服务上的模板</span></a></li></ol></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="_053ydasmd31h"></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">645</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">242</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>