<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="Prometheus简介 Prometheus是在SoundCloud的基础上构建的开源系统监视和警报工具。自从2012年以来，许多公司和组织都采用了Prometheus，该项目拥有非常活跃的开发人员和用户社区。现在，它是一个独立的开源项目，并且独立于任何公司进行维护。为了强调这一点并阐明项目的治理结构，Prometheus在2016年加入了Cloud Native Computing Found"><meta property="og:type" content="article"><meta property="og:title" content="使用Docker安装配置Prometheus"><meta property="og:url" content="https://www.voidking.com/dev-docker-prometheus/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="Prometheus简介 Prometheus是在SoundCloud的基础上构建的开源系统监视和警报工具。自从2012年以来，许多公司和组织都采用了Prometheus，该项目拥有非常活跃的开发人员和用户社区。现在，它是一个独立的开源项目，并且独立于任何公司进行维护。为了强调这一点并阐明项目的治理结构，Prometheus在2016年加入了Cloud Native Computing Found"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com/@/imgs/docker-prometheus/graph.jpg?imageView2/0/w/800"><meta property="og:image" content="http://cdn.voidking.com/@/imgs/docker-prometheus/targets.jpg?imageView2/0/w/800"><meta property="og:image" content="http://cdn.voidking.com/@/imgs/docker-prometheus/metrics.jpg?imageView2/0/w/800"><meta property="og:image" content="http://cdn.voidking.com/@/imgs/docker-prometheus/targets2.png?imageView2/0/w/800"><meta property="og:image" content="http://cdn.voidking.com/@/imgs/docker-prometheus/pushgateway.png?imageView2/0/w/800"><meta property="og:image" content="http://cdn.voidking.com/@/imgs/docker-prometheus/pushgateway2.png?imageView2/0/w/800"><meta property="og:image" content="http://cdn.voidking.com/@/imgs/docker-prometheus/chinese.png?imageView2/0/w/800"><meta property="og:image" content="http://cdn.voidking.com/@/imgs/docker-prometheus/alertmanager.png?imageView2/0/w/800"><meta property="og:image" content="http://cdn.voidking.com/@/imgs/docker-prometheus/alert.jpg?imageView2/0/w/800"><meta property="og:image" content="http://cdn.voidking.com/@/imgs/docker-prometheus/alert.png?imageView2/0/w/800"><meta property="og:image" content="http://cdn.voidking.com/@/imgs/docker-prometheus/webhook.png?imageView2/0/w/800"><meta property="article:published_time" content="2020-06-16T20:00:00.000Z"><meta property="article:modified_time" content="2020-07-30T06:46:04.549Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="docker"><meta property="article:tag" content="centos"><meta property="article:tag" content="监控"><meta property="article:tag" content="prometheus"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com/@/imgs/docker-prometheus/graph.jpg?imageView2/0/w/800"><link rel="canonical" href="https://www.voidking.com/dev-docker-prometheus/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>使用Docker安装配置Prometheus | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-docker-prometheus/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> 使用Docker安装配置Prometheus</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-06-16 20:00:00" itemprop="dateCreated datePublished" datetime="2020-06-16T20:00:00+00:00">2020-06-16</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/" itemprop="url" rel="index"><span itemprop="name">专业</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/%E7%9B%91%E6%8E%A7/" itemprop="url" rel="index"><span itemprop="name">监控</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="Prometheus简介"><a href="#Prometheus简介" class="headerlink" title="Prometheus简介"></a>Prometheus简介</h1><blockquote><p>Prometheus是在SoundCloud的基础上构建的开源系统监视和警报工具。自从2012年以来，许多公司和组织都采用了Prometheus，该项目拥有非常活跃的开发人员和用户社区。现在，它是一个独立的开源项目，并且独立于任何公司进行维护。为了强调这一点并阐明项目的治理结构，Prometheus在2016年加入了Cloud Native Computing Foundation，这是继Kubernetes之后的第二个托管项目。</p></blockquote><p>Prometheus的主要特性包括：</p><ul><li>一个包含时间序列的多维数据模型，由指标名称和键值对进行标记</li><li>PromQL，一种灵活的查询语言</li><li>不依赖分布式存储；单服务器节点是自治的</li><li>时间序列收集是通过HTTP拉取模型实现的</li><li>支持通过中间网关推送时间序列</li><li>通过服务发现或静态配置发现目标</li><li>支持多种图形和仪表板</li></ul><p>Prometheus生态系统包含多个组件，其中许多是可选的：</p><ul><li>prometheus server，负责收取并存储时间序列数据</li><li>client libraries，用于检测应用程序代码</li><li>push gateway，支持短期工作</li><li>exporters，适用于特定服务的指标收集器，如HAProxy，StatsD，Graphite</li><li>alertmanager，处理报警</li><li>各种支持工具</li></ul><p>更多内容参考<a href="https://prometheus.io/docs/introduction/overview/" target="_blank" rel="noopener">Prometheus文档</a>。<br>本文中，我们会使用Docker来安装配置Prometheus，主要参考<a href="https://www.cnblogs.com/informatics/p/12215255.html" target="_blank" rel="noopener">Prometheus监控系统之入门篇</a>。<br>前置条件是安装配置好了docker环境，安装方法参考<a href="https://www.voidking.com/dev-docker-start/">《Docker入门》</a>。已知docker宿主机IP为192.168.56.102。</p><a id="more"></a><h1 id="prometheus-server"><a href="#prometheus-server" class="headerlink" title="prometheus server"></a>prometheus server</h1><p>1、登录dockerhub查看需要的<a href="https://hub.docker.com/r/prom/prometheus" target="_blank" rel="noopener">prometheus server</a>。</p><p>2、下载prometheus server镜像（以v2.18.0为例）<br><code>docker pull prom/prometheus:v2.18.0</code></p><p>3、创建配置文件<br>创建prometheus.yml，内容为</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">15s</span> <span class="comment">#默认采集监控数据时间间隔</span></span><br><span class="line">  <span class="attr">external_labels:</span></span><br><span class="line">    <span class="attr">monitor:</span> <span class="string">'my-monitor'</span></span><br><span class="line"><span class="attr">scrape_configs:</span>  <span class="comment">#监控对象设置</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">prometheus</span> <span class="comment">#任务名称</span></span><br><span class="line">    <span class="attr">scrape_interval:</span> <span class="string">5s</span> <span class="comment">#每隔5s获取一次监控数据</span></span><br><span class="line">    <span class="attr">static_configs:</span> <span class="comment">#监控对象地址</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> <span class="string">['127.0.0.1:9090']</span>  <span class="comment"># 将自己加入到监控对象中</span></span><br></pre></td></tr></table></figure><p>创建rules.yml，内容为空。</p><p>4、启动prometheus server</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run <span class="params">--name=prometheus</span> -d \</span><br><span class="line">-p 9090<span class="function">:9090</span> \</span><br><span class="line">-v $<span class="params">(pwd)</span><span class="string">/prometheus.yml</span>:<span class="string">/etc/prometheus/prometheus.yml</span> \</span><br><span class="line">-v $<span class="params">(pwd)</span><span class="string">/rules.yml</span>:<span class="string">/etc/prometheus/rules.yml</span> \</span><br><span class="line">prom/prometheus<span class="function">:v2.18.0</span> <span class="params">--config</span>.file=<span class="string">/etc/prometheus/prometheus.yml</span> <span class="params">--web</span>.enable-lifecycle</span><br></pre></td></tr></table></figure><p>5、测试服务<br>浏览器访问 <a href="http://192.168.56.102:9090/" target="_blank" rel="noopener">http://192.168.56.102:9090/</a><br><img src="http://cdn.voidking.com/@/imgs/docker-prometheus/graph.jpg?imageView2/0/w/800" alt=""></p><p>6、查看targets<br>浏览器访问 <a href="http://192.168.56.102:9090/targets/" target="_blank" rel="noopener">http://192.168.56.102:9090/targets/</a><br><img src="http://cdn.voidking.com/@/imgs/docker-prometheus/targets.jpg?imageView2/0/w/800" alt=""></p><p>7、查看指标<br>浏览器访问 <a href="http://192.168.56.102:9090/metrics/" target="_blank" rel="noopener">http://192.168.56.102:9090/metrics/</a><br><img src="http://cdn.voidking.com/@/imgs/docker-prometheus/metrics.jpg?imageView2/0/w/800" alt=""></p><h1 id="node-exporter"><a href="#node-exporter" class="headerlink" title="node exporter"></a>node exporter</h1><p>1、登录dockerhub查看需要的<a href="https://hub.docker.com/r/prom/node-exporter" target="_blank" rel="noopener">node exporter</a>。</p><p>2、下载node-exporter镜像（以v1.0.0为例）<br><code>docker pull prom/node-exporter:v1.0.0</code></p><p>3、启动node exporter</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run --<span class="attr">name=</span><span class="keyword">node</span><span class="title">-exporter</span> -d \</span><br><span class="line">-p <span class="number">9100</span>:<span class="number">9100</span> \</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run --<span class="attr">name=</span><span class="keyword">node</span><span class="title">-exporter</span> -d \</span><br><span class="line">  -p <span class="number">9100</span>:<span class="number">9100</span> \</span><br><span class="line">  --<span class="attr">net=</span><span class="string">"host"</span> \</span><br><span class="line">  --<span class="attr">pid=</span><span class="string">"host"</span> \</span><br><span class="line">  -v <span class="string">"/:/host:ro,rslave"</span> \</span><br><span class="line">  prom/<span class="keyword">node</span>-exporter:<span class="title">v1</span>.<span class="number">0.0</span> \</span><br><span class="line">  --path.<span class="attr">rootfs=</span>/host</span><br></pre></td></tr></table></figure><h1 id="promserver收集exporter数据"><a href="#promserver收集exporter数据" class="headerlink" title="promserver收集exporter数据"></a>promserver收集exporter数据</h1><p>1、修改prometheus.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">15s</span> <span class="comment">#默认采集监控数据时间间隔</span></span><br><span class="line">  <span class="attr">external_labels:</span></span><br><span class="line">    <span class="attr">monitor:</span> <span class="string">'my-monitor'</span></span><br><span class="line"><span class="attr">scrape_configs:</span>  <span class="comment">#监控对象设置</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">prometheus</span> <span class="comment">#任务名称</span></span><br><span class="line">    <span class="attr">scrape_interval:</span> <span class="string">5s</span> <span class="comment">#每隔5s获取一次监控数据</span></span><br><span class="line">    <span class="attr">static_configs:</span> <span class="comment">#监控对象地址</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> <span class="string">['127.0.0.1:9090']</span>  <span class="comment"># 将自己加入到监控对象中</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> <span class="string">['192.168.56.102:9100']</span></span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">group:</span> <span class="string">'client-node-exporter'</span></span><br></pre></td></tr></table></figure><p>2、重新加载配置文件<br><code>curl -X POST http://localhost:9090/-/reload</code><br>然而我重新加载配置文件并不生效，最后重启了prometheus server。</p><p>3、查看targets<br>浏览器访问 <a href="http://192.168.56.102:9090/targets/" target="_blank" rel="noopener">http://192.168.56.102:9090/targets/</a><br><img src="http://cdn.voidking.com/@/imgs/docker-prometheus/targets2.png?imageView2/0/w/800" alt=""></p><h1 id="push-gateway"><a href="#push-gateway" class="headerlink" title="push gateway"></a>push gateway</h1><p>Prometheus采集数据是用的pull方式，prometheus配置文件设置的5秒就是采集数据的频率。但是有些数据并不适合采用这样的方式，对这样的数据可以使用Push Gateway服务。PushGateway比较适合临时作业和批处理作业，由于这些作业是short-lived的，如果采用pull的模式，可能在prometheus采集之前，作业已经执行结束。pushgateway相当于一个暂存器，这些临时作业将metrics数据缓存到pushgateway中，然后等待Prometheus来pull数据。</p><p>1、登录dockerhub查看需要的<a href="https://hub.docker.com/r/prom/pushgateway" target="_blank" rel="noopener">pushgateway</a>。</p><p>2、下载pushgateway镜像（以v1.1.0为例）<br><code>docker pull prom/pushgateway:v1.1.0</code></p><p>3、启动push gateway</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run --name=pushgateway -d \</span><br><span class="line">-p <span class="number">9091</span>:<span class="number">9091</span> \</span><br><span class="line">prom/pushgateway:v1<span class="number">.1</span><span class="number">.0</span></span><br></pre></td></tr></table></figure><p>4、测试服务<br>浏览器访问 <a href="http://192.168.56.102:9091/#" target="_blank" rel="noopener">http://192.168.56.102:9091/#</a><br><img src="http://cdn.voidking.com/@/imgs/docker-prometheus/pushgateway.png?imageView2/0/w/800" alt=""></p><p>5、推送数据给push gateway</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="string">"exam_metric 100"</span> | curl --data-binary @- <span class="symbol">http:</span>/<span class="regexp">/127.0.0.1:9091/metrics</span><span class="regexp">/job/exam</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF | curl --data-binary @- <span class="symbol">http:</span>/<span class="regexp">/127.0.0.1:9091/metrics</span><span class="regexp">/job/exam</span><span class="regexp">/instance/test</span></span><br><span class="line">chinese <span class="number">120</span></span><br><span class="line">math <span class="number">150</span></span><br><span class="line">english <span class="number">140</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com/@/imgs/docker-prometheus/pushgateway2.png?imageView2/0/w/800" alt=""></p><h1 id="promserver收集pushgateway数据"><a href="#promserver收集pushgateway数据" class="headerlink" title="promserver收集pushgateway数据"></a>promserver收集pushgateway数据</h1><p>1、修改prometheus.yml文件</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">global</span>:</span><br><span class="line">  <span class="attribute">scrape_interval</span>: <span class="number">15s</span> #默认采集监控数据时间间隔</span><br><span class="line">  <span class="attribute">external_labels</span>:</span><br><span class="line">    <span class="attribute">monitor</span>: <span class="string">'my-monitor'</span></span><br><span class="line"><span class="attribute">scrape_configs</span>:  #监控对象设置</span><br><span class="line">  - <span class="attribute">job_name</span>: prometheus #任务名称</span><br><span class="line">    <span class="attribute">scrape_interval</span>: <span class="number">5s</span> #每隔<span class="number">5s</span>获取一次监控数据</span><br><span class="line">    <span class="attribute">static_configs</span>: #监控对象地址</span><br><span class="line">      - <span class="attribute">targets</span>: [<span class="string">'127.0.0.1:9090'</span>]  # 将自己加入到监控对象中</span><br><span class="line">      - <span class="attribute">targets</span>: [<span class="string">'192.168.56.102:9100'</span>]</span><br><span class="line">        <span class="attribute">labels</span>:</span><br><span class="line">          <span class="attribute">group</span>: <span class="string">'client-node-exporter'</span></span><br><span class="line">      - <span class="attribute">targets</span>: [<span class="string">'192.168.56.102:9091'</span>]</span><br><span class="line">        <span class="attribute">labels</span>:</span><br><span class="line">          <span class="attribute">group</span>: <span class="string">'pushgateway'</span></span><br></pre></td></tr></table></figure><p>2、重新加载配置或者重启promserver</p><p>3、在promserver查看数据<br><img src="http://cdn.voidking.com/@/imgs/docker-prometheus/chinese.png?imageView2/0/w/800" alt=""></p><h1 id="alertmanager"><a href="#alertmanager" class="headerlink" title="alertmanager"></a>alertmanager</h1><p>1、登录dockerhub查看需要的<a href="https://hub.docker.com/r/prom/alertmanager" target="_blank" rel="noopener">alertmanager</a>。</p><p>2、下载alertmanager镜像（以v0.15.0为例）<br><code>docker pull prom/alertmanager:v0.15.0</code></p><p>高版本比如v0.20.0打开页面后会报错，Uncaught TypeError: Cannot read property ‘elmFs’ of undefined</p><p>3、创建配置文件alertmanager.yml</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">global</span>:</span><br><span class="line">  <span class="attribute">resolve_timeout</span>: <span class="number">5</span>m</span><br><span class="line"><span class="attribute">route</span>:</span><br><span class="line">  <span class="attribute">group_by</span>: [<span class="string">'exam'</span>]  #与prometheus配置文件rules.yml中配置规则名对应</span><br><span class="line">  <span class="attribute">group_wait</span>: <span class="number">10s</span> #报警等待时间</span><br><span class="line">  <span class="attribute">group_interval</span>: <span class="number">10s</span> #报警间隔时间</span><br><span class="line">  <span class="attribute">repeat_interval</span>: <span class="number">1</span>m #重复报警间隔时间</span><br><span class="line">  <span class="attribute">receiver</span>: <span class="string">'web.hook'</span> #告警处理方式，我们这里通过web.hook方式，也可以配置成邮件等方式</span><br><span class="line"><span class="attribute">receivers</span>:</span><br><span class="line">  - <span class="attribute">name</span>: <span class="string">'web.hook'</span></span><br><span class="line">    <span class="attribute">webhook_configs</span>:</span><br><span class="line">      - <span class="attribute">url</span>: <span class="string">'http://192.168.56.102:8080/exam/test'</span> #告警webhook地址，告警信息会post到该地址，需要编写服务接收该告警数据</span><br><span class="line"><span class="attribute">inhibit_rules</span>:</span><br><span class="line">  - <span class="attribute">source_match</span>:</span><br><span class="line">      <span class="attribute">severity</span>: <span class="string">'critical'</span></span><br><span class="line">    <span class="attribute">target_match</span>:</span><br><span class="line">      <span class="attribute">severity</span>: <span class="string">'warning'</span> #目标告警状态</span><br><span class="line">    <span class="attribute">equal</span>: [<span class="string">'alertname'</span>, <span class="string">'dev'</span>, <span class="string">'instance'</span>]</span><br></pre></td></tr></table></figure><p>4、启动push gateway</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="builtin-name">run</span> <span class="attribute">--name</span>=alertmanager -d \</span><br><span class="line">-p 9093:9093 \</span><br><span class="line">-v $(pwd)/alertmanager.yml:/etc/alertmanager/alertmanager.yml \</span><br><span class="line">prom/alertmanager:v0.15.0 --config.<span class="attribute">file</span>=/etc/alertmanager/alertmanager.yml --storage.<span class="attribute">path</span>=/alertmanager</span><br></pre></td></tr></table></figure><p>5、测试服务<br>浏览器访问 <a href="http://192.168.56.102:9093/" target="_blank" rel="noopener">http://192.168.56.102:9093/</a><br><img src="http://cdn.voidking.com/@/imgs/docker-prometheus/alertmanager.png?imageView2/0/w/800" alt=""></p><h1 id="告警配置"><a href="#告警配置" class="headerlink" title="告警配置"></a>告警配置</h1><p>1、编辑rules.yml，设置报警规则</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">groups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">exam</span></span><br><span class="line">    <span class="attr">rules:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">exam告警测试</span></span><br><span class="line">        <span class="attr">expr:</span> <span class="string">chinese</span> <span class="string">&gt;</span> <span class="number">100</span> <span class="comment">#语文成绩大于100告警，注：我们在pushgateway推送数据的时候，设置的是120，因此会触发告警</span></span><br><span class="line">        <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">status:</span> <span class="string">warning</span></span><br><span class="line">        <span class="attr">annotations:</span></span><br><span class="line">          <span class="attr">summary:</span> <span class="string">"<span class="template-variable">&#123;&#123;$labels.instance&#125;&#125;</span>:语文成绩优秀! nb了!!!"</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">"<span class="template-variable">&#123;&#123;$labels.instance&#125;&#125;</span>: 语文成绩优秀! nbnbnb!!!"</span></span><br></pre></td></tr></table></figure><p>2、编辑prometheus.yml配置文件，添加alertmanager配置和rules.yml文件</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">15s</span> <span class="comment">#默认采集监控数据时间间隔</span></span><br><span class="line">  <span class="attr">external_labels:</span></span><br><span class="line">    <span class="attr">monitor:</span> <span class="string">'my-monitor'</span></span><br><span class="line"><span class="attr">scrape_configs:</span>  <span class="comment">#监控对象设置</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">prometheus</span> <span class="comment">#任务名称</span></span><br><span class="line">    <span class="attr">scrape_interval:</span> <span class="string">5s</span> <span class="comment">#每隔5s获取一次监控数据</span></span><br><span class="line">    <span class="attr">static_configs:</span> <span class="comment">#监控对象地址</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> <span class="string">['127.0.0.1:9090']</span>  <span class="comment"># 将自己加入到监控对象中</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> <span class="string">['192.168.56.102:9100']</span></span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">group:</span> <span class="string">'client-node-exporter'</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> <span class="string">['192.168.56.102:9091']</span></span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">group:</span> <span class="string">'pushgateway'</span></span><br><span class="line"><span class="attr">rule_files:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">/etc/prometheus/rules.yml</span>   <span class="comment">#告警规则文件路径</span></span><br><span class="line"><span class="attr">alerting:</span>   <span class="comment">#告警管理器设置</span></span><br><span class="line">  <span class="attr">alertmanagers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> <span class="string">['192.168.56.102:9093']</span> <span class="comment">#告警信息会发送给alertmanager进一步处理</span></span><br></pre></td></tr></table></figure><p>3、重新加载配置或者重启promserver</p><p>4、在<a href="http://192.168.56.102:9090/alerts/" target="_blank" rel="noopener">prometheus alerts页面</a>查看告警<br><img src="http://cdn.voidking.com/@/imgs/docker-prometheus/alert.jpg?imageView2/0/w/800" alt=""></p><p>或者在<a href="http://192.168.56.102:9093/#/alerts" target="_blank" rel="noopener">alertmanager alerts页面</a>查看告警<br><img src="http://cdn.voidking.com/@/imgs/docker-prometheus/alert.png?imageView2/0/w/800" alt=""></p><h1 id="告警通知处理"><a href="#告警通知处理" class="headerlink" title="告警通知处理"></a>告警通知处理</h1><p>alertmanager.yml文件中配置的告警方式是webhook，告警发送到 <a href="http://192.168.56.102:8080/exam/test" target="_blank" rel="noopener">http://192.168.56.102:8080/exam/test</a> ，因此，我们需要一个服务来接收处理这个告警。</p><p>1、安装golang环境，参考<a href="https://www.voidking.com/dev-centos7-beego-env/">《CentOS7部署beego项目》</a>golang安装一节</p><p>2、创建main.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"io/ioutil"</span></span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.POST(<span class="string">"/exam/test"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		res, _ := ioutil.ReadAll(c.Request.Body)</span><br><span class="line">		fmt.Println(<span class="keyword">string</span>(res)) <span class="comment">//这里我们只简单打印告警信息</span></span><br><span class="line">		c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line">			<span class="string">"message"</span>: <span class="string">"alert message"</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">	r.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3、运行代码</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> <span class="built_in">get</span> github.<span class="keyword">com</span>/gin-gonic/gin</span><br><span class="line"><span class="keyword">go</span> run main.<span class="keyword">go</span></span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com/@/imgs/docker-prometheus/webhook.png?imageView2/0/w/800" alt=""><br>如上图，服务接收到了告警信息。</p><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><p>更多prometheus配置，参考<a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/" target="_blank" rel="noopener">CONFIGURATION</a> 和 <a href="https://www.bookstack.cn/read/prometheus_practice/configuration-README.md" target="_blank" rel="noopener">Prometheus 配置</a></p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>以上，配置完成了promserver、exporter、pushgateway、alertmanager，跑通了数据的收集和显示，测试了告警信息的收集。本文就到这里，需要用到prometheus的其他内容时，再继续学习，比如<a href="https://thanos.io/" target="_blank" rel="noopener">thanos</a>。</p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/docker/" rel="tag"># docker</a> <a href="/tags/centos/" rel="tag"># centos</a> <a href="/tags/%E7%9B%91%E6%8E%A7/" rel="tag"># 监控</a> <a href="/tags/prometheus/" rel="tag"># prometheus</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-httpload/" rel="prev" title="httpload使用说明"><i class="fa fa-chevron-left"></i> httpload使用说明</a></div><div class="post-nav-item"> <a href="/dev-docker-grafana/" rel="next" title="使用Docker安装配置Grafana">使用Docker安装配置Grafana<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Prometheus简介"><span class="nav-number">1.</span> <span class="nav-text">Prometheus简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#prometheus-server"><span class="nav-number">2.</span> <span class="nav-text">prometheus server</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#node-exporter"><span class="nav-number">3.</span> <span class="nav-text">node exporter</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#promserver收集exporter数据"><span class="nav-number">4.</span> <span class="nav-text">promserver收集exporter数据</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#push-gateway"><span class="nav-number">5.</span> <span class="nav-text">push gateway</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#promserver收集pushgateway数据"><span class="nav-number">6.</span> <span class="nav-text">promserver收集pushgateway数据</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#alertmanager"><span class="nav-number">7.</span> <span class="nav-text">alertmanager</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#告警配置"><span class="nav-number">8.</span> <span class="nav-text">告警配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#告警通知处理"><span class="nav-number">9.</span> <span class="nav-text">告警通知处理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#配置"><span class="nav-number">10.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#后记"><span class="nav-number">11.</span> <span class="nav-text">后记</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">610</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">46</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">193</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://www.beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>