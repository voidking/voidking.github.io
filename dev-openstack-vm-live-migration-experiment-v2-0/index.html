<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//qiniu-cdn.voidking.com/doc/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言《虚拟机在线迁移实验》一文中，进行了一些虚拟机迁移实验，并且记录了迁移过程中的指标数据。但是，实验环境是搭建在VirtualBox虚拟机中的，最终的实验结果不理想，会出现停机时间过长，迁移后实例卡住等问题。而且受限于虚拟机的大小，无法创建m1.xlarge这样的大型实例。 最近参照《Ubuntu16使用Kolla安装OpenStack》和《Kolla安装OpenStack多节点》，在物理机环境"><meta property="og:type" content="article"><meta property="og:title" content="好好学OpenStack：虚拟机在线迁移实验V2——上"><meta property="og:url" content="https://www.voidking.com/dev-openstack-vm-live-migration-experiment-v2-0/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言《虚拟机在线迁移实验》一文中，进行了一些虚拟机迁移实验，并且记录了迁移过程中的指标数据。但是，实验环境是搭建在VirtualBox虚拟机中的，最终的实验结果不理想，会出现停机时间过长，迁移后实例卡住等问题。而且受限于虚拟机的大小，无法创建m1.xlarge这样的大型实例。 最近参照《Ubuntu16使用Kolla安装OpenStack》和《Kolla安装OpenStack多节点》，在物理机环境"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com/img/openstack-vm-live-migration-experiment-v2/flavor.jpg?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com/img/openstack-vm-live-migration-experiment-v2/flavor.png?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com/img/openstack-vm-live-migration-experiment-v2/apachectl.jpg?imageView2/0/w/600"><meta property="article:published_time" content="2019-02-22T09:30:00.000Z"><meta property="article:modified_time" content="2019-02-22T09:30:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="docker"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="apache"><meta property="article:tag" content="openstack"><meta property="article:tag" content="测试"><meta property="article:tag" content="好好学OpenStack"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com/img/openstack-vm-live-migration-experiment-v2/flavor.jpg?imageView2/0/w/600"><link rel="canonical" href="https://www.voidking.com/dev-openstack-vm-live-migration-experiment-v2-0/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>好好学OpenStack：虚拟机在线迁移实验V2——上 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">一个计算机技术爱好者与学习者</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-openstack-vm-live-migration-experiment-v2-0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="一个计算机技术爱好者与学习者"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> 好好学OpenStack：虚拟机在线迁移实验V2——上</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-02-22 09:30:00" itemprop="dateCreated datePublished" datetime="2019-02-22T09:30:00+00:00">2019-02-22</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/testing/" itemprop="url" rel="index"><span itemprop="name">testing</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><span class="post-title-index">1.</span><a href="#前言" class="headerlink" title="前言"></a> 前言</h1><p><a href="https://www.voidking.com/dev-openstack-vm-live-migration-experiment/">《虚拟机在线迁移实验》</a>一文中，进行了一些虚拟机迁移实验，并且记录了迁移过程中的指标数据。但是，实验环境是搭建在VirtualBox虚拟机中的，最终的实验结果不理想，会出现停机时间过长，迁移后实例卡住等问题。而且受限于虚拟机的大小，无法创建m1.xlarge这样的大型实例。</p><p>最近参照<a href="https://www.voidking.com/dev-ubuntu16-kolla-openstack-all-in-one/">《Ubuntu16使用Kolla安装OpenStack》</a>和<a href="https://www.voidking.com/dev-ubuntu16-kolla-openstack-multinode/">《Kolla安装OpenStack多节点》</a>，在物理机环境中重新搭建了OpenStack集群，三个节点分别为controller（network）、compute1、compute2。接下来我们在物理机中重新进行迁移实验，本文记录一下实验的步骤和结果。</p><span id="more"></span><h1 id="实例准备"><span class="post-title-index">2.</span><a href="#实例准备" class="headerlink" title="实例准备"></a> 实例准备</h1><p>1、在horizon控制台，项目，计算，镜像。使用xenial-server-cloudimg-amd64-disk1.img镜像创建ubuntu16的镜像模板。</p><p>2、创建实例类型m1.tiny2，CPU个数为1，内存为512M，磁盘为5GB。</p><p>3、使用ubuntu16的镜像模板创建实例ubuntu0、ubuntu1、ubuntu2、ubuntu3、ubuntu4，实例类型分别选择m1.tiny2、m1.small、m1.medium、m1.large、m1.xlarge。之所以不使用默认的m1.tiny，是因为m1.tiny的磁盘太小，只有1G，无法安装ubuntu16。</p><p><img src="http://cdn.voidking.com/img/openstack-vm-live-migration-experiment-v2/flavor.jpg?imageView2/0/w/600"></p><p>4、创建成功后，分别分配浮动IP。</p><p>PS：在进行迁移实验时，关闭其他实例，防止资源占用产生干扰。</p><h1 id="脚本和软件准备"><span class="post-title-index">3.</span><a href="#脚本和软件准备" class="headerlink" title="脚本和软件准备"></a> 脚本和软件准备</h1><h2 id="总迁移时间"><span class="post-title-index">3.1.</span><a href="#总迁移时间" class="headerlink" title="总迁移时间"></a> 总迁移时间</h2><p>在两个计算节点，新建total-time.sh脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">time1=`grep nova.virt.libvirt.migration /var/lib/docker/volumes/kolla_logs/_data/nova/nova-compute.log | <span class="built_in">tail</span> -n 1 |awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`;</span><br><span class="line">time2=`grep <span class="string">&#x27;VM Stopped&#x27;</span> /var/lib/docker/volumes/kolla_logs/_data/nova/nova-compute.log | <span class="built_in">tail</span> -n 1 | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`;</span><br><span class="line"><span class="comment"># 计算时间差</span></span><br><span class="line"><span class="keyword">time</span>=$(($(date +%s -d <span class="variable">$time2</span>) - $(date +%s -d <span class="variable">$time1</span>)));</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$time</span> s&quot;</span>;</span><br></pre></td></tr></table></figure><h2 id="停机时间"><span class="post-title-index">3.2.</span><a href="#停机时间" class="headerlink" title="停机时间"></a> 停机时间</h2><p>在控制节点，新建downtime.sh脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">transmitted=`grep <span class="string">&#x27;packets transmitted&#x27;</span> ping.log | <span class="built_in">tail</span> -n 1 | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>`</span><br><span class="line">received=`grep <span class="string">&#x27;packets transmitted&#x27;</span> ping.log | <span class="built_in">tail</span> -n 1 | awk <span class="string">&#x27;&#123;print $4&#125;&#x27;</span>`</span><br><span class="line">lost=`<span class="built_in">expr</span> <span class="variable">$transmitted</span> - <span class="variable">$received</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;downtime is <span class="variable">$lost</span> ms&quot;</span></span><br></pre></td></tr></table></figure><h2 id="迁移数据量"><span class="post-title-index">3.3.</span><a href="#迁移数据量" class="headerlink" title="迁移数据量"></a> 迁移数据量</h2><p>在两个计算节点，安装iptraf-ng。<br><code>apt install iptraf-ng</code></p><h2 id="apache"><span class="post-title-index">3.4.</span><a href="#apache" class="headerlink" title="apache"></a> apache</h2><p>在ubuntu0等实例中安装apache：<br><code>apt install apache2</code><br>安装的默认版本为Apache/2.4.18 (Ubuntu)。</p><h2 id="apachebench"><span class="post-title-index">3.5.</span><a href="#apachebench" class="headerlink" title="apachebench"></a> apachebench</h2><p>在控制节点，安装apachebench：<br><code>apt install apache2-utils</code></p><p>在控制节点，新建format.sh脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">filename=<span class="variable">$1</span></span><br><span class="line">start_time=`awk <span class="string">&#x27;&#123;print $6&#125;&#x27;</span> <span class="variable">$filename</span> | grep -v <span class="string">&#x27;wait&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c|<span class="built_in">head</span> -1|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">awk <span class="string">&#x27;&#123;print $6&#125;&#x27;</span> <span class="variable">$filename</span> | grep -v <span class="string">&#x27;wait&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c|awk -v t=<span class="variable">$start_time</span> <span class="string">&#x27;&#123;print $2-t,$1&#125;&#x27;</span> &gt; f-<span class="variable">$filename</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 填充0</span></span><br><span class="line">array_str=`<span class="built_in">cat</span> f-<span class="variable">$filename</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>`</span><br><span class="line">array_str2=`<span class="built_in">cat</span> f-<span class="variable">$filename</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">IPS=<span class="string">&#x27; &#x27;</span></span><br><span class="line">array=(<span class="variable">$array_str</span>)</span><br><span class="line">array2=(<span class="variable">$array_str2</span>)</span><br><span class="line"></span><br><span class="line">index=0</span><br><span class="line">count=0</span><br><span class="line">max=101</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;#Throutput-<span class="variable">$filename</span>&quot;</span> &gt; ff-<span class="variable">$filename</span></span><br><span class="line"><span class="keyword">while</span> ( [ <span class="variable">$index</span> -lt <span class="variable">$max</span> ] &amp;&amp; [ <span class="variable">$count</span> -lt <span class="variable">$max</span> ] )</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="variable">$&#123;array[index]&#125;</span> == <span class="variable">$count</span> ]]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$count</span> <span class="variable">$&#123;array2[index]&#125;</span>&quot;</span> &gt;&gt; ff-<span class="variable">$filename</span></span><br><span class="line">        index=`<span class="built_in">expr</span> <span class="variable">$index</span> + 1`</span><br><span class="line">        count=`<span class="built_in">expr</span> <span class="variable">$count</span> + 1`</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$count</span> 0&quot;</span>  &gt;&gt; ff-<span class="variable">$filename</span></span><br><span class="line">        count=`<span class="built_in">expr</span> <span class="variable">$count</span> + 1`</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="xshell"><span class="post-title-index">3.6.</span><a href="#xshell" class="headerlink" title="xshell"></a> xshell</h2><p>使用xshell，打开3个controller节点的shell，一个用来ping实例，一个用来运行apachebench，一个用来执行迁移命令。打开2个compute1节点的shell，一个用来运行iptraf-ng，一个用来执行total-time.sh脚本。打开2个compute2节点的shell，一个用来运行iptraf-ng，一个用来执行total-time.sh脚本。</p><h1 id="实验流程"><span class="post-title-index">4.</span><a href="#实验流程" class="headerlink" title="实验流程"></a> 实验流程</h1><p>假设当前只启动了ubuntu0实例，<code>nova show ubuntu0</code>位于compute1节点。</p><p>1、在实例中启动压力测试软件，或者在两个compute节点中启动网络故障模拟软件。（flavor实验中不需要）</p><p>2、在两个compute节点启动iptraf-ng，配置参考<a href="https://www.voidking.com/dev-openstack-vm-live-migration-performance/">《虚拟机在线迁移的性能统计》</a>。</p><p>3、在三个controller的shell中分别输入好一条命令：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo</span> ping <span class="number">172.16.0.19</span> -i <span class="number">0</span>.<span class="number">001</span> &gt;&gt; ping.log</span><br><span class="line"><span class="attribute">ab</span> -g t0.dat -t <span class="number">100</span> -n <span class="number">1000000</span> http://<span class="number">172.16.0.19</span>/</span><br><span class="line"><span class="attribute">nova</span> live-migration ubuntu0 compute2</span><br></pre></td></tr></table></figure><p>然后，依次回车执行这些命令。</p><p>4、观察compute节点的iptraf-ng，等到流量不再增加，Ctrl+C结束ping命令。</p><p>5、在controller节点执行downtime.sh得到停机时间，在compute1节点执行total-time.sh得到迁移时间，在两个计算节点观察iptraf-ng得到迁移数据量。</p><p>6、等到ab命令结束，执行<code>./format.sh t0.dat</code>，得到吞吐量数据ff-t0.dat。</p><p>以上流程，适用于接下来的所有实验。</p><h1 id="flavor实验"><span class="post-title-index">5.</span><a href="#flavor实验" class="headerlink" title="flavor实验"></a> flavor实验</h1><p>1、按照实验流程，分别使用五个flavor，进行五次迁移实验，记录实验结果。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Flavor    迁移时间s    停机时间ms    迁出数据量MB   迁入数据量MB</span></span><br><span class="line"><span class="attribute">tiny</span>    <span class="number">19</span>  <span class="number">483</span>    <span class="number">456</span>  <span class="number">459</span></span><br><span class="line"><span class="attribute">small</span>   <span class="number">20</span>  <span class="number">533</span>    <span class="number">443</span>  <span class="number">446</span></span><br><span class="line"><span class="attribute">medium</span>  <span class="number">21</span>  <span class="number">509</span>    <span class="number">491</span>  <span class="number">494</span></span><br><span class="line"><span class="attribute">large</span>   <span class="number">22</span>  <span class="number">455</span>    <span class="number">592</span>  <span class="number">596</span></span><br><span class="line"><span class="attribute">xlarge</span>  <span class="number">24</span>  <span class="number">531</span>    <span class="number">829</span>  <span class="number">834</span></span><br></pre></td></tr></table></figure><p>2、同时得到五个吞吐量数据文件，ff-t0.dat到ff-t4.dat。</p><h1 id="吞吐量问题"><span class="post-title-index">6.</span><a href="#吞吐量问题" class="headerlink" title="吞吐量问题"></a> 吞吐量问题</h1><p>实验结果绘图，发现五种flavor的吞吐量基本没有差别！都是800上下。<br><img src="http://cdn.voidking.com/img/openstack-vm-live-migration-experiment-v2/flavor.png?imageView2/0/w/600"><br>为了解决apache吞吐量问题，必须得研究一下。</p><h2 id="修改apache配置"><span class="post-title-index">6.1.</span><a href="#修改apache配置" class="headerlink" title="修改apache配置"></a> 修改apache配置</h2><p>思路一：提高apache的最大连接数。参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/CheeseZH/p/5169184.html">如何设置Apache中的最大连接数</a>、<a target="_blank" rel="noopener" href="https://www.cnblogs.com/CheeseZH/p/5169184.html">如何设置Apache中的最大连接数</a>。</p><p>1、查看apache module<br><code>apachectl -V</code><br><img src="http://cdn.voidking.com/img/openstack-vm-live-migration-experiment-v2/apachectl.jpg?imageView2/0/w/600"><br>可以看到Server MPM为event。如果要换成其他MPM，可以参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/hursing/article/details/18663047">Ubuntu配置apache2.4的限速功能</a>进行设置，比如换成prefork，这里我们不进行更换。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/apache2/mods-enabled</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">ln</span> -s ../mods-available/mpm_prefork.load .</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">ln</span> -s ../mods-available/mpm_prefork.conf .</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> mods_event.load</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> mods_event.conf</span><br><span class="line"><span class="built_in">sudo</span> service apache2 restart</span><br></pre></td></tr></table></figure><p>2、备份配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/apache2/mods-available/</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> mpm_event.conf&#123;,.bak&#125;</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> mpm_event.load&#123;,.bak&#125;</span><br></pre></td></tr></table></figure><p>3、修改配置<br>编辑<code>/etc/apache2/mods-available/mpm_event.conf</code>，原文件为：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># event MPM</span></span><br><span class="line"><span class="comment"># StartServers: initial number of server processes to start</span></span><br><span class="line"><span class="comment"># MinSpareThreads: minimum number of worker threads which are kept spare</span></span><br><span class="line"><span class="comment"># MaxSpareThreads: maximum number of worker threads which are kept spare</span></span><br><span class="line"><span class="comment"># ThreadsPerChild: constant number of worker threads in each server process</span></span><br><span class="line"><span class="comment"># MaxRequestWorkers: maximum number of worker threads</span></span><br><span class="line"><span class="comment"># MaxConnectionsPerChild: maximum number of requests a server process serves</span></span><br><span class="line"><span class="section">&lt;IfModule mpm_event_module&gt;</span></span><br><span class="line">        <span class="attribute">StartServers</span>             <span class="number">2</span></span><br><span class="line">        <span class="attribute">MinSpareThreads</span>          <span class="number">25</span></span><br><span class="line">        <span class="attribute">MaxSpareThreads</span>          <span class="number">75</span></span><br><span class="line">        <span class="attribute">ThreadLimit</span>              <span class="number">64</span></span><br><span class="line">        <span class="attribute">ThreadsPerChild</span>          <span class="number">25</span></span><br><span class="line">        <span class="attribute">MaxRequestWorkers</span>        <span class="number">150</span></span><br><span class="line">        <span class="attribute">MaxConnectionsPerChild</span>   <span class="number">0</span></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vim: syntax=apache ts=4 sw=4 sts=4 sr noet</span></span><br></pre></td></tr></table></figure><p>参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/yanggd1987/article/details/45578395">关于apache的mpm-event的参数无法调整问题</a>，修改为：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;IfModule mpm_event_module&gt;</span></span><br><span class="line">    <span class="attribute">ServerLimit</span>              <span class="number">100</span></span><br><span class="line">    <span class="attribute">StartServers</span>             <span class="number">20</span></span><br><span class="line">    <span class="attribute">MinSpareThreads</span>          <span class="number">25</span></span><br><span class="line">    <span class="attribute">MaxSpareThreads</span>          <span class="number">1200</span></span><br><span class="line"><span class="comment">#   ThreadLimit              64</span></span><br><span class="line">    <span class="attribute">ThreadsPerChild</span>          <span class="number">50</span></span><br><span class="line">    <span class="attribute">MaxRequestWorkers</span>        <span class="number">5000</span></span><br><span class="line">    <span class="attribute">MaxConnectionsPerChild</span>   <span class="number">10000</span></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br></pre></td></tr></table></figure><p>MaxSpareThreads的参数设置，需要根据<code>StartServers*ThreadsPerChild=1000</code>，因此MaxSpareThreads必须大于1000，在此为1200，否则会有<code>StartServers-MaxSpareThreads/ThreadsPerChild</code>个进程被杀掉。</p><p>MaxRequestWorkers的参数设置，需要根据<code>ServerLimit*ThreadsPerChild=5000</code>，否则启动会有警告。</p><p>4、重启apache2<br><code>sudo service apache2 restart</code></p><p>然而，并没有用，吞吐量并没有发生什么变化，依然是800左右，不过波动幅度变大了。MPM更换为prefork，吞吐量降到了700左右。</p><h2 id="修改ab命令"><span class="post-title-index">6.2.</span><a href="#修改ab命令" class="headerlink" title="修改ab命令"></a> 修改ab命令</h2><p>思路二：apachebench的命令有问题。<br>修改ab命令为：<br><code>ab -g t0.dat -c 1000 -t 100 -n 10000000 http://172.16.0.19/</code></p><p>这次，吞吐量果然上去了，变成8000左右。但是，所有实例的吞吐量都上去了！</p><h2 id="更换测试工具"><span class="post-title-index">6.3.</span><a href="#更换测试工具" class="headerlink" title="更换测试工具"></a> 更换测试工具</h2><p>思路三：测试工具换成webbench。<br>1、安装webbench</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">wget</span> http://soft.vpser.net/test/webbench/webbench-<span class="number">1</span>.<span class="number">5</span>.tar.gz</span><br><span class="line"><span class="attribute">tar</span> zxvf webbench-<span class="number">1</span>.<span class="number">5</span>.tar.gz</span><br><span class="line"><span class="attribute">cd</span> webbench-<span class="number">1</span>.<span class="number">5</span></span><br><span class="line"><span class="attribute">sudo</span> make &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure><p>2、测试<br><code>webbench -c 10000 -t 10 http://172.16.0.19/</code><br>10s成功了80000左右的请求，说明ab测出的吞吐量是真实的。这样看来，问题还是出在apache上，吞吐量固定在8000左右。</p><h2 id="更换为nginx"><span class="post-title-index">6.4.</span><a href="#更换为nginx" class="headerlink" title="更换为nginx"></a> 更换为nginx</h2><p>思路四：apache更换为nginx。<br>1、修改apache的端口<br><code>sudo vim /etc/apache2/ports.conf</code>，端口改为8080。</p><p>2、安装nginx</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y nginx</span><br><span class="line">sudo apt <span class="keyword">update</span> --fix-<span class="literal">missing</span></span><br><span class="line">sudo apt install -y nginx</span><br></pre></td></tr></table></figure><p>3、再次测试<br><code>ab -g t0.dat -c 1000 -t 100 -n 10000000 http://172.16.0.19/</code><br>吞吐量有所上升，9000左右，但是最坑的地方在于，所有实例都上升了，都是9000左右！</p><h2 id="提高ulimit"><span class="post-title-index">6.5.</span><a href="#提高ulimit" class="headerlink" title="提高ulimit"></a> 提高ulimit</h2><p>思路五：在实例中提高ulimit。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> -i</span><br><span class="line"><span class="built_in">ulimit</span> -a</span><br><span class="line"><span class="built_in">ulimit</span> -i 257178</span><br><span class="line"><span class="built_in">ulimit</span> -u 257178</span><br></pre></td></tr></table></figure><p>然而，吞吐量并没有变化。</p><h2 id="网络问题"><span class="post-title-index">6.6.</span><a href="#网络问题" class="headerlink" title="网络问题"></a> 网络问题</h2><p>莫非，是因为计算机网络问题？于是，在实例ubuntu0、ubuntu2、ubuntu4内部中进行ab测试，吞吐量结果为：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">app</span> ubuntu0 ubuntu2 ubuntu4</span><br><span class="line"><span class="attribute">apache</span> <span class="number">5298</span> <span class="number">11290</span> <span class="number">17706</span></span><br><span class="line"><span class="attribute">nginx</span>  <span class="number">9380</span> <span class="number">19745</span> <span class="number">23124</span></span><br></pre></td></tr></table></figure><p>看到这个结果，总算感觉合理了。问题也可以定位了，网络瓶颈。那么新的问题来了，不能在实例内部进行测试的情况下，怎样测试出准确的吞吐量？</p><h2 id="安装应用"><span class="post-title-index">6.7.</span><a href="#安装应用" class="headerlink" title="安装应用"></a> 安装应用</h2><p>如果能够把真实吞吐量降到8000以下，是不是就可以通过内网测出真实吞吐量了？很有可能。那么，就安装一个标准测试应用，来试试效果。找到了两款应用，mediawiki和tpcw，这里我们选择mediawiki，参考<a href="https://www.voidking.com/dev-mediawiki-install-and-config/">《MediaWiki安装与配置》</a>。</p><p>安装好mediawiki后进行ab测试：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ab</span> -g t0.dat -c <span class="number">10</span> -t <span class="number">100</span> -n <span class="number">1000000</span> http://<span class="number">172.16.0.19</span>/mediawiki/index.php/Main_Page</span><br></pre></td></tr></table></figure><p>ubuntu0吞吐量为30左右，ubuntu2的吞吐量为60左右。</p><h1 id="实验流程2"><span class="post-title-index">7.</span><a href="#实验流程2" class="headerlink" title="实验流程2"></a> 实验流程2</h1><p>假设当前只启动了ubuntu0实例，<code>nova show ubuntu0</code>位于compute1节点。</p><p>1、在实例中启动压力测试软件，或者在两个compute节点中启动网络故障模拟软件。（flavor实验中不需要）</p><p>2、在两个compute节点启动iptraf-ng，配置参考<a href="https://www.voidking.com/dev-openstack-vm-live-migration-performance/">《虚拟机在线迁移的性能统计》</a>。</p><p>3、在三个controller的shell中分别输入好一条命令：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo</span> ping <span class="number">172.16.0.19</span> -i <span class="number">0</span>.<span class="number">001</span> &gt;&gt; ping.log</span><br><span class="line"><span class="attribute">ab</span> -g t0.dat -c <span class="number">10</span> -t <span class="number">100</span> -n <span class="number">1000000</span> http://<span class="number">172.16.0.19</span>/mediawiki/index.php/Main_Page</span><br><span class="line"><span class="attribute">nova</span> live-migration ubuntu0 compute2</span><br></pre></td></tr></table></figure><p>然后，依次回车执行这些命令。</p><p>4、观察compute节点的iptraf-ng，等到流量不再增加，Ctrl+C结束ping命令。</p><p>5、在controller节点执行downtime.sh得到停机时间，在compute1节点执行total-time.sh得到迁移时间，在两个计算节点观察iptraf-ng得到迁移数据量。</p><p>6、等到ab命令结束，执行<code>./format.sh t0.dat</code>，得到吞吐量数据ff-t0.dat。</p><p>以上流程，适用于接下来的所有实验。</p><h1 id="flavor实验2"><span class="post-title-index">8.</span><a href="#flavor实验2" class="headerlink" title="flavor实验2"></a> flavor实验2</h1><p>1、按照实验流程，分别使用安装了mediawiki的五个flavor，进行五次迁移实验，记录实验结果。<br>然而，新的问题出现了，安装了mediawiki的flavor，迁移时间特别久，迁移数据量特别大，等到ab命令结束，迁移才会停止。修改ab命令为：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ab</span> -g t0.dat -t <span class="number">100</span> -n <span class="number">1000000</span> http://<span class="number">172.16.0.19</span>/mediawiki/index.php/Main_Page</span><br></pre></td></tr></table></figure><p>可以成功迁移，但是另一个问题出现了，所有实例的吞吐量都下降为10左右，这日子没发过了！</p><p>是mediawiki的问题吗？创建一个index.php文件来测试一下，内容为：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>使用ab命令测试：<br><code>ab -g t0.dat -c 1000 -t 100 -n 1000000 http://172.16.0.19/index.php</code><br>ubuntu0吞吐量在800左右，ubuntu2的吞吐量在1200左右，挺不错的结果。然而，如果在ab测试时进行迁移，迁移时间依然会特别久，迁移数据量依然会特别大。ab命令停止，迁移成功停止；ab命令不停止，迁移直到失败。和mediawiki存在同样的问题。</p><h1 id="后记"><span class="post-title-index">9.</span><a href="#后记" class="headerlink" title="后记"></a> 后记</h1><p>实验遇到瓶颈，找叶老师商量后，决定不再适用Apache这种web服务，而是换成系统服务，比如计算任务。在实例内部运行服务记录结果，就不存在网络的影响了。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>原文链接：</strong> <a href="https://www.voidking.com/dev-openstack-vm-live-migration-experiment-v2-0/" title="好好学OpenStack：虚拟机在线迁移实验V2——上">https://www.voidking.com/dev-openstack-vm-live-migration-experiment-v2-0/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本文采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议，转载请注明出处！源站会即时更新知识点并修正错误，欢迎访问~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/docker/" rel="tag"># docker</a> <a href="/tags/ubuntu/" rel="tag"># ubuntu</a> <a href="/tags/apache/" rel="tag"># apache</a> <a href="/tags/openstack/" rel="tag"># openstack</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" rel="tag"># 测试</a> <a href="/tags/%E5%A5%BD%E5%A5%BD%E5%AD%A6OpenStack/" rel="tag"># 好好学OpenStack</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-vm-live-migration-gnuplot/" rel="prev" title="虚拟机在线迁移实验结果绘图"><i class="fa fa-chevron-left"></i> 虚拟机在线迁移实验结果绘图</a></div><div class="post-nav-item"> <a href="/dev-mediawiki-install-and-config/" rel="next" title="MediaWiki安装与配置">MediaWiki安装与配置<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">1. 前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B%E5%87%86%E5%A4%87"><span class="nav-text">2. 实例准备</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC%E5%92%8C%E8%BD%AF%E4%BB%B6%E5%87%86%E5%A4%87"><span class="nav-text">3. 脚本和软件准备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E8%BF%81%E7%A7%BB%E6%97%B6%E9%97%B4"><span class="nav-text">3.1. 总迁移时间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%81%9C%E6%9C%BA%E6%97%B6%E9%97%B4"><span class="nav-text">3.2. 停机时间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%81%E7%A7%BB%E6%95%B0%E6%8D%AE%E9%87%8F"><span class="nav-text">3.3. 迁移数据量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#apache"><span class="nav-text">3.4. apache</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#apachebench"><span class="nav-text">3.5. apachebench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xshell"><span class="nav-text">3.6. xshell</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E6%B5%81%E7%A8%8B"><span class="nav-text">4. 实验流程</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#flavor%E5%AE%9E%E9%AA%8C"><span class="nav-text">5. flavor实验</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%9E%E5%90%90%E9%87%8F%E9%97%AE%E9%A2%98"><span class="nav-text">6. 吞吐量问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9apache%E9%85%8D%E7%BD%AE"><span class="nav-text">6.1. 修改apache配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9ab%E5%91%BD%E4%BB%A4"><span class="nav-text">6.2. 修改ab命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%8D%A2%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7"><span class="nav-text">6.3. 更换测试工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%8D%A2%E4%B8%BAnginx"><span class="nav-text">6.4. 更换为nginx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%90%E9%AB%98ulimit"><span class="nav-text">6.5. 提高ulimit</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E9%97%AE%E9%A2%98"><span class="nav-text">6.6. 网络问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E5%BA%94%E7%94%A8"><span class="nav-text">6.7. 安装应用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E6%B5%81%E7%A8%8B2"><span class="nav-text">7. 实验流程2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#flavor%E5%AE%9E%E9%AA%8C2"><span class="nav-text">8. flavor实验2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E8%AE%B0"><span class="nav-text">9. 后记</span></a></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">一个计算机技术爱好者与学习者</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">780</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">34</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">272</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2026</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://cdn.staticfile.net/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://cdn.staticfile.net/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: 'c9df011cca9c58a3022ed9c78e592cf1',
      title: '好好学OpenStack：虚拟机在线迁移实验V2——上',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>