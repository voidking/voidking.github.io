<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//qiniu-cdn.voidking.com/doc/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="sudo简介 在sudo于1980年前后被写出之前，一般用户利用 su 切换用户，管理系统时通常使用此命令切换为超级用户。但是使用su的缺点之一在于必须要先告知目标用户的密码。   sudo使一般用户不需要知道目标用户的密码即可获得权限。首先由超级用户将普通用户的名字、可以执行的特定命令、按照哪种用户或用户组的身份执行等信息，登记在特殊的文件中（通常是&#x2F;etc&#x2F;sudoers），即完成对该用户的授"><meta property="og:type" content="article"><meta property="og:title" content="好好学Linux：sudo命令"><meta property="og:url" content="https://www.voidking.com/dev-linux-sudo/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="sudo简介 在sudo于1980年前后被写出之前，一般用户利用 su 切换用户，管理系统时通常使用此命令切换为超级用户。但是使用su的缺点之一在于必须要先告知目标用户的密码。   sudo使一般用户不需要知道目标用户的密码即可获得权限。首先由超级用户将普通用户的名字、可以执行的特定命令、按照哪种用户或用户组的身份执行等信息，登记在特殊的文件中（通常是&#x2F;etc&#x2F;sudoers），即完成对该用户的授"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2017-06-02T08:00:00.000Z"><meta property="article:modified_time" content="2023-10-21T08:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="好好学Linux"><meta property="article:tag" content="shell"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-linux-sudo/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>好好学Linux：sudo命令 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">一个计算机技术爱好者与学习者</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-linux-sudo/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="一个计算机技术爱好者与学习者"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> 好好学Linux：sudo命令</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2017-06-02 08:00:00" itemprop="dateCreated datePublished" datetime="2017-06-02T08:00:00+00:00">2017-06-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2023-10-21 08:00:00" itemprop="dateModified" datetime="2023-10-21T08:00:00+00:00">2023-10-21</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/shell/" itemprop="url" rel="index"><span itemprop="name">shell</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="sudo简介"><span class="post-title-index">1.</span><a href="#sudo简介" class="headerlink" title="sudo简介"></a> sudo简介</h1><blockquote><p>在sudo于1980年前后被写出之前，一般用户利用 su 切换用户，管理系统时通常使用此命令切换为超级用户。但是使用su的缺点之一在于必须要先告知目标用户的密码。</p></blockquote><blockquote><p>sudo使一般用户不需要知道目标用户的密码即可获得权限。首先由超级用户将普通用户的名字、可以执行的特定命令、按照哪种用户或用户组的身份执行等信息，登记在特殊的文件中（通常是/etc/sudoers），即完成对该用户的授权（此时该用户称为sudoer）；在一般用户需要获取特定权限时，其可在命令前加上sudo，此时sudo将会询问该用户自己的密码（以确认终端前的是该用户本人），回答后系统即会将该命令的进程以目标用户的权限执行。如果没有指定目标用户，就默认以超级用户的权限执行。之后的一段时间内（默认为5分钟，可在/etc/sudoers自定义），使用sudo不需要再次输入密码。</p></blockquote><p>当给用户授权sudo权限时，进行哪些限制会更加安全？本文以给 <code>voidking</code> 用户授权为例，学习一下授权sudo的方法。</p><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Sudo">维基百科 - sudo</a></li><li><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-edit-the-sudoers-file">How To Edit the Sudoers File</a></li><li><a target="_blank" rel="noopener" href="https://techglimpse.com/dos-and-donts-of-sudo/">8 Best practices with sudo on Linux – Do’s and Dont’s of sudo</a></li><li><a target="_blank" rel="noopener" href="https://www.mairoot.com/?p=1898">关于linux的sudo的权限分离最佳实践</a></li></ul><span id="more"></span><h1 id="给用户授权sudo"><span class="post-title-index">2.</span><a href="#给用户授权sudo" class="headerlink" title="给用户授权sudo"></a> 给用户授权sudo</h1><h2 id="方法一：直接授权给用户"><span class="post-title-index">2.1.</span><a href="#方法一：直接授权给用户" class="headerlink" title="方法一：直接授权给用户"></a> 方法一：直接授权给用户</h2><p>1、编辑 sudoers 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/sudoers</span></span><br><span class="line">visudo</span><br></pre></td></tr></table></figure><p>添加授权内容：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">voidking   ALL=(ALL:ALL) ALL</span><br></pre></td></tr></table></figure><p>2、测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su voidking</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">pwd</span></span><br></pre></td></tr></table></figure><h2 id="方法二：添加用户到sudo组（推荐）"><span class="post-title-index">2.2.</span><a href="#方法二：添加用户到sudo组（推荐）" class="headerlink" title="方法二：添加用户到sudo组（推荐）"></a> 方法二：添加用户到sudo组（推荐）</h2><h3 id="授权给sudo组"><span class="post-title-index">2.2.1.</span><a href="#授权给sudo组" class="headerlink" title="授权给sudo组"></a> 授权给sudo组</h3><p>授权给sudo组，仅操作一次即可。</p><p>1、添加sudo用户组</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd <span class="built_in">sudo</span></span><br></pre></td></tr></table></figure><p>2、编辑 sudoers 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">visudo</span><br></pre></td></tr></table></figure><p>添加内容：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%sudo ALL=(ALL:ALL) ALL</span><br></pre></td></tr></table></figure><h3 id="添加用户到sudo组"><span class="post-title-index">2.2.2.</span><a href="#添加用户到sudo组" class="headerlink" title="添加用户到sudo组"></a> 添加用户到sudo组</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usermod -G <span class="built_in">sudo</span> -a voidking</span><br></pre></td></tr></table></figure><h1 id="授权文件解释"><span class="post-title-index">3.</span><a href="#授权文件解释" class="headerlink" title="授权文件解释"></a> 授权文件解释</h1><p>已知一条sudoers授权规则为：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">voidking ALL=(ALL:ALL) ALL</span><br></pre></td></tr></table></figure><p>这个配置的含义为：</p><ul><li><code>voidking</code>，表示这个规则是对用户 voidking 生效的</li><li>第一个<code>ALL</code>，表示这个规则是对所有主机生效的</li><li>第二个<code>ALL</code>，表示voidking可以以所有用户身份运行命令</li><li>第三个<code>ALL</code>，表示voidking可以以所有用户组身份运行命令</li><li>第四个<code>ALL</code>，表示voidking用户可以运行所有命令</li></ul><p>如果授权规则改为：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">voidking ALL=(ALL:ALL) NOPASSWD:ALL</span><br></pre></td></tr></table></figure><p>那么表示voidking用户在运行所有命令时都不需要密码。</p><h1 id="最佳实践"><span class="post-title-index">4.</span><a href="#最佳实践" class="headerlink" title="最佳实践"></a> 最佳实践</h1><h2 id="开启sudo日志"><span class="post-title-index">4.1.</span><a href="#开启sudo日志" class="headerlink" title="开启sudo日志"></a> 开启sudo日志</h2><p>将所有sudo命令操作记录到系统的日志文件中，以便日后审计。</p><p>sudoers文件中，添加日志配置</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Defaults        logfile=/var/log/sudo.log</span><br></pre></td></tr></table></figure><h2 id="特定命令的执行权限"><span class="post-title-index">4.2.</span><a href="#特定命令的执行权限" class="headerlink" title="特定命令的执行权限"></a> 特定命令的执行权限</h2><p>限制用户只能执行特定的命令，可以提高系统安全性。</p><p>sudoers文件中，配置改为只能执行指定命令</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">voidking ALL=(ALL) /path/to/command</span><br></pre></td></tr></table></figure><h2 id="锁定sudo命令路径"><span class="post-title-index">4.3.</span><a href="#锁定sudo命令路径" class="headerlink" title="锁定sudo命令路径"></a> 锁定sudo命令路径</h2><p>锁定sudo可以执行的命令的路径。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Defaults secure_path=<span class="string">&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span></span><br></pre></td></tr></table></figure><h2 id="切换其他用户需要密码"><span class="post-title-index">4.4.</span><a href="#切换其他用户需要密码" class="headerlink" title="切换其他用户需要密码"></a> 切换其他用户需要密码</h2><p>默认情况下，用户可以使用sudo命令切换到任何其他用户的身份，我们可以限制用户切换到其他用户时需要密码。</p><p>sudoers文件中，添加切换用户需要密码的配置</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Defaults        targetpw</span><br></pre></td></tr></table></figure><h2 id="禁止用户切换到root（不可行）"><span class="post-title-index">4.5.</span><a href="#禁止用户切换到root（不可行）" class="headerlink" title="禁止用户切换到root（不可行）"></a> 禁止用户切换到root（不可行）</h2><p>sudoers文件中，禁止用户使用<code>sudo su</code>切换到root</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">voidking ALL=(ALL) ALL,!/bin/su</span><br></pre></td></tr></table></figure><p>但是，这个方法并不能阻止用户切换到root，比如用户还可以使用<code>sudo -i</code>或者<code>sudo bash</code>切换到root。</p><p>更好的办法是配置用户只能执行特定的命令。</p><h2 id="特定sudo配置使用单独配置文件"><span class="post-title-index">4.6.</span><a href="#特定sudo配置使用单独配置文件" class="headerlink" title="特定sudo配置使用单独配置文件"></a> 特定sudo配置使用单独配置文件</h2><p>对特定用户和用户组的一组配置，独立作为一个文件，结构会更加清晰。</p><p>默认 /etc/sudoers.d 目录中的文件会被include</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#includedir /etc/sudoers.d</span></span><br></pre></td></tr></table></figure><p>编辑独立配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">visudo -f /etc/sudoers.d/ops</span><br></pre></td></tr></table></figure><h2 id="不给docker命令sudo权限"><span class="post-title-index">4.7.</span><a href="#不给docker命令sudo权限" class="headerlink" title="不给docker命令sudo权限"></a> 不给docker命令sudo权限</h2><p>如果给用户授权了<code>sudo docker</code>权限，那么用户就可以挂载一些没有权限文件到容器中，此时就有权限进行操作了。<br>因此最好不要给用户授权docker的sudo权限，而是应该配置普通用户也可以直接执行docker命令。</p><h1 id="权限分配"><span class="post-title-index">5.</span><a href="#权限分配" class="headerlink" title="权限分配"></a> 权限分配</h1><h2 id="sudoers默认权限分组"><span class="post-title-index">5.1.</span><a href="#sudoers默认权限分组" class="headerlink" title="sudoers默认权限分组"></a> sudoers默认权限分组</h2><p>CentOS7 sudoers中的默认权限分组，可以参考。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">## Command Aliases</span><br><span class="line">## These are groups of related commands...</span><br><span class="line"></span><br><span class="line">## Networking</span><br><span class="line"># Cmnd_Alias NETWORKING = /sbin/route, /sbin/ifconfig, /bin/ping, /sbin/dhclient, /usr/bin/net, /sbin/iptables, /usr/bin/rfcomm, /usr/bin/wvdial, /sbin/iwconfig, /sbin/mii-tool</span><br><span class="line"></span><br><span class="line">## Installation and management of software</span><br><span class="line"># Cmnd_Alias SOFTWARE = /bin/rpm, /usr/bin/up2date, /usr/bin/yum</span><br><span class="line"></span><br><span class="line">## Services</span><br><span class="line"># Cmnd_Alias SERVICES = /sbin/service, /sbin/chkconfig, /usr/bin/systemctl start, /usr/bin/systemctl stop, /usr/bin/systemctl reload, /usr/bin/systemctl restart, /usr/bin/systemctl status, /usr/bin/systemctl enable, /usr/bin/systemctl disable</span><br><span class="line"></span><br><span class="line">## Updating the locate database</span><br><span class="line"># Cmnd_Alias LOCATE = /usr/bin/updatedb</span><br><span class="line"></span><br><span class="line">## Storage</span><br><span class="line"># Cmnd_Alias STORAGE = /sbin/fdisk, /sbin/sfdisk, /sbin/parted, /sbin/partprobe, /bin/mount, /bin/umount</span><br><span class="line"></span><br><span class="line">## Delegating permissions</span><br><span class="line"># Cmnd_Alias DELEGATING = /usr/sbin/visudo, /bin/chown, /bin/chmod, /bin/chgrp</span><br><span class="line"></span><br><span class="line">## Processes</span><br><span class="line"># Cmnd_Alias PROCESSES = /bin/nice, /bin/kill, /usr/bin/kill, /usr/bin/killall</span><br><span class="line"></span><br><span class="line">## Drivers</span><br><span class="line"># Cmnd_Alias DRIVERS = /sbin/modprobe</span><br></pre></td></tr></table></figure><h2 id="权限配置示例"><span class="post-title-index">5.2.</span><a href="#权限配置示例" class="headerlink" title="权限配置示例"></a> 权限配置示例</h2><h3 id="运维组"><span class="post-title-index">5.2.1.</span><a href="#运维组" class="headerlink" title="运维组"></a> 运维组</h3><p>1、权限规划</p><ul><li>初级：查看文件列表和文件内容、查看系统信息、查看网络状态</li><li>高级：初级所有权限、修改网络配置、进程管理、存储管理、软件包管理</li><li>经理：超级用户所有权限</li></ul><p>2、创建配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">visudo -f /etc/sudoers.d/op</span><br></pre></td></tr></table></figure><p>注意：配置文件名不能含有<code>.</code>，否则不会生效，详情参考文档<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/21640770/file-in-etc-sudoers-d-file-not-being-read-by-sudo">File in /etc/sudoers.d file not being read by sudo</a></p><p>3、配置内容</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Cmnd_Alias JUNIOR_OP_CMD = /usr/bin/ls,/usr/bin/cat,/usr/bin/grep,/usr/bin/tail,/usr/bin/df,/usr/bin/free,/usr/bin/top,/usr/bin/hostname,/usr/bin/ping,/usr/sbin/ifconfig,/usr/bin/netstat,/usr/bin/systemctl status *,/usr/bin/journalctl</span><br><span class="line">Cmnd_Alias SENIOR_OP_CMD = /usr/sbin/route,/usr/sbin/iptables,/usr/bin/nice,/usr/bin/kill,/usr/bin/pkill,/usr/bin/killall,/usr/sbin/fdisk,/usr/sbin/sfdisk,/usr/sbin/partprobe,/bin/mount,/usr/bin/systemctl,/usr/bin/journalctl,/usr/bin/rpm,/usr/bin/up2date,/usr/bin/yum</span><br><span class="line"></span><br><span class="line">%juniorop ALL=(ALL) NOPASSWD: JUNIOR_OP_CMD</span><br><span class="line">%seniorop ALL=(ALL) NOPASSWD: JUNIOR_OP_CMD, SENIOR_OP_CMD</span><br><span class="line">%superop ALL=(ALL) NOPASSWD: ALL</span><br></pre></td></tr></table></figure><p>如果是ubuntu/debian系统，软件包管理命令需要改成 <code>/usr/bin/apt,/usr/bin/apt-get</code><br>另外不同的系统中，命令的路径也是不同的，需要针对不同系统进行修改。</p><h3 id="开发组"><span class="post-title-index">5.2.2.</span><a href="#开发组" class="headerlink" title="开发组"></a> 开发组</h3><p>1、权限规划</p><ul><li>初级：查看文件列表和文件内容权限，对应服务查看日志的权限</li><li>高级：初级所有权限，重启对应服务</li><li>经理：项目所在服务器的ALL权限，不能修改root密码，不能修改visudo</li></ul><p>2、创建配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">visudo -f /etc/sudoers.d/dev</span><br></pre></td></tr></table></figure><p>3、配置内容</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Cmnd_Alias JUNIOR_DEV_CMD = /usr/bin/ls,/usr/bin/cat,/usr/bin/grep /data/apps/logs,/usr/bin/tail /data/apps/logs</span><br><span class="line">Cmnd_Alias SENIOR_DEV_CMD = /sbin/service</span><br><span class="line">Cmnd_Alias SUPER_DEV_CMD = ALL,/usr/bin/passwd [A-Za-z]*,!/usr/bin/passwd root,!/usr/sbin/visudo</span><br><span class="line"></span><br><span class="line">%juniordev ALL=(ALL) NOPASSWD: JUNIOR_DEV_CMD</span><br><span class="line">%seniordev ALL=(ALL) NOPASSWD: JUNIOR_DEV_CMD, SENIOR_DEV_CMD</span><br><span class="line">%superdev ALL=(ALL) NOPASSWD: SUPER_DEV_CMD</span><br></pre></td></tr></table></figure><h3 id="网络组"><span class="post-title-index">5.2.3.</span><a href="#网络组" class="headerlink" title="网络组"></a> 网络组</h3><p>1、权限规划</p><ul><li>初级：普通用户的权限，不加入sudo列表</li><li>高级：所在服务器的网络管理权限</li></ul><p>2、创建配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">visudo -f /etc/sudoers.d/net</span><br></pre></td></tr></table></figure><p>3、配置内容</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cmnd_Alias SENIOR_NET_CMD = /usr/sbin/route,/usr/sbin/ifconfig,/usr/bin/ping,/usr/sbin/dhclient,/usr/include/net,/usr/sbin/iptables,/usr/sbin/mii-tool,/usr/bin/cat /var/log/*</span><br><span class="line"></span><br><span class="line">%seniornet ALL=(ALL) NOPASSWD: SENIOR_NET_CMD</span><br></pre></td></tr></table></figure><h3 id="DBA组"><span class="post-title-index">5.2.4.</span><a href="#DBA组" class="headerlink" title="DBA组"></a> DBA组</h3><p>1、权限规划</p><ul><li>初级：普通权限，不加入sudo列表</li><li>高级：数据库服务器的ALL权限，不能修改root密码，不能修改visudo</li></ul><p>2、创建配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">visudo -f /etc/sudoers.d/dba</span><br></pre></td></tr></table></figure><p>3、配置内容</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cmnd_Alias SENIOR_DBA_CMD = ALL,/usr/bin/passwd [A-Za-z]*,!/usr/bin/passwd root,!/usr/sbin/visudo</span><br><span class="line"></span><br><span class="line">%seniordba ALL=(ALL) NOPASSWD: SENIOR_NET_CMD</span><br></pre></td></tr></table></figure></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>原文链接：</strong> <a href="https://www.voidking.com/dev-linux-sudo/" title="好好学Linux：sudo命令">https://www.voidking.com/dev-linux-sudo/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本文采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议，转载请注明出处！源站会即时更新知识点并修正错误，欢迎访问~</li><li> <img width="200" height="200" src="/images/avatar.jpg"><p style="text-align:center;margin-bottom:0">微信公众号同步更新，欢迎关注~</p></li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/%E5%A5%BD%E5%A5%BD%E5%AD%A6Linux/" rel="tag"># 好好学Linux</a> <a href="/tags/shell/" rel="tag"># shell</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-linux-system-management/" rel="prev" title="好好学Linux：系统管理常用命令"><i class="fa fa-chevron-left"></i> 好好学Linux：系统管理常用命令</a></div><div class="post-nav-item"> <a href="/dev-linux-ssh/" rel="next" title="好好学Linux：ssh命令">好好学Linux：ssh命令<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3284447971731414" data-ad-slot="9697986181"></ins><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#sudo%E7%AE%80%E4%BB%8B"><span class="nav-text">1. sudo简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%99%E7%94%A8%E6%88%B7%E6%8E%88%E6%9D%83sudo"><span class="nav-text">2. 给用户授权sudo</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9A%E7%9B%B4%E6%8E%A5%E6%8E%88%E6%9D%83%E7%BB%99%E7%94%A8%E6%88%B7"><span class="nav-text">2.1. 方法一：直接授权给用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E5%88%B0sudo%E7%BB%84%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%89"><span class="nav-text">2.2. 方法二：添加用户到sudo组（推荐）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%88%E6%9D%83%E7%BB%99sudo%E7%BB%84"><span class="nav-text">2.2.1. 授权给sudo组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E5%88%B0sudo%E7%BB%84"><span class="nav-text">2.2.2. 添加用户到sudo组</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8E%88%E6%9D%83%E6%96%87%E4%BB%B6%E8%A7%A3%E9%87%8A"><span class="nav-text">3. 授权文件解释</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-text">4. 最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%90%AFsudo%E6%97%A5%E5%BF%97"><span class="nav-text">4.1. 开启sudo日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%B9%E5%AE%9A%E5%91%BD%E4%BB%A4%E7%9A%84%E6%89%A7%E8%A1%8C%E6%9D%83%E9%99%90"><span class="nav-text">4.2. 特定命令的执行权限</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%94%81%E5%AE%9Asudo%E5%91%BD%E4%BB%A4%E8%B7%AF%E5%BE%84"><span class="nav-text">4.3. 锁定sudo命令路径</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%87%E6%8D%A2%E5%85%B6%E4%BB%96%E7%94%A8%E6%88%B7%E9%9C%80%E8%A6%81%E5%AF%86%E7%A0%81"><span class="nav-text">4.4. 切换其他用户需要密码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A6%81%E6%AD%A2%E7%94%A8%E6%88%B7%E5%88%87%E6%8D%A2%E5%88%B0root%EF%BC%88%E4%B8%8D%E5%8F%AF%E8%A1%8C%EF%BC%89"><span class="nav-text">4.5. 禁止用户切换到root（不可行）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%B9%E5%AE%9Asudo%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8%E5%8D%95%E7%8B%AC%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">4.6. 特定sudo配置使用单独配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8D%E7%BB%99docker%E5%91%BD%E4%BB%A4sudo%E6%9D%83%E9%99%90"><span class="nav-text">4.7. 不给docker命令sudo权限</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E5%88%86%E9%85%8D"><span class="nav-text">5. 权限分配</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#sudoers%E9%BB%98%E8%AE%A4%E6%9D%83%E9%99%90%E5%88%86%E7%BB%84"><span class="nav-text">5.1. sudoers默认权限分组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="nav-text">5.2. 权限配置示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E7%BB%B4%E7%BB%84"><span class="nav-text">5.2.1. 运维组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E7%BB%84"><span class="nav-text">5.2.2. 开发组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E7%BB%84"><span class="nav-text">5.2.3. 网络组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DBA%E7%BB%84"><span class="nav-text">5.2.4. DBA组</span></a></li></ol></li></ol></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">一个计算机技术爱好者与学习者</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">725</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">32</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">255</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: '49f1d28939280a5b2b65db5cf27f9aaf',
      title: '好好学Linux：sudo命令',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>