<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言公司M站要接入支付宝，借机研究了一下支付宝的支付流程。毕竟，只有公司才能拿到支付接口权限。 主要参考文档：https:&#x2F;&#x2F;doc.open.alipay.com&#x2F;doc2&#x2F;detail?treeId&#x3D;60&amp;articleId&#x3D;103564&amp;docType&#x3D;1https:&#x2F;&#x2F;b.alipay.com&#x2F;order&#x2F;productDetail.htm?productId&#x3D;201511"><meta property="og:type" content="article"><meta property="og:title" content="支付宝手机网站支付流程"><meta property="og:url" content="https://www.voidking.com/dev-alipay-process/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言公司M站要接入支付宝，借机研究了一下支付宝的支付流程。毕竟，只有公司才能拿到支付接口权限。 主要参考文档：https:&#x2F;&#x2F;doc.open.alipay.com&#x2F;doc2&#x2F;detail?treeId&#x3D;60&amp;articleId&#x3D;103564&amp;docType&#x3D;1https:&#x2F;&#x2F;b.alipay.com&#x2F;order&#x2F;productDetail.htm?productId&#x3D;201511"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com//imgs/alipay-process/pid.png"><meta property="og:image" content="http://cdn.voidking.com//imgs/alipay-process/pid2.png"><meta property="og:image" content="http://cdn.voidking.com//imgs/alipay-process/nodeforum.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/alipay-process/config.jpg"><meta property="og:image" content="http://cdn.voidking.com//imgs/alipay-process/node%E7%AB%AF%E5%8F%91%E8%B5%B7%E8%AF%B7%E6%B1%82.jpg"><meta property="og:image" content="http://cdn.voidking.com//imgs/alipay-process/%E5%90%8E%E7%AB%AF%E5%8F%91%E8%B5%B7%E8%AF%B7%E6%B1%82.jpg"><meta property="og:image" content="http://cdn.voidking.com//imgs/alipay-process/%E4%B8%8D%E6%AD%A3%E5%B8%B8.jpg"><meta property="og:image" content="http://cdn.voidking.com//imgs/alipay-process/%E6%AD%A3%E5%B8%B8.jpg"><meta property="og:image" content="http://cdn.voidking.com//imgs/alipay-process/success.jpg"><meta property="og:image" content="http://cdn.voidking.com//imgs/alipay-process/error.jpg"><meta property="og:image" content="http://cdn.voidking.com//imgs/alipay-process/%E5%B1%8F%E8%94%BD.jpg?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com//imgs/alipay-process/%E6%8F%90%E7%A4%BA.jpg?imageView2/0/w/600"><meta property="article:published_time" content="2016-07-29T10:15:34.000Z"><meta property="article:modified_time" content="2016-07-29T10:15:34.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="前端"><meta property="article:tag" content="node"><meta property="article:tag" content="支付宝"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com//imgs/alipay-process/pid.png"><link rel="canonical" href="https://www.voidking.com/dev-alipay-process/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>支付宝手机网站支付流程 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-alipay-process/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> 支付宝手机网站支付流程</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2016-07-29 10:15:34" itemprop="dateCreated datePublished" datetime="2016-07-29T10:15:34+00:00">2016-07-29</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/nodejs/" itemprop="url" rel="index"><span itemprop="name">nodejs</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>公司M站要接入支付宝，借机研究了一下支付宝的支付流程。毕竟，只有公司才能拿到支付接口权限。</p><p>主要参考文档：<br><a target="_blank" rel="noopener" href="https://doc.open.alipay.com/doc2/detail?treeId=60&amp;articleId=103564&amp;docType=1">https://doc.open.alipay.com/doc2/detail?treeId=60&amp;articleId=103564&amp;docType=1</a><br><a target="_blank" rel="noopener" href="https://b.alipay.com/order/productDetail.htm?productId=2015110218008816">https://b.alipay.com/order/productDetail.htm?productId=2015110218008816</a></p><span id="more"></span><h1 id="手机网站支付接口"><a href="#手机网站支付接口" class="headerlink" title="手机网站支付接口"></a>手机网站支付接口</h1><h2 id="产品简介"><a href="#产品简介" class="headerlink" title="产品简介"></a>产品简介</h2><p>手机网站支付主要应用于手机、掌上电脑等无线设备的网页上，通过网页跳转或浏览器自带的支付宝快捷支付实现买家付款的功能，资金即时到账。</p><h2 id="申请条件"><a href="#申请条件" class="headerlink" title="申请条件"></a>申请条件</h2><p>1、您申请前必须拥有企业支付宝账号（不含个体工商户账号），且通过支付宝实名认证审核。<br>2、如果您有已经建设完成的无线网站（非淘宝、天猫、诚信通网店），网站经营的商品或服务内容明确、完整（古玩、珠宝等奢侈品、投资类行业无法申请本产品）。<br>3、网站必须已通过ICP备案，备案信息与签约商户信息一致。</p><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><p>假设我们已经成功申请到手机网站支付接口，在进行开发之前，需要使用公司账号登录支付宝开放平台。</p><h2 id="查看PID"><a href="#查看PID" class="headerlink" title="查看PID"></a>查看PID</h2><p>1、开发者登录开放平台，点击右上角的“账户及密钥管理”。<br><img src="http://cdn.voidking.com//imgs/alipay-process/pid.png"></p><p>2、选择“合作伙伴密钥”，即可查询到合作伙伴身份（PID），以2088开头的16位纯数字。<br><img src="http://cdn.voidking.com//imgs/alipay-process/pid2.png"></p><h2 id="配置密钥"><a href="#配置密钥" class="headerlink" title="配置密钥"></a>配置密钥</h2><p>支付宝提供了DSA、RSA、MD5三种签名方式，本次开发中，我们使用RSA签名和加密，那就只配置RSA密钥就好了。</p><p>关于RSA加密的详解，参见《支付宝签名与验签》。</p><h2 id="应用环境"><a href="#应用环境" class="headerlink" title="应用环境"></a>应用环境</h2><p>本节可以忽略，本节可以忽略，本节可以忽略！因为官方文档并没有提及应用环境配置的问题。</p><p>进入管理中心，对应用进行设置。<br><img src="http://cdn.voidking.com//imgs/alipay-process/nodeforum.jpg?imageView2/0/w/700"><br><img src="http://cdn.voidking.com//imgs/alipay-process/config.jpg"><br>上图是我的应用配置选项，公司账号也许会有所不同。具体哪些参数需要配置？请参照<a target="_blank" rel="noopener" href="https://doc.open.alipay.com/doc2/detail.htm?spm=a219a.7629140.0.0.J6vq89&treeId=60&articleId=104790&docType=1">接口参数说明</a>，需要什么就配置什么。</p><h1 id="交互"><a href="#交互" class="headerlink" title="交互"></a>交互</h1><h2 id="Node端发起支付请求"><a href="#Node端发起支付请求" class="headerlink" title="Node端发起支付请求"></a>Node端发起支付请求</h2><p><img src="http://cdn.voidking.com//imgs/alipay-process/node%E7%AB%AF%E5%8F%91%E8%B5%B7%E8%AF%B7%E6%B1%82.jpg"><br>我们公司采用的，就是这种方式，步骤3中Node端获取到的支付宝参数，包括sign。其实，sign的计算工作也可以放在Node端，只不过支付宝没有给出Node的demo，实现起来需要耗费多一点时间。</p><h2 id="后端发起支付请求"><a href="#后端发起支付请求" class="headerlink" title="后端发起支付请求"></a>后端发起支付请求</h2><p><img src="http://cdn.voidking.com//imgs/alipay-process/%E5%90%8E%E7%AB%AF%E5%8F%91%E8%B5%B7%E8%AF%B7%E6%B1%82.jpg"><br>这种方式也很好，而且，步骤4中后端获取到支付页面，也可以不传给Node端，自己显示出来。这样，整个流程就更加简单。</p><h2 id="return-url和notify-url"><a href="#return-url和notify-url" class="headerlink" title="return_url和notify_url"></a>return_url和notify_url</h2><p>return_url，支付完成后的回调url；notify_url，支付完成后通知的url。支付宝发送给两个url的参数是一样的，只不过一个是get，一个是post。</p><p>以上两种发起请求的方式中，return_url在Node端，notify_url在后端。我们也可以根据需要，把两个url都放在后端，或者都放在Node端，改变相应业务逻辑即可。</p><h1 id="Node端详解"><a href="#Node端详解" class="headerlink" title="Node端详解"></a>Node端详解</h1><p>Node端发起支付请求有两种选择，一种是获取到后端给的参数后，通过request模块发起get请求，获取到支付宝返回的支付页面，然后显示到页面上；另一种是获取到后端给的参数后，把参数全部输出到页面中的form表单，然后通过js自动提交表单，获取到支付宝返回的支付页面（同时显示出来）。</p><h2 id="request发起请求"><a href="#request发起请求" class="headerlink" title="request发起请求"></a>request发起请求</h2><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过orderId向后端请求获取支付宝支付参数alidata</span></span><br><span class="line"><span class="keyword">var</span> <span class="variable">alipayUrl</span> <span class="operator">=</span> &#x27;<span class="variable">https</span>:<span class="comment">//mapi.alipay.com/gateway.do?&#x27;+ alidata;</span></span><br><span class="line"><span class="variable">request</span>.<span class="property">get</span>(&#123;<span class="variable">url</span>: <span class="variable">alipayUrl</span>&#125;,<span class="title function_">function</span>(<span class="params">error</span>, <span class="params">response</span>, <span class="params">body</span>)&#123;</span><br><span class="line">    <span class="variable">res</span>.<span class="property">send</span>(<span class="variable">response</span>.<span class="property">body</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>理论上完全正确的请求，然而，获取到的支付页面，输出到页面上，却是乱码。没错，还是一个错误提示页面。<br><img src="http://cdn.voidking.com//imgs/alipay-process/%E4%B8%8D%E6%AD%A3%E5%B8%B8.jpg"></p><p>神奇的地方在于，在刷新页面多次后，正常了！！！啊嘞，这是什么鬼？</p><p><img src="http://cdn.voidking.com//imgs/alipay-process/%E6%AD%A3%E5%B8%B8.jpg"></p><p>先解决乱码问题，看看报什么错！</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">request.get(&#123;<span class="attr">url</span>: alipayUrl&#125;,<span class="keyword">function</span>(<span class="params">error, response, body</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> str = response2.body;</span><br><span class="line">    str = str.<span class="built_in">replace</span>(<span class="regexp">/gb2312/</span>, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    res.setHeader(<span class="string">&#x27;content-type&#x27;</span>, <span class="string">&#x27;text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">    res.send(str);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>很遗憾，无效！乱码依然是乱码。。。和沈晨帅哥讨论很久，最终决定换一种方案——利用表单提交。</p><h2 id="表单提交请求"><a href="#表单提交请求" class="headerlink" title="表单提交请求"></a>表单提交请求</h2><h3 id="Node端"><a href="#Node端" class="headerlink" title="Node端"></a>Node端</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node端</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过orderId向后端请求获取支付宝支付参数alidata</span></span><br><span class="line"><span class="keyword">function</span> get<span class="constructor">Arg(<span class="params">str</span>,<span class="params">arg</span>)</span> &#123;</span><br><span class="line">  var reg = <span class="keyword">new</span> <span class="constructor">RegExp(&#x27;(^|&amp;)</span>&#x27; + arg + &#x27;=(<span class="literal">[^&amp;]</span>*)(&amp;<span class="pattern-match">|<span class="constructor">$</span>)&#x27;, &#x27;i&#x27;);</span></span><br><span class="line"><span class="pattern-match">  var r = str.<span class="keyword">match</span>(reg);</span></span><br><span class="line"><span class="pattern-match">  <span class="keyword">if</span> (r != null) &#123;</span></span><br><span class="line"><span class="pattern-match">      return unescape(r[2]);</span></span><br><span class="line"><span class="pattern-match">  &#125;</span></span><br><span class="line"><span class="pattern-match">  return null;</span></span><br><span class="line"><span class="pattern-match">&#125;</span></span><br><span class="line"><span class="pattern-match"></span></span><br><span class="line"><span class="pattern-match">var alipay<span class="constructor">Param</span> = &#123;</span></span><br><span class="line"><span class="pattern-match">  <span class="constructor">_input_charset</span>: get<span class="constructor">Arg(<span class="params">alidata</span>,&#x27;<span class="params">_input_charset</span>&#x27;)</span>,</span></span><br><span class="line"><span class="pattern-match">  body: get<span class="constructor">Arg(<span class="params">alidata</span>,&#x27;<span class="params">body</span>&#x27;)</span>,</span></span><br><span class="line"><span class="pattern-match">  it<span class="constructor">_b_pay</span>: get<span class="constructor">Arg(<span class="params">alidata</span>, &#x27;<span class="params">it_b_pay</span>&#x27;)</span>,</span></span><br><span class="line"><span class="pattern-match">  notify<span class="constructor">_url</span>: get<span class="constructor">Arg(<span class="params">alidata</span>, &#x27;<span class="params">notify_url</span>&#x27;)</span>,</span></span><br><span class="line"><span class="pattern-match">  out<span class="constructor">_trade_no</span>: get<span class="constructor">Arg(<span class="params">alidata</span>, &#x27;<span class="params">out_trade_no</span>&#x27;)</span>,</span></span><br><span class="line"><span class="pattern-match">  partner: get<span class="constructor">Arg(<span class="params">alidata</span>, &#x27;<span class="params">partner</span>&#x27;)</span>,</span></span><br><span class="line"><span class="pattern-match">  payment<span class="constructor">_type</span>: get<span class="constructor">Arg(<span class="params">alidata</span>, &#x27;<span class="params">payment_type</span>&#x27;)</span>,</span></span><br><span class="line"><span class="pattern-match">  return<span class="constructor">_url</span>: get<span class="constructor">Arg(<span class="params">alidata</span>, &#x27;<span class="params">return_url</span>&#x27;)</span>,</span></span><br><span class="line"><span class="pattern-match">  seller<span class="constructor">_id</span>: get<span class="constructor">Arg(<span class="params">alidata</span>, &#x27;<span class="params">seller_id</span>&#x27;)</span>,</span></span><br><span class="line"><span class="pattern-match">  service: get<span class="constructor">Arg(<span class="params">alidata</span>, &#x27;<span class="params">service</span>&#x27;)</span>,</span></span><br><span class="line"><span class="pattern-match">  show<span class="constructor">_url</span>: get<span class="constructor">Arg(<span class="params">alidata</span>, &#x27;<span class="params">show_url</span>&#x27;)</span>,</span></span><br><span class="line"><span class="pattern-match">  subject: get<span class="constructor">Arg(<span class="params">alidata</span>, &#x27;<span class="params">subject</span>&#x27;)</span>,</span></span><br><span class="line"><span class="pattern-match">  total<span class="constructor">_fee</span>: get<span class="constructor">Arg(<span class="params">alidata</span>, &#x27;<span class="params">total_fee</span>&#x27;)</span>,</span></span><br><span class="line"><span class="pattern-match">  sign<span class="constructor">_type</span>: get<span class="constructor">Arg(<span class="params">alidata</span>, &#x27;<span class="params">sign_type</span>&#x27;)</span>,</span></span><br><span class="line"><span class="pattern-match">  sign: get<span class="constructor">Arg(<span class="params">alidata</span>, &#x27;<span class="params">sign</span>&#x27;)</span>,</span></span><br><span class="line"><span class="pattern-match">  app<span class="constructor">_pay</span>: get<span class="constructor">Arg(<span class="params">alidata</span>, &#x27;<span class="params">app_pay</span>&#x27;)</span></span></span><br><span class="line"><span class="pattern-match">&#125;;</span></span><br><span class="line"><span class="pattern-match"></span></span><br><span class="line"><span class="pattern-match">res.render(&#x27;artist<span class="operator">/</span>alipay&#x27;,&#123;</span></span><br><span class="line"><span class="pattern-match">  <span class="operator">/</span><span class="operator">/</span> 其他参数</span></span><br><span class="line"><span class="pattern-match">  alipay<span class="constructor">Param</span>: alipay<span class="constructor">Param</span></span></span><br><span class="line"><span class="pattern-match">&#125;);</span></span><br><span class="line"><span class="pattern-match"></span></span><br></pre></td></tr></table></figure><h3 id="html"><a href="#html" class="headerlink" title="html"></a>html</h3><figure class="highlight erb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="comment">&lt;!--alipay.html--&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>支付宝支付<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;ali-form&quot;</span> <span class="attr">action</span>=<span class="string">&quot;https://mapi.alipay.com/gateway.do&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span>   </span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_input_charset&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam._input_charset</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;body&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.body</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;it_b_pay&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.it_b_pay</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;notify_url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.notify_url</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;out_trade_no&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.out_trade_no</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;partner&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.partner</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;payment_type&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.payment_type</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;return_url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.return_url</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;seller_id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.seller_id</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;service&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.service</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;show_url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.show_url</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;subject&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.subject</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;total_fee&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.total_fee</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sign_type&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.sign_type</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sign&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.sign</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;app_pay&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.app_pay</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">&lt;%</span><span class="language-ruby"> <span class="keyword">include</span> ../bootstrap.html </span><span class="language-xml">%&gt;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> dist </span><span class="language-xml"><span class="tag"><span class="string">%&gt;/js/business-modules/artist/alipay.js?v=2016052401&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="js"><a href="#js" class="headerlink" title="js"></a>js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// alipay.js</span></span><br><span class="line">seajs.<span class="title function_">use</span>([<span class="string">&#x27;zepto&#x27;</span>],<span class="keyword">function</span>(<span class="params">$</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> index = &#123;</span><br><span class="line">        <span class="attr">init</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> self = <span class="variable language_">this</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">bindEvent</span>();</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">bindEvent</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> self = <span class="variable language_">this</span>;</span><br><span class="line">            $(<span class="string">&#x27;#ali-form&#x27;</span>).<span class="title function_">submit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    index.<span class="title function_">init</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p><img src="http://cdn.voidking.com//imgs/alipay-process/success.jpg"><br>选择支付宝支付后，成功跳转到了支付宝支付页面，nice！看来这种方案很靠谱。</p><p>开始时，打算把alidata直接输出到form表单的action中接口的后面，因为这样似乎最简便。但是，提交表单时，后面的参数全部被丢弃了。所以，不得不得把所有参数放在form表单中。Node端拆分了一下参数，组装成了一个alipayParam对象，这个工作也可以交给后端来做。</p><p>显然，request模拟表单提交和真实表单提交结果的不同，得出的结论是，request并不能完全模拟表单提交。或者，request可以模拟，而我不会-_-|||。</p><h2 id="错误排查"><a href="#错误排查" class="headerlink" title="错误排查"></a>错误排查</h2><p><img src="http://cdn.voidking.com//imgs/alipay-process/error.jpg"><br>值得点赞的是，支付宝给的错误代码很明确，一看就懂。上面这个错误，签名不对。因为我给alipayParam私自加了个app_pay属性，没有经过签名。</p><h1 id="微信屏蔽支付宝"><a href="#微信屏蔽支付宝" class="headerlink" title="微信屏蔽支付宝"></a>微信屏蔽支付宝</h1><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>以上，大功告成？不！还有一个坑要填，因为微信屏蔽了支付宝！<br>在电脑上，跳转支付宝支付页面正常，很完美！然而，在微信浏览器中测试时，却没有跳转，而是出现如下信息。<br><img src="http://cdn.voidking.com//imgs/alipay-process/%E5%B1%8F%E8%94%BD.jpg?imageView2/0/w/600"></p><h2 id="完美解决办法"><a href="#完美解决办法" class="headerlink" title="完美解决办法"></a>完美解决办法</h2><p>微信端支付宝支付，iframe改造<br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/jiqing9006/p/5584268.html">http://www.cnblogs.com/jiqing9006/p/5584268.html</a></p><p>该办法的核心在于：把微信屏蔽的链接，赋值给iframe的src属性。</p><h3 id="Node端-1"><a href="#Node端-1" class="headerlink" title="Node端"></a>Node端</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">res.<span class="title function_ invoke__">render</span>(<span class="string">&#x27;artist/alipay&#x27;</span>,&#123;</span><br><span class="line">  <span class="attr">alipayParam</span>: alipayParam,</span><br><span class="line">  <span class="attr">param</span>: <span class="title function_ invoke__">urlencode</span>(alidata) </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="html-1"><a href="#html-1" class="headerlink" title="html"></a>html</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type<span class="operator">=</span><span class="string">&quot;hidden&quot;</span> id<span class="operator">=</span><span class="string">&quot;param&quot;</span> value<span class="operator">=</span><span class="string">&quot;&lt;%= param%&gt;&quot;</span>&gt;</span><br><span class="line">&lt;iframe id<span class="operator">=</span><span class="string">&quot;payFrame&quot;</span> name<span class="operator">=</span><span class="string">&quot;mainIframe&quot;</span> src<span class="operator">=</span><span class="string">&quot;&quot;</span> frameborder<span class="operator">=</span><span class="string">&quot;0&quot;</span> scrolling<span class="operator">=</span><span class="string">&quot;auto&quot;</span> &gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure><h3 id="js-1"><a href="#js-1" class="headerlink" title="js"></a>js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> iframe = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;payFrame&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> param = $(<span class="string">&#x27;#param&#x27;</span>).<span class="title function_">val</span>();</span><br><span class="line">iframe.<span class="property">src</span>=<span class="string">&#x27;https://mapi.alipay.com/gateway.do?&#x27;</span>+param;</span><br></pre></td></tr></table></figure><h3 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h3><p>然而，在改造时，先是报错ILLEGAL_SIGN，于是利用urlencode处理了字符串。接着，又报错ILLEGAL_EXTERFACE，没有找到解决办法。</p><p>暂时放弃，以后如果有了解决办法再补上。</p><h2 id="官方解决办法"><a href="#官方解决办法" class="headerlink" title="官方解决办法"></a>官方解决办法</h2><p>关于微信公众平台无法使用支付宝收付款的解决方案说明<br><a target="_blank" rel="noopener" href="https://cshall.alipay.com/enterprise/help_detail.htm?help_id=524702">https://cshall.alipay.com/enterprise/help_detail.htm?help_id=524702</a></p><p>该方法的核心在于：确认支付时，提示用户打开外部系统浏览器，在系统浏览器中支付。</p><h3 id="html-2"><a href="#html-2" class="headerlink" title="html"></a>html</h3><figure class="highlight erb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="comment">&lt;!--alipay.html--&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>支付宝支付<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;ali-form&quot;</span> <span class="attr">action</span>=<span class="string">&quot;https://mapi.alipay.com/gateway.do&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_input_charset&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam._input_charset</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;body&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.body</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;it_b_pay&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.it_b_pay</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;notify_url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.notify_url</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;out_trade_no&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.out_trade_no</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;partner&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.partner</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;payment_type&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.payment_type</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;return_url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.return_url</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;seller_id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.seller_id</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;service&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.service</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;show_url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.show_url</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;subject&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.subject</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;total_fee&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.total_fee</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sign_type&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.sign_type</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sign&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> alipayParam.sign</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrapper buy-wrapper&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0);&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">           <span class="attr">class</span>=<span class="string">&quot;J-btn-submit btn mj-submit btn-strong btn-larger btn-block&quot;</span>&gt;</span>确认支付<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">id</span>=<span class="string">&quot;param&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> param</span><span class="language-xml"><span class="tag"><span class="string">%&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">&lt;%</span><span class="language-ruby"> <span class="keyword">include</span> ../bootstrap.html </span><span class="language-xml">%&gt;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&lt;%=</span></span></span><span class="language-ruby"> dist </span><span class="language-xml"><span class="tag"><span class="string">%&gt;/js/business-modules/artist/ap.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> btn = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.J-btn-submit&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    btn.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        e.<span class="title function_">preventDefault</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        e.<span class="title function_">stopPropagation</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        e.<span class="title function_">stopImmediatePropagation</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> queryParam = <span class="string">&#x27;&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;input[type=hidden]&quot;</span>)).<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">ele</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            queryParam += ele.<span class="property">name</span> + <span class="string">&quot;=&quot;</span> + <span class="built_in">encodeURIComponent</span>(ele.<span class="property">value</span>) + <span class="string">&#x27;&amp;&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> gotoUrl = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#ali-form&quot;</span>).<span class="title function_">getAttribute</span>(<span class="string">&#x27;action&#x27;</span>) + <span class="string">&#x27;?&#x27;</span> + queryParam;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        _AP.<span class="title function_">pay</span>(gotoUrl);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;, <span class="literal">false</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    btn.<span class="title function_">click</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>该页面会自动跳转到同一文件夹下的pay.htm，该文件官方已经提供，把其中的引入ap.js的路径修改一下即可。最终效果如下：<br><img src="http://cdn.voidking.com//imgs/alipay-process/%E6%8F%90%E7%A4%BA.jpg?imageView2/0/w/600"></p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>支付宝的支付流程和微信的支付流程，有很多相似之处。沈晨指出一点不同：支付宝支付完成后有return_url和notify_url；微信支付完成后只有notify_url。</p><p>研读了一下微信支付的开发文档，确实如此。微信支付完成后的通知也分成两路，一路通知到notify_url，另一路返回给调用支付接口的JS，同时发微信消息提示。也就是说，跳转return_url的工作我们需要自己做。</p><p>最后，感谢沈晨帅哥提供的思路和帮助，感谢体超帅哥辛苦改后端。</p><h1 id="书签"><a href="#书签" class="headerlink" title="书签"></a>书签</h1><p>支付宝开放平台<br><a target="_blank" rel="noopener" href="https://openhome.alipay.com/platform/home.htm">https://openhome.alipay.com/platform/home.htm</a></p><p>支付宝开放平台-手机网站支付-文档中心<br><a target="_blank" rel="noopener" href="https://doc.open.alipay.com/doc2/detail?treeId=60&amp;articleId=103564&amp;docType=1">https://doc.open.alipay.com/doc2/detail?treeId=60&amp;articleId=103564&amp;docType=1</a></p><p>支付宝WAP支付接口开发<br><a target="_blank" rel="noopener" href="http://blog.csdn.net/tspangle/article/details/39932963">http://blog.csdn.net/tspangle/article/details/39932963</a></p><p><a target="_blank" rel="noopener" href="http://jingyan.baidu.com/article/8ebacdf016222249f65cd532.html?qq-pf-to=pcqq.c2c">wap h5手机网站支付接口唤起支付宝钱包付款</a></p><p>商家服务 - 支付宝 知托付！<br><a target="_blank" rel="noopener" href="https://b.alipay.com/order/techService.htm">https://b.alipay.com/order/techService.htm</a></p><p>微信支付-开发文档<br><a target="_blank" rel="noopener" href="https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_1">https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_1</a></p><p>微信端支付宝支付，iframe改造<br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/jiqing9006/p/5584268.html">http://www.cnblogs.com/jiqing9006/p/5584268.html</a></p><p>微信如何突破支付宝的封锁<br><a target="_blank" rel="noopener" href="http://blog.csdn.net/lee_sire/article/details/49530875">http://blog.csdn.net/lee_sire/article/details/49530875</a></p><p>JavaScript专题（二）：深入理解iframe<br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/fangjins/archive/2645631.html">http://www.cnblogs.com/fangjins/archive/2645631.html</a></p><p>关于微信公众平台无法使用支付宝收付款的解决方案说明<br><a target="_blank" rel="noopener" href="https://cshall.alipay.com/enterprise/help_detail.htm?help_id=524702">https://cshall.alipay.com/enterprise/help_detail.htm?help_id=524702</a></p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-alipay-process/" title="支付宝手机网站支付流程">https://www.voidking.com/dev-alipay-process/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag"># 前端</a> <a href="/tags/node/" rel="tag"># node</a> <a href="/tags/%E6%94%AF%E4%BB%98%E5%AE%9D/" rel="tag"># 支付宝</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-node-request-local-data/" rel="prev" title="利用Node的request模块访问本地数据"><i class="fa fa-chevron-left"></i> 利用Node的request模块访问本地数据</a></div><div class="post-nav-item"> <a href="/dev-alipay-sign-and-checksign/" rel="next" title="支付宝签名与验签">支付宝签名与验签<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%89%8B%E6%9C%BA%E7%BD%91%E7%AB%99%E6%94%AF%E4%BB%98%E6%8E%A5%E5%8F%A3"><span class="nav-number">2.</span> <span class="nav-text">手机网站支付接口</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%A7%E5%93%81%E7%AE%80%E4%BB%8B"><span class="nav-number">2.1.</span> <span class="nav-text">产品简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%B3%E8%AF%B7%E6%9D%A1%E4%BB%B6"><span class="nav-number">2.2.</span> <span class="nav-text">申请条件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-number">3.</span> <span class="nav-text">配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8BPID"><span class="nav-number">3.1.</span> <span class="nav-text">查看PID</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%AF%86%E9%92%A5"><span class="nav-number">3.2.</span> <span class="nav-text">配置密钥</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%8E%AF%E5%A2%83"><span class="nav-number">3.3.</span> <span class="nav-text">应用环境</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%A4%E4%BA%92"><span class="nav-number">4.</span> <span class="nav-text">交互</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Node%E7%AB%AF%E5%8F%91%E8%B5%B7%E6%94%AF%E4%BB%98%E8%AF%B7%E6%B1%82"><span class="nav-number">4.1.</span> <span class="nav-text">Node端发起支付请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8E%E7%AB%AF%E5%8F%91%E8%B5%B7%E6%94%AF%E4%BB%98%E8%AF%B7%E6%B1%82"><span class="nav-number">4.2.</span> <span class="nav-text">后端发起支付请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#return-url%E5%92%8Cnotify-url"><span class="nav-number">4.3.</span> <span class="nav-text">return_url和notify_url</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Node%E7%AB%AF%E8%AF%A6%E8%A7%A3"><span class="nav-number">5.</span> <span class="nav-text">Node端详解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#request%E5%8F%91%E8%B5%B7%E8%AF%B7%E6%B1%82"><span class="nav-number">5.1.</span> <span class="nav-text">request发起请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4%E8%AF%B7%E6%B1%82"><span class="nav-number">5.2.</span> <span class="nav-text">表单提交请求</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Node%E7%AB%AF"><span class="nav-number">5.2.1.</span> <span class="nav-text">Node端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#html"><span class="nav-number">5.2.2.</span> <span class="nav-text">html</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#js"><span class="nav-number">5.2.3.</span> <span class="nav-text">js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">5.2.4.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E6%8E%92%E6%9F%A5"><span class="nav-number">5.3.</span> <span class="nav-text">错误排查</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BE%AE%E4%BF%A1%E5%B1%8F%E8%94%BD%E6%94%AF%E4%BB%98%E5%AE%9D"><span class="nav-number">6.</span> <span class="nav-text">微信屏蔽支付宝</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="nav-number">6.1.</span> <span class="nav-text">问题描述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%8C%E7%BE%8E%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="nav-number">6.2.</span> <span class="nav-text">完美解决办法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Node%E7%AB%AF-1"><span class="nav-number">6.2.1.</span> <span class="nav-text">Node端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#html-1"><span class="nav-number">6.2.2.</span> <span class="nav-text">html</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#js-1"><span class="nav-number">6.2.3.</span> <span class="nav-text">js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%A5%E9%94%99"><span class="nav-number">6.2.4.</span> <span class="nav-text">报错</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%98%E6%96%B9%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="nav-number">6.3.</span> <span class="nav-text">官方解决办法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#html-2"><span class="nav-number">6.3.1.</span> <span class="nav-text">html</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E8%AE%B0"><span class="nav-number">7.</span> <span class="nav-text">后记</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B9%A6%E7%AD%BE"><span class="nav-number">8.</span> <span class="nav-text">书签</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">630</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">31</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">233</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>