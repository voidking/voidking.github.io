<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言《使用PSSH批量管理Linux》一文中，已经学习了使用pssh批量管理linux的技巧。而很多时候，我们需要定时执行一些任务，或者需要定时执行一些批量任务。因此，本文就来研究一下linux设置定时任务的方法。 主要参考Linux Crontab 定时任务、Linux定时任务Crontab命令详解 和 Linux 定时任务详解 。"><meta property="og:type" content="article"><meta property="og:title" content="Linux设置定时任务"><meta property="og:url" content="https://www.voidking.com/dev-linux-crontab/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言《使用PSSH批量管理Linux》一文中，已经学习了使用pssh批量管理linux的技巧。而很多时候，我们需要定时执行一些任务，或者需要定时执行一些批量任务。因此，本文就来研究一下linux设置定时任务的方法。 主要参考Linux Crontab 定时任务、Linux定时任务Crontab命令详解 和 Linux 定时任务详解 。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2018-05-23T01:00:00.000Z"><meta property="article:modified_time" content="2022-01-22T01:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="shell"><meta property="article:tag" content="crontab"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-linux-crontab/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Linux设置定时任务 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-linux-crontab/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Linux设置定时任务</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-05-23 09:00:00" itemprop="dateCreated datePublished" datetime="2018-05-23T09:00:00+08:00">2018-05-23</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-01-22 09:00:00" itemprop="dateModified" datetime="2022-01-22T09:00:00+08:00">2022-01-22</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/" itemprop="url" rel="index"><span itemprop="name">专业</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><a href="http://www.voidking.com/dev-pssh-manage-linux/">《使用PSSH批量管理Linux》</a>一文中，已经学习了使用pssh批量管理linux的技巧。而很多时候，我们需要定时执行一些任务，或者需要定时执行一些批量任务。因此，本文就来研究一下linux设置定时任务的方法。</p><p>主要参考<a href="http://www.runoob.com/w3cnote/linux-crontab-tasks.html" target="_blank" rel="noopener">Linux Crontab 定时任务</a>、<a href="https://www.cnblogs.com/intval/p/5763929.html" target="_blank" rel="noopener">Linux定时任务Crontab命令详解</a> 和 <a href="https://www.cnblogs.com/limonyun/archive/7659350.html" target="_blank" rel="noopener">Linux 定时任务详解</a> 。</p><a id="more"></a><h1 id="理论篇"><a href="#理论篇" class="headerlink" title="理论篇"></a>理论篇</h1><h2 id="crond简介"><a href="#crond简介" class="headerlink" title="crond简介"></a>crond简介</h2><p>cron（crond）是linux下用来周期性的执行某种任务或等待处理某些事件的一个守护进程。linux系统上面原本就有非常多的计划性工作，因此这个系统服务是默认启动的。crond进程每分钟会定期检查是否有要执行的任务，如果有要执行的任务，则自动执行该任务。另外，由于使用者自己也可以设置计划任务，所以，linux系统也提供了使用者控制计划任务的命令：crontab命令。</p><p>crontab命令是cron table的简写，它是cron的配置文件，也可以叫它作业列表，我们可以在以下文件夹内找到相关配置文件。</p><ul><li><code>/var/spool/cron/crontabs/</code> 目录下存放的是每个用户包括root的crontab任务，每个任务以创建者的名字命名。</li><li><code>/etc/crontab</code> 这个文件负责调度各种管理和维护任务。</li><li><code>/etc/cron.d/</code> 这个目录用来存放任何要执行的crontab文件或脚本。</li><li>我们还可以把脚本放在<code>/etc/cron.hourly</code>、<code>/etc/cron.daily</code>、<code>/etc/cron.weekly</code>、<code>/etc/cron.monthly</code>目录中，让它每小时/天/星期/月执行一次。</li></ul><p>linux下的任务调度分为两类，系统任务调度和用户任务调度。</p><p>系统任务调度：系统周期性所要执行的工作，比如写缓存数据到硬盘、日志清理等。<code>/etc/crontab</code>文件就是系统任务调度的配置文件。</p><p>用户任务调度：用户定期要执行的工作，比如用户数据备份、定时邮件提醒等。用户可以使用 crontab 工具来定制自己的计划任务。所有用户定义的crontab文件都被保存在 <code>/var/spool/cron/crontabs/</code>目录中，其文件名与用户名一致。</p><h2 id="crontab文件"><a href="#crontab文件" class="headerlink" title="crontab文件"></a>crontab文件</h2><p>假设我们使用的是Ubuntu14.04.5 Server版，查看<code>/etc/crontab</code>，内容为：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/crontab: system-wide crontab</span></span><br><span class="line"><span class="comment"># Unlike any other crontab you don't have to run the `crontab'</span></span><br><span class="line"><span class="comment"># command to install the new version when you edit this file</span></span><br><span class="line"><span class="comment"># and files in /etc/cron.d. These files also have username fields,</span></span><br><span class="line"><span class="comment"># that none of the other crontabs do.</span></span><br><span class="line"></span><br><span class="line">SHELL=<span class="regexp">/bin/sh</span></span><br><span class="line">PATH=<span class="regexp">/usr/local</span><span class="regexp">/sbin:/usr</span><span class="regexp">/local/bin</span><span class="symbol">:/sbin</span><span class="symbol">:/bin</span><span class="symbol">:/usr/sbin</span><span class="symbol">:/usr/bin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># m h dom mon dow user  command</span></span><br><span class="line"><span class="number">17</span> *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly</span><br><span class="line"><span class="number">25</span> <span class="number">6</span>    * * *   root    test -x /usr/sbin/anacron <span class="params">||</span> ( cd / &amp;&amp; run-parts --report /etc/cron.daily )</span><br><span class="line"><span class="number">47</span> <span class="number">6</span>    * * <span class="number">7</span>   root    test -x /usr/sbin/anacron <span class="params">||</span> ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )</span><br><span class="line"><span class="number">52</span> <span class="number">6</span>    <span class="number">1</span> * *   root    test -x /usr/sbin/anacron <span class="params">||</span> ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )</span><br></pre></td></tr></table></figure><p>第一行SHELL变量指定了系统要使用哪个shell；第二行PATH变量指定了系统执行 命令的路径。<br>接下来的命令格式为：<br><code>m h dom mon dow user command</code><br>英文全拼为：<br><code>minute hour day month week user commond</code></p><ul><li>minute：表示分钟，可以是从0到59之间的任何整数。</li><li>hour：表示小时，可以是从0到23之间的任何整数。</li><li>day：表示日期，可以是从1到31之间的任何整数。</li><li>month：表示月份，可以是从1到12之间的任何整数。</li><li>week：表示星期几，可以是从0到7之间的任何整数，这里的0或7代表星期日。</li><li>user：表示用户。</li><li>command：要执行的命令，可以是系统命令，也可以是自己编写的脚本文件。</li></ul><p>注意，<code>/var/spool/cron</code>目录中的用户调度任务，没有user一项，因为文件名已经代表了user。</p><p>在以上各个字段中，还可以使用以下特殊字符：</p><ul><li>星号（*）：代表所有可能的值，例如month字段如果是星号，则表示在满足其它字段的制约条件后每月都执行该命令操作。</li><li>逗号（,）：可以用逗号隔开的值指定一个列表范围，例如，“1,2,5,7,8,9”</li><li>中杠（-）：可以用整数之间的中杠表示一个整数范围，例如“2-6”表示“2,3,4,5,6”</li><li>正斜线（/）：可以用正斜线指定时间的间隔频率，例如“0-23/2”表示每两小时执行一次。</li><li>同时正斜线可以和星号一起使用，例如*/10，如果用在minute字段，表示每十分钟执行一次。</li></ul><h2 id="crontab命令"><a href="#crontab命令" class="headerlink" title="crontab命令"></a>crontab命令</h2><p>crontab命令格式为：<br><code>crontab [-u username] [file] [ -e | -l | -r ]</code></p><ul><li><code>-u username</code>，指定设置某个用户的crontab，省略则表示操作当前用户的crontab。</li><li><code>file</code>，将file做为crontab的任务列表文件并载入crontab。如果没有指定这个文件，crontab命令将接受标准输入（键盘）上键入的命令，并将它们载入crontab。</li><li><code>-e</code>，编辑某个用户的crontab文件内容。如果不指定用户，则表示编辑当前用户的crontab文件。</li><li><code>-l</code>，显示某个用户的crontab文件内容，如果不指定用户，则表示显示当前用户的crontab文件内容。</li><li><code>-r</code>，删除某个用户的crontab文件，如果不指定用户，则默认删除当前用户的crontab文件。</li></ul><h2 id="crontab脚本"><a href="#crontab脚本" class="headerlink" title="crontab脚本"></a>crontab脚本</h2><p>对于比较长的命令，我们一般不写在crontab文件里，而是单独搞一个脚本，定时任务调用这个脚本。例如：</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">5 </span><span class="number">0</span> * * * /home/voidking/restart.sh</span><br></pre></td></tr></table></figure><p>怎样测试定时任务是否好用？最简单的办法就是改一下定时任务调用时间为 <code>* * * * *</code> ，测试完成再改回去。<br>如果发现手动执行 restart.sh 脚本可以成功，但是通过定时任务调用无法成功，那么大概率是因为环境变量问题。<br>可以在 restart.sh 脚本里先调用一次 <code>source ~/.bash_profile</code>，或者执行<code>env</code>，然后把所有变量都写到 restart.sh 脚本中。<br>详情参考<a href="https://www.voidking.com/dev-bashprofile-bashrc/">《bash_profile和bashrc的区别》</a></p><h1 id="实践篇"><a href="#实践篇" class="headerlink" title="实践篇"></a>实践篇</h1><h2 id="设置系统时间"><a href="#设置系统时间" class="headerlink" title="设置系统时间"></a>设置系统时间</h2><p>设置定时任务和时间紧密相关，如果服务器的时区时间设置和本地不同，就不能保证计划任务的正确执行。所以使用crontab的第一步，是调节好服务器的时间。</p><p>下面参考<a href="https://www.cnblogs.com/EasonJim/p/8099668.html" target="_blank" rel="noopener">Ubuntu 16.04将系统时间写入到硬件时间BIOS</a>，对服务器时间进行调节。</p><p>时间是有时区的，无论硬件时间还是操作系统时间。hwclock的时区在/etc/default/rcS文件中设置，里面有一个参数UTC，默认值为yes，表示使用UTC时区，如果设置为no，那表示使用osclock的时区。建议hwclock与osclock设置相同的时区，也就是no。</p><p>1、查看服务器硬件时间<br><code>sudo hwclock -r</code>，看到的时间格式为：<code>Wed 23 May 2018 11:02:17 AM HKT -0.031663 seconds</code></p><p>2、查看服务器系统时间<br><code>date</code>，看到的时间格式为：<code>Wed May 23 11:02:41 HKT 2018</code></p><p>3、设置hwclock和osclock时区相同<br><code>sudo vim /etc/default/rcS</code>，找到：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">UTC</span>=<span class="literal">yes</span></span><br></pre></td></tr></table></figure><p>修改为：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">UTC</span>=<span class="literal">no</span></span><br></pre></td></tr></table></figure><p>4、将系统时间写入硬件时间<br><code>sudo hwclock -w</code></p><p>5、修改系统时区<br>osclock的时区配置文件为/etc/timezone，不建议直接修改配置文件。</p><p>如果你想修改为CST时间，那么执行<code>sudo tzselect</code>命令时，选择Asia-&gt;China-&gt;Beijing Time即可，这时会提示使用Asia/Shanghai时区。（ubuntu和centos通用）</p><p>6、设置即刻生效<br>执行<code>date</code>，发现时区没有变化，依然是HKT。</p><p><code>sudo cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</code><br><code>sudo ntpdate time.windows.com</code></p><p>如果执行ntpdate报错：ntpdate[18409]: no server suitable for synchronization found ，那么就换一个时间同步工具。<br><code>sudo apt-get install rdate</code><br><code>sudo rdate -s time-b.nist.gov</code></p><p>再次执行<code>date</code>，发现时区已经变成了CST。</p><p>7、硬件时间同步<br><code>sudo hwclock -r</code>，发现硬件时间落后。<br><code>sudo hwclock -w</code>，再次把系统时间写入硬件时间，同步完成。</p><h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>实例1：每分钟、每小时、每天、每周、每月、每年执行</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* * * * * myCommand</span><br><span class="line"><span class="number">0</span> * * * * myCommand</span><br><span class="line"><span class="number">0</span> <span class="number">0</span> * * * myCommand</span><br><span class="line"><span class="number">0</span> <span class="number">0</span> * * <span class="number">0</span> myCommand</span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> * * myCommand</span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> * myCommand</span><br></pre></td></tr></table></figure><p>实例2：每小时的第3和第15分钟执行<br><code>3,15 * * * * myCommand</code></p><p>实例3：在上午8点到11点的第3和第15分钟执行<br><code>3,15 8-11 * * * myCommand</code></p><p>实例4：每隔两天的上午8点到11点的第3和第15分钟执行<br><code>3,15 8-11 */2 * * myCommand</code></p><p>实例5：每周一上午8点到11点的第3和第15分钟执行<br><code>3,15 8-11 * * 1 myCommand</code></p><p>实例6：每晚的21:30重启smb<br><code>30 21 * * * /etc/init.d/smb restart</code></p><p>实例7：每月1、10、22日的4 : 45重启smb<br><code>45 4 1,10,22 * * /etc/init.d/smb restart</code></p><p>实例8：每周六、周日的1 : 10重启smb<br><code>10 1 * * 6,0 /etc/init.d/smb restart</code></p><p>实例9：每天18 : 00至23 : 00之间每隔30分钟重启smb<br><code>0,30 18-23 * * * /etc/init.d/smb restart</code></p><p>实例10：每星期六的晚上11 : 00 pm重启smb<br><code>0 23 * * 6 /etc/init.d/smb restart</code></p><p>实例11：每一小时重启smb<br><code>0 * * * * /etc/init.d/smb restart</code></p><p>实例12：晚上11点到早上7点之间，每隔一小时重启smb<br><code>0 23-7/1 * * * /etc/init.d/smb restart</code></p><p>实例13：每月的4号与每周一到周三的11点重启smb<br><code>0 11 4 * mon-wed /etc/init.d/smb restart</code></p><p>实例14：一月一号的4点重启smb<br><code>0 4 1 jan * /etc/init.d/smb restart</code></p><p>实例15：每小时执行/etc/cron.hourly目录内的脚本<br><code>01 * * * * root run-parts /etc/cron.hourly</code><br>run-parts这个参数了，如果去掉这个参数的话，后面就可以写要运行的某个脚本名，而不是目录名了。</p><h2 id="查看ganglia的状态"><a href="#查看ganglia的状态" class="headerlink" title="查看ganglia的状态"></a>查看ganglia的状态</h2><p>目标：每分钟查看一下ganglia的状态，并保存到/tmp/log/ganglia目录。</p><p>1、创建/tmp/log/ganglia目录<br><code>sudo mkdir -p /tmp/log/ganglia</code></p><p><code>sudo chmod a+w /tmp/log/ganglia</code></p><p>2、编辑crontab<br><code>crontab -e</code>，选择编辑器为vim</p><p>3、在crontab文件中添加一行（注意该命令是错误的，不要直接使用）</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * pssh -h /home/test/hosts.txt -t <span class="number">30</span> -i <span class="string">'ps aux | grep gmond'</span> &gt; /tmp/log/ganglia/ganglia-`date +<span class="meta">%Y</span><span class="meta">%m</span><span class="meta">%d-</span><span class="meta">%H</span><span class="meta">%M</span><span class="meta">%S</span>`.log</span><br></pre></td></tr></table></figure><p>4、查看crontab任务<br><code>crontab -l</code>，看到任务已经添加成功。</p><p>5、等待了五分钟，发现/tmp/log/ganglia目录下啥也没有。<br><code>sudo service cron status</code>，状态正常。<br><code>sudo /etc/init.d/cron restart</code>，重启cron试试。<br>又等待了五分钟，发现/tmp/log/ganglia目录下依然空空。</p><p>莫非是因为pssh没有使用绝对路径？<code>whereis pssh</code>，找到pssh路径为<code>/usr/lib/pssh</code>，修改crontab为：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * <span class="regexp">/usr/lib</span><span class="regexp">/pssh -h /home</span><span class="regexp">/test/hosts</span>.txt -t <span class="number">30</span> -i <span class="string">'ps aux | grep gmond'</span> &gt; <span class="regexp">/tmp/log</span><span class="regexp">/ganglia/ganglia</span>-<span class="string">`date +%Y%m%d-%H%M%S`</span>.log</span><br></pre></td></tr></table></figure><p>然而，并没有用。<br>还是查看下crontab日志吧！</p><h2 id="开启crontab日志"><a href="#开启crontab日志" class="headerlink" title="开启crontab日志"></a>开启crontab日志</h2><p>以下主要参考<a href="https://www.cnblogs.com/michaelzhao10/p/4875719.html" target="_blank" rel="noopener">Ubuntu下用crontab 部署定时任务</a>。</p><p>1、编辑50-default.conf<br><code>sudo vim /etc/rsyslog.d/50-default.conf</code></p><p>2、把cron前的井号去掉，也就是修改为：</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cron.*                         /<span class="built_in">var</span>/<span class="keyword">log</span>/cron.<span class="keyword">log</span></span><br></pre></td></tr></table></figure><p>3、重启rsyslog服务<br><code>sudo service rsyslog restart</code></p><p>4、重启crontab服务<br><code>sudo service cron restart</code></p><p>5、查看crontab日志<br><code>less /var/log/cron.log</code></p><p>果然发现了问题：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(test) CMD (<span class="regexp">/usr/</span>lib<span class="regexp">/pssh -h /</span>home<span class="regexp">/test/</span>hosts.txt -t <span class="number">30</span> -i <span class="string">'ps aux | grep gmond'</span> &gt; <span class="regexp">/tmp/</span>log<span class="regexp">/ganglia/g</span>anglia-`date +)</span><br></pre></td></tr></table></figure><p>也就是说，命令确实按时执行了，只不过没有执行完，被百分号截断了，导致log文件没有正常生成！</p><p>修改crontab为：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * <span class="regexp">/usr/lib</span><span class="regexp">/pssh -h /home</span><span class="regexp">/test/hosts</span>.txt -t <span class="number">30</span> -i <span class="string">'ps aux | grep gmond'</span> &gt; <span class="regexp">/tmp/log</span><span class="regexp">/ganglia/ganglia</span>-<span class="string">`date +\%Y\%m\%d-\%H\%M\%S`</span>.log</span><br></pre></td></tr></table></figure><p>终于，log文件成功生成，nice！但是，文件内容是空的！因为，<code>/usr/lib/pssh</code>是一个目录，不是pssh命令！真正的pssh命令是parallel-ssh，找到它的位置为<code>/usr/bin/parallel-ssh</code>，修改crontab：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * <span class="regexp">/usr/bin</span><span class="regexp">/parallel-ssh -h /home</span><span class="regexp">/test/hosts</span>.txt -t <span class="number">30</span> -i <span class="string">'ps aux | grep gmond'</span> &gt; <span class="regexp">/tmp/log</span><span class="regexp">/ganglia/ganglia</span>-<span class="string">`date +\%Y\%m\%d-\%H\%M\%S`</span>.log</span><br></pre></td></tr></table></figure><p>至此，问题圆满解决。<br>实际使用的时候，一天获取一次ganglia的状态就够了，所以crontab改成：</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">0 </span><span class="number">0</span> * * * /<span class="keyword">usr</span>/bin/parallel-ssh -h /home/test/hosts.txt -t <span class="number">30</span> -i <span class="comment">'ps aux | grep gmond' &gt; /tmp/log/ganglia/ganglia-`date +\%Y\%m\%d`.log</span></span><br></pre></td></tr></table></figure><h2 id="定时执行脚本"><a href="#定时执行脚本" class="headerlink" title="定时执行脚本"></a>定时执行脚本</h2><p>以上，每天执行一次定时任务，抓取ganglia的运行状态保存到日志文件中。紧接着，我们的目标是使用脚本检查当天的日志文件，如果发现ganglia运行异常，则产生一个错误日志。</p><p>1、假设日志文件ganglia-20180524.log的内容为：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>] <span class="number">00</span>:<span class="number">00</span>:<span class="number">01</span> [SUCCESS] <span class="symbol">test@</span><span class="number">192.168</span><span class="number">.56</span><span class="number">.102</span></span><br><span class="line">ganglia  <span class="number">24810</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">57536</span>  <span class="number">3396</span> ?        Ssl  May23   <span class="number">0</span>:<span class="number">20</span> /usr/sbin/gmond --pid-file /var/run/gmond.pid</span><br><span class="line">test     <span class="number">27619</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">11376</span>  <span class="number">2800</span> ?        Ss   <span class="number">09</span>:<span class="number">05</span>   <span class="number">0</span>:<span class="number">00</span> bash -c ps aux | grep gmond</span><br><span class="line">test     <span class="number">27621</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">10720</span>  <span class="number">2276</span> ?        S    <span class="number">09</span>:<span class="number">05</span>   <span class="number">0</span>:<span class="number">00</span> grep gmond</span><br><span class="line">[<span class="number">2</span>] <span class="number">00</span>:<span class="number">00</span>:<span class="number">01</span> [SUCCESS] <span class="symbol">test@</span><span class="number">192.168</span><span class="number">.56</span><span class="number">.103</span></span><br><span class="line">ganglia  <span class="number">25710</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">57536</span>  <span class="number">3396</span> ?        Ssl  May23   <span class="number">0</span>:<span class="number">20</span> /usr/sbin/gmond --pid-file /var/run/gmond.pid</span><br><span class="line">test     <span class="number">27622</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">11376</span>  <span class="number">2800</span> ?        Ss   <span class="number">09</span>:<span class="number">05</span>   <span class="number">0</span>:<span class="number">00</span> bash -c ps aux | grep gmond</span><br><span class="line">test     <span class="number">27645</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">10720</span>  <span class="number">2276</span> ?        S    <span class="number">09</span>:<span class="number">05</span>   <span class="number">0</span>:<span class="number">00</span> grep gmond</span><br></pre></td></tr></table></figure><p>2、参考<a href="https://www.cnblogs.com/tlnshuju/p/7106790.html" target="_blank" rel="noopener">grep命令最经常使用的功能总结</a>，编写脚本checkganglia.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">DATE=`date +%Y%m%d`</span><br><span class="line">filename=<span class="string">"ganglia-<span class="variable">$&#123;DATE&#125;</span>.log"</span></span><br><span class="line">hosts=`grep <span class="built_in">test</span>@ /tmp/<span class="built_in">log</span>/ganglia/<span class="variable">$&#123;filename&#125;</span> | wc -l`</span><br><span class="line">pids=`grep gmond.pid /tmp/<span class="built_in">log</span>/ganglia/<span class="variable">$&#123;filename&#125;</span> | wc -l`</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$&#123;hosts&#125;</span> == <span class="variable">$&#123;pids&#125;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"All services are runing!"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Error occurred!"</span> &gt; /tmp/<span class="built_in">log</span>/ganglia/error-<span class="variable">$&#123;DATE&#125;</span>.<span class="built_in">log</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>3、执行<br><code>chmod a+x checkganglia.sh</code></p><p><code>./checkganglia.sh</code></p><p>如果所有客户机的ganglia运行正常，就会输出All services are runing!。如果有的客户机ganglia进程不存在，则会在/tmp/log/ganglia/目录下生成当天的错误日志。</p><p>4、设置定时运行<br>因为日志的检查工作要在日志生成之后，所以时间上延后十分钟。</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">10 </span><span class="number">0</span> * * * /bin/bash /home/test/checkganglia.sh</span><br></pre></td></tr></table></figure><h1 id="脚本进阶"><a href="#脚本进阶" class="headerlink" title="脚本进阶"></a>脚本进阶</h1><p>上面的脚本，还有很多要改进的地方。比如有的客户机宕机了，上面的脚本检查不出来。比如有的客户机ganglia服务没有启动，那么具体是哪几台？针对这两个问题，下面进行改进。假设已经知道客户机的数量为10。</p><p>参考<a href="http://man.linuxde.net/csplit" target="_blank" rel="noopener">csplit命令</a>，checkganglia.sh脚本修改为：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">DATE=`date +%Y%m%d`</span><br><span class="line">filename=<span class="string">"ganglia-<span class="variable">$&#123;DATE&#125;</span>.log"</span></span><br><span class="line">prefix=<span class="string">"ganglia-<span class="variable">$&#123;DATE&#125;</span>"</span></span><br><span class="line">hosts=`grep <span class="built_in">test</span>@ /tmp/<span class="built_in">log</span>/ganglia/<span class="variable">$&#123;filename&#125;</span> | wc -l`</span><br><span class="line">pids=`grep gmond.pid /tmp/<span class="built_in">log</span>/ganglia/<span class="variable">$&#123;filename&#125;</span> | wc -l`</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$&#123;hosts&#125;</span> != 10 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Some hosts are offline!"</span> &gt;&gt; /tmp/<span class="built_in">log</span>/ganglia/error-<span class="variable">$&#123;DATE&#125;</span>.<span class="built_in">log</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$&#123;hosts&#125;</span> != <span class="variable">$&#123;pids&#125;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Some ganglia services have stopped!"</span> &gt;&gt; /tmp/<span class="built_in">log</span>/ganglia/error-<span class="variable">$&#123;DATE&#125;</span>.<span class="built_in">log</span></span><br><span class="line">    <span class="built_in">cd</span> /tmp/<span class="built_in">log</span>/ganglia/</span><br><span class="line">    csplit /tmp/<span class="built_in">log</span>/ganglia/<span class="variable">$&#123;filename&#125;</span> /<span class="built_in">test</span>@/ -n2 -s &#123;*&#125; -f <span class="variable">$&#123;prefix&#125;</span> -b <span class="string">".log.%02d"</span></span><br><span class="line">    rm <span class="variable">$&#123;prefix&#125;</span>.log.00</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> /tmp/<span class="built_in">log</span>/ganglia/<span class="variable">$&#123;prefix&#125;</span>.<span class="built_in">log</span>.*</span><br><span class="line">    <span class="keyword">do</span> </span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="string">"<span class="variable">$&#123;file&#125;</span>"</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="comment">#echo "$&#123;file&#125; is file"</span></span><br><span class="line">        <span class="keyword">if</span> [ `grep gmond.pid <span class="variable">$&#123;file&#125;</span> | wc -l` == 0 ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> `grep <span class="built_in">test</span>@ <span class="variable">$&#123;file&#125;</span>` &gt;&gt; /tmp/<span class="built_in">log</span>/ganglia/error-<span class="variable">$&#123;DATE&#125;</span>.<span class="built_in">log</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>以上脚本，实现了当客户机数量不为10的时候，进行报错；当客户机ganglia服务没有启动时，进行报错，并且筛选出所有没有启动ganglia的客户机。</p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>本文中，我们先学习了crontab的基础知识和基本用法。然后通过监控ganglia这一个应用场景来具体学习crontab的详细使用方法，包括查看cron日志的方法，crontab中命令转义的方法，定时执行脚本的方法，以及审阅日志脚本的编写和进阶。</p><p>至此，还不够完美，因为我们需要每天登录管理机查看有没有错误日志。下一篇<a href="http://www.voidking.com/dev-linux-mail/">Linux设置邮件提醒</a>中，我们将会研究linux设置邮件提醒的方法。审阅完日志后，如果脚本能够给我们发送一封邮件，告知我们审阅的结果，那么我们就不必再每天查看错误日志。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-linux-crontab/" title="Linux设置定时任务">https://www.voidking.com/dev-linux-crontab/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/shell/" rel="tag"># shell</a> <a href="/tags/crontab/" rel="tag"># crontab</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-ubuntu-change-sources/" rel="prev" title="Ubuntu更换源列表"><i class="fa fa-chevron-left"></i> Ubuntu更换源列表</a></div><div class="post-nav-item"> <a href="/dev-linux-mail/" rel="next" title="Linux设置邮件提醒">Linux设置邮件提醒<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#理论篇"><span class="nav-number">2.</span> <span class="nav-text">理论篇</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#crond简介"><span class="nav-number">2.1.</span> <span class="nav-text">crond简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#crontab文件"><span class="nav-number">2.2.</span> <span class="nav-text">crontab文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#crontab命令"><span class="nav-number">2.3.</span> <span class="nav-text">crontab命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#crontab脚本"><span class="nav-number">2.4.</span> <span class="nav-text">crontab脚本</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#实践篇"><span class="nav-number">3.</span> <span class="nav-text">实践篇</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#设置系统时间"><span class="nav-number">3.1.</span> <span class="nav-text">设置系统时间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实例"><span class="nav-number">3.2.</span> <span class="nav-text">实例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看ganglia的状态"><span class="nav-number">3.3.</span> <span class="nav-text">查看ganglia的状态</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#开启crontab日志"><span class="nav-number">3.4.</span> <span class="nav-text">开启crontab日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#定时执行脚本"><span class="nav-number">3.5.</span> <span class="nav-text">定时执行脚本</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#脚本进阶"><span class="nav-number">4.</span> <span class="nav-text">脚本进阶</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#后记"><span class="nav-number">5.</span> <span class="nav-text">后记</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">638</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">50</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">199</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://www.beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>