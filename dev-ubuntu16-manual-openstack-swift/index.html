<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="目标紧接着《Ubuntu16手动安装OpenStack——cinder篇》，本文，我们来研究一下swift的安装配置。主要参考OpenStack Queens : Configure Swift 和 Object Storage Install Guide。 cinder和swift都是关于存储的组件，那么它们有什么区别呢？cinder的存储，就像是普通硬盘。可以方便快捷地本地存取修改数据，还可以"><meta property="og:type" content="article"><meta property="og:title" content="Ubuntu16手动安装OpenStack——swift篇"><meta property="og:url" content="https://www.voidking.com/dev-ubuntu16-manual-openstack-swift/index.html"><meta property="og:site_name" content="VoidKing"><meta property="og:description" content="目标紧接着《Ubuntu16手动安装OpenStack——cinder篇》，本文，我们来研究一下swift的安装配置。主要参考OpenStack Queens : Configure Swift 和 Object Storage Install Guide。 cinder和swift都是关于存储的组件，那么它们有什么区别呢？cinder的存储，就像是普通硬盘。可以方便快捷地本地存取修改数据，还可以"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-swift/structure.jpg?imageView2/0/w/800"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-swift/disk.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-swift/sdc1.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-swift/xfs.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-swift/swift.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-swift/file.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-swift/objectdel.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-swift/containerdel.jpg?imageView2/0/w/700"><meta property="article:published_time" content="2018-07-13T15:30:00.000Z"><meta property="article:modified_time" content="2020-03-18T07:29:20.455Z"><meta property="article:author" content="VoidKing"><meta property="article:tag" content="linux"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="openstack"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-swift/structure.jpg?imageView2/0/w/800"><link rel="canonical" href="https://www.voidking.com/dev-ubuntu16-manual-openstack-swift/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Ubuntu16手动安装OpenStack——swift篇 | VoidKing</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="VoidKing" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">VoidKing</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-ubuntu16-manual-openstack-swift/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="VoidKing"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="VoidKing"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Ubuntu16手动安装OpenStack——swift篇</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-07-13 15:30:00" itemprop="dateCreated datePublished" datetime="2018-07-13T15:30:00+00:00">2018-07-13</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/" itemprop="url" rel="index"><span itemprop="name">专业</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/ubuntu/" itemprop="url" rel="index"><span itemprop="name">ubuntu</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>紧接着<a href="https://www.voidking.com/dev-ubuntu16-manual-openstack-cinder/">《Ubuntu16手动安装OpenStack——cinder篇》</a>，本文，我们来研究一下swift的安装配置。主要参考<a href="https://www.server-world.info/en/note?os=Ubuntu_16.04&p=openstack_queens2&f=7" target="_blank" rel="noopener">OpenStack Queens : Configure Swift</a> 和 <a href="https://docs.openstack.org/swift/queens/install/" target="_blank" rel="noopener">Object Storage Install Guide</a>。</p><p>cinder和swift都是关于存储的组件，那么它们有什么区别呢？<br>cinder的存储，就像是普通硬盘。可以方便快捷地本地存取修改数据，还可以按需添加减少硬盘。<br>swift的存储，就像是百度云盘。只能存取数据，不能在云端进行修改，适用于备份。如果非要修改，那么需要下载到本地修改，修改完再上传。在openstack实际应用中，swift常用来存储镜像这种不需要经常修改的文件。</p><a id="more"></a><h1 id="swift简介"><a href="#swift简介" class="headerlink" title="swift简介"></a>swift简介</h1><p>OpenStack Object Storage 是一个多租户对象存储系统。它具有高度可扩展性，可以通过RESTful HTTP API以低成本管理大量非结构化数据。</p><p><strong>代理服务器（swift-proxy-server）</strong><br>接受OpenStack Object Storage API和原始HTTP请求，上传文件，修改元数据和创建容器。它还为Web浏览器提供文件或容器列表。为了提高性能，代理服务器可以使用通常使用memcache部署的可选缓存。</p><p><strong>帐户服务器（swift-account-server）</strong><br>管理使用对象存储定义的帐户。</p><p><strong>容器服务器（swift-container-server）</strong><br>在对象存储中管理容器或文件夹的映射。</p><p><strong>对象服务器（swift-object-server）</strong><br>管理存储节点上的实际对象，例如文件。</p><p><strong>Various periodic processes</strong><br>在大型数据存储上执行内务处理任务。复制服务可确保群集的一致性和可用性。其他定期流程包括审计员，更新者和收割者。</p><p><strong>WSGI中间件</strong><br>处理身份验证，通常是OpenStack Identity。</p><p><strong>swift client</strong><br>允许用户通过命令行客户端进行授权，然后为admin用户、经销商用户或swift用户向REST API提交命令。</p><p><strong>swift-init</strong><br>初始化环文件构建的脚本，将守护程序名称作为参数并提供命令。详细文档<a href="https://docs.openstack.org/swift/latest/admin_guide.html#managing-services" target="_blank" rel="noopener">在这里</a>。</p><p><strong>swift-recon</strong><br>一种客户端工具，用于检索由swift-recon中间件收集的有关群集的各种指标和遥测信息。</p><p><strong>swift-ring-builder</strong><br>存储环构建和重新平衡实用程序。详细文档<a href="https://docs.openstack.org/swift/latest/admin_guide.html#managing-the-rings" target="_blank" rel="noopener">在这里</a>。</p><h1 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h1><p>一般来说，swift至少需要三个存储节点，如下结构。<br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-swift/structure.jpg?imageView2/0/w/800" alt=""></p><p>之前的安装中，我们只使用了两个节点，一个控制节点，一个计算节点。本文中，我们把swift安装在控制节点和计算节点，领会精神。如果要增加存储节点，修改Ring files，然后参照计算节点配置即可。</p><p>控制节点安装：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Swift Proxy</span><br><span class="line">Swift-Account</span><br><span class="line">Swift-Container</span><br><span class="line">Swift-Object</span><br></pre></td></tr></table></figure><p>计算节点安装：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Swift Proxy</span><br><span class="line">Swift-Account</span><br><span class="line">Swift-Container</span><br><span class="line">Swift-Object</span><br></pre></td></tr></table></figure><h1 id="控制节点"><a href="#控制节点" class="headerlink" title="控制节点"></a>控制节点</h1><h2 id="root用户"><a href="#root用户" class="headerlink" title="root用户"></a>root用户</h2><p>为了避免权限问题，建议切换到root用户进行操作（否则要加很多sudo）。<br><code>sudo -i</code></p><h2 id="服务证书和端点"><a href="#服务证书和端点" class="headerlink" title="服务证书和端点"></a>服务证书和端点</h2><p>1、使admin环境生效<br><code>. admin-openrc</code></p><p>2、添加swift用户<br><code>openstack user create --domain default --project service --password openstack swift</code></p><p>3、把admin角色添加给swift用户<br><code>openstack role add --project service --user swift admin</code></p><p>4、创建swift服务<br><code>openstack service create --name swift --description &quot;OpenStack Object Storage&quot; object-store</code></p><p>5、创建服务端点</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region <span class="type">RegionOne</span> <span class="class"><span class="keyword">object</span><span class="title">-store</span> <span class="title">public</span> <span class="title">http</span></span>:<span class="comment">//controller:8080/v1/AUTH_%\(tenant_id\)s</span></span><br><span class="line"></span><br><span class="line">openstack endpoint create --region <span class="type">RegionOne</span> <span class="class"><span class="keyword">object</span><span class="title">-store</span> <span class="title">internal</span> <span class="title">http</span></span>:<span class="comment">//controller:8080/v1/AUTH_%\(tenant_id\)s </span></span><br><span class="line"></span><br><span class="line">openstack endpoint create --region <span class="type">RegionOne</span> <span class="class"><span class="keyword">object</span><span class="title">-store</span> <span class="title">admin</span> <span class="title">http</span></span>:<span class="comment">//controller:8080/v1</span></span><br></pre></td></tr></table></figure><h2 id="安装配置Swift-Proxy"><a href="#安装配置Swift-Proxy" class="headerlink" title="安装配置Swift Proxy"></a>安装配置Swift Proxy</h2><p>1、安装swift-proxy<br><code>apt-get -y install swift swift-proxy python-swiftclient python-keystonemiddleware python-memcache</code></p><p>2、创建swift配置目录<br><code>mkdir /etc/swift</code></p><p>3、<code>vi /etc/swift/proxy-server.conf</code>，新建proxy-server.conf内容如下：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create new</span></span><br><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="attr">bind_ip</span> = <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">8080</span></span><br><span class="line"><span class="attr">user</span> = swift</span><br><span class="line"></span><br><span class="line"><span class="section">[pipeline:main]</span></span><br><span class="line"><span class="attr">pipeline</span> = catch_errors gatekeeper healthcheck proxy-logging cache container_sync bulk ratelimit authtoken keystoneauth container-quotas account-quotas slo dlo versioned_writes proxy-logging proxy-server</span><br><span class="line"></span><br><span class="line"><span class="section">[app:proxy-server]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#proxy</span></span><br><span class="line"><span class="attr">allow_account_management</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">account_autocreate</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Keystone auth info</span></span><br><span class="line"><span class="section">[filter:authtoken]</span></span><br><span class="line"><span class="attr">paste.filter_factory</span> = keystonemiddleware.auth_token:filter_factory</span><br><span class="line"><span class="attr">www_authenticate_uri</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">memcached_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = default</span><br><span class="line"><span class="attr">user_domain_name</span> = default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = swift</span><br><span class="line"><span class="attr">password</span> = openstack</span><br><span class="line"><span class="attr">delay_auth_decision</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:keystoneauth]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#keystoneauth</span></span><br><span class="line"><span class="attr">operator_roles</span> = admin,SwiftOperator</span><br><span class="line"></span><br><span class="line"><span class="section">[filter:healthcheck]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#healthcheck</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:cache]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#memcache</span></span><br><span class="line"><span class="attr">memcache_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:ratelimit]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#ratelimit</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:domain_remap]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#domain_remap</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:catch_errors]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#catch_errors</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:cname_lookup]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#cname_lookup</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:staticweb]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#staticweb</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:tempurl]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#tempurl</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:formpost]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#formpost</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:name_check]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#name_check</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:list-endpoints]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#list_endpoints</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:proxy-logging]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#proxy_logging</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:bulk]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#bulk</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:slo]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#slo</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:dlo]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#dlo</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:container-quotas]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#container_quotas</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:account-quotas]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#account_quotas</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:gatekeeper]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#gatekeeper</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:container_sync]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#container_sync</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:xprofile]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#xprofile</span></span><br><span class="line"></span><br><span class="line"><span class="section">[filter:versioned_writes]</span></span><br><span class="line"><span class="attr">use</span> = egg:swift<span class="comment">#versioned_writes</span></span><br></pre></td></tr></table></figure><p>4、<code>vi /etc/swift/swift.conf</code>，新建swift.conf内容为：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create new (it is shared among Swift Nodes - any words you like)</span></span><br><span class="line"><span class="section">[swift-hash]</span></span><br><span class="line"><span class="attr">swift_hash_path_suffix</span> = swift_shared_path</span><br><span class="line"><span class="attr">swift_hash_path_prefix</span> = swift_shared_path</span><br></pre></td></tr></table></figure><p>5、修改权限<br><code>chown -R swift. /etc/swift</code></p><h2 id="配置Ring-files"><a href="#配置Ring-files" class="headerlink" title="配置Ring files"></a>配置Ring files</h2><p>1、创建rings</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">swift-ring-builder /etc/swift/account.builder create <span class="number">12</span> <span class="number">2</span> <span class="number">1</span> </span><br><span class="line">swift-ring-builder /etc/swift/container.builder create <span class="number">12</span> <span class="number">2</span> <span class="number">1</span> </span><br><span class="line">swift-ring-builder /etc/swift/object.builder create <span class="number">12</span> <span class="number">2</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>12、2、1这三个参数，分别代表part_power、replicas、min_part_hours。<br>part_power是以2为底数的指数的幂，即2^ part_power，所得的值表示总共的partition的数目。如果设置为2，则2^2=4，表示总共有4个partition。</p><p>replicas表示每个object在swift中储存的数目。</p><p>min_part_hours表示一个partiton能够再次更改的最小时间。防止没有进行同步便进行下次更改。</p><p>2、添加存储节点</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">swift-ring-builder /etc/swift/account.builder add r0z0<span class="number">-172.16</span><span class="number">.0</span><span class="number">.105</span>:<span class="number">6002</span>/device0 <span class="number">100</span></span><br><span class="line">swift-ring-builder /etc/swift/container.builder add r0z0<span class="number">-172.16</span><span class="number">.0</span><span class="number">.105</span>:<span class="number">6001</span>/device0 <span class="number">100</span> </span><br><span class="line">swift-ring-builder /etc/swift/object.builder add r0z0<span class="number">-172.16</span><span class="number">.0</span><span class="number">.105</span>:<span class="number">6000</span>/device0 <span class="number">100</span></span><br><span class="line"></span><br><span class="line">swift-ring-builder /etc/swift/account.builder add r1z1<span class="number">-172.16</span><span class="number">.0</span><span class="number">.106</span>:<span class="number">6002</span>/device1 <span class="number">100</span> </span><br><span class="line">swift-ring-builder /etc/swift/container.builder add r1z1<span class="number">-172.16</span><span class="number">.0</span><span class="number">.106</span>:<span class="number">6001</span>/device1 <span class="number">100</span> </span><br><span class="line">swift-ring-builder /etc/swift/object.builder add r1z1<span class="number">-172.16</span><span class="number">.0</span><span class="number">.106</span>:<span class="number">6000</span>/device1 <span class="number">100</span></span><br></pre></td></tr></table></figure><p>3、平衡存储</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">swift-ring-builder </span>/etc/<span class="keyword">swift/account.builder </span>rebalance</span><br><span class="line"><span class="keyword">swift-ring-builder </span>/etc/<span class="keyword">swift/container.builder </span>rebalance </span><br><span class="line"><span class="keyword">swift-ring-builder </span>/etc/<span class="keyword">swift/object.builder </span>rebalance</span><br></pre></td></tr></table></figure><p>4、更改权限<br><code>chown swift. /etc/swift/*.gz</code></p><p>5、重启swift-proxy<br><code>systemctl restart swift-proxy</code></p><h1 id="计算节点"><a href="#计算节点" class="headerlink" title="计算节点"></a>计算节点</h1><h2 id="root用户-1"><a href="#root用户-1" class="headerlink" title="root用户"></a>root用户</h2><p>为了避免权限问题，建议切换到root用户进行操作（否则要加很多sudo）。<br><code>sudo -i</code></p><h2 id="磁盘分区"><a href="#磁盘分区" class="headerlink" title="磁盘分区"></a>磁盘分区</h2><p>1、<a href="https://www.voidking.com/dev-ubuntu16-manual-openstack-cinder/">《Ubuntu16手动安装OpenStack——cinder篇》</a>一文中，因为计算节点（存储节点）的sdb用于cinder服务了，所以我们需要在计算节点再添加一块硬盘sdc，用于swift服务。</p><p>2、查看硬盘<br><code>fdisk -l</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-swift/disk.jpg?imageView2/0/w/700" alt=""></p><p>3、对sdc进行分区<br><code>fdisk /dev/sdc</code></p><ul><li>输入 m 显示所有命令提示。</li><li>输入 p 显示硬盘分割情形。</li><li>输入 a 设定硬盘启动区。</li><li>输入 n 设定新的硬盘分割区。输入 e 硬盘为[延伸]分割区(extend)，输入 p 硬盘为[主要]分割区(primary)。</li><li>输入 t 改变硬盘分割区属性。</li><li>输入 d 删除硬盘分割区属性。</li><li>输入 q 结束不存入硬盘分割区属性。</li><li>输入 w 结束并写入硬盘分割区属性。</li></ul><p>4、命令行输入n，添加一个新的分区；接下来选择p，设置一个主分区（e为扩展分区）；接下来分区号选择1；再接下来设置起止扇区号，选择默认值即可（2048到max）；最后输入w，确认写入硬盘分区。<br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-swift/sdc1.jpg?imageView2/0/w/700" alt=""></p><h2 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h2><p>1、下载安装相关组件<br><code>apt-get -y install swift swift-account swift-container swift-object xfsprogs</code></p><p>2、使用xfs格式化空闲磁盘<br><code>mkfs.xfs -i size=1024 -s size=4096 /dev/sdc1</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-swift/xfs.jpg?imageView2/0/w/700" alt=""></p><p>3、创建device1文件夹<br><code>mkdir -p /srv/node/device1</code></p><p>4、挂载/dev/sdc1到device1<br><code>mount -o noatime,nodiratime,nobarrier /dev/sdc1 /srv/node/device1</code></p><p>5、修改权限<br><code>chown -R swift. /srv/node</code></p><p>6、<code>vi /etc/fstab</code>，设置开机挂载</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add to the end</span></span><br><span class="line">/dev/sdc1  /srv/<span class="keyword">node</span><span class="title">/device1</span>  xfs  noatime,nodiratime,nobarrier <span class="number">0</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p>7、从控制节点（swift-proxy）拷贝文件到计算节点<br><code>scp voidking@172.16.0.105:/etc/swift/*.gz /etc/swift/</code></p><p>8、修改权限<br><code>chown swift. /etc/swift/*.gz</code></p><p>9、<code>vi /etc/swift/swift.conf</code>，新建swift.conf内容如下：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># set the value which is set on Proxy Node</span></span><br><span class="line"><span class="section">[swift-hash]</span></span><br><span class="line"><span class="attr">swift_hash_path_suffix</span> = swift_shared_path</span><br><span class="line"><span class="attr">swift_hash_path_prefix</span> = swift_shared_path</span><br></pre></td></tr></table></figure><p>10、<code>vi /etc/swift/account-server.conf</code>，如下修改：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># line <span class="number">2</span>: make sure the value <span class="keyword">is</span> follows</span><br><span class="line">bind_ip = <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">bind_port = <span class="number">6002</span></span><br></pre></td></tr></table></figure><p>11、<code>vi /etc/swift/container-server.conf</code>，如下修改：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># line <span class="number">2</span>: make sure the value <span class="keyword">is</span> follows</span><br><span class="line">bind_ip = <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">bind_port = <span class="number">6001</span></span><br></pre></td></tr></table></figure><p>12、<code>vi /etc/swift/object-server.conf</code>，如下修改：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># line <span class="number">2</span>: make sure the value <span class="keyword">is</span> follows</span><br><span class="line">bind_ip = <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">bind_port = <span class="number">6000</span></span><br></pre></td></tr></table></figure><p>13、<code>vi /etc/rsyncd.conf</code>，新建rsyncd.conf内容如下：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create new</span></span><br><span class="line">pid file = /var/run/rsyncd.pid</span><br><span class="line">log file = /var/log/rsyncd.log</span><br><span class="line">uid = swift</span><br><span class="line">gid = swift</span><br><span class="line"><span class="comment"># IP address of this Node</span></span><br><span class="line">address = 172.16.0.106</span><br><span class="line"></span><br><span class="line">[account]</span><br><span class="line">path            = /srv/node</span><br><span class="line">read only       = <span class="literal">false</span></span><br><span class="line">write only      = <span class="literal">no</span></span><br><span class="line">list            = <span class="literal">yes</span></span><br><span class="line">incoming chmod  = 0644</span><br><span class="line">outgoing chmod  = 0644</span><br><span class="line">max connections = 25</span><br><span class="line">lock file =     /var/lock/account.lock</span><br><span class="line"></span><br><span class="line">[container]</span><br><span class="line">path            = /srv/node</span><br><span class="line">read only       = <span class="literal">false</span></span><br><span class="line">write only      = <span class="literal">no</span></span><br><span class="line">list            = <span class="literal">yes</span></span><br><span class="line">incoming chmod  = 0644</span><br><span class="line">outgoing chmod  = 0644</span><br><span class="line">max connections = 25</span><br><span class="line">lock file =     /var/lock/container.lock</span><br><span class="line"></span><br><span class="line">[object]</span><br><span class="line">path            = /srv/node</span><br><span class="line">read only       = <span class="literal">false</span></span><br><span class="line">write only      = <span class="literal">no</span></span><br><span class="line">list            = <span class="literal">yes</span></span><br><span class="line">incoming chmod  = 0644</span><br><span class="line">outgoing chmod  = 0644</span><br><span class="line">max connections = 25</span><br><span class="line">lock file =     /var/lock/object.lock</span><br><span class="line"></span><br><span class="line">[swift_server]</span><br><span class="line">path            = /etc/swift</span><br><span class="line">read only       = <span class="literal">true</span></span><br><span class="line">write only      = <span class="literal">no</span></span><br><span class="line">list            = <span class="literal">yes</span></span><br><span class="line">incoming chmod  = 0644</span><br><span class="line">outgoing chmod  = 0644</span><br><span class="line">max connections = 5</span><br><span class="line">lock file =     /var/lock/swift_server.lock</span><br></pre></td></tr></table></figure><p>14、<code>vi /etc/default/rsync</code>，如下修改：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># line 8: change</span></span><br><span class="line"><span class="attr">RSYNC_ENABLE</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>15、重启rsync并设置开机启动<br><code>systemctl restart rsync</code></p><p><code>systemctl enable rsync</code></p><p>16、重启其他swift服务并设置开机启动</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ringtype <span class="keyword">in</span> account container object; <span class="keyword">do</span> </span><br><span class="line">    systemctl restart swift-<span class="variable">$ringtype</span></span><br><span class="line">    systemctl <span class="builtin-name">enable</span> swift-<span class="variable">$ringtype</span></span><br><span class="line">    <span class="keyword">for</span><span class="built_in"> service </span><span class="keyword">in</span> replicator updater auditor; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$ringtype</span> != <span class="string">'account'</span> ] || [ <span class="variable">$service</span> != <span class="string">'updater'</span> ]; then</span><br><span class="line">            systemctl start swift-<span class="variable">$ringtype</span>-<span class="variable">$service</span></span><br><span class="line">            systemctl <span class="builtin-name">enable</span> swift-<span class="variable">$ringtype</span>-<span class="variable">$service</span></span><br><span class="line">        fi</span><br><span class="line">    done</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>至此，一个存储节点配置成功，下面再配置一个swift存储节点在控制节点上。</p><h1 id="控制节点-1"><a href="#控制节点-1" class="headerlink" title="控制节点"></a>控制节点</h1><h2 id="root用户-2"><a href="#root用户-2" class="headerlink" title="root用户"></a>root用户</h2><p>为了避免权限问题，建议切换到root用户进行操作（否则要加很多sudo）。<br><code>sudo -i</code></p><h2 id="磁盘分区-1"><a href="#磁盘分区-1" class="headerlink" title="磁盘分区"></a>磁盘分区</h2><p>1、在控制节点再添加一块硬盘sdb，用于swift服务。</p><p>2、参考计算节点的分区方法，给sdb分区。</p><h2 id="安装配置-1"><a href="#安装配置-1" class="headerlink" title="安装配置"></a>安装配置</h2><p>1、下载安装相关组件<br><code>apt-get -y install swift swift-account swift-container swift-object xfsprogs</code></p><p>2、使用xfs格式化空闲磁盘<br><code>mkfs.xfs -i size=1024 -s size=4096 /dev/sdb1</code></p><p>3、创建device0文件夹<br><code>mkdir -p /srv/node/device0</code></p><p>4、挂载/dev/sdc1到device1<br><code>mount -o noatime,nodiratime,nobarrier /dev/sdb1 /srv/node/device0</code></p><p>5、修改权限<br><code>chown -R swift. /srv/node</code></p><p>6、<code>vi /etc/fstab</code>，设置开机挂载</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add to the end</span></span><br><span class="line">/dev/sdb1  /srv/<span class="keyword">node</span><span class="title">/device0</span>  xfs  noatime,nodiratime,nobarrier <span class="number">0</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p>7、修改权限<br><code>chown swift. /etc/swift/*.gz</code></p><p>8、<code>vi /etc/swift/account-server.conf</code>，如下修改：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># line <span class="number">2</span>: make sure the value <span class="keyword">is</span> follows</span><br><span class="line">bind_ip = <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">bind_port = <span class="number">6002</span></span><br></pre></td></tr></table></figure><p>9、<code>vi /etc/swift/container-server.conf</code>，如下修改：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># line <span class="number">2</span>: make sure the value <span class="keyword">is</span> follows</span><br><span class="line">bind_ip = <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">bind_port = <span class="number">6001</span></span><br></pre></td></tr></table></figure><p>10、<code>vi /etc/swift/object-server.conf</code>，如下修改：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># line <span class="number">2</span>: make sure the value <span class="keyword">is</span> follows</span><br><span class="line">bind_ip = <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">bind_port = <span class="number">6000</span></span><br></pre></td></tr></table></figure><p>11、<code>vi /etc/rsyncd.conf</code>，新建rsyncd.conf内容如下：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create new</span></span><br><span class="line">pid file = /var/run/rsyncd.pid</span><br><span class="line">log file = /var/log/rsyncd.log</span><br><span class="line">uid = swift</span><br><span class="line">gid = swift</span><br><span class="line"><span class="comment"># IP address of this Node</span></span><br><span class="line">address = 172.16.0.105</span><br><span class="line"></span><br><span class="line">[account]</span><br><span class="line">path            = /srv/node</span><br><span class="line">read only       = <span class="literal">false</span></span><br><span class="line">write only      = <span class="literal">no</span></span><br><span class="line">list            = <span class="literal">yes</span></span><br><span class="line">incoming chmod  = 0644</span><br><span class="line">outgoing chmod  = 0644</span><br><span class="line">max connections = 25</span><br><span class="line">lock file =     /var/lock/account.lock</span><br><span class="line"></span><br><span class="line">[container]</span><br><span class="line">path            = /srv/node</span><br><span class="line">read only       = <span class="literal">false</span></span><br><span class="line">write only      = <span class="literal">no</span></span><br><span class="line">list            = <span class="literal">yes</span></span><br><span class="line">incoming chmod  = 0644</span><br><span class="line">outgoing chmod  = 0644</span><br><span class="line">max connections = 25</span><br><span class="line">lock file =     /var/lock/container.lock</span><br><span class="line"></span><br><span class="line">[object]</span><br><span class="line">path            = /srv/node</span><br><span class="line">read only       = <span class="literal">false</span></span><br><span class="line">write only      = <span class="literal">no</span></span><br><span class="line">list            = <span class="literal">yes</span></span><br><span class="line">incoming chmod  = 0644</span><br><span class="line">outgoing chmod  = 0644</span><br><span class="line">max connections = 25</span><br><span class="line">lock file =     /var/lock/object.lock</span><br><span class="line"></span><br><span class="line">[swift_server]</span><br><span class="line">path            = /etc/swift</span><br><span class="line">read only       = <span class="literal">true</span></span><br><span class="line">write only      = <span class="literal">no</span></span><br><span class="line">list            = <span class="literal">yes</span></span><br><span class="line">incoming chmod  = 0644</span><br><span class="line">outgoing chmod  = 0644</span><br><span class="line">max connections = 5</span><br><span class="line">lock file =     /var/lock/swift_server.lock</span><br></pre></td></tr></table></figure><p>12、<code>vi /etc/default/rsync</code>，如下修改：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># line 8: change</span></span><br><span class="line"><span class="attr">RSYNC_ENABLE</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>13、重启rsync并设置开机启动<br><code>systemctl restart rsync</code></p><p><code>systemctl enable rsync</code></p><p>14、重启其他swift服务并设置开机启动</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ringtype <span class="keyword">in</span> account container object; <span class="keyword">do</span> </span><br><span class="line">    systemctl restart swift-<span class="variable">$ringtype</span></span><br><span class="line">    systemctl <span class="builtin-name">enable</span> swift-<span class="variable">$ringtype</span></span><br><span class="line">    <span class="keyword">for</span><span class="built_in"> service </span><span class="keyword">in</span> replicator updater auditor; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$ringtype</span> != <span class="string">'account'</span> ] || [ <span class="variable">$service</span> != <span class="string">'updater'</span> ]; then</span><br><span class="line">            systemctl start swift-<span class="variable">$ringtype</span>-<span class="variable">$service</span></span><br><span class="line">            systemctl <span class="builtin-name">enable</span> swift-<span class="variable">$ringtype</span>-<span class="variable">$service</span></span><br><span class="line">        fi</span><br><span class="line">    done</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>至此，控制节点的swift存储也配置完成。</p><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>以下操作在控制节点执行。</p><h2 id="服务角色和用户"><a href="#服务角色和用户" class="headerlink" title="服务角色和用户"></a>服务角色和用户</h2><p>1、使admin环境生效<br><code>. admin-openrc</code></p><p>2、创建一个swiftservice服务<br><code>openstack project create --domain default --description &quot;Swift Service Project&quot; swiftservice</code></p><p>3、创建SwiftOperator角色<br><code>openstack role create SwiftOperator</code></p><p>4、创建user01用户，密码为openstack<br><code>openstack user create --domain default --project swiftservice --password openstack user01</code></p><p>5、给user01添加SwiftOperator角色<br><code>openstack role add --project swiftservice --user user01 SwiftOperator</code></p><h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><p>1、安装swift-client<br><code>apt-get -y install python-openstackclient python-keystoneclient python-swiftclient</code></p><p>2、<code>vi ~/swift-openrc</code>，创建环境配置文件swift-openrc，内容为：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_DOMAIN_NAME</span>=default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USER_DOMAIN_NAME</span>=default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_NAME</span>=swiftservice</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USERNAME</span>=user01</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PASSWORD</span>=openstack</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_AUTH_URL</span>=http://controller:5000/v3</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_IDENTITY_API_VERSION</span>=3</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PS1</span>=<span class="string">'[\u@\h \W(swift)]\$ '</span></span><br></pre></td></tr></table></figure><p>3、使环境生效<br><code>. swift-openrc</code></p><p>4、查看swift状态<br><code>swift stat</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-swift/swift.jpg?imageView2/0/w/700" alt=""></p><p>5、创建一个container<br><code>openstack container create test_container</code></p><p><code>openstack container list</code></p><p>6、<code>vim test.txt</code>，新建test.txt，内容为“hello openstack”。</p><p>7、上传test.txt文件到test_container<br><code>openstack object create test_container test.txt</code></p><p>8、查看test_container中的文件<br><code>openstack object list test_container</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-swift/file.jpg?imageView2/0/w/700" alt=""></p><p>9、下载test.txt文件</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">rm</span> <span class="keyword">test</span>.txt</span><br><span class="line">ll</span><br><span class="line">openstack object <span class="keyword">save</span> test_container <span class="keyword">test</span>.txt </span><br><span class="line">ll</span><br></pre></td></tr></table></figure><p>10、删除test_container中的test.txt文件</p><figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openstack <span class="keyword">object</span> <span class="built_in">list</span> test_container</span><br><span class="line">openstack <span class="keyword">object</span> delete test_container test.txt</span><br><span class="line">openstack <span class="keyword">object</span> <span class="built_in">list</span> test_container</span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-swift/objectdel.jpg?imageView2/0/w/700" alt=""></p><p>11、删除test_container</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openstack <span class="keyword">container</span> list </span><br><span class="line">openstack <span class="keyword">container</span> <span class="keyword">delete</span> test_container </span><br><span class="line">openstack <span class="keyword">container</span> list</span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-swift/containerdel.jpg?imageView2/0/w/700" alt=""></p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/ubuntu/" rel="tag"># ubuntu</a> <a href="/tags/openstack/" rel="tag"># openstack</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-ubuntu16-manual-openstack-cinder/" rel="prev" title="Ubuntu16手动安装OpenStack——cinder篇"><i class="fa fa-chevron-left"></i> Ubuntu16手动安装OpenStack——cinder篇</a></div><div class="post-nav-item"> <a href="/dev-ubuntu16-manual-openstack-vxlan/" rel="next" title="Ubuntu16手动安装OpenStack——vxlan网络">Ubuntu16手动安装OpenStack——vxlan网络<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#目标"><span class="nav-number">1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#swift简介"><span class="nav-number">2.</span> <span class="nav-text">swift简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#架构"><span class="nav-number">3.</span> <span class="nav-text">架构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#控制节点"><span class="nav-number">4.</span> <span class="nav-text">控制节点</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#root用户"><span class="nav-number">4.1.</span> <span class="nav-text">root用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#服务证书和端点"><span class="nav-number">4.2.</span> <span class="nav-text">服务证书和端点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装配置Swift-Proxy"><span class="nav-number">4.3.</span> <span class="nav-text">安装配置Swift Proxy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置Ring-files"><span class="nav-number">4.4.</span> <span class="nav-text">配置Ring files</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#计算节点"><span class="nav-number">5.</span> <span class="nav-text">计算节点</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#root用户-1"><span class="nav-number">5.1.</span> <span class="nav-text">root用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#磁盘分区"><span class="nav-number">5.2.</span> <span class="nav-text">磁盘分区</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装配置"><span class="nav-number">5.3.</span> <span class="nav-text">安装配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#控制节点-1"><span class="nav-number">6.</span> <span class="nav-text">控制节点</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#root用户-2"><span class="nav-number">6.1.</span> <span class="nav-text">root用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#磁盘分区-1"><span class="nav-number">6.2.</span> <span class="nav-text">磁盘分区</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装配置-1"><span class="nav-number">6.3.</span> <span class="nav-text">安装配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用"><span class="nav-number">7.</span> <span class="nav-text">使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#服务角色和用户"><span class="nav-number">7.1.</span> <span class="nav-text">服务角色和用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#客户端"><span class="nav-number">7.2.</span> <span class="nav-text">客户端</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="VoidKing" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">VoidKing</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">589</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">40</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">190</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://twitter.com/voidking_com" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;voidking_com" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i> Twitter</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">VoidKing</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://www.beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>