<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言虚拟机迁移主要有三种方式：P2V、V2V和V2P。P2V指迁移物理服务器上的操作系统及其上的应用软件和数据到VMM（Virtual Machine Monitor）管理的虚拟服务器中。V2V迁移是在虚拟机之间移动操作系统和数据。V2P 指把一个操作系统、应用程序和数据从一个虚拟机中迁移到物理机的主硬盘上，是 P2V 的逆操作。 V2V迁移又分为离线迁移和在线迁移。离线迁移也叫做常规迁移、静态迁"><meta property="og:type" content="article"><meta property="og:title" content="OpenStack中虚拟机的在线迁移"><meta property="og:url" content="https://www.voidking.com/dev-openstack-vm-block-live-migration/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言虚拟机迁移主要有三种方式：P2V、V2V和V2P。P2V指迁移物理服务器上的操作系统及其上的应用软件和数据到VMM（Virtual Machine Monitor）管理的虚拟服务器中。V2V迁移是在虚拟机之间移动操作系统和数据。V2P 指把一个操作系统、应用程序和数据从一个虚拟机中迁移到物理机的主硬盘上，是 P2V 的逆操作。 V2V迁移又分为离线迁移和在线迁移。离线迁移也叫做常规迁移、静态迁"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com//imgs/openstack-vm-live-migration/detail.jpg?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com//imgs/openstack-vm-live-migration/service.jpg?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com//imgs/openstack-vm-live-migration/compute2.jpg?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com//imgs/openstack-vm-live-migration/migration.jpg?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com//imgs/openstack-vm-live-migration/waiting.jpg?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com//imgs/openstack-vm-live-migration/detail2.jpg?imageView2/0/w/600"><meta property="article:published_time" content="2018-11-13T09:00:00.000Z"><meta property="article:modified_time" content="2018-11-13T09:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="docker"><meta property="article:tag" content="linux"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="openstack"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com//imgs/openstack-vm-live-migration/detail.jpg?imageView2/0/w/600"><link rel="canonical" href="https://www.voidking.com/dev-openstack-vm-block-live-migration/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>OpenStack中虚拟机的在线迁移 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-openstack-vm-block-live-migration/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> OpenStack中虚拟机的在线迁移</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-11-13 09:00:00" itemprop="dateCreated datePublished" datetime="2018-11-13T09:00:00+00:00">2018-11-13</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>虚拟机迁移主要有三种方式：P2V、V2V和V2P。P2V指迁移物理服务器上的操作系统及其上的应用软件和数据到VMM（Virtual Machine Monitor）管理的虚拟服务器中。V2V迁移是在虚拟机之间移动操作系统和数据。V2P 指把一个操作系统、应用程序和数据从一个虚拟机中迁移到物理机的主硬盘上，是 P2V 的逆操作。</p><p>V2V迁移又分为离线迁移和在线迁移。离线迁移也叫做常规迁移、静态迁移，在迁移之前需要将虚拟机关闭。在线迁移又称为实时迁移，是指保持虚拟机正常运行的同时进行迁移。本文要研究的，就是虚拟机的在线迁移。更多详细内容，请参考<a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/cn/linux/l-cn-mgrtvm1/index.html">虚拟机迁移技术漫谈，第 1 部分</a>。</p><span id="more"></span><h1 id="迁移相关命令"><a href="#迁移相关命令" class="headerlink" title="迁移相关命令"></a>迁移相关命令</h1><p>本文研究的是OpenStack集群中的虚拟机迁移，那么先研究一下OpenStack的虚拟机迁移命令。主要参考<a target="_blank" rel="noopener" href="https://docs.openstack.org/nova/rocky/admin/live-migration-usage.html">Live-migrate instances</a>、<a target="_blank" rel="noopener" href="https://www.mirantis.com/blog/block-live-migration-openstack-environment/">Block Live Migration in OpenStack environment</a>。</p><p>1、查看实例ID<br><code>openstack server list</code><br><a target="_blank" rel="noopener" href="http://cdn.voidking.com//imgs/openstack-vm-live-migration/server.jpg?imageView2/0/w/600"></a></p><p>PS：<code>openstack server</code>可以换成<code>nova</code>。</p><p>2、查看实例详情<br><code>openstack server show 180617ec-1348-4144-a496-8751d12e84bf</code><br><img src="http://cdn.voidking.com//imgs/openstack-vm-live-migration/detail.jpg?imageView2/0/w/600"></p><p>PS：实例ID可以换成demo1。</p><p>3、查看可以迁移的节点<br><code>openstack compute service list</code><br><img src="http://cdn.voidking.com//imgs/openstack-vm-live-migration/service.jpg?imageView2/0/w/600"></p><p>4、查看其它节点资源使用情况<br><code>openstack host list</code></p><p><code>openstack host show compute2</code><br><img src="http://cdn.voidking.com//imgs/openstack-vm-live-migration/compute2.jpg?imageView2/0/w/600"></p><p>5、迁移<br><code>nova live-migration 180617ec-1348-4144-a496-8751d12e84bf compute2</code><br><img src="http://cdn.voidking.com//imgs/openstack-vm-live-migration/migration.jpg?imageView2/0/w/600"><br>啊嘞，没有反应是闹哪样？查看实例详情，依然位于compute节点。</p><p>6、调试迁移<br><code>nova live-migration 180617ec-1348-4144-a496-8751d12e84bf compute2 --debug</code><br>信息很多，找不到重点。在<a target="_blank" rel="noopener" href="https://www.cnblogs.com/pycode/p/6494848.html">openstack热迁移和冷迁移</a>一文中发现，在线迁移又可以分为两种：live migration和block migration。live migration需要实例保存在NFS共享存储中，这种迁移主要是实例的内存状态的迁移，速度应该会很快。block migration除了实例内存状态要迁移外，还得迁移磁盘文件，速度会慢些，但是它不要求实例存储在共享文件系统中。</p><p>而我们的这个集群，没有共享存储，所以应该用block migration？</p><p>7、再次迁移<br><code>nova live-migration --block-migrate 180617ec-1348-4144-a496-8751d12e84bf compute2</code><br><img src="http://cdn.voidking.com//imgs/openstack-vm-live-migration/waiting.jpg?imageView2/0/w/600"><br>修改后的命令，在shell中同样没有更多提示，但是查看horizon，发现了惊喜，正在迁移。等到迁移完成，查看实例详情，却发现，实例所在主机依然没有发生变化！<br>是因为nova没有配置好吗？很有可能，那么修改一下nova的配置试试。</p><h1 id="nova配置"><a href="#nova配置" class="headerlink" title="nova配置"></a>nova配置</h1><p>因为是使用kolla部署的OpenStack，所以修改配置重启服务的方法，和传统方法有所不同。参考<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/02c8b026fb1c">kolla(Ocata)部署nova组件关键配置和volume映射</a>和<a target="_blank" rel="noopener" href="http://blog.51cto.com/yuweibing/2071364">Openstack 之 调整nova相关参数</a>。可以知道，主机中的/etc/kolla/nova-compute/nova.conf，对应容器中的/etc/nova/nova.conf。修改后重启容器，nova-compute服务配置就会发生改变。</p><p>1、在两个计算节点，修改nova.conf<br><code>vim /etc/kolla/nova-compute/nova.conf</code>，添加:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">live_migration_flag</span>=VIR_MIGRATE_UNDEFINE_SOURCE,VIR_MIGRATE_PEER2PEER,VIR_MIGRATE_LIVE</span><br></pre></td></tr></table></figure><p>2、重启nova-compute</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stop nov<span class="built_in">a_compute</span></span><br><span class="line">docker start nov<span class="built_in">a_compute</span></span><br></pre></td></tr></table></figure><p>3、进入容器<br><code>docker exec -it nova_compute /bin/bash</code></p><p>4、查看配置是否生效<br><code>vi /etc/nova/nova.conf</code></p><h1 id="再次迁移"><a href="#再次迁移" class="headerlink" title="再次迁移"></a>再次迁移</h1><p>1、在控制节点执行迁移命令<br><code>nova live-migration --block-migrate 180617ec-1348-4144-a496-8751d12e84bf compute2</code><br>满怀期望，但是依然失败。</p><p>2、在计算节点查看日志<br><code>tail -n 20 /var/lib/docker/volumes/kolla_logs/_data/nova/nova-compute.log</code><br>日志报错部分如下：</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span>-<span class="number">11</span>-<span class="number">13</span> <span class="number">19</span>:<span class="number">12</span>:<span class="number">04.614</span> <span class="number">6</span> <span class="keyword">ERROR</span> nova.virt.libvirt.driver [req-e6654355-fcec-<span class="number">4</span>b93-a662-c758a03766fa b2edc935f89d4d2684ec4039c02a21cc ab7e3eb8c00d4299afd8572e1ec437bf - default default] [instance: <span class="number">180617</span>ec-<span class="number">1348</span>-<span class="number">4144</span>-a496-<span class="number">8751d12</span>e84bf] Live Migration failure: operation failed: Failed <span class="keyword">to</span> connect <span class="keyword">to</span> <span class="comment">remote libvirt URI qemu+tcp://compute2/system: Unable to resolve address &#x27;compute2&#x27; service &#x27;16509&#x27;: Name or service not known: libvirtError: operation failed: Failed to connect to remote libvirt URI qemu+tcp://compute2/system: Unable to resolve address &#x27;compute2&#x27; service &#x27;16509&#x27;: Name or service not known</span></span><br></pre></td></tr></table></figure><p>由日志可以看出，问题出现在libvirt上，那么修改一下libvirt的配置。</p><h1 id="libvirt配置"><a href="#libvirt配置" class="headerlink" title="libvirt配置"></a>libvirt配置</h1><p>参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/goldsunshine/p/9588017.html">OpenStack虚拟机冷迁移与热迁移</a>、<a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/cn/cloud/library/1508_wangyx_openstacklivemigrate/">虚拟机在 OpenStack 里没有共享存储条件下的在线迁移</a>、<a target="_blank" rel="noopener" href="https://www.cnblogs.com/lin1/p/5776280.html">虚拟化之KVM virsh常用命令篇</a>，对libvirt的配置进行修改。</p><p>1、查看libvirtd.conf<br><code>vim /etc/kolla/nova-libvirt/libvirtd.conf</code><br>修改配置如下：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">listen_tcp</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">listen_tls</span> = <span class="number">0</span></span><br><span class="line"><span class="attr">auth_tcp</span> = <span class="string">&quot;none&quot;</span></span><br><span class="line"><span class="attr">ca_file</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">log_level</span> = <span class="number">3</span></span><br><span class="line"><span class="attr">log_outputs</span> = <span class="string">&quot;3:file:/var/log/kolla/libvirt/libvirtd.log&quot;</span></span><br><span class="line"><span class="attr">listen_addr</span> = <span class="string">&quot;0.0.0.0&quot;</span></span><br></pre></td></tr></table></figure><p>2、重启libvirt服务</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stop nov<span class="built_in">a_libvirt</span></span><br><span class="line">docker start nov<span class="built_in">a_libvirt</span></span><br></pre></td></tr></table></figure><p>3、查看libvirt服务<br><code>netstat -anpt | grep libvirt</code><br>看到libvirtd监听在0.0.0.0:16509端口即为正常。</p><p>PS：可以在其他节点使用virsh命令测试连通性<br><code>virsh -c qemu+tcp://compute2/system</code></p><h1 id="第三次迁移"><a href="#第三次迁移" class="headerlink" title="第三次迁移"></a>第三次迁移</h1><p>1、在控制节点执行迁移命令<br><code>nova live-migration --block-migrate 180617ec-1348-4144-a496-8751d12e84bf compute2</code></p><p>2、查看实例详情<br><code>openstack server show demo1</code><br><img src="http://cdn.voidking.com//imgs/openstack-vm-live-migration/detail2.jpg?imageView2/0/w/600"><br>迁移成功了，nice。</p><h1 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h1><p>1、查看迁移任务<br><code>nova server-migration-list 180617ec-1348-4144-a496-8751d12e84bf</code><br>该命令查看到迁移任务的ID，然后根据这个ID就可以看到更详细的迁移过程。</p><p>2、查看迁移过程<br><code>nova server-migration-show 180617ec-1348-4144-a496-8751d12e84bf 2</code></p><p>3、查看警告或者出错日志<br><code>grep WARNING.*180617ec-1348-4144-a496-8751d12e84bf /var/lib/docker/volumes/kolla_logs/_data/nova/nova-compute.log</code></p><p>4、取消迁移<br><code>nova live-migration-abort 180617ec-1348-4144-a496-8751d12e84bf 2</code></p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>以上，实现了OpenStack虚拟机的block live migration。后续实验，不妨再研究下共享存储的live migration。</p><h1 id="书签"><a href="#书签" class="headerlink" title="书签"></a>书签</h1><p><a target="_blank" rel="noopener" href="https://www.sdnlab.com/20489.html">OpenStack命令行操作之虚机管理实现</a></p><p><a target="_blank" rel="noopener" href="https://dwz.cn/CF438sJZ">虚拟机迁移之热迁移(live_migrate)源码解读</a></p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-openstack-vm-block-live-migration/" title="OpenStack中虚拟机的在线迁移">https://www.voidking.com/dev-openstack-vm-block-live-migration/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/docker/" rel="tag"># docker</a> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/ubuntu/" rel="tag"># ubuntu</a> <a href="/tags/openstack/" rel="tag"># openstack</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-kolla-openstack-add-new-node/" rel="prev" title="Kolla安装OpenStack添加新节点"><i class="fa fa-chevron-left"></i> Kolla安装OpenStack添加新节点</a></div><div class="post-nav-item"> <a href="/dev-openstack-vm-live-migration/" rel="next" title="OpenStack中共享存储的虚拟机在线迁移">OpenStack中共享存储的虚拟机在线迁移<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%81%E7%A7%BB%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="nav-number">2.</span> <span class="nav-text">迁移相关命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nova%E9%85%8D%E7%BD%AE"><span class="nav-number">3.</span> <span class="nav-text">nova配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%86%8D%E6%AC%A1%E8%BF%81%E7%A7%BB"><span class="nav-number">4.</span> <span class="nav-text">再次迁移</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#libvirt%E9%85%8D%E7%BD%AE"><span class="nav-number">5.</span> <span class="nav-text">libvirt配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E6%AC%A1%E8%BF%81%E7%A7%BB"><span class="nav-number">6.</span> <span class="nav-text">第三次迁移</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="nav-number">7.</span> <span class="nav-text">其他命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E8%AE%B0"><span class="nav-number">8.</span> <span class="nav-text">后记</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B9%A6%E7%AD%BE"><span class="nav-number">9.</span> <span class="nav-text">书签</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">630</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">31</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">233</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>