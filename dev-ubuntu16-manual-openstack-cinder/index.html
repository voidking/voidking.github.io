<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="目标在《Ubuntu16手动安装OpenStack——修改镜像》一文中，我们通过修改镜像，实现了ssh密码访问实例。看上去，这个openstack系统已经可以投入使用了，实际上，也确实可以投入使用了。 但是，我们总是追求更好更多的服务。所以接下来，我们继续安装openstack的服务组件。本文中要安装配置的是cinder，主要参考OpenStack Queens : Configure Cinde"><meta property="og:type" content="article"><meta property="og:title" content="Ubuntu16手动安装OpenStack——cinder篇"><meta property="og:url" content="https://www.voidking.com/dev-ubuntu16-manual-openstack-cinder/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="目标在《Ubuntu16手动安装OpenStack——修改镜像》一文中，我们通过修改镜像，实现了ssh密码访问实例。看上去，这个openstack系统已经可以投入使用了，实际上，也确实可以投入使用了。 但是，我们总是追求更好更多的服务。所以接下来，我们继续安装openstack的服务组件。本文中要安装配置的是cinder，主要参考OpenStack Queens : Configure Cinde"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-cinder/volume.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-cinder/disk.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-cinder/create.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-cinder/list.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-cinder/disk1.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-cinder/list1.jpg?imageView2/0/w/700"><meta property="article:published_time" content="2018-07-11T07:00:00.000Z"><meta property="article:modified_time" content="2021-04-12T00:34:25.017Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="openstack"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-cinder/volume.jpg?imageView2/0/w/700"><link rel="canonical" href="https://www.voidking.com/dev-ubuntu16-manual-openstack-cinder/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Ubuntu16手动安装OpenStack——cinder篇 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-ubuntu16-manual-openstack-cinder/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Ubuntu16手动安装OpenStack——cinder篇</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-07-11 15:00:00" itemprop="dateCreated datePublished" datetime="2018-07-11T15:00:00+08:00">2018-07-11</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/" itemprop="url" rel="index"><span itemprop="name">专业</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>在<a href="https://www.voidking.com/dev-ubuntu16-manual-openstack-modify-mirror/">《Ubuntu16手动安装OpenStack——修改镜像》</a>一文中，我们通过修改镜像，实现了ssh密码访问实例。看上去，这个openstack系统已经可以投入使用了，实际上，也确实可以投入使用了。</p><p>但是，我们总是追求更好更多的服务。所以接下来，我们继续安装openstack的服务组件。本文中要安装配置的是cinder，主要参考<a href="https://www.server-world.info/en/note?os=Ubuntu_16.04&p=openstack_queens2&f=1" target="_blank" rel="noopener">OpenStack Queens : Configure Cinder</a>和<a href="https://docs.openstack.org/cinder/queens/install/" target="_blank" rel="noopener">Cinder Installation Guide</a>。</p><a id="more"></a><h1 id="cinder简介"><a href="#cinder简介" class="headerlink" title="cinder简介"></a>cinder简介</h1><p>块存储服务（cinder）为用户实例提供块存储设备。配置和使用存储的方法由块存储驱动程序确定，或者在多后端配置的情况下由驱动程序确定。有多种驱动程序可用：NAS / SAN，NFS，iSCSI，Ceph等。Block Storage API和调度程序服务通常在控制器节点上运行。根据所使用的驱动程序，卷服务可以在控制器节点，计算节点或独立存储节点上运行。</p><h1 id="控制节点"><a href="#控制节点" class="headerlink" title="控制节点"></a>控制节点</h1><h2 id="root用户"><a href="#root用户" class="headerlink" title="root用户"></a>root用户</h2><p>为了避免权限问题，建议切换到root用户进行操作（否则要加很多sudo）。<br><code>sudo -i</code></p><h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><p>1、登录数据库<br><code>mysql -uroot -p</code>，密码为openstack。</p><p>2、创建cinder数据库<br><code>create database cinder;</code></p><p>3、授权</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> cinder.* <span class="keyword">to</span> cinder@<span class="string">'localhost'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'openstack'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> cinder.* <span class="keyword">to</span> cinder@<span class="string">'%'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'openstack'</span>;</span><br></pre></td></tr></table></figure><p>4、退出数据库<br><code>flush privileges;</code></p><p><code>exit;</code></p><h2 id="证书和端点"><a href="#证书和端点" class="headerlink" title="证书和端点"></a>证书和端点</h2><p>1、使admin环境生效<br><code>. admin-openrc</code></p><p>2、创建cinder用户，密码为openstack<br><code>openstack user create --domain default --project service --password openstack cinder</code></p><p>3、给cinder用户添加admin角色<br><code>openstack role add --project service --user cinder admin</code></p><p>4、创建cinder服务</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openstack<span class="built_in"> service </span>create --name cinderv2 --description <span class="string">"OpenStack Block Storage"</span> volumev2</span><br><span class="line"></span><br><span class="line">openstack<span class="built_in"> service </span>create --name cinderv3 --description <span class="string">"OpenStack Block Storage"</span> volumev3</span><br></pre></td></tr></table></figure><p>5、创建cinder服务端点</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne volumev2 <span class="keyword">public</span> <span class="string">http:</span><span class="comment">//controller:8776/v2/%\(project_id\)s</span></span><br><span class="line"></span><br><span class="line">openstack endpoint create --region RegionOne volumev2 internal <span class="string">http:</span><span class="comment">//controller:8776/v2/%\(project_id\)s</span></span><br><span class="line"></span><br><span class="line">openstack endpoint create --region RegionOne volumev2 admin <span class="string">http:</span><span class="comment">//controller:8776/v2/%\(project_id\)s</span></span><br><span class="line"></span><br><span class="line">openstack endpoint create --region RegionOne volumev3 <span class="keyword">public</span> <span class="string">http:</span><span class="comment">//controller:8776/v3/%\(project_id\)s </span></span><br><span class="line"></span><br><span class="line">openstack endpoint create --region RegionOne volumev3 internal <span class="string">http:</span><span class="comment">//controller:8776/v3/%\(project_id\)s </span></span><br><span class="line"></span><br><span class="line">openstack endpoint create --region RegionOne volumev3 admin <span class="string">http:</span><span class="comment">//controller:8776/v3/%\(project_id\)s</span></span><br></pre></td></tr></table></figure><h2 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h2><p>1、下载安装组件<br><code>apt-get -y install cinder-api cinder-scheduler python-cinderclient</code></p><p>2、备份cinder.conf<br><code>mv /etc/cinder/cinder.conf /etc/cinder/cinder.conf.bak</code></p><p>3、<code>vi /etc/cinder/cinder.conf</code>，新建cinder.conf内容为：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create new</span></span><br><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="comment"># define own IP address</span></span><br><span class="line"><span class="attr">my_ip</span> = <span class="number">172.16</span>.<span class="number">0.105</span></span><br><span class="line"><span class="attr">rootwrap_config</span> = /etc/cinder/rootwrap.conf</span><br><span class="line"><span class="attr">api_paste_confg</span> = /etc/cinder/api-paste.ini</span><br><span class="line"><span class="attr">state_path</span> = /var/lib/cinder</span><br><span class="line"><span class="attr">auth_strategy</span> = keystone</span><br><span class="line"><span class="comment"># RabbitMQ connection info</span></span><br><span class="line"><span class="attr">transport_url</span> = rabbit://openstack:openstack@controller</span><br><span class="line"></span><br><span class="line"><span class="comment"># MariaDB connection info</span></span><br><span class="line"><span class="section">[database]</span></span><br><span class="line"><span class="attr">connection</span> = mysql+pymysql://cinder:openstack@controller/cinder</span><br><span class="line"></span><br><span class="line"><span class="comment"># Keystone auth info</span></span><br><span class="line"><span class="section">[keystone_authtoken]</span></span><br><span class="line"><span class="attr">www_authenticate_uri</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">memcached_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = default</span><br><span class="line"><span class="attr">user_domain_name</span> = default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = cinder</span><br><span class="line"><span class="attr">password</span> = openstack</span><br><span class="line"></span><br><span class="line"><span class="section">[oslo_concurrency]</span></span><br><span class="line"><span class="attr">lock_path</span> = <span class="variable">$state_path</span>/tmp</span><br></pre></td></tr></table></figure><p>4、更改权限<br><code>chmod 644 /etc/cinder/cinder.conf</code></p><p><code>chown root:cinder /etc/cinder/cinder.conf</code></p><p>5、生成数据库数据<br><code>su -s /bin/bash cinder -c &quot;cinder-manage db sync&quot;</code></p><p>6、重启cinder-scheduler<br><code>systemctl restart cinder-scheduler</code></p><p>7、查看volume<br><code>openstack volume service list</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-cinder/volume.jpg?imageView2/0/w/700" alt=""></p><h1 id="存储节点"><a href="#存储节点" class="headerlink" title="存储节点"></a>存储节点</h1><p>本文中，我们的存储节点和计算节点在同一个节点，该节点的IP为172.16.0.106。已经安装的服务和virtualbox计算节点（192.168.56.111）相同，包括nova-compute和neutron。</p><h2 id="root用户-1"><a href="#root用户-1" class="headerlink" title="root用户"></a>root用户</h2><p>为了避免权限问题，建议切换到root用户进行操作（否则要加很多sudo）。<br><code>sudo -i</code></p><h2 id="安装配置-1"><a href="#安装配置-1" class="headerlink" title="安装配置"></a>安装配置</h2><p>1、安装cinder-volume<br><code>apt-get -y install cinder-volume python-mysqldb</code></p><p>2、备份cinder.conf<br><code>mv /etc/cinder/cinder.conf /etc/cinder/cinder.conf.bak</code></p><p>3、<code>vi /etc/cinder/cinder.conf</code>，新建cinder.conf内容为：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create new</span></span><br><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="comment"># define own IP address</span></span><br><span class="line"><span class="attr">my_ip</span> = <span class="number">172.16</span>.<span class="number">0.106</span></span><br><span class="line"><span class="attr">rootwrap_config</span> = /etc/cinder/rootwrap.conf</span><br><span class="line"><span class="attr">api_paste_confg</span> = /etc/cinder/api-paste.ini</span><br><span class="line"><span class="attr">state_path</span> = /var/lib/cinder</span><br><span class="line"><span class="attr">auth_strategy</span> = keystone</span><br><span class="line"><span class="comment"># RabbitMQ connection info</span></span><br><span class="line"><span class="attr">transport_url</span> = rabbit://openstack:openstack@controller</span><br><span class="line"><span class="comment"># Glance connection info</span></span><br><span class="line"><span class="attr">glance_api_servers</span> = http://controller:<span class="number">9292</span></span><br><span class="line"><span class="comment"># OK with empty value now</span></span><br><span class="line"><span class="attr">enabled_backends</span> =</span><br><span class="line"></span><br><span class="line"><span class="comment"># MariaDB connection info</span></span><br><span class="line"><span class="section">[database]</span></span><br><span class="line"><span class="attr">connection</span> = mysql+pymysql://cinder:openstack@controller/cinder</span><br><span class="line"></span><br><span class="line"><span class="comment"># Keystone auth info</span></span><br><span class="line"><span class="section">[keystone_authtoken]</span></span><br><span class="line"><span class="attr">www_authenticate_uri</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">memcached_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = default</span><br><span class="line"><span class="attr">user_domain_name</span> = default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = cinder</span><br><span class="line"><span class="attr">password</span> = openstack</span><br><span class="line"></span><br><span class="line"><span class="section">[oslo_concurrency]</span></span><br><span class="line"><span class="attr">lock_path</span> = <span class="variable">$state_path</span>/tmp</span><br></pre></td></tr></table></figure><p>4、更改权限<br><code>chmod 644 /etc/cinder/cinder.conf</code></p><p><code>chown root:cinder /etc/cinder/cinder.conf</code></p><p>5、重启cinder-volume<br><code>systemctl restart cinder-volume</code></p><h1 id="使用lvm卷"><a href="#使用lvm卷" class="headerlink" title="使用lvm卷"></a>使用lvm卷</h1><h2 id="存储节点-1"><a href="#存储节点-1" class="headerlink" title="存储节点"></a>存储节点</h2><p>1、在存储节点添加硬盘，保证至少有两块硬盘。</p><p>2、创建物理卷<br><code>ll /dev/sd*</code></p><p><code>pvcreate /dev/sdb</code></p><p>3、创建volume group<br><code>vgcreate -s 32M vg_volume01 /dev/sdb</code></p><p>4、安装lvm相关组件<br><code>apt-get -y install tgt thin-provisioning-tools</code></p><p>5、<code>vi /etc/cinder/cinder.conf</code>，如下修改cinder.conf：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add a value for enabled_backends</span></span><br><span class="line"><span class="attr">enabled_backends</span> = lvm</span><br><span class="line"><span class="comment"># add follows to the end</span></span><br><span class="line"><span class="section">[lvm]</span></span><br><span class="line"><span class="attr">iscsi_helper</span> = tgtadm</span><br><span class="line"><span class="comment"># volume group name just created</span></span><br><span class="line"><span class="attr">volume_group</span> = vg_volume01</span><br><span class="line"><span class="comment"># IP address of Storage Node</span></span><br><span class="line"><span class="attr">iscsi_ip_address</span> = <span class="number">172.16</span>.<span class="number">0.106</span></span><br><span class="line"><span class="attr">volume_driver</span> = cinder.volume.drivers.lvm.LVMVolumeDriver</span><br><span class="line"><span class="attr">volumes_dir</span> = <span class="variable">$state_path</span>/volumes</span><br><span class="line"><span class="attr">iscsi_protocol</span> = iscsi</span><br></pre></td></tr></table></figure><p>6、重启服务<br><code>systemctl restart cinder-volume tgt</code></p><h2 id="计算节点"><a href="#计算节点" class="headerlink" title="计算节点"></a>计算节点</h2><p>1、<code>vi /etc/nova/nova.conf</code>，编辑nova.conf文件：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add to the end</span></span><br><span class="line"><span class="section">[cinder]</span></span><br><span class="line"><span class="attr">os_region_name</span> = RegionOne</span><br></pre></td></tr></table></figure><p>2、重启compute服务<br><code>systemctl restart nova-compute</code></p><h2 id="控制节点-1"><a href="#控制节点-1" class="headerlink" title="控制节点"></a>控制节点</h2><p>以上，已经准备好了cinder服务，我们在控制节点使用cinder服务（也可以在其他机器使用）。</p><p>1、假设我们已经按照<a href="https://www.voidking.com/dev-ubuntu16-manual-openstack-instance/">《Ubuntu16手动安装OpenStack——创建实例》</a>一文，创建了一个cirros0实例，ip为10.0.0.206。</p><p>2、登录cirros0<br><code>ssh cirros@10.0.0.206</code>，密码默认为gocubsgo。</p><p>3、在cirros0中查看硬盘<br><code>df -h</code></p><p><code>ls -l /dev/vd*</code></p><p><code>sudo fdisk -l</code></p><p><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-cinder/disk.jpg?imageView2/0/w/700" alt=""><br>可以看到，当前虚拟机只有一块vda硬盘。</p><p>4、控制节点中修改voidking用户环境，并使环境生效<br><code>echo &quot;export OS_VOLUME_API_VERSION=2&quot; &gt;&gt; ~/voidkingrc</code></p><p><code>. voidkingrc</code></p><p>5、创建卷disk01，大小为1G<br><code>openstack volume create --size 1 disk01</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-cinder/create.jpg?imageView2/0/w/700" alt=""></p><p>6、查看卷<br><code>openstack volume list</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-cinder/list.jpg?imageView2/0/w/700" alt=""></p><p>7、把卷disk01添加给cirros0实例<br><code>openstack server list</code></p><p><code>openstack server add volume cirros0 disk01</code></p><p>8、在cirros0中查看硬盘<br><code>ls -l /dev/vd*</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-cinder/disk1.jpg?imageView2/0/w/700" alt=""></p><p>发现cirros0中多出了一块硬盘vdb。</p><p>9、在控制节点查看卷<br><code>openstack volume list</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-cinder/list1.jpg?imageView2/0/w/700" alt=""><br>显示disk01已经attach到了cirros0的/dev/vdb，和我们在cirros0中看到的结果一致。</p><p>10、移除卷<br><code>openstack server remove volume cirros0 disk01</code></p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>关于NFS（网络文件系统）的使用，参考<a href="https://www.server-world.info/en/note?os=Ubuntu_16.04&p=openstack_queens2&f=4" target="_blank" rel="noopener">OpenStack Queens : Use Cinder Storage (NFS)</a>。</p><p>关于LVM和NFS格式卷的混合使用，参考<a href="https://www.server-world.info/en/note?os=Ubuntu_16.04&p=openstack_queens2&f=5" target="_blank" rel="noopener">OpenStack Queens : Use Cinder Storage (Multi-BackEnds)</a>。</p><p>关于使用cinder备份卷，参考<a href="https://www.server-world.info/en/note?os=Ubuntu_16.04&p=openstack_queens2&f=6" target="_blank" rel="noopener">OpenStack Queens : Configure Cinder Backup</a>。</p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/ubuntu/" rel="tag"># ubuntu</a> <a href="/tags/openstack/" rel="tag"># openstack</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-ubuntu16-manual-openstack-modify-mirror/" rel="prev" title="Ubuntu16手动安装OpenStack——修改镜像"><i class="fa fa-chevron-left"></i> Ubuntu16手动安装OpenStack——修改镜像</a></div><div class="post-nav-item"> <a href="/dev-ubuntu16-manual-openstack-swift/" rel="next" title="Ubuntu16手动安装OpenStack——swift篇">Ubuntu16手动安装OpenStack——swift篇<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#目标"><span class="nav-number">1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#cinder简介"><span class="nav-number">2.</span> <span class="nav-text">cinder简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#控制节点"><span class="nav-number">3.</span> <span class="nav-text">控制节点</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#root用户"><span class="nav-number">3.1.</span> <span class="nav-text">root用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库"><span class="nav-number">3.2.</span> <span class="nav-text">数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#证书和端点"><span class="nav-number">3.3.</span> <span class="nav-text">证书和端点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装配置"><span class="nav-number">3.4.</span> <span class="nav-text">安装配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#存储节点"><span class="nav-number">4.</span> <span class="nav-text">存储节点</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#root用户-1"><span class="nav-number">4.1.</span> <span class="nav-text">root用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装配置-1"><span class="nav-number">4.2.</span> <span class="nav-text">安装配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用lvm卷"><span class="nav-number">5.</span> <span class="nav-text">使用lvm卷</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#存储节点-1"><span class="nav-number">5.1.</span> <span class="nav-text">存储节点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#计算节点"><span class="nav-number">5.2.</span> <span class="nav-text">计算节点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#控制节点-1"><span class="nav-number">5.3.</span> <span class="nav-text">控制节点</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#后记"><span class="nav-number">6.</span> <span class="nav-text">后记</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">619</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">50</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">198</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2021</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://www.beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>