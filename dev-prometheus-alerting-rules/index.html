<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//qiniu-cdn.voidking.com/doc/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言本文中，我们学习配置Prometheus的告警规则。 参考文档：  《Prometheus入门篇》 Prometheus Alertmanager 《Prometheus AlertManager WebHook通知到到钉钉群》"><meta property="og:type" content="article"><meta property="og:title" content="Promtheus配置告警规则"><meta property="og:url" content="https://www.voidking.com/dev-prometheus-alerting-rules/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言本文中，我们学习配置Prometheus的告警规则。 参考文档：  《Prometheus入门篇》 Prometheus Alertmanager 《Prometheus AlertManager WebHook通知到到钉钉群》"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2020-01-13T20:00:00.000Z"><meta property="article:modified_time" content="2024-09-07T08:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="prometheus"><meta property="article:tag" content="监控"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-prometheus-alerting-rules/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Promtheus配置告警规则 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">一个计算机技术爱好者与学习者</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-prometheus-alerting-rules/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="一个计算机技术爱好者与学习者"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Promtheus配置告警规则</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-01-13 20:00:00" itemprop="dateCreated datePublished" datetime="2020-01-13T20:00:00+00:00">2020-01-13</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-09-07 08:00:00" itemprop="dateModified" datetime="2024-09-07T08:00:00+00:00">2024-09-07</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/monitoring/" itemprop="url" rel="index"><span itemprop="name">monitoring</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><span class="post-title-index">1.</span><a href="#前言" class="headerlink" title="前言"></a> 前言</h1><p>本文中，我们学习配置Prometheus的告警规则。</p><p>参考文档：</p><ul><li><a href="https://www.voidking.com/dev-prometheus-start/">《Prometheus入门篇》</a></li><li><a target="_blank" rel="noopener" href="https://prometheus.io/docs/alerting/latest/alertmanager/">Prometheus Alertmanager</a></li><li><a href="https://www.voidking.com/dev-prometheus-webhook-dingtalk/">《Prometheus AlertManager WebHook通知到到钉钉群》</a></li></ul><span id="more"></span><h1 id="Prometheus告警流程"><span class="post-title-index">2.</span><a href="#Prometheus告警流程" class="headerlink" title="Prometheus告警流程"></a> Prometheus告警流程</h1><h2 id="1-定义告警规则"><span class="post-title-index">2.1.</span><a href="#1-定义告警规则" class="headerlink" title="1. 定义告警规则"></a> 1. 定义告警规则</h2><p>告警规则是通过PromQL表达式来定义的,当表达式查询结果满足一定条件时，就会触发告警。告警规则通常包括以下几个部分:</p><ul><li>告警名称</li><li>PromQL表达式</li><li>持续时间(duration)</li><li>标签(labels)</li><li>注解(annotations)</li></ul><p>告警规则可以定义在Prometheus的配置文件中，也可以通过API动态添加。</p><h2 id="2-Prometheus-Server触发告警"><span class="post-title-index">2.2.</span><a href="#2-Prometheus-Server触发告警" class="headerlink" title="2. Prometheus Server触发告警"></a> 2. Prometheus Server触发告警</h2><p>Prometheus Server会定期(默认每分钟)评估所有的告警规则，如果某个规则的PromQL表达式在持续时间内一直满足，就会触发相应的告警。</p><h2 id="3-告警发送到Alertmanager"><span class="post-title-index">2.3.</span><a href="#3-告警发送到Alertmanager" class="headerlink" title="3. 告警发送到Alertmanager"></a> 3. 告警发送到Alertmanager</h2><p>Prometheus Server将触发的告警发送到Alertmanager组件。Alertmanager负责对告警进行去重、分组、路由等处理。</p><h2 id="4-Alertmanager发送告警通知"><span class="post-title-index">2.4.</span><a href="#4-Alertmanager发送告警通知" class="headerlink" title="4. Alertmanager发送告警通知"></a> 4. Alertmanager发送告警通知</h2><p>Alertmanager根据配置的路由规则，将告警发送到指定的接收器，如邮件、PagerDuty、Slack、Webhook等。</p><h2 id="5-消息中转服务"><span class="post-title-index">2.5.</span><a href="#5-消息中转服务" class="headerlink" title="5. 消息中转服务"></a> 5. 消息中转服务</h2><p>如果Alertmanager把消息发送到了Webhook（消息中转服务），那么消息中转服务会再次进行消息转发，转发给微信、钉钉、飞书等平台。</p><h1 id="配置告警规则"><span class="post-title-index">3.</span><a href="#配置告警规则" class="headerlink" title="配置告警规则"></a> 配置告警规则</h1><h2 id="配置告警规则概述"><span class="post-title-index">3.1.</span><a href="#配置告警规则概述" class="headerlink" title="配置告警规则概述"></a> 配置告警规则概述</h2><p>从上一节【Prometheus告警流程】中我们可以得知，Prometheus的告警流程跑通后，后续增删改告警，实际上就是配置告警规则。<br>配置告警规则的一般流程为：<br>1、准备告警语句<br>2、Prometheus添加告警规则<br>3、模拟告警</p><h2 id="准备告警语句"><span class="post-title-index">3.2.</span><a href="#准备告警语句" class="headerlink" title="准备告警语句"></a> 准备告警语句</h2><p>准备告警语句有两种方法：一种是从网上获取成熟的告警语句；另一种是自己调试告警语句。</p><p>自己调试告警语句的方法如下：</p><p>1、查看监控指标<br>访问Grafana Dashboard，点击一个panel的Edit，可以看到panel使用的变量，以及变量的PromQL计算方法。</p><p>2、编写PromQL语句<br>访问Grafana Explore页面，左上角数据源选择Prometheus。<br>参考panel，选择合适的指标，编写PromQL，计算出自己想要用来报警的指标</p><p>以CPU使用率为例：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">100 - (avg by (environment,instance) (irate(node_cpu_seconds_total&#123;job=&quot;node-exporter&quot;,mode=&quot;idle&quot;&#125;[5m])))  * 100</span><br></pre></td></tr></table></figure><p>以内存使用率为例：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">100 - ((node_memory_MemAvailable_bytes * 100) / node_memory_MemTotal_bytes)</span><br></pre></td></tr></table></figure><h2 id="配置告警"><span class="post-title-index">3.3.</span><a href="#配置告警" class="headerlink" title="配置告警"></a> 配置告警</h2><p>假设规则文件路径为 /opt/prometheus/conf/rules</p><p>1、创建告警规则</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/prometheus/conf/rules/host.rules</span><br></pre></td></tr></table></figure><p>host.rules内容为：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">groups:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hostStatsAlert</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">hostCpuUsageAlert</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="number">100</span> <span class="bullet">-</span> <span class="string">(avg</span> <span class="string">by</span> <span class="string">(environment,instance)</span> <span class="string">(irate(node_cpu_seconds_total&#123;job=&quot;node-exporter&quot;,mode=&quot;idle&quot;&#125;[5m])))</span>  <span class="string">*</span> <span class="number">100</span> <span class="string">&gt;</span> <span class="number">85</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">page</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;Instance <span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> CPU usgae high&quot;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> CPU usage above 85% (current value: <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>)&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">hostMemUsageAlert</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="number">100</span> <span class="bullet">-</span> <span class="string">((node_memory_MemAvailable_bytes</span> <span class="string">*</span> <span class="number">100</span><span class="string">)</span> <span class="string">/</span> <span class="string">node_memory_MemTotal_bytes)</span> <span class="string">&gt;</span> <span class="number">85</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">page</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;Instance <span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> MEM usgae high&quot;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> MEM usage above 85% (current value: <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>)&quot;</span></span><br></pre></td></tr></table></figure><p>告警规则里的<code>expr</code>，是根据【准备告警语句】一节中获取到的PromQL语句改写的。</p><p>2、修改prometheus server配置<br>prometheus.yml 修改为：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">alerting:</span></span><br><span class="line">  <span class="attr">alertmanagers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.56.101:9093&#x27;</span>] <span class="comment">#告警信息会发送给alertmanager</span></span><br><span class="line"><span class="attr">rule_files:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">/etc/prometheus/rules/*.rules</span>   <span class="comment">#告警规则文件路径，对应宿主机 /opt/prometheus/rules/*.rules</span></span><br></pre></td></tr></table></figure><p>3、重载或者重启prometheus server</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http://localhost:9090/-/reload</span><br><span class="line">docker restart prometheus</span><br></pre></td></tr></table></figure><h2 id="模拟告警"><span class="post-title-index">3.4.</span><a href="#模拟告警" class="headerlink" title="模拟告警"></a> 模拟告警</h2><p>1、模拟CPU使用率升高</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install stress-ng</span><br><span class="line">stress-ng --cpu 7 --verbose --<span class="built_in">timeout</span> 2m</span><br></pre></td></tr></table></figure><p>2、查看告警触发情况<br><a target="_blank" rel="noopener" href="http://192.168.56.101:9090/alerts">http://192.168.56.101:9090/alerts</a><br><a target="_blank" rel="noopener" href="http://192.168.56.101:9093/#/alerts">http://192.168.56.101:9093/#/alerts</a></p><p>3、查看群能否收到告警</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>原文链接：</strong> <a href="https://www.voidking.com/dev-prometheus-alerting-rules/" title="Promtheus配置告警规则">https://www.voidking.com/dev-prometheus-alerting-rules/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本文采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议，转载请注明出处！源站会即时更新知识点并修正错误，欢迎访问~</li><li> <img width="200" height="200" src="/images/avatar.jpg"><p style="text-align:center;margin-bottom:0">微信公众号同步更新，欢迎关注~</p></li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/prometheus/" rel="tag"># prometheus</a> <a href="/tags/%E7%9B%91%E6%8E%A7/" rel="tag"># 监控</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-prometheus-labels/" rel="prev" title="Prometheus中标签（Labels）详解"><i class="fa fa-chevron-left"></i> Prometheus中标签（Labels）详解</a></div><div class="post-nav-item"> <a href="/dev-grafana-prometheus-problem/" rel="next" title="Grafana和Prometheus问题记录">Grafana和Prometheus问题记录<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3284447971731414" data-ad-slot="9697986181"></ins><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">1. 前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Prometheus%E5%91%8A%E8%AD%A6%E6%B5%81%E7%A8%8B"><span class="nav-text">2. Prometheus告警流程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%AE%9A%E4%B9%89%E5%91%8A%E8%AD%A6%E8%A7%84%E5%88%99"><span class="nav-text">2.1. 1. 定义告警规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Prometheus-Server%E8%A7%A6%E5%8F%91%E5%91%8A%E8%AD%A6"><span class="nav-text">2.2. 2. Prometheus Server触发告警</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%91%8A%E8%AD%A6%E5%8F%91%E9%80%81%E5%88%B0Alertmanager"><span class="nav-text">2.3. 3. 告警发送到Alertmanager</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Alertmanager%E5%8F%91%E9%80%81%E5%91%8A%E8%AD%A6%E9%80%9A%E7%9F%A5"><span class="nav-text">2.4. 4. Alertmanager发送告警通知</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E6%B6%88%E6%81%AF%E4%B8%AD%E8%BD%AC%E6%9C%8D%E5%8A%A1"><span class="nav-text">2.5. 5. 消息中转服务</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%91%8A%E8%AD%A6%E8%A7%84%E5%88%99"><span class="nav-text">3. 配置告警规则</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%91%8A%E8%AD%A6%E8%A7%84%E5%88%99%E6%A6%82%E8%BF%B0"><span class="nav-text">3.1. 配置告警规则概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E5%91%8A%E8%AD%A6%E8%AF%AD%E5%8F%A5"><span class="nav-text">3.2. 准备告警语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%91%8A%E8%AD%A6"><span class="nav-text">3.3. 配置告警</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E6%8B%9F%E5%91%8A%E8%AD%A6"><span class="nav-text">3.4. 模拟告警</span></a></li></ol></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">一个计算机技术爱好者与学习者</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">744</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">32</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">259</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: '64ba06e5e226b45cd856e7aca0609381',
      title: 'Promtheus配置告警规则',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>