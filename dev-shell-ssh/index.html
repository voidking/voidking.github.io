<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//qiniu.cdn.voidking.com/doc/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="ssh简介 SSH (Secure Shell) 是一个为远程登录会话和其他网络服务提供安全性的协议。通过一个安全通道，用户可以在未加密的网络中为网络服务提供强大的身份验证和安全加密，让用户可以安全地在不安全的网络环境中执行远程命令，并将本地和远程主机之间的数据进行安全传输。  SSH协议的实现包括服务端和客户端。  SSH 服务端提供远程登录和文件传输等功能，可以被其他用户或系统通过 SSH 协"><meta property="og:type" content="article"><meta property="og:title" content="shell命令之ssh"><meta property="og:url" content="https://www.voidking.com/dev-shell-ssh/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="ssh简介 SSH (Secure Shell) 是一个为远程登录会话和其他网络服务提供安全性的协议。通过一个安全通道，用户可以在未加密的网络中为网络服务提供强大的身份验证和安全加密，让用户可以安全地在不安全的网络环境中执行远程命令，并将本地和远程主机之间的数据进行安全传输。  SSH协议的实现包括服务端和客户端。  SSH 服务端提供远程登录和文件传输等功能，可以被其他用户或系统通过 SSH 协"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2017-06-02T08:00:00.000Z"><meta property="article:modified_time" content="2024-01-06T08:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="问题排查"><meta property="article:tag" content="shell"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-shell-ssh/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>shell命令之ssh | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">一个计算机技术爱好者与学习者</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-shell-ssh/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="一个计算机技术爱好者与学习者"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> shell命令之ssh</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2017-06-02 08:00:00" itemprop="dateCreated datePublished" datetime="2017-06-02T08:00:00+00:00">2017-06-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-01-06 08:00:00" itemprop="dateModified" datetime="2024-01-06T08:00:00+00:00">2024-01-06</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/shell/" itemprop="url" rel="index"><span itemprop="name">shell</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/network/" itemprop="url" rel="index"><span itemprop="name">network</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/troubleshooting/" itemprop="url" rel="index"><span itemprop="name">troubleshooting</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="ssh简介"><span class="post-title-index">1.</span><a href="#ssh简介" class="headerlink" title="ssh简介"></a> ssh简介</h1><blockquote><p>SSH (Secure Shell) 是一个为远程登录会话和其他网络服务提供安全性的协议。通过一个安全通道，用户可以在未加密的网络中为网络服务提供强大的身份验证和安全加密，让用户可以安全地在不安全的网络环境中执行远程命令，并将本地和远程主机之间的数据进行安全传输。</p></blockquote><p>SSH协议的实现包括服务端和客户端。</p><ul><li>SSH 服务端提供远程登录和文件传输等功能，可以被其他用户或系统通过 SSH 协议连接并访问。</li><li>SSH 客户端是用来连接远程服务端的工具。用户可以使用命令行或图形界面工具来连接到 SSH 服务端，并通过 SSH 协议进行通信。</li><li>SSH 客户端可以通过用户名和密码、公钥验证等方式进行身份验证，登录到服务端。登录成功后，用户就可以在远程服务器上执行命令、上传或下载文件等操作。</li></ul><p>SSH协议有很多实现，其中最广泛使用的是<a target="_blank" rel="noopener" href="https://www.openssh.com/">OpenSSH</a>，OpenSSH也是Linux、Unix等操作系统的SSH协议默认实现。</p><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://www.commandlinux.com/man-page/man5/authorized_keys.5.html">SSHD</a></li></ul><span id="more"></span><h1 id="安装ssh-server"><span class="post-title-index">2.</span><a href="#安装ssh-server" class="headerlink" title="安装ssh server"></a> 安装ssh server</h1><p>ubuntu/debian中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install ssh</span><br></pre></td></tr></table></figure><p>centos/redhat中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install openssh-server</span><br></pre></td></tr></table></figure><h1 id="配置ssh-server"><span class="post-title-index">3.</span><a href="#配置ssh-server" class="headerlink" title="配置ssh server"></a> 配置ssh server</h1><h2 id="基础配置"><span class="post-title-index">3.1.</span><a href="#基础配置" class="headerlink" title="基础配置"></a> 基础配置</h2><p>ssh server的配置文件位于 <code>/etc/ssh/sshd_config</code>。需要使用具有root权限的编辑器（例如：nano，vi）对其进行编辑。</p><p>在配置文件中的关键参数包括：</p><ul><li>Port：默认端口是22，可以根据需要改变端口。</li><li>PermitRootLogin：这个参数决定是否允许使用root用户进行远程登录，默认是Yes，可改为No。</li><li>PasswordAuthentication：如设置为no，则关闭了密码登录，只能通过密钥登录。</li></ul><p>编辑完成之后，需要重启SSH服务让更改生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/ssh restart</span><br></pre></td></tr></table></figure><h2 id="白名单配置"><span class="post-title-index">3.2.</span><a href="#白名单配置" class="headerlink" title="白名单配置"></a> 白名单配置</h2><p>SSH白名单配置实际上是通过TCP Wrappers实现的。TCP Wrappers为许多网络服务提供了一个基于主机的访问控制策略，包括SSH。</p><p>TCP Wrappers依赖两个配置文件：/etc/hosts.allow和/etc/hosts.deny。</p><p>在hosts.allow文件中列出的主机可以访问网络服务，而在hosts.deny文件中列出的主机则被拒绝访问。</p><p>每个文件中的条目都是一行，包含一个服务名和一列主机名或IP地址。服务名是/etc/services文件中列出的服务名或由互联网守护程序（inetd）或xinetd启动的守护进程的名称。主机名或IP地址可以是完全限定的主机名、IP地址、IPv6地址、DNS域名、网络地址或者是这些值的模式。</p><p>要为SSH配置一个白名单，需要在/etc/hosts.allow文件中指定ssh和sshd服务可以访问的主机，然后在/etc/hosts.deny文件中禁止所有其他主机访问这些服务。</p><p>假设我们希望只允许10.0.0.0/24网络中的主机和192.168.56.200通过SSH访问我们的服务器，其他所有主机都不能访问。可以按如下方式配置:</p><p>在/etc/hosts.allow文件中添加配置：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sshd:10.0.0.0/24</span><br><span class="line">sshd:192.168.56.200</span><br></pre></td></tr></table></figure><p>在/etc/hosts.deny文件中添加配置：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshd:ALL</span><br></pre></td></tr></table></figure><p>参考文档：<a target="_blank" rel="noopener" href="https://linuxconfig.org/hosts-allow-format-and-example-on-linux">hosts.allow format and example on Linux</a></p><h1 id="使用ssh-client"><span class="post-title-index">4.</span><a href="#使用ssh-client" class="headerlink" title="使用ssh client"></a> 使用ssh client</h1><h2 id="ssh登录服务器"><span class="post-title-index">4.1.</span><a href="#ssh登录服务器" class="headerlink" title="ssh登录服务器"></a> ssh登录服务器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh voidking@192.168.56.100</span><br><span class="line"></span><br><span class="line">ssh voidking@192.168.56.100 -p 2222 <span class="comment"># 当远程机器ssh端口为2222时</span></span><br></pre></td></tr></table></figure><h2 id="测试ssh连接"><span class="post-title-index">4.2.</span><a href="#测试ssh连接" class="headerlink" title="测试ssh连接"></a> 测试ssh连接</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -vvv voidking@192.168.56.100 /bin/true</span><br></pre></td></tr></table></figure><h2 id="ssh执行远程命令"><span class="post-title-index">4.3.</span><a href="#ssh执行远程命令" class="headerlink" title="ssh执行远程命令"></a> ssh执行远程命令</h2><p>执行远程命令很简单，直接ssh后面跟着命令就可以了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh voidking@192.168.56.100 <span class="string">&quot;echo helloworld&quot;</span></span><br></pre></td></tr></table></figure><p>那如果远程命令里面包含双引号怎么办？变成单引号，或者添加转义。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh voidking@192.168.56.100 <span class="string">&quot;echo &#x27;helloworld&#x27;&quot;</span></span><br><span class="line">ssh voidking@192.168.56.100 <span class="string">&quot;echo \&quot;helloworld\&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>那如果需要远程命令里使用变量怎么办？添加转义。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh voidking@192.168.56.100 <span class="string">&quot;host=\$(hostname);echo \&quot;\$&#123;host&#125;\&quot;&quot;</span></span><br></pre></td></tr></table></figure><h2 id="ssh批量执行远程命令"><span class="post-title-index">4.4.</span><a href="#ssh批量执行远程命令" class="headerlink" title="ssh批量执行远程命令"></a> ssh批量执行远程命令</h2><p>已知主机列表hosts.txt内容为：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">192.168.56.101</span><br><span class="line">192.168.56.102</span><br></pre></td></tr></table></figure><p>需求：给主机列表中的机器添加开机启动命令</p><p>脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">cat</span> hosts.txt`; <span class="keyword">do</span> ssh <span class="variable">$i</span> <span class="string">&quot;echo &#x27;/home/voidking/start.sh&#x27; | sudo tee -a /etc/rc.local&quot;</span>;<span class="keyword">done</span></span><br></pre></td></tr></table></figure><h1 id="配置免密登录"><span class="post-title-index">5.</span><a href="#配置免密登录" class="headerlink" title="配置免密登录"></a> 配置免密登录</h1><h2 id="生成密钥对"><span class="post-title-index">5.1.</span><a href="#生成密钥对" class="headerlink" title="生成密钥对"></a> 生成密钥对</h2><p>通过ssh登录远程主机，要么使用密码，要么使用密钥对。使用密钥对的话，可以实现免密登录。</p><p>生成默认密钥对：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure><p>执行命令后，一路回车，会生成公钥<code>~/.ssh/id_rsa.pub</code> 和私钥 <code>~/.ssh/id_rsa</code></p><p>指定参数生成密钥对：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -C <span class="string">&quot;voidking@qq.com&quot;</span> -f ~/.ssh/voidking_rsa </span><br></pre></td></tr></table></figure><p>执行命令后，<code>~/.ssh/</code> 目录下会生成 <code>voidking_rsa</code> 和 <code>voidking_rsa.pub</code>，注释内容为 <a href="mailto:&#118;&#x6f;&#x69;&#100;&#x6b;&#x69;&#110;&#103;&#x40;&#113;&#113;&#46;&#x63;&#x6f;&#x6d;">&#118;&#x6f;&#x69;&#100;&#x6b;&#x69;&#110;&#103;&#x40;&#113;&#113;&#46;&#x63;&#x6f;&#x6d;</a></p><h2 id="添加公钥到远程机器"><span class="post-title-index">5.2.</span><a href="#添加公钥到远程机器" class="headerlink" title="添加公钥到远程机器"></a> 添加公钥到远程机器</h2><p>假设远程机器为192.168.56.100。</p><p>添加默认公钥到远程机器：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id voidking@192.168.56.100</span><br><span class="line">ssh-copy-id voidking@192.168.56.100 -p 2222 <span class="comment"># 当远程机器ssh端口为2222时</span></span><br></pre></td></tr></table></figure><p>根据提示输入密码，这条命令会把 <code>~/.ssh/id_rsa.pub</code> 的内容追加到远程机器的 <code>~/.ssh/authorized_keys</code> 中。<br>注意：authorized_keys文件权限需要配置为600。如果配置好了sshd，但是无法使用密钥登录机器，请检查authorized_keys文件权限。</p><p>添加指定公钥到远程机器：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -i ~/.ssh/voidking_rsa voidking@192.168.56.100</span><br></pre></td></tr></table></figure><p>执行这条命令后，<code>~/.ssh/voidking_rsa.pub</code> 中的内容会被拷贝到远程机器的 <code>~/.ssh/authorized_keys</code> 中。</p><p>对于macos系统，需要单独单装 <code>ssh-copy-id</code> 命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L https://raw.githubusercontent.com/beautifulcode/ssh-copy-id-for-OSX/master/install.sh | sh</span><br></pre></td></tr></table></figure><h2 id="密钥添加失败问题"><span class="post-title-index">5.3.</span><a href="#密钥添加失败问题" class="headerlink" title="密钥添加失败问题"></a> 密钥添加失败问题</h2><p>如果<code>ssh-copy-id</code>报错cannot create .ssh/authorized_keys: Operation not permitted<br>或者手动编辑<code>authorized_keys</code>后无法保存，<code>chmod</code>也无法改变<code>authorized_keys</code>文件的权限。</p><p>那么可能是因为<code>authorized_keys</code>被加锁了，防止误删，需要先进行解锁。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chattr -i ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>参考文档<a target="_blank" rel="noopener" href="https://www.linuxcool.com/chattr">chattr命令 – 更改文件隐藏属性</a></p><h2 id="免密登录远程机器"><span class="post-title-index">5.4.</span><a href="#免密登录远程机器" class="headerlink" title="免密登录远程机器"></a> 免密登录远程机器</h2><p>使用默认私钥登录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh voidking@192.168.56.100</span><br></pre></td></tr></table></figure><p>指定私钥登录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i ~/.ssh/id_rsa voidking@192.168.56.100 </span><br></pre></td></tr></table></figure><p>执行<code>ssh</code>命令时，默认会先使用密钥进行验证，如果密钥配置正常，那么就不需要输入密码了。</p><h1 id="配置主机别名登录"><span class="post-title-index">6.</span><a href="#配置主机别名登录" class="headerlink" title="配置主机别名登录"></a> 配置主机别名登录</h1><p>登录远程服务器，需要执行命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh username@host -p port</span><br></pre></td></tr></table></figure><p>如果有大量的username、host、port，是很难记忆的，因此我们需要配置主机别名登录。</p><p>主机别名登录具体配置方法如下：</p><p>1、创建 <code>~/.ssh/config</code> 文件，内容为</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Host jumpbox</span><br><span class="line">HostName jumpbox.voidking.com</span><br><span class="line">User voidking</span><br><span class="line">Port 2345</span><br><span class="line">IdentityFile ~/.ssh/voidking_rsa</span><br><span class="line"></span><br><span class="line">Host bastionhost</span><br><span class="line">HostName 45.68.78.134</span><br><span class="line">User root</span><br><span class="line">Port 3456</span><br><span class="line">IdentityFile ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure><p>2、配置 authorized_keys</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -i ~/.ssh/voidking_rsa.pub jumpbox</span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub bastionhost</span><br></pre></td></tr></table></figure><p>3、登录服务器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh jumpbox</span><br><span class="line">ssh bastionhost</span><br></pre></td></tr></table></figure><h1 id="配置用户只能运行特定命令"><span class="post-title-index">7.</span><a href="#配置用户只能运行特定命令" class="headerlink" title="配置用户只能运行特定命令"></a> 配置用户只能运行特定命令</h1><h2 id="运行命令-脚本"><span class="post-title-index">7.1.</span><a href="#运行命令-脚本" class="headerlink" title="运行命令/脚本"></a> 运行命令/脚本</h2><p>1、authorized_keys 配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">command</span>=<span class="string">&quot;/usr/bin/date&quot;</span> ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC9...</span><br></pre></td></tr></table></figure><p>2、运行命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh voidking@192.168.56.100</span><br></pre></td></tr></table></figure><p>默认会运行 date 命令。</p><h2 id="运行命令-脚本-参数"><span class="post-title-index">7.2.</span><a href="#运行命令-脚本-参数" class="headerlink" title="运行命令/脚本 + 参数"></a> 运行命令/脚本 + 参数</h2><p>1、准备脚本 test.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$2</span></span><br></pre></td></tr></table></figure><p>2、authorized_keys 配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#command=&quot;/usr/bin/echo $SSH_ORIGINAL_COMMAND&quot; ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC9...</span></span><br><span class="line"><span class="built_in">command</span>=<span class="string">&quot;/path/to/test.sh <span class="variable">$SSH_ORIGINAL_COMMAND</span>&quot;</span> ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC9...</span><br></pre></td></tr></table></figure><p>3、运行脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh voidking@192.168.56.100 <span class="string">&quot;test1 test2&quot;</span></span><br><span class="line">ssh voidking@192.168.56.100 test1 test2</span><br></pre></td></tr></table></figure><p>默认会运行 test.sh 脚本，<code>test1</code> 和 <code>test2</code>会作为两个参数传递给 test.sh。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>原文链接：</strong> <a href="https://www.voidking.com/dev-shell-ssh/" title="shell命令之ssh">https://www.voidking.com/dev-shell-ssh/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本文采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议，转载请注明出处！源站会即时更新知识点并修正错误，欢迎访问~</li><li> <img width="200" height="200" src="/images/avatar.jpg"><p style="text-align:center;margin-bottom:0">微信公众号同步更新，欢迎关注~</p></li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/" rel="tag"># 问题排查</a> <a href="/tags/shell/" rel="tag"># shell</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-shell-sudo/" rel="prev" title="shell命令之sudo"><i class="fa fa-chevron-left"></i> shell命令之sudo</a></div><div class="post-nav-item"> <a href="/dev-shell-redirect/" rel="next" title="shell命令之重定向">shell命令之重定向<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3284447971731414" data-ad-slot="9697986181"></ins><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ssh%E7%AE%80%E4%BB%8B"><span class="nav-text">1. ssh简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85ssh-server"><span class="nav-text">2. 安装ssh server</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEssh-server"><span class="nav-text">3. 配置ssh server</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE"><span class="nav-text">3.1. 基础配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%99%BD%E5%90%8D%E5%8D%95%E9%85%8D%E7%BD%AE"><span class="nav-text">3.2. 白名单配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8ssh-client"><span class="nav-text">4. 使用ssh client</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ssh%E7%99%BB%E5%BD%95%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-text">4.1. ssh登录服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95ssh%E8%BF%9E%E6%8E%A5"><span class="nav-text">4.2. 测试ssh连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ssh%E6%89%A7%E8%A1%8C%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4"><span class="nav-text">4.3. ssh执行远程命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ssh%E6%89%B9%E9%87%8F%E6%89%A7%E8%A1%8C%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4"><span class="nav-text">4.4. ssh批量执行远程命令</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95"><span class="nav-text">5. 配置免密登录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E5%AF%86%E9%92%A5%E5%AF%B9"><span class="nav-text">5.1. 生成密钥对</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%85%AC%E9%92%A5%E5%88%B0%E8%BF%9C%E7%A8%8B%E6%9C%BA%E5%99%A8"><span class="nav-text">5.2. 添加公钥到远程机器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%86%E9%92%A5%E6%B7%BB%E5%8A%A0%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98"><span class="nav-text">5.3. 密钥添加失败问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95%E8%BF%9C%E7%A8%8B%E6%9C%BA%E5%99%A8"><span class="nav-text">5.4. 免密登录远程机器</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%88%AB%E5%90%8D%E7%99%BB%E5%BD%95"><span class="nav-text">6. 配置主机别名登录</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%94%A8%E6%88%B7%E5%8F%AA%E8%83%BD%E8%BF%90%E8%A1%8C%E7%89%B9%E5%AE%9A%E5%91%BD%E4%BB%A4"><span class="nav-text">7. 配置用户只能运行特定命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E5%91%BD%E4%BB%A4-%E8%84%9A%E6%9C%AC"><span class="nav-text">7.1. 运行命令&#x2F;脚本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E5%91%BD%E4%BB%A4-%E8%84%9A%E6%9C%AC-%E5%8F%82%E6%95%B0"><span class="nav-text">7.2. 运行命令&#x2F;脚本 + 参数</span></a></li></ol></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">一个计算机技术爱好者与学习者</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">699</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">248</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: '04e31b9f43d012ea71283379c56b5f15',
      title: 'shell命令之ssh',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>