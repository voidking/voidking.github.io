<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//qiniu.cdn.voidking.com/doc/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="Redis集群模式简介Redis集群是Redis的一种高可用解决方案，它通过在多个节点上分片存储数据，实现数据的高可用和扩展。Redis集群最初是在Redis 3.0版本中引入的。 Redis集群的节点由多个主节点和从节点组成，每个主节点都有多个从节点。集群中的每个节点都维护了整个集群的状态信息，节点之间通过Gossip协议进行通信，通过相互交换状态信息来保持集群中节点的一致性。Redis集群使用"><meta property="og:type" content="article"><meta property="og:title" content="Redis集群模式概述"><meta property="og:url" content="https://www.voidking.com/dev-redis-cluster/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="Redis集群模式简介Redis集群是Redis的一种高可用解决方案，它通过在多个节点上分片存储数据，实现数据的高可用和扩展。Redis集群最初是在Redis 3.0版本中引入的。 Redis集群的节点由多个主节点和从节点组成，每个主节点都有多个从节点。集群中的每个节点都维护了整个集群的状态信息，节点之间通过Gossip协议进行通信，通过相互交换状态信息来保持集群中节点的一致性。Redis集群使用"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2019-11-03T21:00:00.000Z"><meta property="article:modified_time" content="2023-08-12T08:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="chatgpt"><meta property="article:tag" content="docker"><meta property="article:tag" content="数据库"><meta property="article:tag" content="问题排查"><meta property="article:tag" content="redis"><meta property="article:tag" content="缓存"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-redis-cluster/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Redis集群模式概述 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">一个计算机技术爱好者与学习者</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-redis-cluster/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="一个计算机技术爱好者与学习者"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Redis集群模式概述</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-11-03 21:00:00" itemprop="dateCreated datePublished" datetime="2019-11-03T21:00:00+00:00">2019-11-03</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2023-08-12 08:00:00" itemprop="dateModified" datetime="2023-08-12T08:00:00+00:00">2023-08-12</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/database/" itemprop="url" rel="index"><span itemprop="name">database</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/cloudnative/" itemprop="url" rel="index"><span itemprop="name">cloudnative</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/troubleshooting/" itemprop="url" rel="index"><span itemprop="name">troubleshooting</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="Redis集群模式简介"><span class="post-title-index">1.</span><a href="#Redis集群模式简介" class="headerlink" title="Redis集群模式简介"></a> Redis集群模式简介</h1><p>Redis集群是Redis的一种高可用解决方案，它通过在多个节点上分片存储数据，实现数据的高可用和扩展。Redis集群最初是在Redis 3.0版本中引入的。</p><p>Redis集群的节点由多个主节点和从节点组成，每个主节点都有多个从节点。集群中的每个节点都维护了整个集群的状态信息，节点之间通过Gossip协议进行通信，通过相互交换状态信息来保持集群中节点的一致性。Redis集群使用的哈希槽（hash slot）将键映射到不同的节点，实现了数据的分布式存储。</p><p>Redis集群的优点包括：</p><ul><li>高可用：当集群中的某个节点故障时，集群仍然可以正常运行。</li><li>扩展性：Redis集群可以支持更多的数据和客户端请求，可以通过增加节点来实现横向扩展。</li><li>分布式：Redis集群可以将数据分散在不同的节点上，使得数据的读写负载得到了平衡，提高了Redis的性能。</li></ul><p>但是Redis集群也存在一些限制和注意事项，例如：</p><ul><li>Redis集群只能支持单个数据库空间，不能在不同节点之间存储不同的数据库。</li><li>Redis集群不支持事务嵌套和 Lua 脚本中的事务操作。</li><li>Redis集群使用的是哈希槽分片，因此在集群运行过程中，不能动态添加或删除哈希槽，否则会导致数据的迁移，对集群性能产生影响。</li></ul><p>在实际应用中，如果需要使用Redis集群，需要对集群中的节点进行适当的配置和调优，以确保集群的高可用性、性能和可靠性。</p><p>本节内容来自ChatGPT。</p><span id="more"></span><h1 id="Redis集群容错机制"><span class="post-title-index">2.</span><a href="#Redis集群容错机制" class="headerlink" title="Redis集群容错机制"></a> Redis集群容错机制</h1><p>Redis集群的节点由多个主节点和从节点组成，每个主节点都有多个从节点，从节点和主节点的数据一致。<br>从节点挂掉，不会影响redis集群数据的写入和读取，只会降低读取的性能和容错能力。从节点启动后会自动从主节点同步数据。<br>主节点挂掉，Redis集群会将该主节点的从节点切换为新的主节点（理论上会几秒内完成，实测三分钟没有等到切换，可能是配置问题），以保证数据可用性和一致性，在新的主节点选出来之前，集群写能力不可用。</p><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2225466">docker搭建3主3从redis集群(主从容错切换、主从扩容、主从缩容)</a></li><li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1796311">K8S部署Redis Cluster集群（三主三从模式）</a></li><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/dadonggg/p/8628735.html">redis集群节点宕机</a></li><li><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/638627">深入理解redis cluster的failover机制</a></li><li><a target="_blank" rel="noopener" href="http://www.redis.cn/commands/cluster-failover.html">CLUSTER FAILOVER</a></li><li><a target="_blank" rel="noopener" href="https://redis.io/docs/management/scaling/">Scaling with Redis Cluster</a></li><li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/section/1373996">腾讯云开发者社区 - cluster failover</a></li></ul><h1 id="Redis集群操作命令"><span class="post-title-index">3.</span><a href="#Redis集群操作命令" class="headerlink" title="Redis集群操作命令"></a> Redis集群操作命令</h1><p><code>cluster</code>命令查看和操作redis集群。<br>通过给定可选的参数 section ，可以让命令只返回某一部分的信息：</p><ul><li><code>cluster info</code>：打印redis集群的信息</li><li><code>cluster slots</code>：列出集群的槽信息</li><li><code>cluster nodes</code>：列出集群当前已知的所有节点（node），以及这些节点的相关信息</li><li><code>cluster meet &lt;ip&gt; &lt;port&gt;</code>：将 ip 和 port 所指定的节点添加到集群当中，让它成为集群的一份子</li><li><code>cluster forget &lt;node_id&gt;</code>：从集群中移除 node_id 指定的节点</li><li><code>cluster failover</code>：该命令只能在群集slave节点执行，让slave节点进行一次人工故障切换，成为master。切换过程中redis会阻塞请求（10s），切换完成再处理请求。</li></ul><h1 id="Redis集群重启"><span class="post-title-index">4.</span><a href="#Redis集群重启" class="headerlink" title="Redis集群重启"></a> Redis集群重启</h1><p>需求描述：<br>192.168.56.101-103 三台机器，使用7001和7002端口，搭建了redis集群。<br>现在想降低内存碎片率，因此计划对redis集群进行重启。</p><p>根据Redis集群容错机制，为了对上游调用的服务影响最小，重启流程如下：</p><p>1、查看主节点和从节点</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c -h 192.168.56.101 -p 7001 -a <span class="string">&#x27;xxx&#x27;</span> cluster nodes</span><br><span class="line">redis-cli --cluster check 192.168.56.101:7001 -a <span class="string">&#x27;xxx&#x27;</span></span><br></pre></td></tr></table></figure><p>其中<code>-c</code>参数的作用是启用集群模式，这样可以自动重定向到正确的节点。</p><p>查看到主节点和从节点，以及它们的对应关系。</p><p>2、挨个重启从节点（一个节点重启成功再进行下一个）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录192.168.56.101执行</span></span><br><span class="line">redis-cli -c -h 192.168.56.101 -p 7002 -a <span class="string">&#x27;xxx&#x27;</span> shutdown</span><br><span class="line">redis-server /path/to/conf/7002.conf</span><br><span class="line">redis-cli --cluster check 192.168.56.101:7002 -a <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录192.168.56.102执行</span></span><br><span class="line">redis-cli -c -h 192.168.56.102 -p 7002 -a <span class="string">&#x27;xxx&#x27;</span> shutdown</span><br><span class="line">redis-server /path/to/conf/7002.conf</span><br><span class="line">redis-cli --cluster check 192.168.56.102:7002 -a <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录192.168.56.103执行</span></span><br><span class="line">redis-cli -c -h 192.168.56.103 -p 7002 -a <span class="string">&#x27;xxx&#x27;</span> shutdown</span><br><span class="line">redis-server /path/to/conf/7002.conf</span><br><span class="line">redis-cli --cluster check 192.168.56.103:7002 -a <span class="string">&#x27;xxx&#x27;</span></span><br></pre></td></tr></table></figure><p>3、手动故障转移，从节点升级为主节点</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c -h 192.168.56.101 -p 7002 -a <span class="string">&#x27;xxx&#x27;</span> cluster failover TAKEOVER</span><br><span class="line">redis-cli -c -h 192.168.56.102 -p 7002 -a <span class="string">&#x27;xxx&#x27;</span> cluster failover TAKEOVER</span><br><span class="line">redis-cli -c -h 192.168.56.103 -p 7002 -a <span class="string">&#x27;xxx&#x27;</span> cluster failover TAKEOVER</span><br></pre></td></tr></table></figure><p>其中<code>TAKEOVER</code>可选，详情参考<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/section/1373996">腾讯云开发者社区 - cluster failover</a></p><p>4、挨个重启从节点（原本的主节点）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录192.168.56.101执行</span></span><br><span class="line">redis-cli -c -h 192.168.56.101 -p 7001 -a <span class="string">&#x27;xxx&#x27;</span> shutdown</span><br><span class="line">redis-server /path/to/conf/7001.conf</span><br><span class="line">redis-cli --cluster check 192.168.56.101:7001 -a <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录192.168.56.102执行</span></span><br><span class="line">redis-cli -c -h 192.168.56.102 -p 7001 -a <span class="string">&#x27;xxx&#x27;</span> shutdown</span><br><span class="line">redis-server /path/to/conf/7001.conf</span><br><span class="line">redis-cli --cluster check 192.168.56.102:7001 -a <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录192.168.56.103执行</span></span><br><span class="line">redis-cli -c -h 192.168.56.103 -p 7001 -a <span class="string">&#x27;xxx&#x27;</span> shutdown</span><br><span class="line">redis-server /path/to/conf/7001.conf</span><br><span class="line">redis-cli --cluster check 192.168.56.103:7001 -a <span class="string">&#x27;xxx&#x27;</span></span><br></pre></td></tr></table></figure><p>5、手动故障转移，从节点升级为主节点</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c -h 192.168.56.101 -p 7001 -a <span class="string">&#x27;xxx&#x27;</span> cluster failover TAKEOVER</span><br><span class="line">redis-cli -c -h 192.168.56.102 -p 7001 -a <span class="string">&#x27;xxx&#x27;</span> cluster failover TAKEOVER</span><br><span class="line">redis-cli -c -h 192.168.56.103 -p 7001 -a <span class="string">&#x27;xxx&#x27;</span> cluster failover TAKEOVER</span><br></pre></td></tr></table></figure><h1 id="节点不可用问题"><span class="post-title-index">5.</span><a href="#节点不可用问题" class="headerlink" title="节点不可用问题"></a> 节点不可用问题</h1><p>Redis集群模式，Java访问Redis集群报错：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">io.lettuce.core.RedisCommandExecutionException: CLUSTERDOWN The cluster is down</span><br></pre></td></tr></table></figure><p>排查方法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c -h 192.168.56.101 -p 7001 -a <span class="string">&#x27;xxx&#x27;</span> cluster nodes</span><br><span class="line">redis-cli --cluster check 192.168.56.101:7001 -a <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"><span class="comment"># yum install -y ruby</span></span><br><span class="line"><span class="comment"># cd redis-6.2.4/src</span></span><br><span class="line"><span class="comment"># ./redis-trib.rb check 192.168.56.101:7001 -a &#x27;xxx&#x27;</span></span><br></pre></td></tr></table></figure><p>发现报错：</p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ERR] Nodes don&#x27;t agree about configuration!</span><br><span class="line">&gt;&gt;&gt; Check <span class="keyword">for</span> open slots...</span><br><span class="line">[WARNING] Node <span class="number">192.168</span>.<span class="number">56.101</span>:<span class="number">7002</span> has slots <span class="keyword">in</span> importing <span class="keyword">state</span> ...</span><br></pre></td></tr></table></figure><p>这个报错实际上有两个问题：1）有一个节点报错ERR，处于不可用状态，经查是<code>192.168.56.103:7001</code>；2）<code>192.168.56.101:7002</code>节点有一些槽位处于导入状态还未完成。</p><p>对于<code>192.168.56.101:7002</code>，解决办法是重启redis节点。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c -h 192.168.56.101 -p 7002 -a <span class="string">&#x27;xxx&#x27;</span> shutdown</span><br><span class="line">redis-server /path/to/conf/7002.conf</span><br><span class="line">redis-cli --cluster check 192.168.56.101:7001 -a <span class="string">&#x27;xxx&#x27;</span></span><br></pre></td></tr></table></figure><p>重启成功。</p><p>对于<code>192.168.56.103:7001</code>，也是首先尝试重启redis节点。<br>重启失败，查看日志发现报错：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">15914:C 12 Aug 2023 19:07:36.383 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span><br><span class="line">15914:C 12 Aug 2023 19:07:36.383 # Redis version=6.2.4, bits=64, commit=00000000, modified=0, pid=15914, just started</span><br><span class="line">15914:C 12 Aug 2023 19:07:36.383 # Configuration loaded</span><br><span class="line">15914:M 12 Aug 2023 19:07:36.384 * monotonic clock: POSIX clock_gettime</span><br><span class="line">15914:M 12 Aug 2023 19:07:36.384 # Unrecoverable error: corrupted cluster config file.</span><br></pre></td></tr></table></figure><p>解决办法：删除数据目录中的文件，然后重新启动。</p><p>重新启动成功，但是该节点启动后独立了，不在原本的集群中，这时需要重新握手加入到集群。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster check 192.168.56.103:7002 -a <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">redis-cli -c -h 192.168.56.101 -p 7001 -a <span class="string">&#x27;xxx&#x27;</span> cluster meet 192.168.56.103 7002</span><br><span class="line">redis-cli --cluster check 192.168.56.103:7002 -a <span class="string">&#x27;xxx&#x27;</span></span><br></pre></td></tr></table></figure><p>参考文档：<a target="_blank" rel="noopener" href="https://blog.csdn.net/wgw_dream/article/details/83615503">Redis [ERR] Nodes don’t agree about configuration!</a></p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>原文链接：</strong> <a href="https://www.voidking.com/dev-redis-cluster/" title="Redis集群模式概述">https://www.voidking.com/dev-redis-cluster/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本文采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议，转载请注明出处！源站会即时更新知识点并修正错误，欢迎访问~</li><li> <img width="200" height="200" src="/images/avatar.jpg"><p style="text-align:center;margin-bottom:0">微信公众号同步更新，欢迎关注~</p></li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/chatgpt/" rel="tag"># chatgpt</a> <a href="/tags/docker/" rel="tag"># docker</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"># 数据库</a> <a href="/tags/%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/" rel="tag"># 问题排查</a> <a href="/tags/redis/" rel="tag"># redis</a> <a href="/tags/%E7%BC%93%E5%AD%98/" rel="tag"># 缓存</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-redis-start/" rel="prev" title="Redis入门篇"><i class="fa fa-chevron-left"></i> Redis入门篇</a></div><div class="post-nav-item"> <a href="/dev-redis-backup-and-recovery/" rel="next" title="Redis数据备份和恢复">Redis数据备份和恢复<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3284447971731414" data-ad-slot="9697986181"></ins><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E7%AE%80%E4%BB%8B"><span class="nav-text">1. Redis集群模式简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis%E9%9B%86%E7%BE%A4%E5%AE%B9%E9%94%99%E6%9C%BA%E5%88%B6"><span class="nav-text">2. Redis集群容错机制</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis%E9%9B%86%E7%BE%A4%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="nav-text">3. Redis集群操作命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis%E9%9B%86%E7%BE%A4%E9%87%8D%E5%90%AF"><span class="nav-text">4. Redis集群重启</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%8A%82%E7%82%B9%E4%B8%8D%E5%8F%AF%E7%94%A8%E9%97%AE%E9%A2%98"><span class="nav-text">5. 节点不可用问题</span></a></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">一个计算机技术爱好者与学习者</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">703</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">31</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">251</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: '298744712bb8c6e87d44226fe7aabc99',
      title: 'Redis集群模式概述',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>