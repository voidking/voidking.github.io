<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言《Django开发简单Blog系统》系列中，我们已经完成了一个迷你Web项目。那么，怎么把这个项目发布到线上呢？怎样给它一个域名呢？ 思路：nginx + uwsgi"><meta property="og:type" content="article"><meta property="og:title" content="Django部署到线上"><meta property="og:url" content="https://www.voidking.com/dev-django-deploy/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言《Django开发简单Blog系统》系列中，我们已经完成了一个迷你Web项目。那么，怎么把这个项目发布到线上呢？怎样给它一个域名呢？ 思路：nginx + uwsgi"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2017-12-06T09:00:00.000Z"><meta property="article:modified_time" content="2020-12-15T13:29:54.334Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="python"><meta property="article:tag" content="django"><meta property="article:tag" content="centos"><meta property="article:tag" content="supervisor"><meta property="article:tag" content="uwsgi"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-django-deploy/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Django部署到线上 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-django-deploy/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Django部署到线上</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2017-12-06 09:00:00" itemprop="dateCreated datePublished" datetime="2017-12-06T09:00:00+00:00">2017-12-06</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/" itemprop="url" rel="index"><span itemprop="name">专业</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E5%90%8E%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E5%90%8E%E7%AB%AF/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/centos/" itemprop="url" rel="index"><span itemprop="name">centos</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E5%90%8E%E7%AB%AF/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>《Django开发简单Blog系统》系列中，我们已经完成了一个迷你Web项目。那么，怎么把这个项目发布到线上呢？怎样给它一个域名呢？</p><p>思路：nginx + uwsgi</p><a id="more"></a><h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><h2 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h2><p>阿里云服务器，centos7系统。</p><h2 id="python"><a href="#python" class="headerlink" title="python"></a>python</h2><p>升级python到3.6.1，统一线上和本地python环境。</p><p>1、下载python3.6.1源码<br><code>wget https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tar.xz</code></p><p>2、解压源码</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">xz</span> <span class="selector-tag">-d</span> <span class="selector-tag">Python-3</span><span class="selector-class">.6</span><span class="selector-class">.1</span><span class="selector-class">.tar</span><span class="selector-class">.xz</span></span><br><span class="line"><span class="selector-tag">tar</span> <span class="selector-tag">-xvf</span> <span class="selector-tag">Python-3</span><span class="selector-class">.6</span><span class="selector-class">.1</span><span class="selector-class">.tar</span></span><br></pre></td></tr></table></figure><p>3、编译源码</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /usr/local/<span class="keyword">python3</span></span><br><span class="line"><span class="keyword">cd</span> Python-<span class="number">3.6</span>.<span class="number">1</span></span><br><span class="line">./configure --prefix=/usr/local/<span class="keyword">python3</span> --enable-optimizations</span><br><span class="line"><span class="keyword">make</span> &amp;&amp; <span class="keyword">make</span> install</span><br></pre></td></tr></table></figure><p>如果编译失败，需要先更新编译环境：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">gcc</span> <span class="string">-v </span></span><br><span class="line"><span class="meta">g++</span> <span class="string">-v</span></span><br><span class="line"></span><br><span class="line"><span class="attr">yum</span> <span class="string">install gcc</span></span><br><span class="line"><span class="attr">yum</span> <span class="string">install gcc-c++</span></span><br></pre></td></tr></table></figure><p>注：我的环境版本为 gcc version 4.8.5 20150623 (Red Hat 4.8.5-11) (GCC) 。</p><p>4、替换python</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> /usr/bin</span><br><span class="line">mv <span class="keyword">python</span> <span class="keyword">python</span>.bak</span><br><span class="line"><span class="keyword">ln</span> -s /usr/local/<span class="keyword">python3</span>/bin/<span class="keyword">python3</span>.<span class="number">6</span> /usr/bin/<span class="keyword">python</span></span><br><span class="line"><span class="keyword">ll</span> <span class="keyword">python</span>*</span><br><span class="line"><span class="keyword">python</span> -V</span><br></pre></td></tr></table></figure><p>5、解决遗留问题<br>所有python相关的应用，如果使用/usr/bin/python开头的脚本，替换为/usr/bin/python2.7。比如：</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="meta-keyword">/usr/</span>bin/yum</span><br><span class="line">vim <span class="meta-keyword">/usr/</span>libexec/urlgrabber-ext-down</span><br></pre></td></tr></table></figure><h2 id="uwsgi"><a href="#uwsgi" class="headerlink" title="uwsgi"></a>uwsgi</h2><p><code>pip install uwsgi</code></p><p>编写测试：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">application</span><span class="params">(env, start_response)</span></span><span class="symbol">:</span></span><br><span class="line">    start_response(<span class="string">'200 OK'</span>, [(<span class="string">'Content-Type'</span>,<span class="string">'text/html'</span>)])</span><br><span class="line">    <span class="keyword">return</span> [b<span class="string">"Hello World"</span>]</span><br></pre></td></tr></table></figure><p>启动测试：<br><code>uwsgi --http :8001 --wsgi-file test.py</code></p><p>报错：uwsgi: command not found，看来我们需要把python3/bin加入到path。<br><code>vim /etc/profile</code>，在文件最底部找到PATH，添加：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">:/usr/local/python3/bin</span></span><br></pre></td></tr></table></figure><p>使配置生效：<code>source /etc/profile</code></p><p>访问 <a href="http://ip:8001" target="_blank" rel="noopener">http://ip:8001</a> ，即可看到Hello World 。</p><h2 id="nginx和mysql"><a href="#nginx和mysql" class="headerlink" title="nginx和mysql"></a>nginx和mysql</h2><p>参考<a href="http://www.voidking.com/dev-centos-php-envirenment/">《在CentOS7上配置PHP运行环境》</a>，安装好了nginx和mysql。</p><h1 id="项目部署"><a href="#项目部署" class="headerlink" title="项目部署"></a>项目部署</h1><h2 id="代码准备"><a href="#代码准备" class="headerlink" title="代码准备"></a>代码准备</h2><p>1、克隆项目到服务器<br><code>git clone https://github.com/voidking/djsite.git</code></p><p>2、安装django<br><code>pip install django</code></p><p>3、安装pymysql<br><code>pip install pymysql</code></p><h2 id="数据库准备"><a href="#数据库准备" class="headerlink" title="数据库准备"></a>数据库准备</h2><p>1、创建数据库</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql -uroot -p</span></span><br><span class="line">mysql&gt; create database `djsite`<span class="built_in"> default </span>character <span class="builtin-name">set</span> utf8 collate utf8_general_ci; </span><br><span class="line">mysql&gt; exit;</span><br></pre></td></tr></table></figure><p>2、修改djsite/djsite/settings.py中的数据库配置<br><code>vim djsite/djsite/settings.py</code></p><p>3、创建表结构</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> makemigrations</span><br><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> migrate</span><br></pre></td></tr></table></figure><p>报错：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django.db.utils.InternalError: (1665, 'Cannot <span class="keyword">execute</span> <span class="keyword">statement</span>: impossible <span class="keyword">to</span> write <span class="keyword">to</span> <span class="built_in">binary</span> <span class="keyword">log</span> since BINLOG_FORMAT = <span class="keyword">STATEMENT</span> <span class="keyword">and</span> <span class="keyword">at</span> <span class="keyword">least</span> one <span class="keyword">table</span> uses a <span class="keyword">storage</span> <span class="keyword">engine</span> limited <span class="keyword">to</span> <span class="keyword">row</span>-based logging. <span class="keyword">InnoDB</span> <span class="keyword">is</span> limited <span class="keyword">to</span> <span class="keyword">row</span>-<span class="keyword">logging</span> <span class="keyword">when</span> <span class="keyword">transaction</span> <span class="keyword">isolation</span> <span class="keyword">level</span> <span class="keyword">is</span> <span class="keyword">READ</span> COMMITTED <span class="keyword">or</span> <span class="keyword">READ</span> UNCOMMITTED.<span class="string">')</span></span><br></pre></td></tr></table></figure><p>修改mysql的binlog格式为混合模式：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql -uroot -p</span></span><br><span class="line">mysql&gt; <span class="builtin-name">set</span> global <span class="attribute">binlog_format</span>=mixed;</span><br></pre></td></tr></table></figure><p>删除数据库djsite中的所有表，然后再次执行：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> migrate</span><br></pre></td></tr></table></figure><h1 id="启动项目"><a href="#启动项目" class="headerlink" title="启动项目"></a>启动项目</h1><h2 id="数据库问题"><a href="#数据库问题" class="headerlink" title="数据库问题"></a>数据库问题</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> djsite</span><br><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> runserver</span><br></pre></td></tr></table></figure><p>报错：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">File</span> <span class="string">"/usr/local/python3/lib/python3.6/site-packages/django/db/backends/mysql/base.py"</span><span class="string">,</span> <span class="string">line</span> <span class="number">36</span><span class="string">,</span> <span class="string">in</span> <span class="string">&lt;module&gt;</span></span><br><span class="line">    <span class="string">raise</span> <span class="string">ImproperlyConfigured("mysqlclient</span> <span class="number">1.3</span><span class="number">.3</span> <span class="string">or</span> <span class="string">newer</span> <span class="string">is</span> <span class="string">required;</span> <span class="string">you</span> <span class="string">have</span> <span class="string">%s"</span> <span class="string">%</span> <span class="string">Database.__version__)</span></span><br><span class="line"><span class="attr">django.core.exceptions.ImproperlyConfigured:</span> <span class="string">mysqlclient</span> <span class="number">1.3</span><span class="number">.3</span> <span class="string">or</span> <span class="string">newer</span> <span class="string">is</span> <span class="string">required;</span> <span class="string">you</span> <span class="string">have</span> <span class="number">0.7</span><span class="number">.11</span><span class="string">.None</span></span><br></pre></td></tr></table></figure><p>解决办法：</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/python3/<span class="class"><span class="keyword">lib</span>/<span class="title">python3</span>.6/<span class="title">site</span>-<span class="title">packages</span>/<span class="title">django</span>/<span class="title">db</span>/<span class="title">backends</span>/<span class="title">mysql</span>/<span class="title">base</span>.<span class="title">py</span></span></span><br></pre></td></tr></table></figure><p>进入vim命令模式，输入<code>/version</code>，按N查找下一个，找到：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">version</span> &lt; (<span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>):</span><br><span class="line">    <span class="keyword">raise</span> ImproperlyConfigured("mysqlclient 1.3.3 or newer is required; you have %s" % <span class="keyword">Database</span>.__version__)</span><br></pre></td></tr></table></figure><p>注释掉它，问题解决。</p><h2 id="url问题"><a href="#url问题" class="headerlink" title="url问题"></a>url问题</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> djsite</span><br><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> runserver</span><br></pre></td></tr></table></figure><p>再次报错：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">File <span class="string">"/root/djsite/djsite/urls.py"</span>, <span class="built_in">line</span> <span class="number">21</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    url(r<span class="string">'^blog/'</span>, <span class="built_in">include</span>(<span class="string">'blog.urls'</span>, namespace=<span class="string">'blog'</span>)),</span><br><span class="line">  File <span class="string">"/usr/local/python3/lib/python3.6/site-packages/django/urls/conf.py"</span>, <span class="built_in">line</span> <span class="number">39</span>, <span class="keyword">in</span> <span class="built_in">include</span></span><br><span class="line">    <span class="string">'Specifying a namespace in include() without providing an app_name '</span></span><br><span class="line">django.core.exceptions.ImproperlyConfigured: Specifying <span class="keyword">a</span> namespace <span class="keyword">in</span> <span class="built_in">include</span>() <span class="keyword">without</span> providing <span class="keyword">an</span> app_name is <span class="keyword">not</span> supported. Set <span class="keyword">the</span> app_name attribute <span class="keyword">in</span> <span class="keyword">the</span> included module, <span class="keyword">or</span> pass <span class="keyword">a</span> <span class="number">2</span>-tuple containing <span class="keyword">the</span> list <span class="keyword">of</span> patterns <span class="keyword">and</span> app_name instead.</span><br></pre></td></tr></table></figure><p>解决办法：</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/python3/<span class="class"><span class="keyword">lib</span>/<span class="title">python3</span>.6/<span class="title">site</span>-<span class="title">packages</span>/<span class="title">django</span>/<span class="title">urls</span>/<span class="title">conf</span>.<span class="title">py</span></span></span><br></pre></td></tr></table></figure><p>找到：</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">namespace</span> <span class="keyword">and</span> <span class="keyword">not</span> app_name:</span><br><span class="line">    raise ImproperlyConfigured(</span><br><span class="line">        <span class="comment">'Specifying a namespace in include() without providing an app_name '</span></span><br><span class="line">        <span class="comment">'is not supported. Set the app_name attribute in the included '</span></span><br><span class="line">        <span class="comment">'module, or pass a 2-tuple containing the list of patterns and '</span></span><br><span class="line">        <span class="comment">'app_name instead.',</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure><p>注释掉它，问题解决。</p><h2 id="查看效果"><a href="#查看效果" class="headerlink" title="查看效果"></a>查看效果</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> djsite</span><br><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> runserver</span><br></pre></td></tr></table></figure><p>启动成功，在服务器上测试访问：<br><code>curl localhost:8000/blog/index</code></p><p>使用浏览器查看 <a href="http://ip:8000/blog/index" target="_blank" rel="noopener">http://ip:8000/blog/index</a> ，却无法访问。这是因为在settings.py中，ALLOWED_HOSTS的配置为：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ALLOWED_HOSTS</span> = []</span><br></pre></td></tr></table></figure><p><a href="https://docs.djangoproject.com/en/1.11/ref/settings/" target="_blank" rel="noopener">官方文档</a>说：</p><blockquote><p>When DEBUG is True and ALLOWED_HOSTS is empty, the host is validated against [‘localhost’, ‘127.0.0.1’, ‘[::1]’].</p></blockquote><p>修改ALLOWED_HOSTS的配置为：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ALLOWED_HOSTS</span> = [<span class="string">'*'</span>]</span><br></pre></td></tr></table></figure><p>然后启动命令改为：<code>python manage.py runserver 0.0.0.0:8000</code>，此时即可在浏览器看到部署好的项目。</p><p>如果还是不能访问，尝试先关闭防火墙：<code>systemctl stop firewalld</code></p><h1 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h1><p>1、首先，在万网上配置域名解析，添加A记录，解析到阿里云服务器IP。假设解析好的域名为django.voidking.com。</p><p>2、在nginx的vhost中，添加django.voidking.com.conf，内容为：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> django.voidking.com;</span><br><span class="line">    <span class="attribute">charset</span> utf-<span class="number">8</span>;</span><br><span class="line">    <span class="attribute">location</span> /&#123;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>   Host             <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>   X-Real-IP        <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>  X-Forwarded-For  <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">client_max_body_size</span>       <span class="number">1024m</span>;</span><br><span class="line">        <span class="attribute">client_body_buffer_size</span>    <span class="number">128k</span>;</span><br><span class="line">        <span class="attribute">client_body_temp_path</span>      data/client_body_temp;</span><br><span class="line">        <span class="attribute">proxy_connect_timeout</span>      <span class="number">90</span>;</span><br><span class="line">        <span class="attribute">proxy_send_timeout</span>         <span class="number">90</span>;</span><br><span class="line">        <span class="attribute">proxy_read_timeout</span>         <span class="number">90</span>;</span><br><span class="line">        <span class="attribute">proxy_buffer_size</span>          <span class="number">4k</span>;</span><br><span class="line">        <span class="attribute">proxy_buffers</span>              <span class="number">4</span> <span class="number">32k</span>;</span><br><span class="line">        <span class="attribute">proxy_busy_buffers_size</span>    <span class="number">64k</span>;</span><br><span class="line">        <span class="attribute">proxy_temp_file_write_size</span> <span class="number">64k</span>;</span><br><span class="line">        <span class="attribute">proxy_temp_path</span>            data/proxy_temp;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:8000;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3、重启nginx，<code>./nginx -s reload</code></p><p>4、测试访问<br>服务器：<code>curl django.voidking.com/blog/index</code><br>本地浏览器：<a href="http://django.voidking.com/blog/index" target="_blank" rel="noopener">http://django.voidking.com/blog/index</a></p><p>至此，django项目已经部署成功，没有用到uwsgi。如果给django添加守护进程，那么我们的部署就接近完美了。那么，uwsgi又能干什么呢，我们继续研究。</p><h1 id="uwsgi-1"><a href="#uwsgi-1" class="headerlink" title="uwsgi"></a>uwsgi</h1><h2 id="一般启动"><a href="#一般启动" class="headerlink" title="一般启动"></a>一般启动</h2><p>1、编写wsgi.py文件<br>编写django_wsgi.py文件，将其放在与文件manage.py同一个目录下。</p><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env python</span></span><br><span class="line"># coding: utf-<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os,django</span><br><span class="line">from django.core.handlers.wsgi <span class="keyword">import</span> WSGIHandler</span><br><span class="line"></span><br><span class="line">os.environ.setdefault(<span class="string">"DJANGO_SETTINGS_MODULE"</span>, <span class="string">"djsite.settings"</span>)</span><br><span class="line">django.setup()</span><br><span class="line">application = WSGIHandler()</span><br></pre></td></tr></table></figure><p>2、启动项目<br><code>uwsgi --http :8000 --chdir ~/djsite/ --module django_wsgi</code></p><p>3、查看启动结果<br><code>lsof -i :8000</code>，<code>ps aux | grep uwsgi</code></p><p>4、测试访问<br><a href="http://ip:8000/blog/index" target="_blank" rel="noopener">http://ip:8000/blog/index</a><br>此时，页面是没有样式的，也就是说静态资源加载失败。</p><p>5、配置静态资源<br><code>uwsgi --http :8000 --chdir ~/djsite/ --module django_wsgi --static-map=/static=static</code><br>此时，页面样式就正常了。</p><h2 id="高级启动"><a href="#高级启动" class="headerlink" title="高级启动"></a>高级启动</h2><p>1、新建uwsgi.ini，与manage.py在同一级目录。</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[uwsgi]</span></span><br><span class="line"><span class="attr">http</span> = :<span class="number">8000</span></span><br><span class="line"><span class="attr">chdir</span> = /root/djsite/</span><br><span class="line"><span class="attr">wsgi-file</span> = django_wsgi.py</span><br><span class="line"><span class="attr">static-map</span> = <span class="string">'/static=static'</span></span><br></pre></td></tr></table></figure><p>2、启动uwsgi<br><code>uwsgi uwsgi.ini</code></p><p>3、测试访问<br><a href="http://ip:8000/blog/index" target="_blank" rel="noopener">http://ip:8000/blog/index</a></p><h1 id="守护进程"><a href="#守护进程" class="headerlink" title="守护进程"></a>守护进程</h1><h2 id="安装supervisor"><a href="#安装supervisor" class="headerlink" title="安装supervisor"></a>安装supervisor</h2><p>关闭shell后，uwsgi服务就很快关闭了。为了让它后台运行，需要让它变成守护进程。<br>参考<a href="https://www.voidking.com/dev-centos-supervisor/">《CentOS安装配置Supervisor》</a>，安装配置好supervisor。</p><h2 id="守护uwsgi"><a href="#守护uwsgi" class="headerlink" title="守护uwsgi"></a>守护uwsgi</h2><p>1、在/etc/supervisor中新建djsite.conf文件：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[program:djsite]</span></span><br><span class="line"><span class="attr">command</span>=/usr/local/python3/bin/uwsgi --http :<span class="number">8000</span> --chdir /root/djsite/ --module django_wsgi --static-map=/static=static</span><br><span class="line"><span class="attr">directory</span>=/root/djsite/</span><br><span class="line"><span class="attr">startsecs</span>=<span class="number">0</span></span><br><span class="line"><span class="attr">stopwaitsecs</span>=<span class="number">0</span></span><br><span class="line"><span class="attr">autostart</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">autorestart</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>2、重启supervisor</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="literal">stop</span> supervisord</span><br><span class="line">systemctl <span class="literal">start</span> supervisord</span><br></pre></td></tr></table></figure><p>附：重启djsite命令</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl -c <span class="regexp">/etc/</span>supervisord.conf restart djsite</span><br></pre></td></tr></table></figure><p>3、测试访问<br><a href="http://ip:8000/blog/index" target="_blank" rel="noopener">http://ip:8000/blog/index</a><br>页面显示正常，至此守护进程配置成功。</p><p>4、退出supervisor环境<br><code>source deactivate</code>，守护进程并没有受到影响。</p><h1 id="nginx-uwsgi"><a href="#nginx-uwsgi" class="headerlink" title="nginx+uwsgi"></a>nginx+uwsgi</h1><p>以上，我们的djsite项目已经通过uwsgi方式启动起来，并且可以保持后台运行。nginx配置不改变的情况下，我们可以正常访问 <a href="http://django.voidking.com/blog/index" target="_blank" rel="noopener">http://django.voidking.com/blog/index</a> 。此时，nginx作为反向代理，和uwsgi间通过http交互。</p><p>接下来，就配置下nginx和uwsgi通过socket结合的方式。原理：用户发送http请求到nginx，nginx通过socket把请求交给uwsgi，uwsgi拿到django的处理结果，通过socket返还给nginx，nginx通过http返回结果给用户。</p><p>1、因为nginx和uwsgi通过socket方式交互，我们需要修改uwsgi.ini的配置为：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[uwsgi]</span></span><br><span class="line"><span class="attr">socket</span> = :<span class="number">8000</span></span><br><span class="line"><span class="attr">chdir</span> = /root/djsite/</span><br><span class="line"><span class="attr">wsgi-file</span> = django_wsgi.py</span><br><span class="line"><span class="attr">static-map</span> = <span class="string">'/static=static'</span></span><br><span class="line"><span class="attr">master</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">processes</span> = <span class="number">2</span></span><br><span class="line"><span class="attr">enable-threads</span> = <span class="literal">true</span></span><br><span class="line"><span class="comment"># daemonize = /root/djsite/uwsgi.log</span></span><br></pre></td></tr></table></figure><p>2、<code>/etc/supervisor/djsite.conf</code>，修改为</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[program:djsite]<span class="attribute">command</span>=/usr/local/python3/bin/uwsgi uwsgi.ini</span><br><span class="line"><span class="attribute">directory</span>=/root/djsite/</span><br><span class="line"><span class="attribute">startsecs</span>=0</span><br><span class="line"><span class="attribute">stopwaitsecs</span>=0</span><br><span class="line"><span class="attribute">autostart</span>=<span class="literal">true</span></span><br><span class="line"><span class="attribute">autorestart</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>3、重启supervisor<br><code>systemctl stop supervisord</code><br><code>systemctl start supervisord</code></p><p>4、修改nginx配置djsite.voidking.com.conf：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>      <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> djsite.voidking.com;</span><br><span class="line">    <span class="attribute">charset</span>     utf-<span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">uwsgi_pass</span>     <span class="number">127.0.0.1:8000</span>;</span><br><span class="line">        <span class="attribute">include</span>        uwsgi_params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /static &#123;</span><br><span class="line">        <span class="attribute">alias</span> /root/djsite/static;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5、重启nginx<br><code>./nginx -s reload</code></p><p>6、测试访问<br>此时，访问 <a href="http://ip:8000/blog/index" target="_blank" rel="noopener">http://ip:8000/blog/index</a> 失败，访问 <a href="http://django.voidking.com/blog/index" target="_blank" rel="noopener">http://django.voidking.com/blog/index</a> 正常。因为8000端口不再提供http服务，而是一个和nginx连接的socket。</p><p>7、static<br>请问，此时的静态资源，是通过uwsgi获取的？还是通过nginx直接获取的？做一个测试即可，修改uwsgi为：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[uwsgi]</span></span><br><span class="line"><span class="attr">socket</span> = :<span class="number">8000</span></span><br><span class="line"><span class="attr">chdir</span> = /root/djsite/</span><br><span class="line"><span class="attr">wsgi-file</span> = django_wsgi.py</span><br><span class="line"><span class="comment"># static-map = '/static=static'</span></span><br><span class="line"><span class="attr">master</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">processes</span> = <span class="number">2</span></span><br><span class="line"><span class="attr">enable-threads</span> = <span class="literal">true</span></span><br><span class="line"><span class="comment"># daemonize = /root/djsite/uwsgi.log</span></span><br></pre></td></tr></table></figure><p>此时，uwsgi不再提供静态资源。重启supervisor，页面样式正常，可见，静态资源是通过nginx获取的。之所以可以获取到，是因为我们之前在djsite/settings.py中配置了：</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">STATICFILES_DIRS = (</span><br><span class="line">    os.path.join(<span class="name">BASE_DIR</span>, <span class="string">"static"</span>),</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>至此，django部署完毕，我们实现了三种部署方法：</p><ul><li>nginx + django（http方式）</li><li>nginx + uwsgi（http方式）</li><li>nginx + uwsgi（socket方式）</li></ul><p>在此过程中，解决了一些奇怪的bug，学习了升级python的方法，学习了使用pyenv安装多版本python的方法（类似的还有anaconda），学习了给django或者uwsgi添加守护进程的方法，收获颇丰。</p><h1 id="书签"><a href="#书签" class="headerlink" title="书签"></a>书签</h1><p><a href="http://python.jobbole.com/85489/" target="_blank" rel="noopener">Python Web部署方式总结</a></p><p><a href="http://geek.csdn.net/news/detail/114808" target="_blank" rel="noopener">Python网络框架——Web服务器</a></p><p><a href="http://blog.csdn.net/nghuyong/article/details/54025761" target="_blank" rel="noopener">Django在生产环境中的部署</a></p><p><a href="https://code.ziqiangxuetang.com/django/django-nginx-deploy.html" target="_blank" rel="noopener">Django 部署(Nginx)</a></p><p><a href="http://ovwane.me/%E4%BD%BF%E7%94%A8Supervisor%E7%AE%A1%E7%90%86SpiderKeeper%E5%92%8CScrapyd/" target="_blank" rel="noopener">使用Supervisor管理SpiderKeeper和Scrapyd</a></p><p><a href="http://uwsgi-docs-zh.readthedocs.io/zh_CN/latest/StaticFiles.html" target="_blank" rel="noopener">使用uWSGI提供静态文件 (更新至1.9)</a></p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/python/" rel="tag"># python</a> <a href="/tags/django/" rel="tag"># django</a> <a href="/tags/centos/" rel="tag"># centos</a> <a href="/tags/supervisor/" rel="tag"># supervisor</a> <a href="/tags/uwsgi/" rel="tag"># uwsgi</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-django-blog-2/" rel="prev" title="Django开发简单Blog系统——下"><i class="fa fa-chevron-left"></i> Django开发简单Blog系统——下</a></div><div class="post-nav-item"> <a href="/dev-hadoop-hive-on-centos/" rel="next" title="在CentOS7上安装Hadoop和Hive">在CentOS7上安装Hadoop和Hive<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#环境准备"><span class="nav-number">2.</span> <span class="nav-text">环境准备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#服务器"><span class="nav-number">2.1.</span> <span class="nav-text">服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python"><span class="nav-number">2.2.</span> <span class="nav-text">python</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#uwsgi"><span class="nav-number">2.3.</span> <span class="nav-text">uwsgi</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nginx和mysql"><span class="nav-number">2.4.</span> <span class="nav-text">nginx和mysql</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#项目部署"><span class="nav-number">3.</span> <span class="nav-text">项目部署</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#代码准备"><span class="nav-number">3.1.</span> <span class="nav-text">代码准备</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库准备"><span class="nav-number">3.2.</span> <span class="nav-text">数据库准备</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#启动项目"><span class="nav-number">4.</span> <span class="nav-text">启动项目</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库问题"><span class="nav-number">4.1.</span> <span class="nav-text">数据库问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#url问题"><span class="nav-number">4.2.</span> <span class="nav-text">url问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看效果"><span class="nav-number">4.3.</span> <span class="nav-text">查看效果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nginx配置"><span class="nav-number">5.</span> <span class="nav-text">nginx配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#uwsgi-1"><span class="nav-number">6.</span> <span class="nav-text">uwsgi</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一般启动"><span class="nav-number">6.1.</span> <span class="nav-text">一般启动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#高级启动"><span class="nav-number">6.2.</span> <span class="nav-text">高级启动</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#守护进程"><span class="nav-number">7.</span> <span class="nav-text">守护进程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#安装supervisor"><span class="nav-number">7.1.</span> <span class="nav-text">安装supervisor</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#守护uwsgi"><span class="nav-number">7.2.</span> <span class="nav-text">守护uwsgi</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nginx-uwsgi"><span class="nav-number">8.</span> <span class="nav-text">nginx+uwsgi</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#小结"><span class="nav-number">9.</span> <span class="nav-text">小结</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#书签"><span class="nav-number">10.</span> <span class="nav-text">书签</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">613</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">49</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">194</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://www.beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>