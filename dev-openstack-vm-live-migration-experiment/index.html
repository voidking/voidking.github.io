<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.voidking.com/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言《虚拟机在线迁移的性能统计》解决了性能统计的问题，《虚拟机在线迁移过程中的故障注入》解决了环境模拟的问题。接下来我们进行一些虚拟机迁移实验，收集不同环境下迁移过程中产生的性能统计数据。 共享存储和非共享存储的虚拟机迁移，性能差别很大。本次实验，在共享存储的条件下进行。对于非共享存储的虚拟机迁移实验，放在其他文章中记录。"><meta property="og:type" content="article"><meta property="og:title" content="虚拟机在线迁移实验"><meta property="og:url" content="https://www.voidking.com/dev-openstack-vm-live-migration-experiment/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言《虚拟机在线迁移的性能统计》解决了性能统计的问题，《虚拟机在线迁移过程中的故障注入》解决了环境模拟的问题。接下来我们进行一些虚拟机迁移实验，收集不同环境下迁移过程中产生的性能统计数据。 共享存储和非共享存储的虚拟机迁移，性能差别很大。本次实验，在共享存储的条件下进行。对于非共享存储的虚拟机迁移实验，放在其他文章中记录。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2018-11-22T09:30:00.000Z"><meta property="article:modified_time" content="2018-11-22T09:30:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="docker"><meta property="article:tag" content="linux"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="openstack"><meta property="article:tag" content="测试"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-openstack-vm-live-migration-experiment/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>虚拟机在线迁移实验 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-openstack-vm-live-migration-experiment/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> 虚拟机在线迁移实验</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-11-22 09:30:00" itemprop="dateCreated datePublished" datetime="2018-11-22T09:30:00+00:00">2018-11-22</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/testing/" itemprop="url" rel="index"><span itemprop="name">testing</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><a href="https://www.voidking.com/dev-openstack-vm-live-migration-performance/">《虚拟机在线迁移的性能统计》</a>解决了性能统计的问题，<a href="https://www.voidking.com/dev-openstack-vm-live-migration-fault-injection/">《虚拟机在线迁移过程中的故障注入》</a>解决了环境模拟的问题。接下来我们进行一些虚拟机迁移实验，收集不同环境下迁移过程中产生的性能统计数据。</p><p>共享存储和非共享存储的虚拟机迁移，性能差别很大。本次实验，在共享存储的条件下进行。对于非共享存储的虚拟机迁移实验，放在其他文章中记录。</p><span id="more"></span><h1 id="实例准备"><a href="#实例准备" class="headerlink" title="实例准备"></a>实例准备</h1><p><a href="https://www.voidking.com/dev-openstack-vm-block-live-migration/">《OpenStack中虚拟机的在线迁移》</a>和<a href="https://www.voidking.com/dev-openstack-vm-live-migration/">《OpenStack中共享存储的虚拟机在线迁移》</a>两篇文章中，使用cirros作为迁移对象；本次实验中，使用ubuntu16作为迁移对象，因为这样可以更方便地注入故障，实例创建参考<a href="https://www.voidking.com/dev-openstack-add-mirror/">《OpenStack添加镜像》</a>和<a href="https://www.voidking.com/dev-ubuntu16-manual-openstack-instance/">《Ubuntu16手动安装OpenStack——创建实例》</a>。</p><p>1、在horizon控制台，项目，计算，镜像。使用xenial-server-cloudimg-amd64-disk1.img镜像创建ubuntu16的镜像模板。</p><p>2、使用ubuntu16的镜像模板创建实例ubuntu0，实例类型选择m1.small，配置为1核2G内存20G存储。</p><p>3、创建成功后，分配浮动IP。本次分配的浮动IP为10.0.2.154。</p><p>4、登录ubuntu0实例，安装stress-ng，方便接下来的实验。</p><h1 id="正常虚拟机迁移"><a href="#正常虚拟机迁移" class="headerlink" title="正常虚拟机迁移"></a>正常虚拟机迁移</h1><p>1、controller节点ping实例并记录<br><code>sudo ping 10.0.2.154 -i 0.01 &gt;&gt; ping.log</code></p><p>2、在compute和compute2节点，都启动iptraf，监听49152 to 49261。</p><p>3、在控制节点执行迁移命令<br><code>nova live-migration ubuntu0 compute2</code></p><p>4、查看是否迁移完成<br><code>nova show ubuntu0</code></p><p>5、迁移完成后进行统计。<br>（1）在compute节点执行time.sh，得到总的迁移时间，22s。<br>（2）在controller执行downtime.sh，计算downtime，6.28s。<br>（3）根据iptraf的监听结果，得到迁出和迁入的数据量，283M，248M。</p><p>downtime不合理！为什么这么久？理论上是毫秒级的哇！参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/ChrisYoung95/article/details/83273564">《详解openstack下热迁移机制》</a>，发现OpenStack可以进行迁移的参数设置，downtime可以进行调节。<br>查看迁移日志：<br><code>grep downtime /var/lib/docker/volumes/kolla_logs/_data/nova/nova-compute.log</code><br>发现日志中显示的downtime都是固定的50ms，每次迁移只有一次停机。感觉挺复杂的样子，先不管它，按照默认设置来实验吧。</p><h1 id="取消迁移"><a href="#取消迁移" class="headerlink" title="取消迁移"></a>取消迁移</h1><p>如果虚拟机迁移失败，可以取消迁移。</p><p>1、查看迁移任务<br><code>nova server-migration-list ubuntu0</code><br>该命令查看到迁移任务的ID为12。</p><p>2、查看迁移过程<br><code>nova server-migration-show ubuntu0 12</code></p><p>3、取消迁移<br><code>nova live-migration-abort ubuntu0 12</code></p><h1 id="CPU故障"><a href="#CPU故障" class="headerlink" title="CPU故障"></a>CPU故障</h1><p>1、在ubuntu0实例中创建一个CPU进程，CPU占用率10%<br><code>stress-ng -c 1 -l 10</code><br>使用<code>top</code>可以看到，CPU占用率不稳定，stress-ng进程偶尔跳到最高，占用率10%到90%不等。</p><p>2、实例迁移，得到总的迁移时间，34s。</p><p>3、设置CPU占用率分别为20%、30%到100%，统计结果如下：</p><p>| CPU占用率 | 迁移时间 | 停机时间 | 迁出数据量 | 迁入数据量 |<br>| —– | —– | —– | —– | —– | —– |<br>| 0% | 18s | 6.28s | 283M | 248M |<br>| 10% | 20s | 6.53s | 353M | 341M |<br>| 20% | 19s | 4.52s | 323M | 300M |<br>| 30% | 20s | 4.58s | 354M | 338M |<br>| 40% | 21s | 4.62s | 336M | 347M |<br>| 50% | 20s | 5.41s | 355M | 323M |<br>| 60% | 19s | 4.54s | 303M | 309M |<br>| 70% | 21s | 5.24s | 356M | 355M |<br>| 80% | 19s | 4.41s | 351M | 338M |<br>| 90% | 17s | 7.31s | 328M | 362M |<br>| 99% | 19s | 5.77s | 351M | 348M |</p><h1 id="内存故障"><a href="#内存故障" class="headerlink" title="内存故障"></a>内存故障</h1><p>1、在实例中创建一个100M的内存进程<br><code>stress-ng --vm 1 --vm-bytes 100M --vm-keep</code><br>使用<code>free -h</code>，可以看到内存被使用掉了100M。</p><p>2、虚拟机迁移，得到总的迁移时间，22s。</p><p>3、设置内存进程分别占用300M、600M到1.5G，统计结果如下：</p><p>| 内存占用 | 迁移时间 | 停机时间 | 迁出数据量 | 迁入数据量 |<br>| —– | —– | —– | —– | —– | —– |<br>| 100M | 22s | 7.63s | 501M | 653M |<br>| 300M | 29s | 7.88s | 1238M | 1159M |<br>| 600M | 26s | 7.72s | 1341M | 1279M |<br>| 900M | 78s | 8.31s | 5572M | 6155M |<br>| 1200M | 92s | 8.14s | 8208M | 8070M |<br>| 1500M | 102s | 8.47s | 8396M | 9088M |</p><h1 id="IO故障"><a href="#IO故障" class="headerlink" title="IO故障"></a>IO故障</h1><p>1、在实例中创建一个IO进程<br><code>stress-ng --io 1</code><br>使用<code>iostat -d -k 2</code>查看IO状态，发现tps稳定在200以上，而磁盘读写都为0。使用<code>top</code>命令可以看到，CPU占用率很高，在90%上下。</p><p>2、在实例中创建1-10个IO进程，统计结果如下：</p><p>| IO进程数 | 迁移时间 | 停机时间 | 迁出数据量 | 迁入数据量 |<br>| —– | —– | —– | —– | —– | —– |<br>| 1 | 37s | 7.59s | 2067M | 1954M |<br>| 2 | 40s | 6.83s | 2032M | 2007M |<br>| 3 | 36s | 7.04s | 2071M | 1788M |<br>| 4 | 36s | 8.08s | 1846M | 1969M |<br>| 5 | 36s | 6.02s | 2074M | 2012M |<br>| 6 | 35s | 7.44s | 1805M | 2032M |<br>| 7 | 36s | 5.64s | 2066M | 2010M |<br>| 8 | 36s | 8.60s | 1972M | 1987M |<br>| 9 | 34s | 10.95s | 2064M | 1880M |<br>| 10 | 36s | 7.02s | 1865M | 1981M |</p><h1 id="磁盘故障"><a href="#磁盘故障" class="headerlink" title="磁盘故障"></a>磁盘故障</h1><p>1、在虚拟机中创建一个写入进程<br><code>stress-ng -d 1</code><br>使用<code>iostat -d -k 2</code>查看IO状态，发现tps在30上下，kB_wrtn/s在30000上下。使用<code>top</code>命令可以看到，CPU占用率在25%到99%浮动。</p><p>2、在实例中创建1-10个写入进程，统计结果如下：</p><p>| 写入进程数 | 迁移时间 | 停机时间 | 迁出数据量 | 迁入数据量 |<br>| —– | —– | —– | —– | —– | —– |<br>| 1 | 35s | 4.83s | 2059M | 2023M |<br>| 2 | 37s | 8.70s | 1874M | 1957M |<br>| 3 | 34s | 8.92s | 2055M | 1980M |<br>| 4 | 36s | 4.97s | 2024M | 1959M |<br>| 5 | 36s | 5.50s | 2055M | 1960M |<br>| 6 | 35s | 4.64s | 2025M | 1957M |<br>| 7 | 34s | 6.02s | 2055M | 2041M |<br>| 8 | 43s | 9.11s | 2009M | 1978M |<br>| 9 | 35s | 6.60s | 2069M | 1997M |<br>| 10 | 34s | 8.89s | 1931M | 1942M |</p><h1 id="网络延迟"><a href="#网络延迟" class="headerlink" title="网络延迟"></a>网络延迟</h1><p>1、在compute节点（迁出节点）添加网络延迟10ms<br><code>tc qdisc add dev eth0 root netem delay 10ms</code><br>注：原本的延迟在0.5ms上下。</p><p>2、将网络延迟修改为20ms-100ms<br><code>tc qdisc replace dev eth0 root netem delay 20ms</code></p><p>统计结果如下：</p><p>| 延迟时间 | 迁移时间 | 停机时间 | 迁出数据量 | 迁入数据量 |<br>| —– | —– | —– | —– | —– | —– |<br>| 10ms | 28s | 10.43s | 325M | 307M |<br>| 20ms | 36s | 8.80s | 305M | 287M |<br>| 30ms | 38s | 5.73s | 344M | 305M |<br>| 40ms | 43s | 11.28s | 305M | 290M |<br>| 50ms | 44s | 6.81s | 240M | 292M |<br>| 60ms | 47s | 7.09s | 256M | 295M |<br>| 70ms | 52s | 14.48s | 303M | 292M |<br>| 80ms | 50s | 12.17s | 242M | 297M |<br>| 90ms | 51s | 11.37s | 249M | 297M |<br>| 100ms | 63s | 18.22s | 298M | 344M |</p><p>在延迟时间大于100ms后，迁移显示成功，实例状态active，但是无法ping通实例。</p><p>取消模拟：<br><code>tc qdisc del dev eth0 root</code></p><h1 id="丢包"><a href="#丢包" class="headerlink" title="丢包"></a>丢包</h1><p>1、两个计算节点，都模拟丢包率1%<br><code>tc qdisc add dev eth0 root netem loss 1%</code></p><p>2、将模拟丢包率修改为2%-10%<br><code>tc qdisc change dev eth0 root netem loss 2%</code></p><p>统计结果如下：</p><p>| 丢包率 | 迁移时间 | 停机时间 | 迁出数据量 | 迁入数据量 |<br>| —– | —– | —– | —– | —– | —– |<br>| 0.5% | 20s | 8.55s | 295M | 330M |<br>| 1% | 31s | 11.24s | 301M | 249M |<br>| 1.5% | 29s | 7.44s | 335M | 313M |<br>| 2% | 28s | 11.62s | 261M | 299M |<br>| 2.5% | 40s | 10.34s | 300M | 325M |<br>| 3% | 43s | 15.19s | 306M | 268M |</p><p>在丢包率大于3%后，迁移显示成功，实例状态active，但是无法ping通实例。</p><p>取消模拟：<br><code>tc qdisc del dev eth0 root</code></p><h1 id="包重复"><a href="#包重复" class="headerlink" title="包重复"></a>包重复</h1><p>1、两个计算节点，都模拟包重复率1%<br><code>tc qdisc add dev eth0 root netem duplicate 1%</code><br>随机产生 1% 重复的包。</p><p>2、将模拟包重复率修改为2%-10%-100%<br><code>tc qdisc change dev eth0 root netem duplicate 2%</code></p><p>统计结果如下：</p><p>| 包重复率 | 迁移时间 | 停机时间 | 迁出数据量 | 迁入数据量 |<br>| —– | —– | —– | —– | —– | —– |<br>| 1% | 18s | 4.82s | 288M | 283M |<br>| 2% | 21s | 4.06s | 308M | 288M |<br>| 3% | 18s | 8.02s | 249M | 309M |<br>| 4% | 21s | 6.37s | 316M | 300M |<br>| 5% | 19s | 4.70s | 314M | 307M |<br>| 6% | 18s | 4.18s | 285M | 316M |<br>| 7% | 21s | 3.81s | 324M | 315M |<br>| 8% | 18s | 7.60s | 305M | 234M |<br>| 9% | 21s | 6.87s | 328M | 316M |<br>| 10% | 18s | 7.71s | 310M | 317M |<br>| 20% | 21s | 11.24s | 360M | 347M |<br>| 30% | 19s | 9.90s | 381M | 388M |<br>| 40% | 22s | 6.67s | 429M | 376M |<br>| 50% | 18s | 4.43s | 445M | 434M |<br>| 60% | 24s | 8.04s | 499M | 438M |<br>| 70% | 19s | 11.30s | 488M | 518M |<br>| 80% | 25s | 5.61s | 581M | 485M |<br>| 90% | 29s | 5.08s | 745M | 646M |<br>| 100% | 21s | 7.89s | 706M | 727M |</p><p>取消模拟：<br><code>tc qdisc del dev eth0 root</code></p><h1 id="包损坏"><a href="#包损坏" class="headerlink" title="包损坏"></a>包损坏</h1><p>1、两个计算节点，都模拟包损坏率1%<br><code>tc qdisc add dev eth0 root netem corrupt 1%</code><br>随机产生 1% 损坏的报文（在报文的随机位置造成一个比特的错误）。</p><p>在ping的时候会报错：Warning: time of day goes back , taking countermeasures，不过没关系，不影响我们的停机时间统计结果。</p><p>2、将模拟丢包率修改为2%-10%<br><code>tc qdisc change dev eth0 root netem corrupt 2%</code></p><p>| 包损坏率 | 迁移时间 | 停机时间 | 迁出数据量 | 迁入数据量 |<br>| —– | —– | —– | —– | —– | —– |<br>| 0.5% | 20s | 4.43s | 359M | 369M |<br>| 1% | 24s | 5.90s | 371M | 351M |<br>| 1.5% | 30s | 12.13s | 374M | 357M |<br>| 2% | 32s | 9.09s | 331M | 362M |<br>| 2.5% | 42s | 7.49s | 345M | 337M |<br>| 3% | 48s | 13.46s | 378M | 374M |</p><p>迁移成功率随着包损坏率的增加而降低，包损坏率大于3%之后，基本不会成功。会停留在迁移状态，每秒几K传输。</p><p>取消模拟：<br><code>tc qdisc del dev eth0 root</code></p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>至此，完成了系统故障对于OpenStack虚拟机在线迁移过程中的性能影响的实验。实验数据和预期差别很大，比如停机时间量级不合理，比如停机时间基本上不受系统故障影响，比如迁移成功后却出现无法ping通的现象等等。</p><p>后续任务有两个，一是需要进行共享存储的虚拟机在线迁移实验，用于对比。二是尝试进行调参，把停机时间调整到毫秒级。</p><p>再进一步的话，可以研究下虚拟机迁移成功后无法ping通的原因，还可以研究下同样故障下虚拟机迁移时而成功时而失败的原因。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-openstack-vm-live-migration-experiment/" title="虚拟机在线迁移实验">https://www.voidking.com/dev-openstack-vm-live-migration-experiment/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/docker/" rel="tag"># docker</a> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/ubuntu/" rel="tag"># ubuntu</a> <a href="/tags/openstack/" rel="tag"># openstack</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" rel="tag"># 测试</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-openstack-vm-live-migration-fault-injection/" rel="prev" title="虚拟机在线迁移过程中的故障注入"><i class="fa fa-chevron-left"></i> 虚拟机在线迁移过程中的故障注入</a></div><div class="post-nav-item"> <a href="/dev-ali-tech-system-summary/" rel="next" title="阿里云技术体系概览">阿里云技术体系概览<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3284447971731414" data-ad-slot="9697986181"></ins><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B%E5%87%86%E5%A4%87"><span class="nav-number">2.</span> <span class="nav-text">实例准备</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%AD%A3%E5%B8%B8%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BF%81%E7%A7%BB"><span class="nav-number">3.</span> <span class="nav-text">正常虚拟机迁移</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%96%E6%B6%88%E8%BF%81%E7%A7%BB"><span class="nav-number">4.</span> <span class="nav-text">取消迁移</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CPU%E6%95%85%E9%9A%9C"><span class="nav-number">5.</span> <span class="nav-text">CPU故障</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E6%95%85%E9%9A%9C"><span class="nav-number">6.</span> <span class="nav-text">内存故障</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#IO%E6%95%85%E9%9A%9C"><span class="nav-number">7.</span> <span class="nav-text">IO故障</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%A3%81%E7%9B%98%E6%95%85%E9%9A%9C"><span class="nav-number">8.</span> <span class="nav-text">磁盘故障</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E5%BB%B6%E8%BF%9F"><span class="nav-number">9.</span> <span class="nav-text">网络延迟</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%A2%E5%8C%85"><span class="nav-number">10.</span> <span class="nav-text">丢包</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8C%85%E9%87%8D%E5%A4%8D"><span class="nav-number">11.</span> <span class="nav-text">包重复</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8C%85%E6%8D%9F%E5%9D%8F"><span class="nav-number">12.</span> <span class="nav-text">包损坏</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E8%AE%B0"><span class="nav-number">13.</span> <span class="nav-text">后记</span></a></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">647</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">29</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">242</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: 'b54c1c4f6d40f96b4ad5b55d48812bad',
      title: '虚拟机在线迁移实验',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>