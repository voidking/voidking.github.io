<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="问题描述《Ubuntu16手动安装OpenStack——horizon篇》一文中，已经安装了horizon，并且在dashboard中使用官方镜像创建了ubuntu16实例。看上去，很成功。 但是，再次使用官方镜像创建实例，这次居然无法通过ssh密钥访问！！！Permission denied (publickey). 神奇了。。。 重建实例，依然无法通过密钥访问。本文，就来研究一下解决办法。"><meta property="og:type" content="article"><meta property="og:title" content="Ubuntu16手动安装OpenStack——修改镜像"><meta property="og:url" content="https://www.voidking.com/dev-ubuntu16-manual-openstack-modify-mirror/index.html"><meta property="og:site_name" content="VoidKing"><meta property="og:description" content="问题描述《Ubuntu16手动安装OpenStack——horizon篇》一文中，已经安装了horizon，并且在dashboard中使用官方镜像创建了ubuntu16实例。看上去，很成功。 但是，再次使用官方镜像创建实例，这次居然无法通过ssh密钥访问！！！Permission denied (publickey). 神奇了。。。 重建实例，依然无法通过密钥访问。本文，就来研究一下解决办法。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-modify-mirror/addkey.jpg?imageView2/0/w/750"><meta property="article:published_time" content="2018-07-10T10:00:00.000Z"><meta property="article:modified_time" content="2020-02-09T11:01:20.472Z"><meta property="article:author" content="VoidKing"><meta property="article:tag" content="linux"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="openstack"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-modify-mirror/addkey.jpg?imageView2/0/w/750"><link rel="canonical" href="https://www.voidking.com/dev-ubuntu16-manual-openstack-modify-mirror/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Ubuntu16手动安装OpenStack——修改镜像 | VoidKing</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="VoidKing" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">VoidKing</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-ubuntu16-manual-openstack-modify-mirror/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="VoidKing"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="VoidKing"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Ubuntu16手动安装OpenStack——修改镜像</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-07-10 10:00:00" itemprop="dateCreated datePublished" datetime="2018-07-10T10:00:00+00:00">2018-07-10</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/" itemprop="url" rel="index"><span itemprop="name">专业</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/ubuntu/" itemprop="url" rel="index"><span itemprop="name">ubuntu</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p><a href="https://www.voidking.com/dev-ubuntu16-manual-openstack-horizon/">《Ubuntu16手动安装OpenStack——horizon篇》</a>一文中，已经安装了horizon，并且在dashboard中使用官方镜像创建了ubuntu16实例。看上去，很成功。</p><p>但是，再次使用官方镜像创建实例，这次居然无法通过ssh密钥访问！！！Permission denied (publickey). 神奇了。。。</p><p>重建实例，依然无法通过密钥访问。本文，就来研究一下解决办法。</p><a id="more"></a><h1 id="尝试解决"><a href="#尝试解决" class="headerlink" title="尝试解决"></a>尝试解决</h1><p>1、查看启动日志，发现：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ci-info: <span class="literal">no</span> authorized ssh keys fingerprints found <span class="keyword">for</span><span class="built_in"> user </span>ubuntu.</span><br></pre></td></tr></table></figure><p>看这个提示，应该是密钥没有注入到实例中。</p><p>2、再往上看，发现：</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">DataSourceEc2</span>.py[<span class="symbol">CRITICAL</span>]: <span class="symbol">Giving</span> up on md from [<span class="string">'http://169.254.169.254/2009-04-04/meta-data/instance-id'</span>] after <span class="number">120</span> seconds</span><br><span class="line">url_helper.py[<span class="symbol">WARNING</span>]: <span class="symbol">Calling</span> <span class="string">'http://10.0.0.200/latest/meta-data/instance-id'</span> failed [<span class="number">0</span>/<span class="number">120</span>s]: bad status code [<span class="number">404</span>]</span><br><span class="line">......</span><br><span class="line"><span class="symbol">DataSourceCloudStack</span>.py[<span class="symbol">CRITICAL</span>]: <span class="symbol">Giving</span> up on waiting for the metadata from [<span class="string">'http://10.0.0.200/latest/meta-data/instance-id'</span>] after <span class="number">120</span> seconds</span><br></pre></td></tr></table></figure><p>完整日志查看：<a href="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-modify-mirror/start.log" target="_blank" rel="noopener">start.log</a></p><p>3、参考<a href="https://blog.csdn.net/tomstrong_369/article/details/64918678" target="_blank" rel="noopener">OpenStack METADATA不工作的分析方法</a>，重启metadata服务：<br><code>systemctl restart neutron-metadata-agent.service</code></p><p>然后重新创建实例，没有用。</p><p>4、查看metadata日志<br><code>tail /var/log/neutron/neutron-metadata-agent.log</code></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span><span class="number">-07</span><span class="number">-10</span> <span class="number">11</span>:<span class="number">40</span>:<span class="number">45.079</span> <span class="number">22459</span> INFO eventlet.wsgi.server [-] <span class="number">10.0</span><span class="number">.0</span><span class="number">.1</span>,&lt;local&gt; <span class="string">"GET /latest/meta-data/instance-id HTTP/1.1"</span> status: <span class="number">404</span>  len: <span class="number">297</span> time: <span class="number">0.0431259</span></span><br></pre></td></tr></table></figure><p>使用日志关键词搜索，并没有找到相关解决办法。</p><p>5、参考<a href="https://www.jianshu.com/p/e2c3066b613d" target="_blank" rel="noopener">Openstack 通过 Metadata 服务请求流程</a> 和 <a href="https://blog.csdn.net/zhangli_perdue/article/details/50317221" target="_blank" rel="noopener">在OpenStack里如何确保虚机正常访问MetaData IP 169.254.169.254</a>，也没有解决问题。</p><p>6、重建实例，配置脚本设置ssh允许密码登录。但是，无论是密钥还是密码，都无法登录，和<a href="https://www.voidking.com/dev-openstack-add-mirror/">《OpenStack添加镜像》</a>一文中遇到的问题简直一模一样。</p><h1 id="修改镜像"><a href="#修改镜像" class="headerlink" title="修改镜像"></a>修改镜像</h1><p>配置失败，决定从镜像入手，修改镜像，使之支持ssh密码登录。主要参考<a href="http://ylong.net.cn/openstack-images-password.html" target="_blank" rel="noopener">openstack中镜像的密码修改</a>和<a href="https://www.wanglf.net/modify-openstack-ubuntu-image-with-guestfish.html" target="_blank" rel="noopener">使用 guestfish 工具修改OpenStack官方Ubuntu 镜像</a></p><p>以下操作在控制节点切换到root执行。</p><p>1、下载镜像<br><code>wget http://cloud-images.ubuntu.com/xenial/current/xenial-server-cloudimg-amd64-disk1.img</code></p><p>2、安装guestfish工具<br><code>apt-get install libguestfs-tools -y</code></p><p>3、打开镜像<br><code>guestfish --rw -a xenial-server-cloudimg-amd64-disk1.img</code></p><p>4、执行修改</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&lt;<span class="string">fs&gt;</span> <span class="string">run</span></span><br><span class="line"><span class="string">&gt;</span>&lt;<span class="string">fs&gt;</span> <span class="built_in">list-filesystems</span></span><br><span class="line"><span class="built_in">&gt;&lt;fs&gt;</span> <span class="string">mount </span>/<span class="string">dev/</span><span class="string">sda1 </span>/</span><br><span class="line">&gt;&lt;<span class="string">fs&gt;</span> <span class="string">vi </span>/<span class="string">etc/</span><span class="string">cloud/</span><span class="string">cloud.</span><span class="string">cfg</span></span><br><span class="line"><span class="string">&gt;</span>&lt;<span class="string">fs&gt;</span> <span class="string">quit</span></span><br></pre></td></tr></table></figure><p>在编辑cloud.cfg的时候，做如下修改：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># line 12, change and add</span></span><br><span class="line"><span class="attr">disable_root:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">ssh_pwauth:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># line 93, change and add</span></span><br><span class="line"><span class="attr">lock_passwd:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">plain_text_passwd:</span> <span class="string">"ubuntu"</span></span><br></pre></td></tr></table></figure><p>以上，允许了root登录，增加了ssh密码登录，设置ubuntu用户的默认密码为ubuntu。</p><p>5、使admin环境生效<br><code>. admin-openrc</code></p><p>6、添加镜像</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openstack <span class="keyword">image</span> create <span class="string">"ubuntu16-server-modified"</span> \</span><br><span class="line">  --<span class="keyword">file</span> xenial-server-cloudimg-amd64-disk1.img \</span><br><span class="line">  --disk-<span class="keyword">format</span> qcow2 --<span class="keyword">container</span>-<span class="keyword">format</span> bare \</span><br><span class="line">  --public</span><br></pre></td></tr></table></figure><p>7、之后，创建实例ubuntu1，就可以在vnc使用密码登录了。可以使用<code>sudo -i</code>切换到root，等待时间很长，大概半分钟才能切换成功。</p><p>但是此时，依然不能使用ssh登录，无论是使用密钥，还是不使用密钥，都会提示：Permission denied (publickey).。</p><p>打算在vnc给实例添加公钥，然后把私钥scp给控制节点，但是，无法向authorized_keys写入公钥。神奇了！<br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-modify-mirror/addkey.jpg?imageView2/0/w/750" alt=""></p><p>而且，在vnc也无法ssh登录本机！同样提示Permission denied (publickey).</p><p>8、解决办法</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sudo</span> <span class="string">-i</span></span><br><span class="line"><span class="attr">apt</span> <span class="string">remove openssh-server</span></span><br><span class="line"><span class="attr">rm</span> <span class="string">/etc/ssh/*</span></span><br><span class="line"><span class="attr">apt</span> <span class="string">install openssh-server</span></span><br></pre></td></tr></table></figure><h1 id="继续修改镜像"><a href="#继续修改镜像" class="headerlink" title="继续修改镜像"></a>继续修改镜像</h1><h2 id="定位问题"><a href="#定位问题" class="headerlink" title="定位问题"></a>定位问题</h2><p>以上，已经实现了实例通过ssh密码登录，但是这个过程比较麻烦。理论上，继续修改镜像，应该就能够实现这个目标。</p><p>1、创建一个实例ubuntu2，然后对比ubuntu1和ubuntu2中的/etc/ssh/sshd_config。发现它们最大的不同在于PasswordAuthentication。</p><p>ubuntu1中：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Change <span class="keyword">to</span> <span class="keyword">no</span> <span class="keyword">to</span> <span class="keyword">disable</span> tunnelled clear <span class="type">text</span> passwords</span><br><span class="line"><span class="meta">#PasswordAuthentication yes</span></span><br></pre></td></tr></table></figure><p>ubuntu2中：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Change <span class="keyword">to</span> <span class="keyword">no</span> <span class="keyword">to</span> <span class="keyword">disable</span> tunnelled clear <span class="type">text</span> passwords</span><br><span class="line">PasswordAuthentication <span class="keyword">no</span></span><br></pre></td></tr></table></figure><p>啊哈，这就是无法使用ssh登录的罪魁祸首了。</p><p>2、在ubuntu2中，修改PasswordAuthentication：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Change <span class="keyword">to</span> <span class="keyword">no</span> <span class="keyword">to</span> <span class="keyword">disable</span> tunnelled clear <span class="type">text</span> passwords</span><br><span class="line"><span class="meta">#PasswordAuthentication no</span></span><br></pre></td></tr></table></figure><p>3、重启sshd<br><code>service sshd restart</code></p><p>然后，就可以使用ssh密码登录了。</p><h2 id="修改镜像-1"><a href="#修改镜像-1" class="headerlink" title="修改镜像"></a>修改镜像</h2><p>那么，该怎么在镜像中修改PasswordAuthentication呢？很简单。</p><p>1、打开镜像<br><code>guestfish --rw -a xenial-server-cloudimg-amd64-disk1.img</code></p><p>2、修改sshd_config</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&lt;<span class="string">fs&gt;</span> <span class="string">run</span></span><br><span class="line"><span class="string">&gt;</span>&lt;<span class="string">fs&gt;</span> <span class="built_in">list-filesystems</span></span><br><span class="line"><span class="built_in">&gt;&lt;fs&gt;</span> <span class="string">mount </span>/<span class="string">dev/</span><span class="string">sda1 </span>/</span><br><span class="line">&gt;&lt;<span class="string">fs&gt;</span> <span class="string">vi </span>/<span class="string">etc/</span><span class="string">ssh/</span><span class="string">sshd_config</span></span><br><span class="line"><span class="string">&gt;</span>&lt;<span class="string">fs&gt;</span> <span class="string">quit</span></span><br></pre></td></tr></table></figure><p>在编辑sshd_config的时候，做如下修改：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Change <span class="keyword">to</span> <span class="keyword">no</span> <span class="keyword">to</span> <span class="keyword">disable</span> tunnelled clear <span class="type">text</span> passwords</span><br><span class="line"><span class="meta">#PasswordAuthentication no</span></span><br></pre></td></tr></table></figure><p>3、（可选）为了方便联网，不妨编辑resolv.conf.d/base</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="symbol">&lt;fs&gt;</span> <span class="keyword">vi</span> /etc/resolvconf/resolv.<span class="keyword">conf</span>.d/base</span><br></pre></td></tr></table></figure><p>在base中添加：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nameserver <span class="number">180.76</span><span class="number">.76</span><span class="number">.76</span></span><br><span class="line">nameserver <span class="number">223.6</span><span class="number">.6</span><span class="number">.6</span></span><br></pre></td></tr></table></figure><p>4、使admin环境生效<br><code>. admin-openrc</code></p><p>5、删除镜像，重新添加</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">openstack <span class="keyword">image</span> <span class="keyword">delete</span> <span class="string">"ubuntu16-server-modified"</span></span><br><span class="line"></span><br><span class="line">openstack <span class="keyword">image</span> create <span class="string">"ubuntu16-server-modified"</span> \</span><br><span class="line">  --<span class="keyword">file</span> xenial-server-cloudimg-amd64-disk1.img \</span><br><span class="line">  --disk-<span class="keyword">format</span> qcow2 --<span class="keyword">container</span>-<span class="keyword">format</span> bare \</span><br><span class="line">  --public</span><br></pre></td></tr></table></figure><p>至此，大功告成。</p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>在创建实例时无法注入公钥和脚本的问题，最终没有解决，好在找到了其他解决方案。至于这个注入问题，会在后续的学习中继续尝试解决。</p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/ubuntu/" rel="tag"># ubuntu</a> <a href="/tags/openstack/" rel="tag"># openstack</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-ubuntu16-manual-openstack-horizon/" rel="prev" title="Ubuntu16手动安装OpenStack——horizon篇"><i class="fa fa-chevron-left"></i> Ubuntu16手动安装OpenStack——horizon篇</a></div><div class="post-nav-item"> <a href="/dev-ubuntu16-manual-openstack-cinder/" rel="next" title="Ubuntu16手动安装OpenStack——cinder篇">Ubuntu16手动安装OpenStack——cinder篇<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#问题描述"><span class="nav-number">1.</span> <span class="nav-text">问题描述</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#尝试解决"><span class="nav-number">2.</span> <span class="nav-text">尝试解决</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#修改镜像"><span class="nav-number">3.</span> <span class="nav-text">修改镜像</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#继续修改镜像"><span class="nav-number">4.</span> <span class="nav-text">继续修改镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#定位问题"><span class="nav-number">4.1.</span> <span class="nav-text">定位问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改镜像-1"><span class="nav-number">4.2.</span> <span class="nav-text">修改镜像</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#后记"><span class="nav-number">5.</span> <span class="nav-text">后记</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="VoidKing" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">VoidKing</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">583</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">40</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">189</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://twitter.com/voidking_com" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;voidking_com" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i> Twitter</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">VoidKing</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://www.beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>