<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.voidking.com/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言《使用Libvirt创建虚拟机》一文中，我们学会了使用Libvirt创建虚拟机的方法。但是，文中创建的虚拟机只能在宿主机node0上访问，node1就无法访问，也就是说虚拟机和宿主机外部的网络还没有打通。 本文，就来研究一下虚拟机网络配置的方法，使得node1也可以访问到node0中的虚拟机。"><meta property="og:type" content="article"><meta property="og:title" content="Libvirt虚拟机网络配置"><meta property="og:url" content="https://www.voidking.com/dev-libvirt-vm-network/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言《使用Libvirt创建虚拟机》一文中，我们学会了使用Libvirt创建虚拟机的方法。但是，文中创建的虚拟机只能在宿主机node0上访问，node1就无法访问，也就是说虚拟机和宿主机外部的网络还没有打通。 本文，就来研究一下虚拟机网络配置的方法，使得node1也可以访问到node0中的虚拟机。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com//imgs/libvirt-vm-network/add.jpg?imageView2/0/w/600"><meta property="og:image" content="http://cdn.voidking.com//imgs/libvirt-vm-network/network.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/libvirt-vm-network/network2.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/libvirt-vm-network/network3.jpg?imageView2/0/w/700"><meta property="og:image" content="http://cdn.voidking.com//imgs/libvirt-vm-network/network4.jpg?imageView2/0/w/700"><meta property="article:published_time" content="2018-12-25T14:30:00.000Z"><meta property="article:modified_time" content="2018-12-25T14:30:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="网络"><meta property="article:tag" content="libvirt"><meta property="article:tag" content="virsh"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com//imgs/libvirt-vm-network/add.jpg?imageView2/0/w/600"><link rel="canonical" href="https://www.voidking.com/dev-libvirt-vm-network/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Libvirt虚拟机网络配置 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-libvirt-vm-network/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Libvirt虚拟机网络配置</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-12-25 14:30:00" itemprop="dateCreated datePublished" datetime="2018-12-25T14:30:00+00:00">2018-12-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/network/" itemprop="url" rel="index"><span itemprop="name">network</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><span class="post-title-index">1.</span><a href="#前言" class="headerlink" title="前言"></a> 前言</h1><p><a href="https://www.voidking.com/dev-libvirt-create-vm/">《使用Libvirt创建虚拟机》</a>一文中，我们学会了使用Libvirt创建虚拟机的方法。<br>但是，文中创建的虚拟机只能在宿主机node0上访问，node1就无法访问，也就是说虚拟机和宿主机外部的网络还没有打通。</p><p>本文，就来研究一下虚拟机网络配置的方法，使得node1也可以访问到node0中的虚拟机。</p><span id="more"></span><h1 id="网络配置1"><span class="post-title-index">2.</span><a href="#网络配置1" class="headerlink" title="网络配置1"></a> 网络配置1</h1><p>最简单的实现方法，就是VM要有一个对外提供服务的IP，这个IP不依赖于宿主机，而是和宿主机的IP同级。</p><p>参考<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/199b1d39590b">KVM 以及桥接网络配置</a>和<a target="_blank" rel="noopener" href="https://www.chenyudong.com/archives/libvirt-kvm-bridge-network.html">libvirt kvm 虚拟机上网 – Bridge桥接</a>进行配置。</p><p>1、在node0的网络配置中进行修改：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#auto eth0</span><br><span class="line">#iface eth0 inet static</span><br><span class="line">#address 192.168.56.200</span><br><span class="line">#netmask 255.255.255.0</span><br><span class="line"></span><br><span class="line">auto eth0</span><br><span class="line">iface eth0 inet manual</span><br><span class="line">up ifconfig $IFACE 0.0.0.0 up</span><br><span class="line">up ifconfig $IFACE promisc</span><br><span class="line"></span><br><span class="line">auto br0</span><br><span class="line">iface br0 inet static</span><br><span class="line">address 192.168.56.200</span><br><span class="line">netmask 255.255.255.0</span><br><span class="line">gateway 192.168.56.1</span><br><span class="line">bridge_ports eth0</span><br><span class="line">bridge_stp off</span><br><span class="line">bridge_fd 0</span><br><span class="line">bridge_maxwait 0</span><br></pre></td></tr></table></figure><p>使用br0替代eth0，eth0做流量转发。</p><p>2、重启网络</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/networking restart</span><br></pre></td></tr></table></figure><p>3、修改路由（可选）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">route -n</span><br><span class="line">route del -net 192.168.56.0/24 dev eth0</span><br><span class="line">route add -net 192.168.56.0/24 dev br0</span><br></pre></td></tr></table></figure><p>同样的，在node1中也配置br0。</p><p>下面参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenjiahe/p/5950038.html">虚拟机在线添加网卡</a>，添加网卡。</p><p>4、添加网卡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">virsh domiflist cirros</span><br><span class="line">virsh attach-interface cirros --<span class="built_in">type</span> bridge --<span class="built_in">source</span> br0 --config</span><br><span class="line">virsh domiflist cirros</span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com//imgs/libvirt-vm-network/add.jpg?imageView2/0/w/600"><br>如果在实例开机状态下添加网卡，需要重启实例后才能看到。</p><p>5、网卡信息保存到配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">virsh dumpxml cirros &gt;/etc/libvirt/qemu/cirros.xml </span><br><span class="line">virsh define /etc/libvirt/qemu/cirros.xml </span><br></pre></td></tr></table></figure><p>PS：删除网卡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh detach-interface cirros --<span class="built_in">type</span> bridge --mac 52:54:00:09:36:ad</span><br></pre></td></tr></table></figure><p>6、登录实例后，配置新网卡的IP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/network/interfaces</span><br></pre></td></tr></table></figure><p>添加eth1的配置：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">auto eth1</span><br><span class="line">iface eth1 inet static</span><br><span class="line">address 192.168.56.202</span><br><span class="line">netmask 255.255.255.0</span><br></pre></td></tr></table></figure><p>7、重启实例</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo reboot</span><br></pre></td></tr></table></figure><p>至此，实例桥接网络配置完成。</p><p>8、测试网络<br>在node0上<code>ping 192.168.56.202 -c2</code>，正常。<br>在node1上<code>ping 192.168.56.202 -c2</code>，不通。<br>在virtualbox宿主机上<code>ping 192.168.56.202 -c2</code>，不通。</p><p>以上，我们的配置失败了，因为除了node0，其他机器无法访问实例。下面我们来分析一下当前网络，如下图：<br><img src="http://cdn.voidking.com//imgs/libvirt-vm-network/network.jpg?imageView2/0/w/700"><br>经过测试，node0到switch0是通的，node0到vm0是通的，但是vm0到switch0不通。诡异，理论上应该是通的啊！</p><h1 id="网络配置2"><span class="post-title-index">3.</span><a href="#网络配置2" class="headerlink" title="网络配置2"></a> 网络配置2</h1><p>那么，怎么打通vm0到switch0呢？最容易想到的，是把vm0直接连接到eth0上，而br0单纯作为node0的管理网络。修改后的方案如下图：<br><img src="http://cdn.voidking.com//imgs/libvirt-vm-network/network2.jpg?imageView2/0/w/700"></p><p>1、修改cirros配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh edit cirros</span><br></pre></td></tr></table></figure><p>找到：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">interface</span> <span class="attr">type</span>=<span class="string">&#x27;bridge&#x27;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mac</span> <span class="attr">address</span>=<span class="string">&#x27;52:54:00:09:36:ad&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">bridge</span>=<span class="string">&#x27;br0&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">model</span> <span class="attr">type</span>=<span class="string">&#x27;rtl8139&#x27;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">&#x27;pci&#x27;</span> <span class="attr">domain</span>=<span class="string">&#x27;0x0000&#x27;</span> <span class="attr">bus</span>=<span class="string">&#x27;0x00&#x27;</span> <span class="attr">slot</span>=<span class="string">&#x27;0x06&#x27;</span> <span class="attr">function</span>=<span class="string">&#x27;0x0&#x27;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interface</span>&gt;</span></span><br></pre></td></tr></table></figure><p>把source中的br0改为eth0。</p><p>2、重启实例</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">virsh shutdown cirros</span><br><span class="line">virsh start cirros</span><br></pre></td></tr></table></figure><p>报错：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">error: Failed to start domain cirros</span><br><span class="line">error: Unable to add bridge eth0 port vnet1: Operation not supported</span><br></pre></td></tr></table></figure><p>想法是美好的，但是行不通啊！</p><p>参考<a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/virtualization_administration_guide/sect-attch-nic-physdev">Attaching a Virtual NIC Directly to a Physical Interface</a>进行修改，但是又报出了其他错误：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">error: Failed to start domain cirros</span><br><span class="line">error: error creating macvtap interface macvtap0@eth0 (52:54:00:c8:33:b3): Device or resource busy</span><br></pre></td></tr></table></figure><p>参考<a target="_blank" rel="noopener" href="https://blog.scottlowe.org/2016/02/09/using-kvm-libvirt-macvtap-interfaces/">Using KVM with Libvirt and macvtap Interfaces</a>也许可以解决，但是感觉好麻烦，所以决定放弃这个方案。</p><h1 id="网络配置3"><span class="post-title-index">4.</span><a href="#网络配置3" class="headerlink" title="网络配置3"></a> 网络配置3</h1><p>如果，再创建一个网桥，这个网桥不指定IP呢？如下图：<br><img src="http://cdn.voidking.com//imgs/libvirt-vm-network/network3.jpg?imageView2/0/w/700"></p><p>1、创建新网桥br1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/network/interfaces</span><br></pre></td></tr></table></figure><p>添加：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">auto br1</span><br><span class="line">iface br1 inet dhcp</span><br><span class="line">bridge_ports eth0</span><br><span class="line">bridge_stp off</span><br><span class="line">bridge_fd 0</span><br><span class="line">bridge_maxwait 0</span><br></pre></td></tr></table></figure><p>2、启动br1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifup br1</span><br></pre></td></tr></table></figure><p>报错：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">device eth0 is already a member of a bridge; can&#x27;t enslave it to bridge br1.</span><br><span class="line">Internet Systems Consortium DHCP Client 4.3.3</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>由上可知，一个物理网卡，只能绑定到一个网桥上。所以，这个想法也是行不通的。</p><h1 id="网络配置4"><span class="post-title-index">5.</span><a href="#网络配置4" class="headerlink" title="网络配置4"></a> 网络配置4</h1><p>那么，把br1绑定到eth2（eth1是上网网卡）上面呢？如下图：<br><img src="http://cdn.voidking.com//imgs/libvirt-vm-network/network4.jpg?imageView2/0/w/700"></p><p>1、修改br1配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/network/interfaces</span><br></pre></td></tr></table></figure><p>如下修改：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">auto eth2</span><br><span class="line">iface eth2 inet manual</span><br><span class="line">up ifconfig $IFACE 0.0.0.0 up</span><br><span class="line">up ifconfig $IFACE promisc</span><br><span class="line"></span><br><span class="line">auto br1</span><br><span class="line">iface br1 inet dhcp</span><br><span class="line">bridge_ports eth2</span><br><span class="line">bridge_stp off</span><br><span class="line">bridge_fd 0</span><br><span class="line">bridge_maxwait 0</span><br></pre></td></tr></table></figure><p>2、启动br1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ifup eth2</span><br><span class="line">ifup br1</span><br></pre></td></tr></table></figure><p>3、编辑cirros配置，修改br0为br1，重启cirros。<br>结果，vm0到switch0依然不通。证明这个方案也不行。</p><h1 id="网络配置5"><span class="post-title-index">6.</span><a href="#网络配置5" class="headerlink" title="网络配置5"></a> 网络配置5</h1><p>网络配置2、3、4都不行，看来拍脑门想出来的方法不太靠谱。实际上网络配置1应该是可以的，但是，却无法连通，问题出在哪里呢？莫非，是因为virtualbox？virtualbox有多种网络模式，node1和node2使用的是Host-only Adapter，如果换成Bridged Adapter呢？那就试试吧！结果，依然失败。</p><h1 id="后记"><span class="post-title-index">7.</span><a href="#后记" class="headerlink" title="后记"></a> 后记</h1><p>还能不能愉快地玩耍了？明明很简单的桥接，为啥就不通呢？诡异，实在诡异。郝同学表示已经无能为力，留个坑吧！</p><h1 id="书签"><span class="post-title-index">8.</span><a href="#书签" class="headerlink" title="书签"></a> 书签</h1><ul><li><a target="_blank" rel="noopener" href="https://help.ubuntu.com/community/KVM/Networking">KVM/Networking</a></li><li><a target="_blank" rel="noopener" href="https://wiki.libvirt.org/page/Networking">Networking</a></li><li><a target="_blank" rel="noopener" href="https://wiki.libvirt.org/page/VirtualNetworking">VirtualNetworking</a></li><li><a target="_blank" rel="noopener" href="https://blog.codybunch.com/2016/10/14/KVM-and-OVS-on-Ubuntu-1604/">KVM and OVS on Ubuntu 16.04</a></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/x_i_y_u_e/article/details/56665926">ubuntu16.04 配置kvm openvswitch 桥接环境</a></li><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sometingintheway/p/9449368.html">Open vSwitch + libvirt 搭建vlan网络</a></li><li><a target="_blank" rel="noopener" href="http://thomasmullaly.com/2015/03/29/how-to-put-a-kvm-guest-domain-on-a-bridged-network/">How to Put a KVM Guest Domain on a Bridged Network</a></li></ul></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-libvirt-vm-network/" title="Libvirt虚拟机网络配置">https://www.voidking.com/dev-libvirt-vm-network/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/ubuntu/" rel="tag"># ubuntu</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag"># 网络</a> <a href="/tags/libvirt/" rel="tag"># libvirt</a> <a href="/tags/virsh/" rel="tag"># virsh</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-network-building/" rel="prev" title="组网技术概述"><i class="fa fa-chevron-left"></i> 组网技术概述</a></div><div class="post-nav-item"> <a href="/dev-libvirt-vm-live-migration/" rel="next" title="使用Libvirt进行虚拟机在线迁移">使用Libvirt进行虚拟机在线迁移<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3284447971731414" data-ad-slot="9697986181"></ins><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">1. 前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE1"><span class="nav-text">2. 网络配置1</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE2"><span class="nav-text">3. 网络配置2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE3"><span class="nav-text">4. 网络配置3</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE4"><span class="nav-text">5. 网络配置4</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE5"><span class="nav-text">6. 网络配置5</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E8%AE%B0"><span class="nav-text">7. 后记</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B9%A6%E7%AD%BE"><span class="nav-text">8. 书签</span></a></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">649</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">29</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">242</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: '4780f18b3f2d87b22edc1cb8f240b023',
      title: 'Libvirt虚拟机网络配置',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>