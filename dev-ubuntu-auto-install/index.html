<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//qiniu.cdn.voidking.com/doc/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言《Ubuntu 14.04.5 Server物理机安装》一文中，我们安装了一台Ubuntu Server服务器，整个过程花费了很多时间。令人难过的是，还有15台机器需要安装！本来打算每天安装个一两台，慢慢来，今天老师提醒说为什么不使用脚本呢？对啊，为什么不试试脚本呢！这是一个思路。突然想起师兄曾说，机房的机器系统安装都是通过网络，这也是一个很好的思路啊！ 按照上面两个思路，那就研究下批量安装U"><meta property="og:type" content="article"><meta property="og:title" content="Ubuntu系统批量自动安装"><meta property="og:url" content="https://www.voidking.com/dev-ubuntu-auto-install/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言《Ubuntu 14.04.5 Server物理机安装》一文中，我们安装了一台Ubuntu Server服务器，整个过程花费了很多时间。令人难过的是，还有15台机器需要安装！本来打算每天安装个一两台，慢慢来，今天老师提醒说为什么不使用脚本呢？对啊，为什么不试试脚本呢！这是一个思路。突然想起师兄曾说，机房的机器系统安装都是通过网络，这也是一个很好的思路啊！ 按照上面两个思路，那就研究下批量安装U"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu-auto-install/config-ks.jpg"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu-auto-install/install.jpg"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu-auto-install/network.jpg"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu-auto-install/network-manual.jpg"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu-auto-install/partition.jpg"><meta property="article:published_time" content="2018-05-10T11:00:00.000Z"><meta property="article:modified_time" content="2018-05-10T11:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="操作系统"><meta property="article:tag" content="pxe"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com//imgs/ubuntu-auto-install/config-ks.jpg"><link rel="canonical" href="https://www.voidking.com/dev-ubuntu-auto-install/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Ubuntu系统批量自动安装 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">一个计算机技术爱好者与学习者</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-ubuntu-auto-install/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="一个计算机技术爱好者与学习者"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Ubuntu系统批量自动安装</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-05-10 11:00:00" itemprop="dateCreated datePublished" datetime="2018-05-10T11:00:00+00:00">2018-05-10</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/uncategories/" itemprop="url" rel="index"><span itemprop="name">uncategories</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><span class="post-title-index">1.</span><a href="#前言" class="headerlink" title="前言"></a> 前言</h1><p><a href="http://www.voidking.com/dev-ubuntu-14.04.5-server-install/">《Ubuntu 14.04.5 Server物理机安装》</a>一文中，我们安装了一台Ubuntu Server服务器，整个过程花费了很多时间。令人难过的是，还有15台机器需要安装！本来打算每天安装个一两台，慢慢来，今天老师提醒说为什么不使用脚本呢？对啊，为什么不试试脚本呢！这是一个思路。突然想起师兄曾说，机房的机器系统安装都是通过网络，这也是一个很好的思路啊！</p><p>按照上面两个思路，那就研究下批量安装Ubuntu系统的方法！</p><span id="more"></span><h1 id="原理篇"><span class="post-title-index">2.</span><a href="#原理篇" class="headerlink" title="原理篇"></a> 原理篇</h1><h2 id="历史"><span class="post-title-index">2.1.</span><a href="#历史" class="headerlink" title="历史"></a> 历史</h2><p>参考<a target="_blank" rel="noopener" href="http://book.51cto.com/art/201403/430773.htm">PXE、kickstart与preseed简介</a>、<a target="_blank" rel="noopener" href="http://os.51cto.com/art/201008/218652.htm">Linux装机利器Cobbler简述</a>和<a target="_blank" rel="noopener" href="https://my.oschina.net/tinyhare/blog/378406">ubuntu 14.04 无人职守全自动安装-基础知识</a>中，郝同学简单归纳了批量装机的发展。</p><p>历史上，很多同学都遇到过和我同样的问题，机器太多，需要挨个装机，简直就是折磨！</p><p>于是，为了降低批量装机的难度，出现了PXE技术，它将操作系统远程下载到本地运行，有了这个技术，我们就不需要再挨个机器插U盘安装系统。</p><p>有了PXE技术，依然需要在安装的过程中不停地与机器进行交互，设置选项，费时费力。为了减轻同学们的工作量，RedHat推出了kickstart，在安装操作系统前将其中出现的各种问题的应答内容提前写好，使整个操作系统的安装可以自动完成。Debian系的Ubuntu等感觉kickstart对自己不够友善，不能完全满足自己的要求，于是推出了preseed。</p><p>再后来，因为kickstart难度系数太高，RedHad又推出了cobbler，把批量装机的难度降低到了小学水平。</p><h2 id="PXE"><span class="post-title-index">2.2.</span><a href="#PXE" class="headerlink" title="PXE"></a> PXE</h2><p>PXE是Intel公司开发的将操作系统远程下载到本地运行的一种技术。</p><p>本地网卡ROM中包含有PXE客户端软件。网卡启动时会发出DHCP请求，从PXE服务器端获得动态IP地址、网关及TFTP服务器信息后，它会自动下载一个用于引导操作系统的启动软件包到本地内存（不同的操作系统使用不同的PXE引导文件）中，再通过此软件加载操作系统启动文件，从而开始操作系统的安装工作。</p><p>PXE的详细介绍请参考<a target="_blank" rel="noopener" href="https://www.linuxidc.com/Linux/2017-10/147379.htm">自动化运维之-PXE实现系统批量自动安装</a>和<a target="_blank" rel="noopener" href="https://jingyan.baidu.com/article/22a299b5e1ad899e19376a84.html">PXE网络装机攻略</a>。</p><h2 id="kickstart与preseed"><span class="post-title-index">2.3.</span><a href="#kickstart与preseed" class="headerlink" title="kickstart与preseed"></a> kickstart与preseed</h2><p>在我们手动安装操作系统时，需要回答各种提示问题，而针对某种特定应用时，这种回答完全有章可循，如果我们能在安装操作系统时将其中出现的各种问题的应答内容提前写好，那么整个操作系统的安装就可以自动完成。</p><p>kickstart是RedHat公司针对自动安装RedHat、Fedora与CentOS这3种同一体系的操作系统而制定的问答规范。它一般会以.cfg作为文件后缀名，不仅可以自动应答一些简单问题，还可以指定操作系统需要安装的各种软件包，更可以在操作系统完装完成后自动执行一些脚本，这些脚本可以让我们直接配置系统。</p><p>通常，kickstart配置文件通过命令行工具system-config-kickstart生成。当然，我们更喜欢在CentOS图形界面环境下生成用于定制操作系统安装的配置文件。</p><p>preseed则是Debian/Ubuntu操作系统自动安装的问答规范，同样可以预定义Ubuntu如何安装，其配置更多通过手动处理。</p><h2 id="cobbler"><span class="post-title-index">2.4.</span><a href="#cobbler" class="headerlink" title="cobbler"></a> cobbler</h2><p>RedHat在2008年发布了网络安装服务器套件 cobbler（补鞋匠），它集成了PXE、DHCP、HTTP、TFTP、kickstart等服务，相对之前的 kickstart ，能够更加快捷、方便的批量布署redhat、centos类系统。</p><h2 id="选择"><span class="post-title-index">2.5.</span><a href="#选择" class="headerlink" title="选择"></a> 选择</h2><p>由上面的基础概念我们了解到，可选择的技术组合有：</p><ul><li>PXE+DHCP+HTTP+TFTP+kickstart</li><li>PXE+DHCP+HTTP+TFTP+preseed</li><li>PXE+DHCP+HTTP+TFTP+kickstart+preseed</li><li>PXE+cobbler</li><li>PXE+cobbler+preseed</li></ul><p>本文，我们选择PXE+DHCP+HTTP+TFTP+kickstart+preseed，主要参考<a target="_blank" rel="noopener" href="http://blog.mccode.net/2016/05/pxe-network-installation-ubuntu14-04/">PXE无人值守网络安装Ubuntu14.04</a> 、 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/danxi/p/6181479.html">PXE+kickstart自动安装ubuntu14.04</a> 和 <a target="_blank" rel="noopener" href="https://linux.cn/article-6553-1.html">在 Ubuntu 14.04 中配置 PXE 服务器</a>。</p><h1 id="实践篇"><span class="post-title-index">3.</span><a href="#实践篇" class="headerlink" title="实践篇"></a> 实践篇</h1><h2 id="PXE服务器"><span class="post-title-index">3.1.</span><a href="#PXE服务器" class="headerlink" title="PXE服务器"></a> PXE服务器</h2><p>PXE服务器选择我们手动安装好的那一台，系统是Ubuntu 14.04.5 Server (64-bit)版，当前IP为172.16.0.213。</p><p>配置为PXE服务器后网段为10.0.0.0/8，IP为10.0.0.100。</p><h2 id="DHCP"><span class="post-title-index">3.2.</span><a href="#DHCP" class="headerlink" title="DHCP"></a> DHCP</h2><p>1、安装isc-dhcp-server<br><code>sudo apt-get update</code></p><p><code>sudo apt-get install isc-dhcp-server -y</code></p><p>2、查看网卡和ip<br><code>ip add</code>或者<code>ifconfig</code>，查看正在使用的局域网网卡，假设为eth0。</p><p>3、指定dhcp网卡<br><code>sudo vim /etc/default/isc-dhcp-server</code><br>拉到最底部，修改为：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">INTERFACES</span><span class="operator">=</span><span class="string">&quot;eth0&quot;</span></span><br></pre></td></tr></table></figure><p>4、配置dhcp服务<br><code>sudo vim /etc/dhcp/dhcpd.conf</code><br>在文件末尾添加：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">subnet <span class="number">10.0.0.0</span> netmask <span class="number">255.0.0.0</span> &#123;</span><br><span class="line">    range <span class="number">10.0.0.101</span> <span class="number">10.0.0.200</span><span class="comment">;</span></span><br><span class="line">    option subnet-mask <span class="number">255.0.0.0</span><span class="comment">;</span></span><br><span class="line">    option routers <span class="number">10.0.0.100</span><span class="comment">;</span></span><br><span class="line">    option broadcast-address <span class="number">10.255.255.255</span><span class="comment">;</span></span><br><span class="line">    filename &quot;pxelinux.<span class="number">0</span>&quot;<span class="comment">;</span></span><br><span class="line">    next-server <span class="number">10.0.0.100</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>子网和掩码可以根据自己的需要设置。</p><p><code>filename &quot;pxelinux.0&quot;;</code>，指定PXE启动文件名。<br><code>next-server 10.0.0.100;</code>，指定PXE服务器IP地址，TFTP服务器IP地址。</p><p>5、重启服务<br><code>service isc-dhcp-server restart</code></p><p>备注：也可以安装DNSmasq，DNSmasq实际上是一个集成工具，包含了DNS、DHCP、TFTP服务器。</p><h2 id="TFTP"><span class="post-title-index">3.3.</span><a href="#TFTP" class="headerlink" title="TFTP"></a> TFTP</h2><p>主要参考<a target="_blank" rel="noopener" href="http://wiki.ubuntu.org.cn/Tftpd-hpa">Tftpd-hpa</a></p><p>1、安装tftpd-hpa<br><code>apt-get install tftpd-hpa -y</code></p><p>2、给根目录添加读写权限<br><code>sudo chmod 777 /var/lib/tftpboot/</code></p><p>3、测试tftp</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="keyword">get</span> install tftp -y</span><br><span class="line">cd ~</span><br><span class="line">tftp <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="keyword">get</span> <span class="keyword">version</span>.<span class="keyword">info</span></span><br></pre></td></tr></table></figure><p>4、tftpd开启关闭命令<br><code>sudo /etc/init.d/tftpd-hpa start</code></p><p><code>sudo /etc/init.d/tftpd-hpa stop</code></p><h2 id="apache2"><span class="post-title-index">3.4.</span><a href="#apache2" class="headerlink" title="apache2"></a> apache2</h2><p>1、安装apache2<br><code>sudo apt-get install apache2 -y</code></p><p>web根目录是 <code>/var/www/html/</code></p><p>2、测试apache2<br><code>curl 127.0.0.1</code></p><p>3、重启命令<br><code>sudo /etc/init.d/apache2 restart</code></p><h2 id="文件准备"><span class="post-title-index">3.5.</span><a href="#文件准备" class="headerlink" title="文件准备"></a> 文件准备</h2><p>1、上传ubuntu-14.04.5-server-amd64.iso到用户目录。使用xftp上传，或者使用scp命令，这里使用scp命令。打开git bash，执行：<br><code>scp ubuntu-14.04.5-server-amd64.iso test@172.16.0.213:~</code></p><p>2、挂载ubuntu-14.04.5-server-amd64.iso到ubuntu目录。在用户目录执行：<br><code>sudo mkdir /var/www/html/ubuntu</code></p><p><code>sudo mount ubuntu-14.04.5-server-amd64.iso /var/www/html/ubuntu</code></p><p>3、拷贝部分文件到tftp<br><code>sudo cp -r /var/www/html/ubuntu/install/netboot/* /var/lib/tftpboot/</code></p><p>4、拷贝seed文件到web根目录<br><code>sudo cp /var/www/html/ubuntu/preseed/ubuntu-server.seed /var/www/html/</code></p><p>5、编辑seed文件<br><code>sudo vim /var/www/html/ubuntu-server.seed</code></p><p>在文件末尾添加：</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d-i live-installer/net-image <span class="keyword">string</span> http://<span class="number">10.0</span>.<span class="number">0.100</span>/ubuntu/<span class="keyword">install</span>/filesystem.squashfs</span><br><span class="line">d-i pkgsel/<span class="keyword">include</span> <span class="keyword">string</span> openssh-server</span><br></pre></td></tr></table></figure><p>（1）因为在ubuntu12.10版本以后，安装一些包会依赖于预配置的文件系统，这就是导致使用kickstart方式无法成功安装的原因。<br>（2）自动安装ssh服务。</p><h2 id="kickstart"><span class="post-title-index">3.6.</span><a href="#kickstart" class="headerlink" title="kickstart"></a> kickstart</h2><p>ks.cfg中保存的是安装系统过程中默认的系统配置，没有这个文件就需要安装中对系统手动交互设置。kickstart则是方便编辑这个文件的，不用它的话也可以手工编辑。</p><p>kickstart需要GUI界面，我因为是安装的server，所以需要安装桌面（如果是desktop版本就不需要）。</p><p>1、安装图形界面<br><code>sudo apt-get install ubuntu-desktop -y</code></p><p>过程非常久，请先去继续读论文。</p><p>2、安装kickstart<br><code>sudo apt-get install system-config-kickstart -y</code></p><p>3、使用屏幕键盘连接主机，进入图形界面<br><code>sudo startx</code>，或者直接重启<code>sudo reboot</code></p><p>4、点击右上角“Search your computer and online resources”，搜索kickstart，启动kickstart。</p><p>5、然后，按照图示选择kickstart的配置。<br><img src="http://cdn.voidking.com//imgs/ubuntu-auto-install/config-ks.jpg"></p><p>附：上图的长图合成工具为 <a target="_blank" rel="noopener" href="http://xiuxiu.web.meitu.com/puzzle/photo/">美图秀秀网页版</a></p><p>6、保存ks.cfg后，查看ks.cfg内容为：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Generated by Kickstart Configurator</span></span><br><span class="line"><span class="comment">#platform=AMD64 or Intel EM64T</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#System language</span></span><br><span class="line">lang en_US</span><br><span class="line"><span class="comment">#Language modules to install</span></span><br><span class="line">langsupport en_US</span><br><span class="line"><span class="comment">#System keyboard</span></span><br><span class="line">keyboard us</span><br><span class="line"><span class="comment">#System mouse</span></span><br><span class="line">mouse</span><br><span class="line"><span class="comment">#System timezone</span></span><br><span class="line">timezone Asia/Shanghai</span><br><span class="line"><span class="comment">#Root password</span></span><br><span class="line">rootpw <span class="params">--disabled</span></span><br><span class="line"><span class="comment">#Initial user</span></span><br><span class="line">user test <span class="params">--fullname</span> <span class="string">&quot;test&quot;</span> <span class="params">--iscrypted</span> <span class="params">--password</span> $1$AKq0i3Yu$Tunuha7bYwq5uUV62F2nF0</span><br><span class="line"><span class="comment">#Reboot after installation</span></span><br><span class="line"></span><br><span class="line">reboot</span><br><span class="line"><span class="comment">#Use text mode install</span></span><br><span class="line">text</span><br><span class="line"><span class="comment">#Install OS instead of upgrade</span></span><br><span class="line">install</span><br><span class="line"><span class="comment">#Use Web installation</span></span><br><span class="line">url <span class="params">--url</span> http:<span class="string">//10.0.0.100/ubuntu</span></span><br><span class="line"><span class="comment">#System bootloader configuration</span></span><br><span class="line">bootloader <span class="params">--location=mbr</span> </span><br><span class="line"><span class="comment">#Clear the Master Boot Record</span></span><br><span class="line">zerombr yes</span><br><span class="line"><span class="comment">#Partition clearing information</span></span><br><span class="line">clearpart <span class="params">--all</span> <span class="params">--initlabel</span> </span><br><span class="line"><span class="comment">#System authorization infomation</span></span><br><span class="line">auth  <span class="params">--useshadow</span>  <span class="params">--enablemd5</span> </span><br><span class="line"><span class="comment">#Network information</span></span><br><span class="line">network <span class="params">--bootproto=dhcp</span> <span class="params">--device=eth0</span></span><br><span class="line"><span class="comment">#Firewall configuration</span></span><br><span class="line">firewall <span class="params">--disabled</span> <span class="params">--trust=eth0</span> <span class="params">--ssh</span> </span><br><span class="line"><span class="comment">#Do not configure the X Window System</span></span><br><span class="line">skipx</span><br></pre></td></tr></table></figure><p>7、移动ks.cfg到web根目录<br><code>sudo mv ks.cfg /var/www/html/</code></p><p>8、修改txt.cfg<br><code>sudo vim /var/lib/tftpboot/ubuntu-installer/amd64/boot-screens/txt.cfg</code>，原txt.cfg为：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">default install</span><br><span class="line">label install</span><br><span class="line">        menu label ^Install</span><br><span class="line">        menu<span class="built_in"> default</span></span><br><span class="line"><span class="built_in"></span>        kernel ubuntu-installer/amd64/linux</span><br><span class="line">        append <span class="attribute">vga</span>=788 <span class="attribute">initrd</span>=ubuntu-installer/amd64/initrd.gz --- quiet </span><br><span class="line">label cli</span><br><span class="line">        menu label ^Command-line install</span><br><span class="line">        kernel ubuntu-installer/amd64/linux</span><br><span class="line">        append <span class="attribute">tasks</span>=standard pkgsel/language-pack-patterns= pkgsel/<span class="attribute">install-language-support</span>=<span class="literal">false</span> <span class="attribute">vga</span>=788 <span class="attribute">initrd</span>=ubuntu-installer/amd64/initrd.gz --- quiet </span><br></pre></td></tr></table></figure><p>修改为：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">default install</span><br><span class="line">label install</span><br><span class="line">        menu label ^Install</span><br><span class="line">        menu<span class="built_in"> default</span></span><br><span class="line"><span class="built_in"></span>        kernel ubuntu-installer/amd64/linux</span><br><span class="line">        append <span class="attribute">ks</span>=http://10.0.0.100/ks.cfg preseed/<span class="attribute">url</span>=http://10.0.0.100/ubuntu-server.seed netcfg/<span class="attribute">get_nameservers</span>=10.0.0.100 <span class="attribute">vga</span>=788 <span class="attribute">initrd</span>=ubuntu-installer/amd64/initrd.gz --- quiet </span><br><span class="line">label cli</span><br><span class="line">        menu label ^Command-line install</span><br><span class="line">        kernel ubuntu-installer/amd64/linux</span><br><span class="line">        append <span class="attribute">tasks</span>=standard pkgsel/language-pack-patterns= pkgsel/<span class="attribute">install-language-support</span>=<span class="literal">false</span> <span class="attribute">vga</span>=788 <span class="attribute">initrd</span>=ubuntu-installer/amd64/initrd.gz --- quiet</span><br></pre></td></tr></table></figure><h2 id="pxelinux-cfg"><span class="post-title-index">3.7.</span><a href="#pxelinux-cfg" class="headerlink" title="pxelinux.cfg"></a> pxelinux.cfg</h2><p>编辑pxelinux.cfg配置文件<br><code>sudo vim /var/lib/tftpboot/pxelinux.cfg/default</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># D-I config version 2.0</span></span><br><span class="line">include ubuntu-installer/amd64/boot-screens/menu.cfg</span><br><span class="line">default ubuntu-installer/amd64/boot-screens/vesamenu.c32</span><br><span class="line">prompt 0</span><br><span class="line"><span class="built_in">timeout</span> 60</span><br></pre></td></tr></table></figure><p>timeout默认是0，改为60（6秒后自动选择install选项）。</p><h2 id="收尾"><span class="post-title-index">3.8.</span><a href="#收尾" class="headerlink" title="收尾"></a> 收尾</h2><p>1、重新配置IP<br><code>sudo vim /etc/network/interfaces</code>，修改eth0的IP为10.0.0.100：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This file describes the network interfaces available on your system</span></span><br><span class="line"><span class="comment"># and how to activate them. For more information, see interfaces(5).</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The loopback network interface</span></span><br><span class="line"><span class="attribute">auto</span> lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line"><span class="comment"># The primary network interface</span></span><br><span class="line">auto eth0</span><br><span class="line">iface eth0 inet static</span><br><span class="line">address <span class="number">10.0.0.100</span></span><br><span class="line">gateway <span class="number">10.0.0.100</span></span><br><span class="line">netmask <span class="number">255.0.0.0</span></span><br></pre></td></tr></table></figure><p>2、重启eth0<br><code>sudo ifdown eth0</code>，<code>sudo ifup eth0</code></p><p>3、重启dhcp<br><code>sudo service isc-dhcp-server restart</code></p><p>4、重新挂载镜像<br><code>sudo mount ubuntu-14.04.5-server-amd64.iso /var/www/html/ubuntu</code></p><p>5、检查各个服务<br><code>ps aux | grep dhcp</code></p><p><code>ps aux | grep apache</code></p><p><code>ps aux | grep tftp</code></p><p>6、把PC和PXE服务器连接到同一个交换机，测试一下PC能否获取到IP。</p><p>7、PC浏览器访问 <a target="_blank" rel="noopener" href="http://10.0.0.100/ubuntu/">http://10.0.0.100/ubuntu/</a> ，测试能否正常访问Web服务。</p><h1 id="安装篇"><span class="post-title-index">4.</span><a href="#安装篇" class="headerlink" title="安装篇"></a> 安装篇</h1><h2 id="安装步骤"><span class="post-title-index">4.1.</span><a href="#安装步骤" class="headerlink" title="安装步骤"></a> 安装步骤</h2><p>1、把PXE服务器和需要安装系统的主机（下文统一称为目标主机）连接到同一个交换机。</p><p>2、目标主机开机启动进入BIOS，首选启动项选择PXE，保存退出。</p><p>3、然后，目标主机就会自动获取IP地址，连接PXE服务器，进入到安装界面。<br><img src="http://cdn.voidking.com//imgs/ubuntu-auto-install/install.jpg"></p><p>4、在自动网络配置的时候失败，报错“Network autoconfiguration failed”，多次尝试依然失败。<br><img src="http://cdn.voidking.com//imgs/ubuntu-auto-install/network.jpg"><br>Alt+F2，进入命令行界面，<code>ip add</code>，查看到已经获取到IP地址。</p><p>Alt+F1，切换回安装界面，这时需要手动配置，一次不行就再来一次。</p><p><img src="http://cdn.voidking.com//imgs/ubuntu-auto-install/network-manual.jpg"></p><p>5、安装过程中，分区后卡住，需要手动选择确认分区。<br><img src="http://cdn.voidking.com//imgs/ubuntu-auto-install/partition.jpg"></p><p>6、之后，无需任何操作，直到安装成功。</p><p>7、测试ssh服务<br><code>ssh test@localhost</code>，顺利登录。</p><p>以上安装过程，已经省去了很多交互步骤，但是依然比较麻烦，主要存在两个问题：一个是自动配置网络的问题，一个是需要分区确认的问题。下面尝试解决这两个问题。</p><h2 id="网络问题"><span class="post-title-index">4.2.</span><a href="#网络问题" class="headerlink" title="网络问题"></a> 网络问题</h2><p>1、对于网络配置问题，在<a target="_blank" rel="noopener" href="https://askubuntu.com/questions/459721/14-04-server-pxe-installation-fails-at-configure-the-network-page">14.04 server PXE installation fails at “Configure the network” page</a> 找到了可能的答案，也许是<code>/var/lib/tftpboot/pxelinux.cfg/default</code> 文件的问题，修改为：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># D-I config version 2.0</span></span><br><span class="line">include ubuntu-installer/amd64/boot-screens/menu.cfg<span class="built_in"></span></span><br><span class="line"><span class="built_in">default </span>linux</span><br><span class="line">label linux</span><br><span class="line">  menu<span class="built_in"> default</span></span><br><span class="line"><span class="built_in"></span>  menu label Linux</span><br><span class="line">  kernel ubuntu-installer/amd64/linux</span><br><span class="line">  append <span class="attribute">ks</span>=http://10.0.0.100/ks.cfg preseed/<span class="attribute">url</span>=http://10.0.0.100/ubuntu-server.seed <span class="attribute">vga</span>=normal <span class="attribute">initrd</span>=ubuntu-installer/amd64/initrd.gz --</span><br><span class="line">prompt 0</span><br><span class="line">timeout 60</span><br></pre></td></tr></table></figure><p>问题依旧。最好再改回原来的<code>/var/lib/tftpboot/pxelinux.cfg/default</code>文件配置，因为这样启动时通过DHCP获取IP的时间明显变长了，有时还会出现无法获取IP以至于无法启动安装的情况。如果没有获取到IP，记得及时按下ctrl+alt+del，进行重启，不然要等很久才能开始第二次尝试。</p><p>2、莫非是dhcp配置的问题？参考<a target="_blank" rel="noopener" href="https://askubuntu.com/questions/459721/14-04-server-pxe-installation-fails-at-configure-the-network-page">14.04 server PXE installation fails at “Configure the network” page</a>修改网卡配置为：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This file describes the network interfaces available on your system</span></span><br><span class="line"><span class="comment"># and how to activate them. For more information, see interfaces(5).</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The loopback network interface</span></span><br><span class="line"><span class="attribute">auto</span> lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line"><span class="comment"># The primary network interface</span></span><br><span class="line">auto eth0</span><br><span class="line">iface eth0 inet static</span><br><span class="line">address <span class="number">10.0.0.100</span></span><br><span class="line">netmask <span class="number">255.0.0.0</span></span><br><span class="line">gateway <span class="number">10.0.0.100</span></span><br><span class="line">broadcast <span class="number">10.255.255.255</span></span><br><span class="line">dns-nameservers <span class="number">10.0.0.100</span></span><br></pre></td></tr></table></figure><p>重启网络，<code>sudo ifdown eth0</code>，<code>sudo ifup eth0</code>。<br>重启dhcp，<code>sudo service isc-dhcp-server restart</code>。<br>问题依旧。</p><p>3、参考<a target="_blank" rel="noopener" href="https://www.linuxsecrets.com/900-install-and-configure-pxe-server-on-ubuntu-14-04-lts">Install And Configure PXE Server On Ubuntu 14.04 LTS</a>，<code>sudo vim /etc/dhcp/dhcpd.conf</code>，在最后添加：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">allow booting<span class="comment">;</span></span><br><span class="line">allow bootp<span class="comment">;</span></span><br><span class="line">option option-<span class="number">128</span> code <span class="number">128</span> <span class="operator">=</span> string<span class="comment">;</span></span><br><span class="line">option option-<span class="number">129</span> code <span class="number">129</span> <span class="operator">=</span> text<span class="comment">;</span></span><br><span class="line">next-server <span class="number">10.0</span>.<span class="number">0.100</span><span class="comment">;</span></span><br><span class="line">filename <span class="string">&quot;pxelinux.0&quot;</span><span class="comment">;</span></span><br></pre></td></tr></table></figure><p>重启dhcp，<code>sudo service isc-dhcp-server restart</code>。<br>问题依旧。</p><p>4、莫非是因为没有安装DNS？参考<a href="http://www.voidking.com/dev-ubuntu-dns-server/">《Ubuntu14.04配置DNS Server》</a>，安装好DNS。<br>问题依旧。</p><p>5、参考<a target="_blank" rel="noopener" href="https://github.com/jameswthorne/preseeds/blob/master/ubuntu-server-14.04-unattended-cobbler.seed">preseeds</a>，<code>sudo vim /var/www/html/ubuntu-server.seed</code>，在尾部添加：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d-i netcfg/choose_interface <span class="keyword">select</span> auto</span><br><span class="line">d-i netcfg/get_hostname string <span class="variable">$hostname</span></span><br></pre></td></tr></table></figure><p>问题依旧。</p><p>6、删除步骤第5次尝试的内容，参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/boycy/article/details/44081311"></a>，<code>sudo vim /var/www/html/ubuntu-server.seed</code>，在尾部添加：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">d-i netcfg/choose_interface <span class="keyword">select</span> eth0</span><br><span class="line">d-i netcfg/dhcp_timeout string 60</span><br><span class="line">d-i netcfg/get_hostname string ubuntu</span><br><span class="line">d-i netcfg/get_domain string ubuntu-domain</span><br></pre></td></tr></table></figure><p>问题依旧。</p><p>7、删除步骤第6次尝试的内容，参考<a target="_blank" rel="noopener" href="https://wenku.baidu.com/view/d5c27b39d15abe23492f4d26.html">基于PXE和preseed安装Ubuntu-14.04 Server 64位操作系统</a>，<code>sudo vim /var/www/html/ubuntu-server.seed</code>，在尾部添加：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">d-i netcfg/choose_interface <span class="keyword">select</span> eth0</span><br><span class="line">d-i netcfg/dhcp_failed note</span><br><span class="line">d-i netcfg/dhcp_options <span class="keyword">select</span> Do not configure the network at this time</span><br><span class="line">d-i netcfg/get_hostname string ubuntu</span><br><span class="line">d-i netcfg/get_domain string ubuntu-domain</span><br></pre></td></tr></table></figure><p>问题依旧。</p><p>8、参考<a target="_blank" rel="noopener" href="https://www.debian.org/releases/stable/amd64/apbs04.html.zh-cn">附录 B. 使用预置自动进行安装</a>，<code>sudo vim /var/www/html/ubuntu-server.seed</code>，在尾部添加：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># If you prefer to configure the network manually, uncomment this line and</span></span><br><span class="line"><span class="comment"># the static network configuration below.</span></span><br><span class="line">d-i netcfg/disable_dhcp boolean <span class="literal">true</span></span><br><span class="line">d-i netcfg/disable_autoconfig boolean <span class="literal">true</span></span><br><span class="line">d-i netcfg/use_autoconfig boolean <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If you want the preconfiguration file to work on systems both with and</span></span><br><span class="line"><span class="comment"># without a dhcp server, uncomment these lines and the static network</span></span><br><span class="line"><span class="comment"># configuration below.</span></span><br><span class="line">d-i netcfg/dhcp_failed note</span><br><span class="line">d-i netcfg/dhcp_options <span class="keyword">select</span> Configure network manually</span><br><span class="line"></span><br><span class="line"><span class="comment"># Static network configuration.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># IPv4 example</span></span><br><span class="line">d-i netcfg/get_ipaddress string 10.0.0.134</span><br><span class="line">d-i netcfg/get_netmask string 255.0.0.0</span><br><span class="line">d-i netcfg/get_gateway string 10.0.0.100</span><br><span class="line">d-i netcfg/get_nameservers string 10.0.0.100</span><br><span class="line">d-i netcfg/confirm_static boolean <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>问题依旧。感觉netcfg这个系列的命令根本没有生效！</p><p><a target="_blank" rel="noopener" href="https://www.debian.org/releases/stable/amd64/apbs04.html.zh-cn">附录 B. 使用预置自动进行安装</a>一文中说，例如，为网卡设置静态地址。它使加载了预置文件以后网络预置再运行一次，这需要将下面的命令包含在 “preseed/run” 脚本里面：<br><code>kill-all-dhcp; netcfg</code></p><p>于是在<a target="_blank" rel="noopener" href="https://askubuntu.com/questions/294338/is-it-possible-to-download-a-bash-script-and-execute-it-from-a-preseed-file">Is it possible to download a bash script and execute it from a preseed file?</a>和<a target="_blank" rel="noopener" href="https://github.com/Sprezzatech/netcfg-udeb/blob/master/kill-all-dhcp">kill-all-dhcp</a>中找到了使用脚本的方法。<br>（1）创建脚本<br><code>sudo vim /var/www/html/run.sh</code><br>写入内容为：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment"># Killall for dhcp clients.</span></span><br><span class="line"></span><br><span class="line">kill-all-dhcp;</span><br><span class="line">netcfg;</span><br><span class="line"><span class="keyword">for</span> client <span class="keyword">in</span> dhclient udhcpc pump dhcp6c; <span class="keyword">do</span></span><br><span class="line">        pid=$(pidof <span class="variable">$client</span>) || <span class="literal">true</span></span><br><span class="line">        [ <span class="string">&quot;<span class="variable">$pid</span>&quot;</span> ] || <span class="built_in">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">kill</span> -0 <span class="variable">$pid</span> 2&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">kill</span> -TERM <span class="variable">$pid</span></span><br><span class="line">                <span class="built_in">sleep</span> 1</span><br><span class="line">                <span class="comment"># Still alive? Die!</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">kill</span> -0 <span class="variable">$pid</span> 2&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">                        <span class="built_in">kill</span> -KILL <span class="variable">$pid</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>（2）变更权限<br><code>sudo chmod a+x /var/www/html/run.sh</code></p><p>（3）在ubuntu-server.seed文件中添加一行：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d-i preseed/<span class="built_in">run</span> <span class="built_in">string</span> <span class="built_in">run</span>.sh</span><br></pre></td></tr></table></figure><p>问题依旧，但是Alt+F2进入命令行，发现获取的IP确实没有了。</p><p>9、莫非，是因为DHCP的网段问题？折腾了一个多小时，PXE服务器地址换成192.168.34.1，DHCP换成了192.168.34.0网段，然而并没有什么用。</p><p>最终，我猜测这个锅是ubuntu14的，或者是电脑硬件的。在askubuntu上进行了<a target="_blank" rel="noopener" href="https://askubuntu.com/questions/1036411/pxe-network-autoconfiguration-failed">提问</a>，但是没有得到满意的回复。</p><h2 id="分区问题"><span class="post-title-index">4.3.</span><a href="#分区问题" class="headerlink" title="分区问题"></a> 分区问题</h2><p>1、参考<a target="_blank" rel="noopener" href="https://serverfault.com/questions/189328/ubuntu-kickstart-installation-using-lvm-waits-for-input">Ubuntu Kickstart installation using LVM waits for input</a>，修改ks.cfg文件。</p><p><code>sudo vim /var/www/html/ks.cfg</code>，添加：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preseed partman-lvm/confirm_nooverwrite <span class="built_in">bool</span>ean <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>问题依旧。</p><p>2、<code>sudo vim /var/www/html/ks.cfg</code>，添加：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">preseed partman-lvm/confirm_nooverwrite <span class="built_in">bool</span>ean <span class="literal">true</span></span><br><span class="line">preseed partman-lvm/device_remove_lvm <span class="built_in">bool</span>ean <span class="literal">true</span></span><br><span class="line">preseed partman/confirm_write_new_label <span class="built_in">bool</span>ean <span class="literal">true</span></span><br><span class="line">preseed partman/confirm <span class="built_in">bool</span>ean <span class="literal">true</span></span><br><span class="line">preseed partman/confirm_nooverwrite <span class="built_in">bool</span>ean <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>问题依旧。</p><p>3、删除ks.cfg中添加的内容，参考<a target="_blank" rel="noopener" href="https://ubuntuforums.org/showthread.php?t=1549202">Automated Kickstart Partitioning</a>，<code>sudo vim /var/www/html/ubuntu-server.seed</code>，在末尾加上：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d-i partman/confirm_write_new_label <span class="type">boolean</span> <span class="keyword">true</span></span><br><span class="line">d-i partman/choose_partition <span class="keyword">select</span> Finish partitioning <span class="keyword">and</span> <span class="keyword">write</span> changes <span class="keyword">to</span> disk</span><br><span class="line">d-i partman/confirm <span class="type">boolean</span> <span class="keyword">true</span></span><br></pre></td></tr></table></figure><p>分区成功，吼吼吼！折腾了一整天，总算有点成就，泪流满面。。。让我安静的哭一会。。。</p><h1 id="后记"><span class="post-title-index">5.</span><a href="#后记" class="headerlink" title="后记"></a> 后记</h1><p>配置Ubuntu批量自动安装的过程中，发现最重要的两个文件是<code>/var/www/html/ks.cfg</code> 和 <code>/var/www/html/ubuntu-server.seed</code>，因为他们两个是控制交互的。</p><p>折腾的过程中学到了很多东西，而最终的成果，除了网络需要手动配置之外，其他都很满意。我会继续尝试解决网络配置的问题，有了进展，再更新本文。</p><h1 id="书签"><span class="post-title-index">6.</span><a href="#书签" class="headerlink" title="书签"></a> 书签</h1><p><a target="_blank" rel="noopener" href="http://blog.mccode.net/2016/05/pxe-network-installation-ubuntu14-04/">PXE无人值守网络安装Ubuntu14.04</a></p><p><a target="_blank" rel="noopener" href="http://blog.oldboyedu.com/autoinstall-kickstart/">KICKSTART无人值守安装</a></p><p><a target="_blank" rel="noopener" href="http://blog.oldboyedu.com/autoinstall-cobbler/">COBBLER无人值守安装</a></p><p><a target="_blank" rel="noopener" href="http://blog.51cto.com/yangzhiming/2052396">Cobbler+preseed自动化安装Ubuntu系统</a></p><p><a target="_blank" rel="noopener" href="http://blog.51cto.com/liwenhn/1931251">Ubuntu 16.04.2 LTS PXE全自动安装</a></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/kakane/article/details/8167404">u盘全自动安装 ubuntu server 12.04</a></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Frank_Abagnale/article/details/78963876">CentOS/Ubuntu制作自动安装iso实操</a></p><p><a target="_blank" rel="noopener" href="https://help.ubuntu.com/community/Installation/UnattendedCD">Installation/UnattendedCD</a></p><p><a target="_blank" rel="noopener" href="https://www.syslinux.org/wiki/index.php?title=PXELINUX">PXELINUX</a></p><p><a target="_blank" rel="noopener" href="http://linux.vbird.org/linux_enterprise/0120installation.php">第二章、安裝伺服器與 kickstart 大量部署用戶端電腦</a></p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>原文链接：</strong> <a href="https://www.voidking.com/dev-ubuntu-auto-install/" title="Ubuntu系统批量自动安装">https://www.voidking.com/dev-ubuntu-auto-install/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本文采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议，转载请注明出处！源站会即时更新知识点并修正错误，欢迎访问~</li><li> <img width="200" height="200" src="/images/avatar.jpg"><p style="text-align:center;margin-bottom:0">微信公众号同步更新，欢迎关注~</p></li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/ubuntu/" rel="tag"># ubuntu</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="tag"># 操作系统</a> <a href="/tags/pxe/" rel="tag"># pxe</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-ubuntu-14.04.5-server-install/" rel="prev" title="Ubuntu 14.04.5 Server物理机安装"><i class="fa fa-chevron-left"></i> Ubuntu 14.04.5 Server物理机安装</a></div><div class="post-nav-item"> <a href="/dev-ubuntu-dns-server/" rel="next" title="Ubuntu14.04安装配置DNS服务">Ubuntu14.04安装配置DNS服务<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3284447971731414" data-ad-slot="9697986181"></ins><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">1. 前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8E%9F%E7%90%86%E7%AF%87"><span class="nav-text">2. 原理篇</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8E%86%E5%8F%B2"><span class="nav-text">2.1. 历史</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PXE"><span class="nav-text">2.2. PXE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#kickstart%E4%B8%8Epreseed"><span class="nav-text">2.3. kickstart与preseed</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cobbler"><span class="nav-text">2.4. cobbler</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%89%E6%8B%A9"><span class="nav-text">2.5. 选择</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E8%B7%B5%E7%AF%87"><span class="nav-text">3. 实践篇</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#PXE%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-text">3.1. PXE服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DHCP"><span class="nav-text">3.2. DHCP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TFTP"><span class="nav-text">3.3. TFTP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#apache2"><span class="nav-text">3.4. apache2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%87%86%E5%A4%87"><span class="nav-text">3.5. 文件准备</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#kickstart"><span class="nav-text">3.6. kickstart</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pxelinux-cfg"><span class="nav-text">3.7. pxelinux.cfg</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%94%B6%E5%B0%BE"><span class="nav-text">3.8. 收尾</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E7%AF%87"><span class="nav-text">4. 安装篇</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4"><span class="nav-text">4.1. 安装步骤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E9%97%AE%E9%A2%98"><span class="nav-text">4.2. 网络问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E5%8C%BA%E9%97%AE%E9%A2%98"><span class="nav-text">4.3. 分区问题</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E8%AE%B0"><span class="nav-text">5. 后记</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B9%A6%E7%AD%BE"><span class="nav-text">6. 书签</span></a></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">一个计算机技术爱好者与学习者</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">702</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">31</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">251</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: '62956c804c2e4605a0d7d4efa457a41b',
      title: 'Ubuntu系统批量自动安装',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>