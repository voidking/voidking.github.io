<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="目标完成了《Ubuntu16手动安装OpenStack——neutron篇》，意味着keystone、glance、nova和neutron都已经安装完成，也就是说，openstack最小安装已经完成。在安装horizon、cinder和swift之前，我们先来通过命令行创建一个实例，验证一下之前的安装。 主要参考OpenStack Queens : Add Users、OpenStack Que"><meta property="og:type" content="article"><meta property="og:title" content="Ubuntu16手动安装OpenStack——创建实例"><meta property="og:url" content="https://www.voidking.com/dev-ubuntu16-manual-openstack-instance/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="目标完成了《Ubuntu16手动安装OpenStack——neutron篇》，意味着keystone、glance、nova和neutron都已经安装完成，也就是说，openstack最小安装已经完成。在安装horizon、cinder和swift之前，我们先来通过命令行创建一个实例，验证一下之前的安装。 主要参考OpenStack Queens : Add Users、OpenStack Que"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/ip.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/routen.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/sharednet.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/subnet.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/netlist.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/flavor.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/lists.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/secgroup.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/secgrouplist.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/addkey.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/cirros0.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/server.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/icmp.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/ssh.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/secrule.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/vnc0.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/vnc.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/ip2.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/br.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/routen2.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/ping.jpg?imageView2/0/w/750"><meta property="article:published_time" content="2018-07-06T09:30:00.000Z"><meta property="article:modified_time" content="2018-07-06T09:30:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="openstack"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/ip.jpg?imageView2/0/w/750"><link rel="canonical" href="https://www.voidking.com/dev-ubuntu16-manual-openstack-instance/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Ubuntu16手动安装OpenStack——创建实例 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-ubuntu16-manual-openstack-instance/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Ubuntu16手动安装OpenStack——创建实例</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-07-06 09:30:00" itemprop="dateCreated datePublished" datetime="2018-07-06T09:30:00+00:00">2018-07-06</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>完成了<a href="https://www.voidking.com/dev-ubuntu16-manual-openstack-neutron/">《Ubuntu16手动安装OpenStack——neutron篇》</a>，意味着keystone、glance、nova和neutron都已经安装完成，也就是说，openstack最小安装已经完成。在安装horizon、cinder和swift之前，我们先来通过命令行创建一个实例，验证一下之前的安装。</p><p>主要参考<a target="_blank" rel="noopener" href="https://www.server-world.info/en/note?os=Ubuntu_16.04&p=openstack_queens&f=13">OpenStack Queens : Add Users</a>、<a target="_blank" rel="noopener" href="https://www.server-world.info/en/note?os=Ubuntu_16.04&p=openstack_queens&f=13">OpenStack Queens : Add Users</a> 和 <a target="_blank" rel="noopener" href="https://www.server-world.info/en/note?os=Ubuntu_16.04&p=openstack_queens&f=14">OpenStack Queens : Boot Instances</a>。</p><span id="more"></span><h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>本文操作全部都是在控制节点。<br>为了避免权限问题，建议切换到root用户进行操作（否则要加很多sudo）。<br><code>sudo -i</code></p><h1 id="网卡配置"><a href="#网卡配置" class="headerlink" title="网卡配置"></a>网卡配置</h1><p>参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/horizonli/p/5172065.html">Openstack的网卡设置</a>和和<a target="_blank" rel="noopener" href="https://www.mirantis.com/blog/openstack-networking-single-host-flatdhcpmanager/">OpenStack Networking Tutorial: Single-host FlatDHCPManager</a>，配置eth2网卡。</p><p>1、查看当前网络，<code>ip add</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/ip.jpg?imageView2/0/w/750"></p><p><code>route -n</code>，<code>brctl show</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/routen.jpg?imageView2/0/w/750"></p><p>2、<code>vim /etc/network/interfaces</code>，添加：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">auto</span> eth2</span><br><span class="line">iface eth2 inet manual</span><br><span class="line">  up ifconfig <span class="variable">$IFACE</span> <span class="number">0.0.0.0</span> up</span><br><span class="line">  up ifconfig <span class="variable">$IFACE</span> promisc</span><br><span class="line"><span class="comment">#iface eth2 inet manual</span></span><br><span class="line"><span class="comment">#up ifconfig eth2 up</span></span><br></pre></td></tr></table></figure><p>3、启用网卡，<code>ifup eth2</code></p><h1 id="创建子网"><a href="#创建子网" class="headerlink" title="创建子网"></a>创建子网</h1><p>1、<code>vi /etc/neutron/plugins/ml2/ml2_conf.ini</code>，如下修改：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># line 181: add</span></span><br><span class="line"><span class="section">[ml2_type_flat]</span></span><br><span class="line"><span class="attr">flat_networks</span> = physnet1</span><br></pre></td></tr></table></figure><p>2、<code>vi /etc/neutron/plugins/ml2/linuxbridge_agent.ini</code>，如下修改：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># line 147: add</span></span><br><span class="line"><span class="section">[linux_bridge]</span></span><br><span class="line"><span class="attr">physical_interface_mappings</span> = physnet1:eth2</span><br><span class="line"><span class="comment"># line 208: uncomment and change</span></span><br><span class="line"><span class="attr">enable_vxlan</span> = <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>3、重启neutron-linuxbridge-agent<br><code>systemctl restart neutron-linuxbridge-agent</code></p><p>4、获取projectID<br><code>. admin-openrc</code></p><p><code>projectID=$(openstack project list | grep service | awk &#39;&#123;print $2&#125;&#39;)</code></p><p>5、创建名为sharednet1的网络</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openstack network create <span class="attr">--project</span> <span class="variable">$projectID</span> \</span><br><span class="line"><span class="attr">--share</span> <span class="attr">--provider-network-type</span> flat <span class="attr">--provider-physical-network</span> physnet1 sharednet1</span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/sharednet.jpg?imageView2/0/w/750"></p><p>6、在sharednet1中创建子网10.0.0.0/24</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">openstack</span> subnet create subnet1 --network sharednet1 \</span><br><span class="line">--project <span class="variable">$projectID</span> --subnet-range <span class="number">10.0.0.0</span>/<span class="number">24</span> \</span><br><span class="line">--allocation-pool start=<span class="number">10.0.0.200</span>,end=<span class="number">10.0.0.254</span> \</span><br><span class="line">--gateway <span class="number">10.0.0.1</span> --dns-nameserver <span class="number">10.0.0.10</span></span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/subnet.jpg?imageView2/0/w/750"></p><p>7、查看网络<br><code>openstack network list</code></p><p><code>openstack subnet list</code></p><p><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/netlist.jpg?imageView2/0/w/750"></p><h1 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h1><p>首先使admin环境生效，<code>. admin-openrc</code>。</p><p>1、添加siat项目<br><code>openstack project create --domain default --description &quot;SIAT Project&quot; siat</code></p><p>2、添加voidking用户，密码为openstack<br><code>openstack user create --domain default --project siat --password openstack voidking</code></p><p>3、添加clouduser角色<br><code>openstack role create clouduser</code></p><p>4、给voidking用户添加clouduser角色<br><code>openstack role add --project siat --user voidking clouduser</code></p><p>5、因为cirros需要的资源很少，所以创建一个类型模板m1.tiny<br><code>openstack flavor create --id 0 --vcpus 1 --ram 256 --disk 5 m1.tiny</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/flavor.jpg?imageView2/0/w/750"></p><h1 id="创建实例"><a href="#创建实例" class="headerlink" title="创建实例"></a>创建实例</h1><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><p>1、<code>vi ~/voidkingrc</code>，创建voidking环境脚本，内容如下：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="attribute">OS_PROJECT_DOMAIN_NAME</span>=default</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">OS_USER_DOMAIN_NAME</span>=default</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">OS_PROJECT_NAME</span>=siat</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">OS_USERNAME</span>=voidking</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">OS_PASSWORD</span>=openstack</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">OS_AUTH_URL</span>=http://controller:5000/v3</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">OS_IDENTITY_API_VERSION</span>=3</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">OS_IMAGE_API_VERSION</span>=2</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">PS1</span>=<span class="string">&#x27;\u@\h \W(keystone)\$ &#x27;</span></span><br></pre></td></tr></table></figure><p>2、使环境生效<br><code>. voidkingrc</code></p><p>3、查看类型模板<br><code>openstack flavor list</code></p><p>4、查看可用镜像<br><code>openstack image list</code></p><p>5、查看可用网络<br><code>openstack network list</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/lists.jpg?imageView2/0/w/750"></p><p>6、创建安全组<br><code>openstack security group create secgroup01</code></p><p><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/secgroup.jpg?imageView2/0/w/750"></p><p>7、查看安全组<br><code>openstack security group list</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/secgrouplist.jpg?imageView2/0/w/750"></p><p>8、创建ssh密钥<br><code>ssh-keygen -q -N &quot;&quot;</code></p><p>密钥文件保存在/home/root/.ssh/目录下。</p><p>9、添加公钥<br><code>openstack keypair create --public-key ~/.ssh/id_rsa.pub vkkey</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/addkey.jpg?imageView2/0/w/750"></p><p>10、查看公钥<br><code>openstack keypair list</code></p><h2 id="创建实例-1"><a href="#创建实例-1" class="headerlink" title="创建实例"></a>创建实例</h2><p>1、给netID赋值<br><code>netID=$(openstack network list | grep sharednet1 | awk &#39;&#123; print $2 &#125;&#39;)</code></p><p>2、创建实例</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openstack server create <span class="attr">--flavor</span> m1<span class="selector-class">.tiny</span> \</span><br><span class="line"><span class="attr">--image</span> cirros <span class="attr">--security-group</span> secgroup01 \</span><br><span class="line"><span class="attr">--nic</span> net-id=<span class="variable">$netID</span> <span class="attr">--key-name</span> vkkey cirros0</span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/cirros0.jpg?imageView2/0/w/750"></p><p>3、查看实例<br><code>openstack server list</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/server.jpg?imageView2/0/w/750"></p><p>如上图，已经成功启动实例，ip为10.0.0.206，nice。</p><p>PS：删除实例命令，<code>openstack server delete cirros0</code></p><h2 id="访问实例"><a href="#访问实例" class="headerlink" title="访问实例"></a>访问实例</h2><p>配置安全组的安全设置，以便使用SSH和ICMP进行访问。</p><p>1、设置允许ICMP<br><code>openstack security group rule create --protocol icmp --ingress secgroup01</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/icmp.jpg?imageView2/0/w/750"></p><p>2、设置允许ssh<br><code>openstack security group rule create --protocol tcp --dst-port 22:22 secgroup01</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/ssh.jpg?imageView2/0/w/750"></p><p>3、查看安全组规则<br><code>openstack security group rule list</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/secrule.jpg?imageView2/0/w/750"></p><p>4、访问测试<br><code>ping 10.0.0.206 -c3</code></p><p>ping不通，看来网络出了问题，等会再解决这个问题。</p><p>5、查看vnc的url，并复制该url<br><code>openstack console url show cirros0</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/vnc0.jpg?imageView2/0/w/750"></p><p>6、url中的controller替换为192.168.56.110，在浏览器中打开<br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/vnc.jpg?imageView2/0/w/750"></p><p>顺利访问，可以看到，cirros0的ip为192.168.56.102，难怪10.0.0.206无法ping通。</p><p>控制节点上，<code>ping 192.168.56.102</code>，依然不通。<br>vnc中，<code>ping 192.168.56.110</code>，也不通。</p><h1 id="网络问题"><a href="#网络问题" class="headerlink" title="网络问题"></a>网络问题</h1><h2 id="网桥支持"><a href="#网桥支持" class="headerlink" title="网桥支持"></a>网桥支持</h2><p><a target="_blank" rel="noopener" href="https://docs.openstack.org/neutron/queens/install/controller-install-option1-ubuntu.html#configure-the-linux-bridge-agent">Configure the Linux bridge agent</a>一节中，提到过要启用网桥支持，那就启用网桥试试。</p><p>1、查看ip转发<br><code>cat /proc/sys/net/ipv4/ip_forward</code><br>如果值为0，那么改为1。</p><p>2、启用网桥支持<br><code>vim /etc/sysctl.conf</code>，添加</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">net</span>.bridge.bridge-nf-<span class="keyword">call</span>-iptables = <span class="number">1</span></span><br><span class="line"><span class="built_in">net</span>.bridge.bridge-nf-<span class="keyword">call</span>-ip6tables = <span class="number">1</span></span><br></pre></td></tr></table></figure><p>3、使配置生效<br><code>sysctl -p</code></p><p>修改后，依然无法ping通10.0.0.206。</p><h2 id="网卡配置-1"><a href="#网卡配置-1" class="headerlink" title="网卡配置"></a>网卡配置</h2><p>1、查看ip<br><code>ip add</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/ip2.jpg?imageView2/0/w/750"><br>如上图，和本文开始时相比，多了三个接口。</p><p>2、查看网桥<br><code>brctl show</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/br.jpg?imageView2/0/w/750"></p><p>3、<code>vim /etc/network/interfaces</code>，添加</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">auto</span> brqedda68f7-<span class="number">72</span></span><br><span class="line"><span class="attribute">iface</span> brqedda68f7-<span class="number">72</span> inet static</span><br><span class="line"><span class="attribute">address</span> <span class="number">10.0.0.1</span></span><br><span class="line"><span class="attribute">netmask</span> <span class="number">255.255.255.0</span></span><br><span class="line"><span class="attribute">bridge_stp</span> <span class="literal">off</span></span><br><span class="line"><span class="attribute">bridge_fd</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p>然后启用brqedda68f7-72端口，<code>ifup brqedda68f7-72</code></p><p>或者不配置interfaces，直接执行<code>ifconfig brqedda68f7-72 10.0.0.1/24 up</code></p><p>5、查看网络<br><code>ip add</code></p><p><code>route -n</code></p><p><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/routen2.jpg?imageView2/0/w/750"></p><p>不过，依然无法ping通10.0.0.206。毕竟，cirros0的ip不是10.0.0.206，而是192.168.56.102。这个ip，明显是通过VirtualBox分配的，和虚拟机在同一个网段。</p><h2 id="修改ip"><a href="#修改ip" class="headerlink" title="修改ip"></a>修改ip</h2><p>既然cirros0的ip不对，那就给它手动修改一下，好主意。<br>1、通过vnc登录cirros0</p><p>2、<code>sudo vi /etc/network/interfaces</code>，修改eth0的配置为：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">auto</span> eth0</span><br><span class="line">iface eth0 inet static</span><br><span class="line">address <span class="number">10.0.0.206</span></span><br><span class="line">netmask <span class="number">255.255.255.0</span></span><br></pre></td></tr></table></figure><p>3、重启eth0<br><code>sudo ifdown eth0</code></p><p><code>sudo ifup eth0</code></p><p>4、在控制节点测试连接<br><code>ping 10.0.0.206 -c3</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-instance/ping.jpg?imageView2/0/w/750"></p><p>至此，问题解决。</p><h1 id="访问实例-1"><a href="#访问实例-1" class="headerlink" title="访问实例"></a>访问实例</h1><p>1、cirros当前只支持密码访问：<br><code>ssh cirros@10.0.0.206</code>，输入密码gocubsgo。</p><p>登录后执行<code>ls .ssh</code>，并没有authorized_keys文件，看来创建实例时并没有注入密钥，不知道什么原因。</p><p>2、在控制节点，添加密钥到cirros0<br><code>ssh-copy-id -i .ssh/id_rsa.pub -p 22 cirros@10.0.0.206</code></p><p>3、用密钥测试登录<br><code>ssh cirros@10.0.0.206 -i .ssh/id_rsa</code></p><p>登录成功。</p><p>4、如果重启了控制节点，那么需要手动启动cirros0<br><code>openstack server start cirros0</code></p><p>5、vnc的token也会改变，所以要重新获取<br><code>openstack console url show cirros0</code></p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>至此，已经完成了吗？想到一些问题：</p><ul><li>cirros0理论上应该通过浮动ip进行访问，我们这种直接访问是闹哪样？</li><li>以后每次创建实例，都要通过vnc重新配置ip？</li><li>以后每次创建实例，都要手动添加密钥？</li></ul><p>也许是因为VirtualBox网卡分配不对，也许是因为在虚拟机中安装，也许是因为控制节点网络配置不对。。。不管了，反正创建实例完成，其他问题放在以后的文章中解决。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-ubuntu16-manual-openstack-instance/" title="Ubuntu16手动安装OpenStack——创建实例">https://www.voidking.com/dev-ubuntu16-manual-openstack-instance/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/ubuntu/" rel="tag"># ubuntu</a> <a href="/tags/openstack/" rel="tag"># openstack</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-ubuntu16-manual-openstack-neutron/" rel="prev" title="Ubuntu16手动安装OpenStack——neutron篇"><i class="fa fa-chevron-left"></i> Ubuntu16手动安装OpenStack——neutron篇</a></div><div class="post-nav-item"> <a href="/dev-ubuntu16-manual-openstack-horizon/" rel="next" title="Ubuntu16手动安装OpenStack——horizon篇">Ubuntu16手动安装OpenStack——horizon篇<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87"><span class="nav-number">1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AF%B4%E6%98%8E"><span class="nav-number">2.</span> <span class="nav-text">说明</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE"><span class="nav-number">3.</span> <span class="nav-text">网卡配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%90%E7%BD%91"><span class="nav-number">4.</span> <span class="nav-text">创建子网</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7"><span class="nav-number">5.</span> <span class="nav-text">添加用户</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BE%8B"><span class="nav-number">6.</span> <span class="nav-text">创建实例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="nav-number">6.1.</span> <span class="nav-text">环境准备</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BE%8B-1"><span class="nav-number">6.2.</span> <span class="nav-text">创建实例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E5%AE%9E%E4%BE%8B"><span class="nav-number">6.3.</span> <span class="nav-text">访问实例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E9%97%AE%E9%A2%98"><span class="nav-number">7.</span> <span class="nav-text">网络问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E6%A1%A5%E6%94%AF%E6%8C%81"><span class="nav-number">7.1.</span> <span class="nav-text">网桥支持</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE-1"><span class="nav-number">7.2.</span> <span class="nav-text">网卡配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9ip"><span class="nav-number">7.3.</span> <span class="nav-text">修改ip</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E5%AE%9E%E4%BE%8B-1"><span class="nav-number">8.</span> <span class="nav-text">访问实例</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E8%AE%B0"><span class="nav-number">9.</span> <span class="nav-text">后记</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">630</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">31</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">233</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>