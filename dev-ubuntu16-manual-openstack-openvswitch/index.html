<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="目标《Ubuntu16手动安装OpenStack——实例访问外网》一文中，已经配置好了实例访问外网。但是仍有不足，因为我们看不到更详细网络信息，排查问题不方便。 本文，我们把linuxbridge-agent更换为openvswitch-agent，主要参考OpenStack Pike : Configure Neutron、Neutron Configuration Options和Open v"><meta property="og:type" content="article"><meta property="og:title" content="Ubuntu16手动安装OpenStack——openvswitch"><meta property="og:url" content="https://www.voidking.com/dev-ubuntu16-manual-openstack-openvswitch/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="目标《Ubuntu16手动安装OpenStack——实例访问外网》一文中，已经配置好了实例访问外网。但是仍有不足，因为我们看不到更详细网络信息，排查问题不方便。 本文，我们把linuxbridge-agent更换为openvswitch-agent，主要参考OpenStack Pike : Configure Neutron、Neutron Configuration Options和Open v"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-openvswitch/agentlist.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-openvswitch/agentlist2.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-openvswitch/agentlist3.jpg?imageView2/0/w/750"><meta property="og:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-openvswitch/agentlist4.jpg?imageView2/0/w/750"><meta property="article:published_time" content="2018-07-17T14:00:00.000Z"><meta property="article:modified_time" content="2018-07-17T14:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="openstack"><meta property="article:tag" content="网络"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-openvswitch/agentlist.jpg?imageView2/0/w/750"><link rel="canonical" href="https://www.voidking.com/dev-ubuntu16-manual-openstack-openvswitch/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Ubuntu16手动安装OpenStack——openvswitch | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-ubuntu16-manual-openstack-openvswitch/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Ubuntu16手动安装OpenStack——openvswitch</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-07-17 14:00:00" itemprop="dateCreated datePublished" datetime="2018-07-17T14:00:00+00:00">2018-07-17</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p><a href="https://www.voidking.com/dev-ubuntu16-manual-openstack-internet/">《Ubuntu16手动安装OpenStack——实例访问外网》</a>一文中，已经配置好了实例访问外网。但是仍有不足，因为我们看不到更详细网络信息，排查问题不方便。</p><p>本文，我们把linuxbridge-agent更换为openvswitch-agent，主要参考<a target="_blank" rel="noopener" href="https://www.server-world.info/en/note?os=CentOS_7&p=openstack_pike&f=16">OpenStack Pike : Configure Neutron</a>、<a target="_blank" rel="noopener" href="https://docs.openstack.org/neutron/queens/configuration/index.html">Neutron Configuration Options</a>和<a target="_blank" rel="noopener" href="https://docs.openstack.org/ocata/networking-guide/deploy-ovs-selfservice.html">Open vSwitch: Self-service networks</a>。</p><span id="more"></span><h1 id="openvswitch简介"><a href="#openvswitch简介" class="headerlink" title="openvswitch简介"></a>openvswitch简介</h1><p>以下简介摘自<a target="_blank" rel="noopener" href="https://opengers.github.io/openstack/openstack-base-use-openvswitch/">openstack底层技术-使用openvswitch</a>。</p><p>在过去，数据中心的服务器是直接连在硬件交换机上，后来VMware实现了服务器虚拟化技术，使虚拟服务器(VMs)能够连接在虚拟交换机上。借助这个虚拟交换机，可以为服务器上运行的VMs或容器提供逻辑的虚拟的以太网接口，这些逻辑接口都连接到虚拟交换机上。有三种比较流行的虚拟交换机：VMware virtual switch，Cisco Nexus 1000V和Open vSwitch。</p><p>Open vSwitch(OVS)是运行在虚拟化平台上的虚拟交换机，其支持OpenFlow协议，也支持gre/vxlan/IPsec等隧道技术。在OVS之前，基于Linux的虚拟化平台比如KVM或Xen上，缺少一个功能丰富的虚拟交换机，因此OVS迅速崛起并开始在Xen/KVM中流行起来，并且应用于越来越多的开源项目，比如openstack neutron中的网络解决方案。</p><p>在虚拟交换机的Flow控制器或管理工具方面，一些商业产品都集成有控制器或管理工具，比如Cisco 1000V的Virtual Supervisor Manager(VSM)，VMware的分布式交换机中的vCenter。而OVS则需要借助第三方控制器或管理工具实现复杂的转发策略。例如OVS支持OpenFlow协议，我们就可以使用任何支持OpenFlow协议的控制器来对OVS进行远程管理。OpenStack Neutron中的ML2插件也能够实现对OVS的管理。但这并不意味着OVS必须要有一个控制器才能工作。在不连接外部控制器情况下，OVS自身可以依靠MAC地址学习实现二层数据包转发功能，就像Linux Bridge。</p><p>在基于Linux内核的系统上，应用最广泛的还是系统自带的虚拟交换机Linux Bridge，它是一个单纯的基于MAC地址学习的二层交换机，简单高效，但同时缺乏一些高级特性，比如OpenFlow、VLAN tag、QOS、ACL、Flow等，而且在隧道协议支持上，Linux Bridge只支持vxlan，OVS支持gre/vxlan/IPsec等，这也决定了OVS更适用于实现SDN技术。</p><h1 id="控制节点"><a href="#控制节点" class="headerlink" title="控制节点"></a>控制节点</h1><h2 id="root用户"><a href="#root用户" class="headerlink" title="root用户"></a>root用户</h2><p>为了避免权限问题，建议切换到root用户进行操作（否则要加很多sudo）。<br><code>sudo -i</code></p><h2 id="卸载linuxbridge"><a href="#卸载linuxbridge" class="headerlink" title="卸载linuxbridge"></a>卸载linuxbridge</h2><p>在安装OVS之前，我们先删除实例和网络，卸载掉linuxbridge。</p><p>1、使admin环境生效<br><code>. admin-openrc</code></p><p>2、查看当前网络组件<br><code>openstack network agent list</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-openvswitch/agentlist.jpg?imageView2/0/w/750"></p><p>3、在dashboard使用admin账户登录，依次删除实例、路由和网络。</p><p>4、卸载linuxbridge</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">disable</span> neutron-linuxbridge-agent</span><br><span class="line">systemctl stop    neutron-linuxbridge-agent</span><br><span class="line">apt <span class="built_in">remove</span> -y neutron-plugin-linuxbridge-agent</span><br></pre></td></tr></table></figure><p>5、查看当前网络组件<br><code>openstack network agent list</code><br><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-openvswitch/agentlist2.jpg?imageView2/0/w/750"><br>此时，controller节点上的Linux bridge agent已经从笑脸变成了XXX。</p><p>6、从数据库删除Linux bridge agent</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Bridge</span>=`openstack<span class="built_in"> network </span>agent list | grep <span class="string">&#x27;Linux bridge agent&#x27;</span>|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">echo <span class="variable">$Bridge</span></span><br><span class="line">neutron agent-delete <span class="variable">$Bridge</span></span><br><span class="line">openstack<span class="built_in"> network </span>agent list</span><br></pre></td></tr></table></figure><p>7、重新创建neutron数据库<br><code>mysql -uroot -p</code>，密码为openstack。</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> neutron;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> neutron;</span><br></pre></td></tr></table></figure><p>8、参考<a href="https://www.voidking.com/dev-ubuntu16-manual-openstack-neutron/">Ubuntu16手动安装OpenStack——neutron篇</a>，创建好证书和服务端点。</p><h2 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h2><p>1、安装相关组件</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="keyword">get</span> -y install neutron-<span class="keyword">server</span> neutron-metadata-agent neutron-plugin-ml2 python-neutronclient</span><br></pre></td></tr></table></figure><p>2、备份neutron.conf<br><code>mv /etc/neutron/neutron.conf /etc/neutron/neutron.conf.bak</code></p><p>3、<code>vim /etc/neutron/neutron.conf</code>，新建neutron.conf内容为：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="attr">core_plugin</span> = ml2</span><br><span class="line"><span class="attr">service_plugins</span> = router</span><br><span class="line"><span class="attr">auth_strategy</span> = keystone</span><br><span class="line"><span class="attr">state_path</span> = /var/lib/neutron</span><br><span class="line"><span class="attr">dhcp_agent_notification</span> = <span class="literal">True</span></span><br><span class="line"><span class="attr">allow_overlapping_ips</span> = <span class="literal">True</span></span><br><span class="line"><span class="attr">notify_nova_on_port_status_changes</span> = <span class="literal">True</span></span><br><span class="line"><span class="attr">notify_nova_on_port_data_changes</span> = <span class="literal">True</span></span><br><span class="line"><span class="comment"># RabbitMQ connection info</span></span><br><span class="line"><span class="attr">transport_url</span> = rabbit://openstack:openstack@controller</span><br><span class="line"></span><br><span class="line"><span class="section">[agent]</span></span><br><span class="line"><span class="attr">root_helper</span> = sudo /usr/bin/neutron-rootwrap /etc/neutron/rootwrap.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># Keystone auth info</span></span><br><span class="line"><span class="section">[keystone_authtoken]</span></span><br><span class="line"><span class="attr">www_authenticate_uri</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">memcached_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = default</span><br><span class="line"><span class="attr">user_domain_name</span> = default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = neutron</span><br><span class="line"><span class="attr">password</span> = openstack</span><br><span class="line"></span><br><span class="line"><span class="comment"># MariaDB connection info</span></span><br><span class="line"><span class="section">[database]</span></span><br><span class="line"><span class="attr">connection</span> = mysql+pymysql://neutron:openstack@controller/neutron</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nova connection info</span></span><br><span class="line"><span class="section">[nova]</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = default</span><br><span class="line"><span class="attr">user_domain_name</span> = default</span><br><span class="line"><span class="attr">region_name</span> = RegionOne</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = nova</span><br><span class="line"><span class="attr">password</span> = openstack</span><br><span class="line"></span><br><span class="line"><span class="section">[oslo_concurrency]</span></span><br><span class="line"><span class="attr">lock_path</span> = <span class="variable">$state_path</span>/tmp</span><br></pre></td></tr></table></figure><p>4、更改权限<br><code>chmod 640 /etc/neutron/neutron.conf</code></p><p><code>chgrp neutron /etc/neutron/neutron.conf</code></p><p>5、<code>vi /etc/neutron/metadata_agent.ini</code>，如下修改：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># line 22: uncomment and specify Nova API server</span></span><br><span class="line"><span class="attr">nova_metadata_host</span> = controller</span><br><span class="line"><span class="comment"># line 34: uncomment and specify any secret key you like</span></span><br><span class="line"><span class="attr">metadata_proxy_shared_secret</span> = openstack</span><br><span class="line"><span class="comment"># line 260: uncomment and specify Memcache Server</span></span><br><span class="line"><span class="attr">memcache_servers</span> = controller:<span class="number">11211</span></span><br></pre></td></tr></table></figure><p>6、<code>vi /etc/neutron/plugins/ml2/ml2_conf.ini</code>，如下修改：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># line 129: add ( it&#x27;s OK with no value for &quot;tenant_network_types&quot; (set later if need) )</span></span><br><span class="line"><span class="section">[ml2]</span></span><br><span class="line"><span class="attr">type_drivers</span> = flat,vlan,gre,vxlan</span><br><span class="line"><span class="attr">tenant_network_types</span> =</span><br><span class="line"><span class="attr">mechanism_drivers</span> = openvswitch,l2population</span><br><span class="line"><span class="attr">extension_drivers</span> = port_security</span><br><span class="line"><span class="comment"># line 262: uncomment and add</span></span><br><span class="line"><span class="attr">enable_security_group</span> = <span class="literal">True</span></span><br><span class="line"><span class="attr">firewall_driver</span> = neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver</span><br><span class="line"><span class="comment"># end line: uncomment</span></span><br><span class="line"><span class="attr">enable_ipset</span> = <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>7、<code>vi /etc/nova/nova.conf</code>，如下修改：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add follows into [DEFAULT] section</span></span><br><span class="line"><span class="attr">use_neutron</span> = <span class="literal">True</span></span><br><span class="line"><span class="attr">linuxnet_interface_driver</span> = nova.network.linux_net.LinuxOVSInterfaceDriver</span><br><span class="line"><span class="attr">firewall_driver</span> = nova.virt.firewall.NoopFirewallDriver</span><br><span class="line"><span class="attr">vif_plugging_is_fatal</span> = <span class="literal">True</span></span><br><span class="line"><span class="attr">vif_plugging_timeout</span> = <span class="number">300</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># add follows to the end : Neutron auth info</span></span><br><span class="line"><span class="comment"># the value of metadata_proxy_shared_secret is the same with the one in metadata_agent.ini</span></span><br><span class="line"><span class="section">[neutron]</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = default</span><br><span class="line"><span class="attr">user_domain_name</span> = default</span><br><span class="line"><span class="attr">region_name</span> = RegionOne</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = neutron</span><br><span class="line"><span class="attr">password</span> = openstack</span><br><span class="line"><span class="attr">service_metadata_proxy</span> = <span class="literal">True</span></span><br><span class="line"><span class="attr">metadata_proxy_shared_secret</span> = openstack</span><br></pre></td></tr></table></figure><p>8、创建链接<br><code>ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini</code></p><p>9、生成数据库数据</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su -s <span class="regexp">/bin/</span>bash neutron -c <span class="string">&quot;neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugin.ini upgrade head&quot;</span></span><br></pre></td></tr></table></figure><p>10、重启neutron服务并设置开机启动</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="keyword">start</span> neutron-<span class="keyword">server</span> neutron-metadata-agent </span><br><span class="line">systemctl <span class="keyword">enable</span> neutron-<span class="keyword">server</span> neutron-metadata-agent </span><br></pre></td></tr></table></figure><p>11、重启nova-api<br><code>systemctl restart nova-api</code></p><h1 id="网络节点"><a href="#网络节点" class="headerlink" title="网络节点"></a>网络节点</h1><p>本文中，控制节点和网络节点是同一个节点。</p><p>1、安装相关组件</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="built_in">get</span> -y install neutron-plugin-ml2 neutron-plugin-openvswitch-<span class="built_in">agent</span> neutron-l3-<span class="built_in">agent</span> neutron-dhcp-<span class="built_in">agent</span> neutron-metadata-<span class="built_in">agent</span> python-neutronclient</span><br></pre></td></tr></table></figure><p>2、备份neutron.conf<br><code>mv /etc/neutron/neutron.conf /etc/neutron/neutron.conf.bak</code></p><p>3、<code>vim /etc/neutron/neutron.conf</code>，新建neutron.conf如下：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="attr">core_plugin</span> = ml2</span><br><span class="line"><span class="attr">service_plugins</span> = router</span><br><span class="line"><span class="attr">auth_strategy</span> = keystone</span><br><span class="line"><span class="attr">state_path</span> = /var/lib/neutron</span><br><span class="line"><span class="attr">allow_overlapping_ips</span> = <span class="literal">True</span></span><br><span class="line"><span class="comment"># RabbitMQ connection info</span></span><br><span class="line"><span class="attr">transport_url</span> = rabbit://openstack:openstack@controller</span><br><span class="line"></span><br><span class="line"><span class="section">[agent]</span></span><br><span class="line"><span class="attr">root_helper</span> = sudo /usr/bin/neutron-rootwrap /etc/neutron/rootwrap.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># Keystone auth info</span></span><br><span class="line"><span class="section">[keystone_authtoken]</span></span><br><span class="line"><span class="attr">www_authenticate_uri</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">memcached_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = default</span><br><span class="line"><span class="attr">user_domain_name</span> = default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = neutron</span><br><span class="line"><span class="attr">password</span> = openstack</span><br><span class="line"></span><br><span class="line"><span class="section">[oslo_concurrency]</span></span><br><span class="line"><span class="attr">lock_path</span> = <span class="variable">$state_path</span>/lock</span><br></pre></td></tr></table></figure><p>4、修改权限<br><code>chmod 640 /etc/neutron/neutron.conf</code></p><p><code>chgrp neutron /etc/neutron/neutron.conf</code></p><p>5、<code>vi /etc/neutron/l3_agent.ini</code>，如下修改：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># line 17: add</span></span><br><span class="line"><span class="attr">interface_driver</span> = neutron.agent.linux.interface.OVSInterfaceDriver</span><br><span class="line"><span class="comment"># line 100: uncomment and change</span></span><br><span class="line"><span class="attr">external_network_bridge</span> = br-eth2</span><br></pre></td></tr></table></figure><p>6、<code>vi /etc/neutron/dhcp_agent.ini</code>，如下修改：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># line 17: add</span></span><br><span class="line"><span class="attr">interface_driver</span> = neutron.agent.linux.interface.OVSInterfaceDriver</span><br><span class="line"><span class="comment"># line 28: uncomment</span></span><br><span class="line"><span class="attr">dhcp_driver</span> = neutron.agent.linux.dhcp.Dnsmasq</span><br><span class="line"><span class="comment"># line 37: uncomment and change</span></span><br><span class="line"><span class="attr">enable_isolated_metadata</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>7、<code>vi /etc/neutron/metadata_agent.ini</code>，如下修改：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># line 22: uncomment and specify Nova API server</span></span><br><span class="line"><span class="attr">nova_metadata_host</span> = controller</span><br><span class="line"><span class="comment"># line 34: uncomment and specify any secret key you like</span></span><br><span class="line"><span class="attr">metadata_proxy_shared_secret</span> = openstack</span><br><span class="line"><span class="comment"># line 260: uncomment and specify Memcache Server</span></span><br><span class="line"><span class="attr">memcache_servers</span> = controller:<span class="number">11211</span></span><br></pre></td></tr></table></figure><p>8、<code>vi /etc/neutron/plugins/ml2/ml2_conf.ini</code>，如下修改：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># line 129: add ( it&#x27;s OK with no value for &quot;tenant_network_types&quot; (set later if need) )</span></span><br><span class="line"><span class="section">[ml2]</span></span><br><span class="line"><span class="attr">type_drivers</span> = flat,vlan,gre,vxlan</span><br><span class="line"><span class="attr">tenant_network_types</span> =</span><br><span class="line"><span class="attr">mechanism_drivers</span> = openvswitch,l2population</span><br><span class="line"><span class="attr">extension_drivers</span> = port_security</span><br><span class="line"><span class="comment"># line 262: uncomment and add</span></span><br><span class="line"><span class="attr">enable_security_group</span> = <span class="literal">True</span></span><br><span class="line"><span class="attr">firewall_driver</span> = neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver</span><br><span class="line"><span class="comment"># end line: uncomment</span></span><br><span class="line"><span class="attr">enable_ipset</span> = <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>9、创建链接<br><code>ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini</code></p><p>10、重启openvswitch并设置开机启动</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart openvswitch-<span class="keyword">switch</span> </span><br><span class="line">systemctl enable openvswitch-<span class="keyword">switch</span> </span><br></pre></td></tr></table></figure><p>11、创建网桥br-int<br><code>ovs-vsctl add-br br-int</code></p><p>12、重启相关服务并设置开机启动</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span><span class="built_in"> service </span><span class="keyword">in</span> dhcp-agent l3-agent metadata-agent openvswitch-agent; <span class="keyword">do</span></span><br><span class="line">systemctl start neutron-<span class="variable">$service</span></span><br><span class="line">systemctl <span class="built_in">enable</span> neutron-<span class="variable">$service</span></span><br><span class="line">done </span><br></pre></td></tr></table></figure><p>13、在控制节点查看neutron服务</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">. <span class="built_in">admin</span>-openrc</span><br><span class="line">openstack network <span class="built_in">agent</span> <span class="built_in">list</span></span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-openvswitch/agentlist3.jpg?imageView2/0/w/750"></p><h1 id="计算节点"><a href="#计算节点" class="headerlink" title="计算节点"></a>计算节点</h1><h2 id="root用户-1"><a href="#root用户-1" class="headerlink" title="root用户"></a>root用户</h2><p>为了避免权限问题，建议切换到root用户进行操作（否则要加很多sudo）。<br><code>sudo -i</code></p><h2 id="卸载linuxbridge-1"><a href="#卸载linuxbridge-1" class="headerlink" title="卸载linuxbridge"></a>卸载linuxbridge</h2><p>1、卸载linuxbridge</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">disable</span> neutron-linuxbridge-agent</span><br><span class="line">systemctl stop    neutron-linuxbridge-agent</span><br><span class="line">apt <span class="built_in">remove</span> -y neutron-plugin-linuxbridge-agent</span><br></pre></td></tr></table></figure><p>2、控制节点查看当前网络组件<br><code>openstack network agent list</code></p><p>3、从数据库删除Linux bridge agent</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Bridge</span>=`openstack<span class="built_in"> network </span>agent list | grep <span class="string">&#x27;Linux bridge agent&#x27;</span>|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">echo <span class="variable">$Bridge</span></span><br><span class="line">neutron agent-delete <span class="variable">$Bridge</span></span><br><span class="line">openstack<span class="built_in"> network </span>agent list</span><br></pre></td></tr></table></figure><h2 id="安装配置-1"><a href="#安装配置-1" class="headerlink" title="安装配置"></a>安装配置</h2><p>1、安装相关组件</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">apt</span>-<span class="meta">get</span> -y install neutron-<span class="meta">common</span> neutron-plugin-ml2 neutron-plugin-openvswitch-agent</span><br></pre></td></tr></table></figure><p>2、备份neutron.conf<br><code>mv /etc/neutron/neutron.conf /etc/neutron/neutron.conf.bak</code></p><p>3、<code>vim /etc/neutron/neutron.conf</code>，新建neutron.conf如下：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="attr">core_plugin</span> = ml2</span><br><span class="line"><span class="attr">service_plugins</span> = router</span><br><span class="line"><span class="attr">auth_strategy</span> = keystone</span><br><span class="line"><span class="attr">state_path</span> = /var/lib/neutron</span><br><span class="line"><span class="attr">allow_overlapping_ips</span> = <span class="literal">True</span></span><br><span class="line"><span class="comment"># RabbitMQ connection info</span></span><br><span class="line"><span class="attr">transport_url</span> = rabbit://openstack:openstack@controller</span><br><span class="line"></span><br><span class="line"><span class="section">[agent]</span></span><br><span class="line"><span class="attr">root_helper</span> = sudo /usr/bin/neutron-rootwrap /etc/neutron/rootwrap.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># Keystone auth info</span></span><br><span class="line"><span class="section">[keystone_authtoken]</span></span><br><span class="line"><span class="attr">www_authenticate_uri</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">memcached_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = default</span><br><span class="line"><span class="attr">user_domain_name</span> = default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = neutron</span><br><span class="line"><span class="attr">password</span> = openstack</span><br><span class="line"></span><br><span class="line"><span class="section">[oslo_concurrency]</span></span><br><span class="line"><span class="attr">lock_path</span> = <span class="variable">$state_path</span>/lock</span><br></pre></td></tr></table></figure><p>4、修改权限<br><code>chmod 640 /etc/neutron/neutron.conf</code></p><p><code>chgrp neutron /etc/neutron/neutron.conf</code></p><p>5、<code>vi /etc/neutron/plugins/ml2/ml2_conf.ini</code>，如下修改：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># line 129: add ( it&#x27;s OK with no value for &quot;tenant_network_types&quot; (set later if need) )</span></span><br><span class="line"><span class="section">[ml2]</span></span><br><span class="line"><span class="attr">type_drivers</span> = flat,vlan,gre,vxlan</span><br><span class="line"><span class="attr">tenant_network_types</span> =</span><br><span class="line"><span class="attr">mechanism_drivers</span> = openvswitch,l2population</span><br><span class="line"><span class="attr">extension_drivers</span> = port_security</span><br><span class="line"><span class="comment"># line 262: uncomment and add</span></span><br><span class="line"><span class="attr">enable_security_group</span> = <span class="literal">True</span></span><br><span class="line"><span class="attr">firewall_driver</span> = neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver</span><br><span class="line"><span class="comment"># end line: uncomment</span></span><br><span class="line"><span class="attr">enable_ipset</span> = <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>6、<code>vi /etc/nova/nova.conf</code>，如下修改：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add follows into [DEFAULT] section</span></span><br><span class="line"><span class="attr">use_neutron</span> = <span class="literal">True</span></span><br><span class="line"><span class="attr">linuxnet_interface_driver</span> = nova.network.linux_net.LinuxOVSInterfaceDriver</span><br><span class="line"><span class="attr">firewall_driver</span> = nova.virt.firewall.NoopFirewallDriver</span><br><span class="line"><span class="attr">vif_plugging_is_fatal</span> = <span class="literal">True</span></span><br><span class="line"><span class="attr">vif_plugging_timeout</span> = <span class="number">300</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># add follows to the end : Neutron auth info</span></span><br><span class="line"><span class="comment"># the value of metadata_proxy_shared_secret is the same with the one in metadata_agent.ini</span></span><br><span class="line"><span class="section">[neutron]</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = default</span><br><span class="line"><span class="attr">user_domain_name</span> = default</span><br><span class="line"><span class="attr">region_name</span> = RegionOne</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = neutron</span><br><span class="line"><span class="attr">password</span> = openstack</span><br><span class="line"><span class="attr">service_metadata_proxy</span> = <span class="literal">True</span></span><br><span class="line"><span class="attr">metadata_proxy_shared_secret</span> = openstack</span><br></pre></td></tr></table></figure><p>7、创建链接<br><code>ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini</code></p><p>8、重启openvswitch并设置开机启动</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart openvswitch-<span class="keyword">switch</span> </span><br><span class="line">systemctl enable openvswitch-<span class="keyword">switch</span> </span><br></pre></td></tr></table></figure><p>9、创建网桥br-int<br><code>ovs-vsctl add-br br-int</code></p><p>10、重启nova-compute服务<br><code>systemctl restart nova-compute</code></p><p>11、重启neutron-openvswitch-agent并设置开机启动</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">system</span>ctl restart neutron-openvswitch-agent </span><br><span class="line"><span class="params">system</span>ctl enable neutron-openvswitch-agent </span><br></pre></td></tr></table></figure><p>13、在控制节点查看neutron服务</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">. <span class="built_in">admin</span>-openrc</span><br><span class="line">openstack network <span class="built_in">agent</span> <span class="built_in">list</span></span><br></pre></td></tr></table></figure><p><img src="http://cdn.voidking.com//imgs/ubuntu16-manual-openstack-openvswitch/agentlist4.jpg?imageView2/0/w/750"><br>可以看到，新添加了compute节点的Open vSwitch agent。</p><p>至此，openvswitch安装配置完成。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-ubuntu16-manual-openstack-openvswitch/" title="Ubuntu16手动安装OpenStack——openvswitch">https://www.voidking.com/dev-ubuntu16-manual-openstack-openvswitch/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/ubuntu/" rel="tag"># ubuntu</a> <a href="/tags/openstack/" rel="tag"># openstack</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag"># 网络</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-ubuntu16-manual-openstack-internet/" rel="prev" title="Ubuntu16手动安装OpenStack——实例访问外网"><i class="fa fa-chevron-left"></i> Ubuntu16手动安装OpenStack——实例访问外网</a></div><div class="post-nav-item"> <a href="/dev-ubuntu16-manual-openstack-vxlan-advance/" rel="next" title="Ubuntu16手动安装OpenStack——vxlan网络进阶">Ubuntu16手动安装OpenStack——vxlan网络进阶<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><div class="_xduxciwe4ao"></div><div class="_ft8kcphe7kl"></div><script type="text/javascript">(window.slotbydup=window.slotbydup||[]).push({id:"u6921432",container:"_ft8kcphe7kl",async:!0})</script><script type="text/javascript">(window.slotbydup=window.slotbydup||[]).push({id:"u6920911",container:"_xduxciwe4ao",async:!0}),(window.slotbydup=window.slotbydup||[]).push({id:"u6920919",container:"_053ydasmd31h",async:!0}),(window.slotbydup=window.slotbydup||[]).push({id:"u6921432",container:"_ft8kcphe7kl",async:!0})</script><script type="text/javascript" src="//cpro.baidustatic.com/cpro/ui/cm.js" async="async" defer="defer"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87"><span class="nav-number">1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#openvswitch%E7%AE%80%E4%BB%8B"><span class="nav-number">2.</span> <span class="nav-text">openvswitch简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9"><span class="nav-number">3.</span> <span class="nav-text">控制节点</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#root%E7%94%A8%E6%88%B7"><span class="nav-number">3.1.</span> <span class="nav-text">root用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%B8%E8%BD%BDlinuxbridge"><span class="nav-number">3.2.</span> <span class="nav-text">卸载linuxbridge</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE"><span class="nav-number">3.3.</span> <span class="nav-text">安装配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E8%8A%82%E7%82%B9"><span class="nav-number">4.</span> <span class="nav-text">网络节点</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9"><span class="nav-number">5.</span> <span class="nav-text">计算节点</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#root%E7%94%A8%E6%88%B7-1"><span class="nav-number">5.1.</span> <span class="nav-text">root用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%B8%E8%BD%BDlinuxbridge-1"><span class="nav-number">5.2.</span> <span class="nav-text">卸载linuxbridge</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE-1"><span class="nav-number">5.3.</span> <span class="nav-text">安装配置</span></a></li></ol></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="_053ydasmd31h"></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">645</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">242</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>