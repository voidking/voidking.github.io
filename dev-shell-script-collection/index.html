<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言好多shell命令和脚本，写过就扔了，感觉很可惜。本文持续更新，用于记录实用的常用的命令和脚本。以后再遇到相似的需求，方便进行参考查找。 如果想要系统学习shell脚本编程，推荐学习阮一峰前辈的《Bash 脚本教程》。shell小技巧，可以参考《Linux shell 的实用小技巧》。"><meta property="og:type" content="article"><meta property="og:title" content="shell实用命令和脚本"><meta property="og:url" content="https://www.voidking.com/dev-shell-script-collection/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言好多shell命令和脚本，写过就扔了，感觉很可惜。本文持续更新，用于记录实用的常用的命令和脚本。以后再遇到相似的需求，方便进行参考查找。 如果想要系统学习shell脚本编程，推荐学习阮一峰前辈的《Bash 脚本教程》。shell小技巧，可以参考《Linux shell 的实用小技巧》。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2017-06-02T00:00:00.000Z"><meta property="article:modified_time" content="2022-11-22T07:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="网络"><meta property="article:tag" content="linux"><meta property="article:tag" content="shell"><meta property="article:tag" content="问题排查"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-shell-script-collection/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>shell实用命令和脚本 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-shell-script-collection/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> shell实用命令和脚本</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2017-06-02 08:00:00" itemprop="dateCreated datePublished" datetime="2017-06-02T08:00:00+08:00">2017-06-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-11-22 15:00:00" itemprop="dateModified" datetime="2022-11-22T15:00:00+08:00">2022-11-22</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/shell/" itemprop="url" rel="index"><span itemprop="name">shell</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/network/" itemprop="url" rel="index"><span itemprop="name">network</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/troubleshooting/" itemprop="url" rel="index"><span itemprop="name">troubleshooting</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>好多shell命令和脚本，写过就扔了，感觉很可惜。本文持续更新，用于记录实用的常用的命令和脚本。以后再遇到相似的需求，方便进行参考查找。</p><p>如果想要系统学习shell脚本编程，推荐学习阮一峰前辈的<a href="https://wangdoc.com/bash/" target="_blank" rel="noopener">《Bash 脚本教程》</a>。<br>shell小技巧，可以参考<a href="https://labuladong.gitbook.io/algo/mu-lu-ye-5/linuxshell-ji-qiao" target="_blank" rel="noopener">《Linux shell 的实用小技巧》</a>。</p><a id="more"></a><h1 id="shell命令"><a href="#shell命令" class="headerlink" title="shell命令"></a>shell命令</h1><h2 id="查看硬件配置"><a href="#查看硬件配置" class="headerlink" title="查看硬件配置"></a>查看硬件配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/cpuinfo | grep <span class="string">"cpu cores"</span></span><br><span class="line"></span><br><span class="line">free -h</span><br><span class="line">free -m</span><br><span class="line">cat /proc/meminfo</span><br><span class="line"></span><br><span class="line">lsblk</span><br><span class="line">df -h</span><br><span class="line"></span><br><span class="line">lspci | grep -i vga <span class="comment"># 最前面的序号是显卡代号</span></span><br><span class="line">lspci | grep -i nvidia</span><br><span class="line">lspci -v -s 00:02.0</span><br></pre></td></tr></table></figure><h2 id="查看系统版本"><a href="#查看系统版本" class="headerlink" title="查看系统版本"></a>查看系统版本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lsb_release -a</span><br><span class="line">cat /etc/issue</span><br><span class="line">cat /etc/os-release</span><br><span class="line">cat /etc/centos-release</span><br></pre></td></tr></table></figure><h2 id="查看系统位数"><a href="#查看系统位数" class="headerlink" title="查看系统位数"></a>查看系统位数</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br><span class="line">file /bin/ls</span><br><span class="line">getconf LONG_BIT</span><br></pre></td></tr></table></figure><h2 id="查看是否是物理机"><a href="#查看是否是物理机" class="headerlink" title="查看是否是物理机"></a>查看是否是物理机</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmidecode -s system-product-name</span><br></pre></td></tr></table></figure><h2 id="查看系统日志"><a href="#查看系统日志" class="headerlink" title="查看系统日志"></a>查看系统日志</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dmesg -T</span><br><span class="line">journalctl -xb</span><br></pre></td></tr></table></figure><h2 id="查看磁盘资源占用"><a href="#查看磁盘资源占用" class="headerlink" title="查看磁盘资源占用"></a>查看磁盘资源占用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">du -sh *</span><br><span class="line"></span><br><span class="line">du -sh .[!.]*</span><br></pre></td></tr></table></figure><h2 id="查看命令属于哪个包"><a href="#查看命令属于哪个包" class="headerlink" title="查看命令属于哪个包"></a>查看命令属于哪个包</h2><p>1、centos</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum makecache fast</span><br><span class="line">yum whatprovides lsb_release</span><br></pre></td></tr></table></figure><p>2、ubuntu</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-get install -y apt-file</span><br><span class="line">apt-file update</span><br><span class="line">apt-file search ifconfig</span><br></pre></td></tr></table></figure><h2 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h2><p>创建voidking用户，并添加sudo权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useradd -m voidking -s /bin/bash</span><br><span class="line">passwd voidking</span><br><span class="line">adduser voidking sudo</span><br></pre></td></tr></table></figure><h2 id="生成密钥"><a href="#生成密钥" class="headerlink" title="生成密钥"></a>生成密钥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br><span class="line">ssh-keygen -C <span class="string">"voidking@qq.com"</span> -f ./voidking_rsa</span><br></pre></td></tr></table></figure><p>第一条命令执行完之后，.ssh目录下生成了 id_rsa 和 id_rsa.pub。<br>第二条命令执行完之后，当前目录下生成了 voidking_rsa 和 voidking_rsa.pub，注释内容为 <a href="mailto:voidking@qq.com">voidking@qq.com</a> 。</p><h2 id="使密钥生效"><a href="#使密钥生效" class="headerlink" title="使密钥生效"></a>使密钥生效</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub voidking@hostname</span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub voidking@hostname -p 22</span><br><span class="line">ssh voidking@hostname</span><br></pre></td></tr></table></figure><p>ssh-copy-id 这个命令做的事情，是把 id_rsa.pub 中的内容，追加到 <code>hostname:/home/voidking/.ssh/authorized_keys</code> 文件中。<br>authorized_keys文件权限为600。</p><h2 id="压缩与解压"><a href="#压缩与解压" class="headerlink" title="压缩与解压"></a>压缩与解压</h2><p>压缩和解压tar.gz文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -czvf filename.tar.gz filename</span><br><span class="line">tar -xzvf filename.tar.gz</span><br></pre></td></tr></table></figure><p>压缩和解压zip文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zip filename.zip filename</span><br><span class="line">unzip filename.zip</span><br></pre></td></tr></table></figure><p>加密压缩和解压zip文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">zip -er filename.zip filename</span><br><span class="line">zip -er -P xxxxxx filename.zip filename</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `ls`;<span class="keyword">do</span> zip -er -P xxxxxx <span class="variable">$i</span>.zip <span class="variable">$i</span>;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">unzip -P xxxxxx filename.zip</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> *.zip;<span class="keyword">do</span> unzip -P xxxxxx <span class="variable">$i</span>;<span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>解压中文名zip文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install unar</span><br><span class="line">unar -e GBK 中文名.zip</span><br><span class="line">unar -e GBK -p xxxxxx 中文名.zip</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> *.zip;<span class="keyword">do</span> unar -e GBK -p xxxxxx <span class="variable">$i</span>;<span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="awk注意事项"><a href="#awk注意事项" class="headerlink" title="awk注意事项"></a>awk注意事项</h2><p>awk命令格式：<br><code>awk [选项参数] &#39;script&#39; var=value file(s)</code></p><p>这里需要特别注意的是，包裹script的是单引号，单引号，单引号！<br>参考文档<a href="https://www.runoob.com/linux/linux-comm-awk.html" target="_blank" rel="noopener">Linux awk 命令</a></p><h2 id="删除空行"><a href="#删除空行" class="headerlink" title="删除空行"></a>删除空行</h2><p>过滤hostlist.txt中的空行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat hostlist.txt |tr -s <span class="string">'\n'</span></span><br><span class="line">cat hostlist.txt |sed <span class="string">'/^$/d'</span></span><br><span class="line">cat hostlist.txt |awk <span class="string">'&#123;if($0!="")print&#125;'</span></span><br><span class="line">cat hostlist.txt |awk <span class="string">'&#123;if(length!=0) print $0&#125;'</span></span><br><span class="line">grep -v <span class="string">"^$"</span> hostlist.txt</span><br><span class="line"><span class="comment"># 终极方法（linux和windows空行都适用）</span></span><br><span class="line">grep -v -e <span class="string">'^[[:space:]]*$'</span> hostlist.txt</span><br></pre></td></tr></table></figure><h2 id="过滤windows换行符"><a href="#过滤windows换行符" class="headerlink" title="过滤windows换行符"></a>过滤windows换行符</h2><p>在windows里编辑好的文件，上传到linux后发现多了^M。以过滤hostlist.txt中的^M为例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">'s/^M//g'</span> hostlist.txt</span><br></pre></td></tr></table></figure><p>注意，直接复制粘贴上面的命令是无效的。^M的输入方式是 Ctrl + V ，然后 Ctrl + M 。</p><h2 id="去除空格"><a href="#去除空格" class="headerlink" title="去除空格"></a>去除空格</h2><p>去除test.txt文本中的空格：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat test.txt | tr -d <span class="string">' '</span></span><br></pre></td></tr></table></figure><h2 id="空格转换行"><a href="#空格转换行" class="headerlink" title="空格转换行"></a>空格转换行</h2><p>把test.txt文本中的空格变成换行符。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat test.txt | tr <span class="string">' '</span> <span class="string">'\n'</span></span><br><span class="line">cat test.txt | sed <span class="string">'s/ /\n/g'</span></span><br></pre></td></tr></table></figure><h2 id="查找并插入一行"><a href="#查找并插入一行" class="headerlink" title="查找并插入一行"></a>查找并插入一行</h2><p>查找包含<code>- [engineering,subject0]</code>的文件，<code>- [engineering,subject0]</code>之后紧接着插入一行<code>- [engineering,subject1]</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">'s/- \[engineering,subject0\]/- \[engineering,subject0\]\n- \[engineering,subject1\]/g'</span> *</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">'s/- \[engineering,subject0\]/- \[engineering,subject0\]\n- \[engineering,subject1\]/g'</span> `grep -e <span class="string">'- \[engineering,subject0\]'</span> -rl .`</span><br></pre></td></tr></table></figure><h2 id="大小写字符转换"><a href="#大小写字符转换" class="headerlink" title="大小写字符转换"></a>大小写字符转换</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 大写转小写</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"192.168.56.101 MASTER"</span> | tr <span class="string">'[A-Z]'</span> <span class="string">'[a-z]'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 小写转大写</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"192.168.56.101 master"</span> | tr <span class="string">'[a-z]'</span> <span class="string">'[A-Z]'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 某一列大写转小写</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"192.168.56.101 MASTER"</span> | awk <span class="string">'$3=tolower($2) &#123;print $1" "$2" "$3&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 某一列小写转大写</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"192.168.56.101 master"</span> | awk <span class="string">'$3=toupper($2) &#123;print $1" "$2" "$3&#125;'</span></span><br></pre></td></tr></table></figure><p>PS：对于<code>/etc/hosts</code>中的主机名和域名，只保留大写或者只保留小写就可以了，因为主机名和域名不区分大小写。</p><h2 id="utf8-bom-转-utf8"><a href="#utf8-bom-转-utf8" class="headerlink" title="utf8 bom 转 utf8"></a>utf8 bom 转 utf8</h2><p>使用macos中编译运行windows下创建的java项目，报错 Error:(1, 1) java: 非法字符: ‘\ufeff’。<br>BOM（byte order mark）是为 UTF-16 和 UTF-32 准备的，用于标记字节序（byte order）。<br>微软在 UTF-8 中使用 BOM 是因为这样可以把 UTF-8 和 ASCII 等编码明确区分开，但这样的文件在 Windows 之外的操作系统里会带来问题。<br>那么，怎么把utf8 bom编码文件批量转换为utf8编码文件呢？使用下面的脚本。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当前目录下递归所有文件</span></span><br><span class="line">grep -r -i -l $<span class="string">'^\xEF\xBB\xBF'</span> . | xargs sed -i <span class="string">'s/^\xEF\xBB\xBF//g'</span></span><br><span class="line"><span class="comment"># 当前目录下所有文件</span></span><br><span class="line">grep -i -l $<span class="string">'^\xEF\xBB\xBF'</span> * | xargs sed -i <span class="string">'s/^\xEF\xBB\xBF//g'</span></span><br><span class="line"><span class="comment"># macos</span></span><br><span class="line">brew install gnu-sed</span><br><span class="line">grep -r -i -l $<span class="string">'^\xEF\xBB\xBF'</span> . | xargs gsed -i <span class="string">'s/^\xEF\xBB\xBF//g'</span></span><br><span class="line">grep -i -l $<span class="string">'^\xEF\xBB\xBF'</span> * | xargs gsed -i <span class="string">'s/^\xEF\xBB\xBF//g'</span></span><br></pre></td></tr></table></figure><h2 id="GBK编码转UTF8"><a href="#GBK编码转UTF8" class="headerlink" title="GBK编码转UTF8"></a>GBK编码转UTF8</h2><p>1、单个文件编码转换<br>打开一个文件，发现中文显示乱码，大概率编码问题。使用下面的命令进行转码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iconv -f GBK -t UTF-8 inputfile &gt; outputfile</span><br></pre></td></tr></table></figure><p>2、多个文件批量编码转换</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">find . -<span class="built_in">type</span> f -name <span class="string">"*.py"</span> &gt; filename.txt</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line;<span class="keyword">do</span> </span><br><span class="line">    iconv -f GBK -t UTF-8 <span class="variable">$&#123;line&#125;</span> &gt; <span class="variable">$&#123;line&#125;</span>.bak</span><br><span class="line">    mv <span class="variable">$&#123;line&#125;</span>.bak <span class="variable">$&#123;line&#125;</span></span><br><span class="line"><span class="keyword">done</span> &lt; filename.txt</span><br><span class="line">rm -f filename.txt</span><br></pre></td></tr></table></figure><h2 id="读取某一列"><a href="#读取某一列" class="headerlink" title="读取某一列"></a>读取某一列</h2><p>读取第一列，读取最后一列。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"www.voidking.com"</span> | awk -F<span class="string">'.'</span> <span class="string">'&#123;print $1&#125;'</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"www.voidking.com"</span> | awk -F<span class="string">'.'</span> <span class="string">'&#123;print $3&#125;'</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"www.voidking.com"</span> | awk -F<span class="string">'.'</span> <span class="string">'&#123;print $NF&#125;'</span></span><br></pre></td></tr></table></figure><h2 id="第一列换到最后一列"><a href="#第一列换到最后一列" class="headerlink" title="第一列换到最后一列"></a>第一列换到最后一列</h2><p>已知namelist.txt：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">haojin <span class="number">70</span> <span class="number">80</span></span><br><span class="line"><span class="built_in">void</span>king <span class="number">90</span> <span class="number">100</span></span><br></pre></td></tr></table></figure><p>需求：第一列name，在显示时放到最后一列。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat namelist.txt | awk <span class="string">'&#123;for(i=2;i&lt;=NF;i++)printf("%s ", $i);print $1&#125;'</span></span><br></pre></td></tr></table></figure><h2 id="循环读取单列文本"><a href="#循环读取单列文本" class="headerlink" title="循环读取单列文本"></a>循环读取单列文本</h2><p>已知hostlist.txt为：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">www</span><span class="selector-class">.baidu</span><span class="selector-class">.com</span></span><br><span class="line"><span class="selector-tag">www</span><span class="selector-class">.voidking</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure><p>需求：批量查询主机名或者主机IP</p><p>脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `cat hostlist.txt`;<span class="keyword">do</span> host <span class="variable">$i</span>;<span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="文本比较"><a href="#文本比较" class="headerlink" title="文本比较"></a>文本比较</h2><p>需求：两个姓名列表，需要对比出两个文件中相同的姓名和不同的姓名。</p><p>脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat file1 &gt; file.txt</span><br><span class="line">cat file2 &gt;&gt; file.txt</span><br><span class="line">cat file.txt | sort |uniq -c | sort -n &gt; result.txt</span><br></pre></td></tr></table></figure><h2 id="ssh执行远程命令"><a href="#ssh执行远程命令" class="headerlink" title="ssh执行远程命令"></a>ssh执行远程命令</h2><p>执行远程命令很简单，直接ssh后面跟着命令就可以了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@192.168.56.100 <span class="string">"echo helloworld"</span></span><br></pre></td></tr></table></figure><p>那如果远程命令里面包含双引号怎么办？变成单引号，或者添加转义。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh root@192.168.56.100 <span class="string">"echo 'helloworld'"</span></span><br><span class="line">ssh root@192.168.56.100 <span class="string">"echo \"helloworld\""</span></span><br></pre></td></tr></table></figure><p>那如果需要远程命令里使用变量怎么办？添加转义。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@192.168.56.100 <span class="string">"host=\$(hostname);echo \"\$&#123;host&#125;\""</span></span><br></pre></td></tr></table></figure><h2 id="批量添加开机启动命令"><a href="#批量添加开机启动命令" class="headerlink" title="批量添加开机启动命令"></a>批量添加开机启动命令</h2><p>已知主机列表hosts.txt内容为：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192.168.56.101</span></span><br><span class="line"><span class="number">192.168.56.102</span></span><br></pre></td></tr></table></figure><p>需求：给主机列表中的机器添加开机启动命令</p><p>脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `cat hosts.txt`; <span class="keyword">do</span> ssh <span class="variable">$i</span> <span class="string">"echo '/home/voidking/start.sh' | sudo tee -a /etc/rc.local"</span>;<span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="EPEL源"><a href="#EPEL源" class="headerlink" title="EPEL源"></a>EPEL源</h2><p>EPEL（ExtraPackagesforEnterpriseLinux）是基于Fedora的一个项目，为RedHat系的操作系统提供额外的高质量软件包。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release</span><br></pre></td></tr></table></figure><p>安装epel源之后，可以安装很多原本 No package xxx available 的软件，比如jq：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install jq</span><br></pre></td></tr></table></figure><h2 id="联合查询"><a href="#联合查询" class="headerlink" title="联合查询"></a>联合查询</h2><p>使用shell，能否实现类似于SQL的联合查询？必须可以。</p><p>已知file1的内容为：</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1 </span>realname</span><br><span class="line"><span class="symbol">2 </span>nickname</span><br></pre></td></tr></table></figure><p>file2的内容为：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">voidking</span> <span class="string">nickname</span></span><br><span class="line"><span class="attr">haojin</span> <span class="string">realname</span></span><br><span class="line"><span class="attr">hankin</span> <span class="string">nickname</span></span><br><span class="line"><span class="attr">jinhao</span> <span class="string">realname</span></span><br><span class="line"><span class="attr">vk</span> <span class="string">nickname</span></span><br></pre></td></tr></table></figure><p>需求：根据file1和file2的第二列，把file1和file2合并成一个文件。</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">2 </span>voidking nickname</span><br><span class="line"><span class="symbol">1 </span>haojin realname</span><br><span class="line"><span class="symbol">2 </span>hankin nickname</span><br><span class="line"><span class="symbol">1 </span>jinhao realname</span><br><span class="line"><span class="symbol">2 </span>vk nickname</span><br></pre></td></tr></table></figure><p>这个需求使用awk命令来实现。<br>NR，表示awk开始执行程序后所读取的数据行数。<br>FNR，与NR功用类似，不同的是awk每打开一个新文件，FNR便从0重新累计。<br>NR==FNR：用于在读取两个或两个以上的文件时，判断是不是在读取第一个文件。<br>awk处理多个文件的语法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F 分隔符 <span class="string">'BEGIN &#123; 初始化 &#125; &#123; 循环执行部分 &#125; END &#123; 结束处理 &#125;'</span> file_list1 file_list2</span><br></pre></td></tr></table></figure><p>其中BEGIN和END可以省略，-F也可以使用默认，循环执行部分，是按行对文件进行处理的。</p><p>脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk -F <span class="string">" "</span> <span class="string">'NR==FNR&#123;a[$2]=$0;next&#125;&#123;print a[$2]" "$1&#125;'</span> file1 file2 \</span><br><span class="line">| awk <span class="string">'&#123;print $1" "$3" "$2&#125;'</span></span><br></pre></td></tr></table></figure><p>由NR=FNR为真时，判断当前读入的是第一个文件file1，执行第一个花括号内的内容。<br>把file1中每行记录都存入数组a，并使用file1的第2个字段作为下标。</p><p>由NR=FNR为假时，判断当前读入了第二个文件file2，执行第二个花括号内的内容。<br>file2中的每行，根据file2的第2个字段打印数组a中的内容，同时打印file2中的第一列。</p><h2 id="求交集"><a href="#求交集" class="headerlink" title="求交集"></a>求交集</h2><p>已知file1内容为：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">haojin</span><br><span class="line"><span class="built_in">void</span>king</span><br><span class="line">vk</span><br></pre></td></tr></table></figure><p>file2内容为：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">haoshuai <span class="number">95</span> <span class="number">93</span> <span class="number">80</span></span><br><span class="line">vk <span class="number">99</span> <span class="number">99</span> <span class="number">100</span></span><br><span class="line">haojin <span class="number">100</span> <span class="number">100</span> <span class="number">99</span></span><br><span class="line">baidu <span class="number">100</span> <span class="number">100</span> <span class="number">100</span></span><br><span class="line"><span class="built_in">void</span>king <span class="number">99</span> <span class="number">99</span> <span class="number">99</span></span><br></pre></td></tr></table></figure><p>需求：file1第一列和file2第一列求交集，显示file2中交集的内容。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">'&#123;if(NR==FNR)&#123;a[$1]=$1&#125;else if($1 in a)&#123;print $0&#125;&#125;'</span> file1 file2</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">awk <span class="string">'&#123;if(NR==FNR)a[$1]=$1;else if($1 in a)print $0&#125;'</span> file1 file2</span><br></pre></td></tr></table></figure><h2 id="每两行合成一行"><a href="#每两行合成一行" class="headerlink" title="每两行合成一行"></a>每两行合成一行</h2><p>已知ip-port.txt内容为：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1</span></span><br><span class="line"><span class="number">80</span></span><br><span class="line"><span class="number">127.0.0.1</span></span><br><span class="line"><span class="number">8080</span></span><br><span class="line"><span class="number">192.168.56.101</span></span><br><span class="line"><span class="number">3306</span></span><br></pre></td></tr></table></figure><p>需求：把ip和对应端口放在同一行。</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1</span> <span class="number">80</span></span><br><span class="line"><span class="number">127.0.0.1</span> <span class="number">8080</span></span><br><span class="line"><span class="number">192.168.56.101</span> <span class="number">3306</span></span><br></pre></td></tr></table></figure><p>脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">"N;s/\n/ /p"</span> ip-port.txt</span><br><span class="line">awk <span class="string">'NR%2&#123;printf "%s ",$0;next;&#125;1'</span> ip-port.txt</span><br><span class="line">awk <span class="string">'ORS=NR%2?FS:RS'</span> ip-port.txt</span><br><span class="line">awk <span class="string">'&#123; ORS = (NR%2 ? FS : RS) &#125; 1'</span> ip-port.txt</span><br><span class="line">awk <span class="string">'&#123; ORS = (NR%2 ? "," : RS) &#125; 1'</span> ip-port.txt</span><br></pre></td></tr></table></figure><h2 id="删除10天前的日志"><a href="#删除10天前的日志" class="headerlink" title="删除10天前的日志"></a>删除10天前的日志</h2><p>需求：找出10天前的日志并删除。<br>脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find /usr/<span class="built_in">local</span>/tomcat/logs/ -<span class="built_in">type</span> f -mtime +10 -<span class="built_in">exec</span> rm -rfv &#123;&#125; \;</span><br><span class="line">find /usr/<span class="built_in">local</span>/tomcat/logs/ -<span class="built_in">type</span> f -mtime +10 | xargs rm -rfv</span><br></pre></td></tr></table></figure><h2 id="计算一列的和"><a href="#计算一列的和" class="headerlink" title="计算一列的和"></a>计算一列的和</h2><p>已知fruit.txt内容为：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apple <span class="number">10</span></span><br><span class="line">orange <span class="number">7</span></span><br><span class="line">banana <span class="number">0</span></span><br><span class="line">watermelon <span class="number">1</span></span><br></pre></td></tr></table></figure><p>第一列是水果名称，第二列是水果数量。</p><p>需求1：计算水果的总数。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">'&#123;sum += $2&#125;;END &#123;print sum&#125;'</span> fruit.txt</span><br><span class="line">cat fruit.txt | awk <span class="string">'&#123;sum += $2&#125;;END &#123;print sum&#125;'</span></span><br></pre></td></tr></table></figure><p>需求2：计算存在多少种水果。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat fruit.txt | awk <span class="string">'&#123;if ($2&gt;0) (sum += 1); else (sum += 0)&#125;;END&#123;print sum&#125;'</span></span><br></pre></td></tr></table></figure><h2 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h2><p>0 标准输入<br>1 标准输出，默认指向屏幕<br>2 错误输出，默认指向屏幕<br>/dev/null 黑洞</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 标准输出重定向到文件</span></span><br><span class="line">ls &gt;out.txt</span><br><span class="line">cat out.txt</span><br><span class="line"><span class="comment"># 等同于</span></span><br><span class="line">ls 1&gt;out.txt</span><br><span class="line">cat out.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 错误输出重定向到文件</span></span><br><span class="line">ls 2&gt;out.txt</span><br><span class="line">cat out.txt</span><br><span class="line">ls xxx 2&gt;out.txt</span><br><span class="line">cat out.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 标准输出和错误输出都重定向到文件</span></span><br><span class="line">(ls xxx || ls) &gt;out.txt 2&gt;&amp;1</span><br><span class="line">cat out.txt</span><br><span class="line"><span class="comment"># 等同于</span></span><br><span class="line">(ls xxx || ls) &amp;&gt;out.txt</span><br><span class="line">cat out.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 标准输出和错误输出都丢弃</span></span><br><span class="line">(ls xxx || ls) &amp;&gt;/dev/null</span><br><span class="line"><span class="comment"># 等同于</span></span><br><span class="line">(ls xxx; ls) &amp;&gt;/dev/null</span><br></pre></td></tr></table></figure><h2 id="输出到屏幕和文件"><a href="#输出到屏幕和文件" class="headerlink" title="输出到屏幕和文件"></a>输出到屏幕和文件</h2><p>输出内容同时到屏幕和文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"hello"</span> | tee test.log</span><br></pre></td></tr></table></figure><h2 id="清空文件内容"><a href="#清空文件内容" class="headerlink" title="清空文件内容"></a>清空文件内容</h2><p>需求：清空test.txt文件中的内容<br>脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">""</span> &gt; test.txt</span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">""</span> &gt; test.txt</span><br><span class="line">cat /dev/null &gt; test.txt</span><br><span class="line">:&gt; test.txt</span><br></pre></td></tr></table></figure><h2 id="cat写入文件"><a href="#cat写入文件" class="headerlink" title="cat写入文件"></a>cat写入文件</h2><p>新建文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; test.txt</span><br><span class="line">hello world</span><br><span class="line">welcome to python world!</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF | tee test.txt</span><br><span class="line">hello world</span><br><span class="line">welcome to python world!</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>追加内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;&gt; test.txt</span><br><span class="line">hello world</span><br><span class="line">welcome to python world!</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF | tee -a test.txt</span><br><span class="line">hello world</span><br><span class="line">welcome to python world!</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h2 id="测试mtu值"><a href="#测试mtu值" class="headerlink" title="测试mtu值"></a>测试mtu值</h2><p>MTU是Maximum Transmission Unit的缩写，表示最大传输单元，MTU的单位是字节。大部分网络设备的MTU都是1500。<br>把本机的MTU设成比网关的MTU小或相同，就可以减少丢包。如果本机的MTU比网关的MTU大，大的数据包就会被拆开来传送，这样会产生很多数据包碎片，增加丢包率。<br>把数据包长度加上数据包头28字节，就得到MTU的值。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping -c 3 -s 1472 -M <span class="keyword">do</span> www.baidu.com</span><br><span class="line">ping -c 3 -s 1473 -M <span class="keyword">do</span> www.baidu.com</span><br></pre></td></tr></table></figure><h2 id="获取脚本绝对路径"><a href="#获取脚本绝对路径" class="headerlink" title="获取脚本绝对路径"></a>获取脚本绝对路径</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scriptpath=$(<span class="built_in">cd</span> <span class="string">"<span class="variable">$(dirname "$0")</span>"</span>; <span class="built_in">pwd</span>)</span><br></pre></td></tr></table></figure><h2 id="时间和时间戳"><a href="#时间和时间戳" class="headerlink" title="时间和时间戳"></a>时间和时间戳</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输出时间</span></span><br><span class="line">date</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出时间并格式化</span></span><br><span class="line">date <span class="string">"+%Y-%m-%d %H:%M:%S"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 时间转时间戳（秒）</span></span><br><span class="line">date <span class="string">"+%s"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 时间转时间戳（微秒）</span></span><br><span class="line">microsecond=$(($(date <span class="string">"+%s%N"</span>)/1000000))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 时间戳（秒）转时间</span></span><br><span class="line">date -d @1612351314 <span class="string">"+%Y-%m-%d %H:%M:%S"</span></span><br></pre></td></tr></table></figure><h2 id="查看进程和线程"><a href="#查看进程和线程" class="headerlink" title="查看进程和线程"></a>查看进程和线程</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看所有进程</span></span><br><span class="line">ps -ef</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">ps aux</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有进程，并且显示进程启动的全部命令</span></span><br><span class="line">ps auxww</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有进程，并且显示进程的线程</span></span><br><span class="line">ps -efL</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看某个进程的线程</span></span><br><span class="line">ps -T -p 12345</span><br></pre></td></tr></table></figure><h2 id="根据端口找进程"><a href="#根据端口找进程" class="headerlink" title="根据端口找进程"></a>根据端口找进程</h2><p>已知某进程监听22端口，怎样找到该进程的pid？怎样找到该进程启动命令？</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lsof -i:22</span><br><span class="line">netstat -npt | grep <span class="string">":22"</span></span><br><span class="line">netstat -nlpt | grep <span class="string">":22"</span></span><br><span class="line">ps -ef |grep 12345</span><br></pre></td></tr></table></figure><h2 id="查看端口是否可以正常连接"><a href="#查看端口是否可以正常连接" class="headerlink" title="查看端口是否可以正常连接"></a>查看端口是否可以正常连接</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nc -v 192.168.56.101 8080</span><br><span class="line">nc -zv -w 5 192.168.56.101 8080</span><br><span class="line"><span class="comment"># 成功返回0，5s超时失败返回1</span></span><br><span class="line"></span><br><span class="line">telnet 192.168.56.101 8080</span><br><span class="line"><span class="built_in">echo</span> <span class="string">''</span> | timeout --signal=9 5 telnet 192.168.56.101 8080</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'q'</span> | timeout --signal=9 5 telnet -e <span class="string">'q'</span> 192.168.56.101 8080</span><br><span class="line"><span class="comment"># 成功返回1，5s超时失败返回137</span></span><br></pre></td></tr></table></figure><h2 id="查看进程资源占用"><a href="#查看进程资源占用" class="headerlink" title="查看进程资源占用"></a>查看进程资源占用</h2><p>1、查看进程的实时资源占用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">top -p 12234</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">cat /proc/12345/status</span><br></pre></td></tr></table></figure><p>2、查看进程从启动到此刻的资源占用平均值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep 12345</span><br></pre></td></tr></table></figure><p>参考文档：</p><ul><li><a href="https://xiaorui.cc/archives/4470" target="_blank" rel="noopener">纠结ps和top的cpu占用率不一致问题</a></li><li><a href="https://www.cnblogs.com/arnoldlu/p/12162860.html" target="_blank" rel="noopener">/proc/pid/status简要分析</a></li><li><a href="https://blog.csdn.net/beckdon/article/details/48491909" target="_blank" rel="noopener">Linux下进程信息/proc/pid/status的深入分析</a></li></ul><h2 id="查看本机IP地址"><a href="#查看本机IP地址" class="headerlink" title="查看本机IP地址"></a>查看本机IP地址</h2><p>1、查看本机当前namespace所有IP地址<br><code>ifconfig</code> 或者 <code>ip address</code></p><p>2、获取某个网卡的IP地址<br><code>ifconfig eth0 | awk &#39;NR==2{print $2}&#39;</code></p><h2 id="查看外网出口IP"><a href="#查看外网出口IP" class="headerlink" title="查看外网出口IP"></a>查看外网出口IP</h2><p><code>curl myip.ipip.net</code></p><h2 id="cp须知"><a href="#cp须知" class="headerlink" title="cp须知"></a>cp须知</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unalias</span> cp <span class="comment">#避免cp命令被alias</span></span><br><span class="line">cp -f <span class="comment">#强制覆盖</span></span><br><span class="line">cp -R <span class="comment">#递归拷贝所有文件。对特殊文件（管道文件、块设备文件、字符设备文件）会进行创建而不是拷贝。</span></span><br><span class="line">cp -r <span class="comment">#递归拷贝所有文件。所有source文件当做普通文件。</span></span><br><span class="line">cp -rf public/* voidking <span class="comment">#递归拷贝所有文件，不包括隐藏文件</span></span><br><span class="line">cp -rf public/. voidking <span class="comment">#递归拷贝所有文件，包括隐藏文件</span></span><br></pre></td></tr></table></figure><h2 id="匹配排除-和"><a href="#匹配排除-和" class="headerlink" title="匹配排除.和.."></a>匹配排除.和..</h2><p>当前目录下，一定存在两个目录：<code>.</code>和<code>..</code>。<br>有一些操作我们需要排除这两个目录，怎样匹配排除它们呢？</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ls -a</span><br><span class="line">ls -a | xargs</span><br><span class="line">ls -a | wc -l</span><br><span class="line">ls -a | grep -vw <span class="string">'\.'</span></span><br><span class="line">ls -a | grep -vw <span class="string">'[.]'</span></span><br><span class="line">ls -a | grep -v <span class="string">'^.$'</span> | grep -v <span class="string">'^..$'</span></span><br></pre></td></tr></table></figure><h2 id="cp排除目录"><a href="#cp排除目录" class="headerlink" title="cp排除目录"></a>cp排除目录</h2><p>需求：源目录为dirA，目标目录dirB，复制dirA下所有目录&amp;文件到dirB，排除目录log<br>方法一：不包含隐藏文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> dirA</span><br><span class="line">ls | grep -v <span class="built_in">log</span> | xargs</span><br><span class="line">cp -r `ls | grep -v <span class="built_in">log</span> | xargs` pathto/dirB</span><br></pre></td></tr></table></figure><p>方法二：包含隐藏文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> dirA</span><br><span class="line">ls -a | grep -vw <span class="string">'\.'</span> | grep -v <span class="built_in">log</span> | xargs</span><br><span class="line">cp -r `ls -a | grep -vw <span class="string">'\.'</span> | grep -v <span class="built_in">log</span> | xargs` pathto/dirB</span><br></pre></td></tr></table></figure><h2 id="rm排除目录"><a href="#rm排除目录" class="headerlink" title="rm排除目录"></a>rm排除目录</h2><p>需求：想要删除dirA目录下的所有目录和文件，除了.git目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> dirA</span><br><span class="line">ls -a | grep -vw <span class="string">'\.'</span> | grep -vw <span class="string">'\.git'</span> | xargs</span><br><span class="line">rm -rf `ls -a | grep -vw <span class="string">'\.'</span> | grep -vw <span class="string">'\.git'</span> | xargs`</span><br></pre></td></tr></table></figure><h2 id="tar排除目录"><a href="#tar排除目录" class="headerlink" title="tar排除目录"></a>tar排除目录</h2><p>需求：打包目录dirA下所有目录&amp;文件，排除目录dirA/log和dirA/data</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -czvf dirA.tar.gz dirA --exclude dirA/<span class="built_in">log</span> --exclude dirA/data</span><br></pre></td></tr></table></figure><h2 id="tar文件拆分与合并"><a href="#tar文件拆分与合并" class="headerlink" title="tar文件拆分与合并"></a>tar文件拆分与合并</h2><p>使用sz传输大文件，有时候会被中断。这时我们可以把文件进行拆分，下载后再进行合并。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -czf - bigfile.tar.gz | split -b 50m -d - bigfile.tar.gz.</span><br><span class="line">cat bigfile.tar.gz.* | tar -xzf -</span><br><span class="line">md5sum bigfile.tar.gz</span><br></pre></td></tr></table></figure><h2 id="启动python-web服务器"><a href="#启动python-web服务器" class="headerlink" title="启动python web服务器"></a>启动python web服务器</h2><p>使用sz传输大文件，有时候会被中断。这时我们可以启动一个web服务，把大文件作为静态资源下载。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer 9999</span><br><span class="line">python3 -m http.server 9999</span><br></pre></td></tr></table></figure><p>然后浏览器输入ip:port，即可下载文件。</p><h2 id="查看局域网所有IP"><a href="#查看局域网所有IP" class="headerlink" title="查看局域网所有IP"></a>查看局域网所有IP</h2><p>需求：查看当前局域网已经分配的IP，已知局域网为<code>192.168.56.0/24</code><br>1、通过扫描获取最新的arp信息<br><code>nmap -sP 192.168.56.0/24</code></p><p>2、查看本地arp缓存<br><code>cat /proc/net/arp | awk &#39;{print $1}&#39; | grep &#39;192.168&#39; | sort</code><br>或者<br><code>arp -a | awk &#39;{print $2}&#39; | grep &#39;192.168&#39; | sort</code></p><h2 id="根据IP排序"><a href="#根据IP排序" class="headerlink" title="根据IP排序"></a>根据IP排序</h2><p>需求：/proc/net/arp中的内容，根据IP进行排序</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/net/arp | grep 192.168.56 | sort -t<span class="string">'.'</span> -k1n,1 -k2n,2 -k3n,3 -k4n,4</span><br></pre></td></tr></table></figure><h2 id="修改默认shell"><a href="#修改默认shell" class="headerlink" title="修改默认shell"></a>修改默认shell</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$SHELL</span></span><br><span class="line">cat /etc/shells</span><br><span class="line"><span class="built_in">which</span> bash</span><br><span class="line">chsh -s /bin/bash</span><br></pre></td></tr></table></figure><h2 id="编码格式修改"><a href="#编码格式修改" class="headerlink" title="编码格式修改"></a>编码格式修改</h2><p>执行sh脚本时报错：/bin/sh^M: bad interpreter: No such file or directory</p><p>1、添加执行权限<br><code>chmod a+x filename</code></p><p>2、然后修改文件格式<br><code>vi filename</code></p><p>3、利用如下命令查看文件格式</p><p><code>:set ff</code> 或 <code>:set fileformat</code></p><p>可以看到 fileformat=dos 或 fileformat=unix。</p><p>4、利用如下命令修改文件格式</p><p><code>:set ff=unix</code> 或 <code>:set fileformat=unix</code></p><p>5、保存文件<br><code>:wq</code></p><p>6、最后再执行文件<br><code>./filename</code></p><h2 id="根据时间筛选日志"><a href="#根据时间筛选日志" class="headerlink" title="根据时间筛选日志"></a>根据时间筛选日志</h2><p>筛选11月10日和11月11日的14:30到18:00的日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grep -E <span class="string">'1[0,1]/Nov/2022:14:[3,4,5][0-9]|1[0,1]/Nov/2022:1[5-7]|1[0,1]/Nov/2022:18:00'</span> access.log</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">grep -E <span class="string">'10/Nov/2022'</span> access.log | sed -n <span class="string">'/2022:14:30/,/2022:18:00/p'</span> &gt; tmp.log</span><br><span class="line">grep -E <span class="string">'11/Nov/2022'</span> access.log | sed -n <span class="string">'/2022:14:30/,/2022:18:00/p'</span> &gt;&gt; tmp.log</span><br></pre></td></tr></table></figure><p>grep筛选出的日志，包含18:00:00-18:00:59内的日志。<br>sed筛选出的日志，只包含第一个匹配上2022:18:00的日志，不包含18:00:00-18:00:59内的日志。</p><hr><h1 id="shell脚本"><a href="#shell脚本" class="headerlink" title="shell脚本"></a>shell脚本</h1><h2 id="文件拆分"><a href="#文件拆分" class="headerlink" title="文件拆分"></a>文件拆分</h2><p>需求1：大文件拆分成小文件，每50行拆分成一个文件。<br>脚本1：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">linenum=<span class="string">"50"</span></span><br><span class="line">bigfile=<span class="string">"bigfile.txt"</span></span><br><span class="line">datadir=<span class="string">"files"</span></span><br><span class="line">prefix=<span class="string">"smallfile."</span></span><br><span class="line">mkdir -p <span class="variable">$&#123;datadir&#125;</span></span><br><span class="line">split -l <span class="variable">$&#123;linenum&#125;</span> <span class="variable">$&#123;bigfile&#125;</span> -d -a 2 <span class="variable">$&#123;datadir&#125;</span>/<span class="variable">$&#123;prefix&#125;</span></span><br></pre></td></tr></table></figure><p>需求2：大文件拆分成小文件，方便按比例进行变更。<br>脚本2：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">percent=<span class="string">"50"</span></span><br><span class="line"><span class="comment">#percent="34"</span></span><br><span class="line">bigfile=<span class="string">"bigfile.txt"</span></span><br><span class="line">datadir=<span class="string">"file"</span></span><br><span class="line">prefix=<span class="string">"smallfile."</span></span><br><span class="line"></span><br><span class="line">rm -rf <span class="variable">$&#123;datadir&#125;</span>/<span class="variable">$&#123;prefix&#125;</span>*</span><br><span class="line">mkdir -p <span class="variable">$&#123;datadir&#125;</span></span><br><span class="line">content=$(cat <span class="variable">$&#123;bigfile&#125;</span>)</span><br><span class="line">sum=$(<span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;content&#125;</span>"</span> | wc -l)</span><br><span class="line">linenum=$((<span class="variable">$&#123;sum&#125;</span>*<span class="variable">$&#123;percent&#125;</span>/100))</span><br><span class="line">split -l <span class="variable">$&#123;linenum&#125;</span> <span class="variable">$&#123;bigfile&#125;</span> -d -a 2 <span class="variable">$&#123;datadir&#125;</span>/<span class="variable">$&#123;prefix&#125;</span></span><br></pre></td></tr></table></figure><h2 id="还原history"><a href="#还原history" class="headerlink" title="还原history"></a>还原history</h2><p>万万没想到，centos4.3的<code>history -c</code>命令，不止会清除当前登录的操作历史记录，还会清除 .bash_history 中的内容。</p><p>如果不小心清除了 .bash_history 中的内容，该怎么办？如果屏幕上还残留着history的历史记录，那么还有得救。<br>拷贝屏幕上的内容，到 history.txt，假设内容为：</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">244486 </span> <span class="number">2021</span>-<span class="number">01</span>-<span class="number">08</span> <span class="number">17</span>:<span class="number">35</span>:<span class="number">18</span> cd haojin</span><br><span class="line"><span class="symbol">244487 </span> <span class="number">2021</span>-<span class="number">01</span>-<span class="number">08</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">01</span> vim main.py</span><br><span class="line"><span class="symbol">244488 </span> <span class="number">2021</span>-<span class="number">01</span>-<span class="number">08</span> <span class="number">17</span>:<span class="number">38</span>:<span class="number">33</span> python main.py</span><br></pre></td></tr></table></figure><p>怎么恢复成标准的 .bash_history 格式呢？使用如下脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">cat /dev/null &gt; bash_history</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  time=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">'&#123;print $2" "$3&#125;'</span>)</span><br><span class="line">  <span class="comment">#cmd=$(echo $line | awk '&#123;$1="";$2="";$3="";print $0&#125;')</span></span><br><span class="line">  cmd=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk -F <span class="string">" "</span>  <span class="string">'&#123;for (i=4;i&lt;=NF;i++)printf("%s ", $i);print ""&#125;'</span>)</span><br><span class="line">  timestamp=$(date -d <span class="string">"<span class="variable">$time</span>"</span> +%s)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"#"</span><span class="variable">$timestamp</span> &gt;&gt; bash_history</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$cmd</span> &gt;&gt; bash_history</span><br><span class="line"><span class="keyword">done</span> &lt; history.txt</span><br></pre></td></tr></table></figure><p>执行完成，使用 bash_history 替换 .bash_history 即可。</p><h2 id="执行SQL语句"><a href="#执行SQL语句" class="headerlink" title="执行SQL语句"></a>执行SQL语句</h2><p>需求：mysql数据库，获取数据库vk中的app表中所有记录的name，写入到 name.txt 文件。</p><p>脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">get_all_name=<span class="string">"select name from app where app.deleted=0;"</span></span><br><span class="line"></span><br><span class="line">all_name=$(mysql -h192.168.56.100 -uroot -pmypassword -s -e <span class="string">"use vk;<span class="variable">$&#123;get_all_name&#125;</span>"</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;all_name&#125;</span>"</span> &gt; name.txt</span><br></pre></td></tr></table></figure></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-shell-script-collection/" title="shell实用命令和脚本">https://www.voidking.com/dev-shell-script-collection/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag"># 网络</a> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/shell/" rel="tag"># shell</a> <a href="/tags/%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/" rel="tag"># 问题排查</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-iftop/" rel="prev" title="iftop命令"><i class="fa fa-chevron-left"></i> iftop命令</a></div><div class="post-nav-item"> <a href="/dev-systemctl-command/" rel="next" title="systemctl命令">systemctl命令<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#shell命令"><span class="nav-number">2.</span> <span class="nav-text">shell命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#查看硬件配置"><span class="nav-number">2.1.</span> <span class="nav-text">查看硬件配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看系统版本"><span class="nav-number">2.2.</span> <span class="nav-text">查看系统版本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看系统位数"><span class="nav-number">2.3.</span> <span class="nav-text">查看系统位数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看是否是物理机"><span class="nav-number">2.4.</span> <span class="nav-text">查看是否是物理机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看系统日志"><span class="nav-number">2.5.</span> <span class="nav-text">查看系统日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看磁盘资源占用"><span class="nav-number">2.6.</span> <span class="nav-text">查看磁盘资源占用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看命令属于哪个包"><span class="nav-number">2.7.</span> <span class="nav-text">查看命令属于哪个包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建用户"><span class="nav-number">2.8.</span> <span class="nav-text">创建用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#生成密钥"><span class="nav-number">2.9.</span> <span class="nav-text">生成密钥</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使密钥生效"><span class="nav-number">2.10.</span> <span class="nav-text">使密钥生效</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#压缩与解压"><span class="nav-number">2.11.</span> <span class="nav-text">压缩与解压</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#awk注意事项"><span class="nav-number">2.12.</span> <span class="nav-text">awk注意事项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除空行"><span class="nav-number">2.13.</span> <span class="nav-text">删除空行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#过滤windows换行符"><span class="nav-number">2.14.</span> <span class="nav-text">过滤windows换行符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#去除空格"><span class="nav-number">2.15.</span> <span class="nav-text">去除空格</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#空格转换行"><span class="nav-number">2.16.</span> <span class="nav-text">空格转换行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查找并插入一行"><span class="nav-number">2.17.</span> <span class="nav-text">查找并插入一行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#大小写字符转换"><span class="nav-number">2.18.</span> <span class="nav-text">大小写字符转换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#utf8-bom-转-utf8"><span class="nav-number">2.19.</span> <span class="nav-text">utf8 bom 转 utf8</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GBK编码转UTF8"><span class="nav-number">2.20.</span> <span class="nav-text">GBK编码转UTF8</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#读取某一列"><span class="nav-number">2.21.</span> <span class="nav-text">读取某一列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第一列换到最后一列"><span class="nav-number">2.22.</span> <span class="nav-text">第一列换到最后一列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#循环读取单列文本"><span class="nav-number">2.23.</span> <span class="nav-text">循环读取单列文本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#文本比较"><span class="nav-number">2.24.</span> <span class="nav-text">文本比较</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ssh执行远程命令"><span class="nav-number">2.25.</span> <span class="nav-text">ssh执行远程命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#批量添加开机启动命令"><span class="nav-number">2.26.</span> <span class="nav-text">批量添加开机启动命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EPEL源"><span class="nav-number">2.27.</span> <span class="nav-text">EPEL源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#联合查询"><span class="nav-number">2.28.</span> <span class="nav-text">联合查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#求交集"><span class="nav-number">2.29.</span> <span class="nav-text">求交集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#每两行合成一行"><span class="nav-number">2.30.</span> <span class="nav-text">每两行合成一行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除10天前的日志"><span class="nav-number">2.31.</span> <span class="nav-text">删除10天前的日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#计算一列的和"><span class="nav-number">2.32.</span> <span class="nav-text">计算一列的和</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重定向"><span class="nav-number">2.33.</span> <span class="nav-text">重定向</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输出到屏幕和文件"><span class="nav-number">2.34.</span> <span class="nav-text">输出到屏幕和文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#清空文件内容"><span class="nav-number">2.35.</span> <span class="nav-text">清空文件内容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cat写入文件"><span class="nav-number">2.36.</span> <span class="nav-text">cat写入文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#测试mtu值"><span class="nav-number">2.37.</span> <span class="nav-text">测试mtu值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取脚本绝对路径"><span class="nav-number">2.38.</span> <span class="nav-text">获取脚本绝对路径</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#时间和时间戳"><span class="nav-number">2.39.</span> <span class="nav-text">时间和时间戳</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看进程和线程"><span class="nav-number">2.40.</span> <span class="nav-text">查看进程和线程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#根据端口找进程"><span class="nav-number">2.41.</span> <span class="nav-text">根据端口找进程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看端口是否可以正常连接"><span class="nav-number">2.42.</span> <span class="nav-text">查看端口是否可以正常连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看进程资源占用"><span class="nav-number">2.43.</span> <span class="nav-text">查看进程资源占用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看本机IP地址"><span class="nav-number">2.44.</span> <span class="nav-text">查看本机IP地址</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看外网出口IP"><span class="nav-number">2.45.</span> <span class="nav-text">查看外网出口IP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cp须知"><span class="nav-number">2.46.</span> <span class="nav-text">cp须知</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#匹配排除-和"><span class="nav-number">2.47.</span> <span class="nav-text">匹配排除.和..</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cp排除目录"><span class="nav-number">2.48.</span> <span class="nav-text">cp排除目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rm排除目录"><span class="nav-number">2.49.</span> <span class="nav-text">rm排除目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tar排除目录"><span class="nav-number">2.50.</span> <span class="nav-text">tar排除目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tar文件拆分与合并"><span class="nav-number">2.51.</span> <span class="nav-text">tar文件拆分与合并</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#启动python-web服务器"><span class="nav-number">2.52.</span> <span class="nav-text">启动python web服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看局域网所有IP"><span class="nav-number">2.53.</span> <span class="nav-text">查看局域网所有IP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#根据IP排序"><span class="nav-number">2.54.</span> <span class="nav-text">根据IP排序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改默认shell"><span class="nav-number">2.55.</span> <span class="nav-text">修改默认shell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编码格式修改"><span class="nav-number">2.56.</span> <span class="nav-text">编码格式修改</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#根据时间筛选日志"><span class="nav-number">2.57.</span> <span class="nav-text">根据时间筛选日志</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#shell脚本"><span class="nav-number">3.</span> <span class="nav-text">shell脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#文件拆分"><span class="nav-number">3.1.</span> <span class="nav-text">文件拆分</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#还原history"><span class="nav-number">3.2.</span> <span class="nav-text">还原history</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#执行SQL语句"><span class="nav-number">3.3.</span> <span class="nav-text">执行SQL语句</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">656</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">205</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://www.beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>