<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言好多shell脚本，写过就扔了，感觉很可惜。本文会不断更新，用于记录自我感觉良好的脚本。以后再遇到相似的需求，方便进行参考查找。 如果想要系统学习Bash，推荐学习阮一峰前辈的《Bash 脚本教程》。"><meta property="og:type" content="article"><meta property="og:title" content="Shell实用脚本"><meta property="og:url" content="https://www.voidking.com/dev-shell-script-collection/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言好多shell脚本，写过就扔了，感觉很可惜。本文会不断更新，用于记录自我感觉良好的脚本。以后再遇到相似的需求，方便进行参考查找。 如果想要系统学习Bash，推荐学习阮一峰前辈的《Bash 脚本教程》。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2017-06-02T12:00:00.000Z"><meta property="article:modified_time" content="2021-01-10T10:06:01.374Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="shell"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-shell-script-collection/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Shell实用脚本 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-shell-script-collection/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Shell实用脚本</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2017-06-02 12:00:00" itemprop="dateCreated datePublished" datetime="2017-06-02T12:00:00+00:00">2017-06-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/" itemprop="url" rel="index"><span itemprop="name">专业</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>好多shell脚本，写过就扔了，感觉很可惜。本文会不断更新，用于记录自我感觉良好的脚本。以后再遇到相似的需求，方便进行参考查找。</p><p>如果想要系统学习Bash，推荐学习阮一峰前辈的<a href="https://wangdoc.com/bash/" target="_blank" rel="noopener">《Bash 脚本教程》</a>。</p><a id="more"></a><h1 id="短脚本"><a href="#短脚本" class="headerlink" title="短脚本"></a>短脚本</h1><h2 id="查看系统版本"><a href="#查看系统版本" class="headerlink" title="查看系统版本"></a>查看系统版本</h2><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">lsb_release -a</span></span><br></pre></td></tr></table></figure><h2 id="查看命令属于哪个包"><a href="#查看命令属于哪个包" class="headerlink" title="查看命令属于哪个包"></a>查看命令属于哪个包</h2><p>1、centos</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">yum</span> <span class="string">makecache fast</span></span><br><span class="line"><span class="attr">yum</span> <span class="string">whatprovides lsb_release</span></span><br></pre></td></tr></table></figure><p>2、ubuntu</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-get <span class="keyword">install</span> -y apt-<span class="keyword">file</span></span><br><span class="line">apt-<span class="keyword">file</span> <span class="keyword">update</span></span><br><span class="line">apt-<span class="keyword">file</span> <span class="keyword">search</span> ifconfig</span><br></pre></td></tr></table></figure><h2 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h2><p>创建voidking用户，并添加sudo权限：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useradd -m <span class="built_in">void</span>king -s /bin/bash</span><br><span class="line">passwd <span class="built_in">void</span>king</span><br><span class="line">adduser <span class="built_in">void</span>king sudo</span><br></pre></td></tr></table></figure><h2 id="过滤空行"><a href="#过滤空行" class="headerlink" title="过滤空行"></a>过滤空行</h2><p>过滤hostlist.txt中的空行（linux和windows空行都进行过滤）：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grep</span> -v -e <span class="string">'^[[:space:]]*$'</span> ng.txt</span><br></pre></td></tr></table></figure><h2 id="过滤windows换行符"><a href="#过滤windows换行符" class="headerlink" title="过滤windows换行符"></a>过滤windows换行符</h2><p>在windows里编辑好的文件，上传到linux后发现多了^M。以过滤hostlist.txt中的^M为例：</p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i '<span class="keyword">s</span>/<span class="symbol">^M</span><span class="comment">//g' hostlist.txt</span></span><br></pre></td></tr></table></figure><p>注意，直接复制粘贴上面的命令是无效的。^M的输入方式是 Ctrl + V ，然后 Ctrl + M 。</p><h2 id="去除空格"><a href="#去除空格" class="headerlink" title="去除空格"></a>去除空格</h2><p>去除test.txt文本中的空格：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> test.txt | <span class="keyword">tr</span> -d <span class="string">' '</span></span><br></pre></td></tr></table></figure><h2 id="空格转换行"><a href="#空格转换行" class="headerlink" title="空格转换行"></a>空格转换行</h2><p>把test.txt文本中的空格变成换行符。</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> test.txt | <span class="keyword">tr</span> <span class="string">' '</span> <span class="string">'\n'</span></span><br><span class="line"><span class="keyword">cat</span> test.txt | sed <span class="string">'s/ /\n/g'</span></span><br></pre></td></tr></table></figure><h2 id="utf8-bom-转-utf8"><a href="#utf8-bom-转-utf8" class="headerlink" title="utf8 bom 转 utf8"></a>utf8 bom 转 utf8</h2><p>使用macos中编译运行windows下创建的java项目，报错 Error:(1, 1) java: 非法字符: ‘\ufeff’。<br>BOM（byte order mark）是为 UTF-16 和 UTF-32 准备的，用于标记字节序（byte order）。<br>微软在 UTF-8 中使用 BOM 是因为这样可以把 UTF-8 和 ASCII 等编码明确区分开，但这样的文件在 Windows 之外的操作系统里会带来问题。<br>那么，怎么把utf8 bom编码文件批量转换为utf8编码文件呢？使用下面的脚本。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 当前目录下递归所有文件</span></span><br><span class="line">grep -r -i -l $'^\xEF\xBB\xBF' . | xargs sed -i 's/^\xEF\xBB\xBF//g'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 当前目录下所有文件</span></span><br><span class="line">grep -i -l $'^\xEF\xBB\xBF' * | xargs sed -i 's/^\xEF\xBB\xBF//g'</span><br><span class="line"><span class="meta">#</span><span class="bash"> macos</span></span><br><span class="line">brew install gnu-sed</span><br><span class="line">grep -r -i -l $'^\xEF\xBB\xBF' . | xargs gsed -i 's/^\xEF\xBB\xBF//g'</span><br><span class="line">grep -i -l $'^\xEF\xBB\xBF' * | xargs gsed -i 's/^\xEF\xBB\xBF//g'</span><br></pre></td></tr></table></figure><h2 id="循环读取单列文本"><a href="#循环读取单列文本" class="headerlink" title="循环读取单列文本"></a>循环读取单列文本</h2><p>已知hostlist.txt为：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">www</span><span class="selector-class">.baidu</span><span class="selector-class">.com</span></span><br><span class="line"><span class="selector-tag">www</span><span class="selector-class">.voidking</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure><p>需求：批量查询主机名或者主机IP</p><p>脚本：</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i in <span class="string">`cat hostlist.txt`</span>;<span class="keyword">do</span> host <span class="symbol">$i</span>;done</span><br></pre></td></tr></table></figure><h2 id="文本比较"><a href="#文本比较" class="headerlink" title="文本比较"></a>文本比较</h2><p>需求：两个姓名列表，需要对比出两个文件中相同的姓名和不同的姓名。</p><p>脚本：</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> file1 &gt; <span class="keyword">file</span>.txt</span><br><span class="line"><span class="keyword">cat</span> file2 &gt;&gt; <span class="keyword">file</span>.txt</span><br><span class="line"><span class="keyword">cat</span> <span class="keyword">file</span>.txt | <span class="keyword">sort</span> |uniq -c | <span class="keyword">sort</span> -<span class="keyword">n</span> &gt; result.txt</span><br></pre></td></tr></table></figure><h2 id="批量添加开机启动命令"><a href="#批量添加开机启动命令" class="headerlink" title="批量添加开机启动命令"></a>批量添加开机启动命令</h2><p>已知主机列表hosts.txt内容为：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192.168.56.101</span></span><br><span class="line"><span class="number">192.168.56.102</span></span><br></pre></td></tr></table></figure><p>需求：给主机列表中的机器添加开机启动命令</p><p>脚本：</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i in <span class="string">`cat hosts.txt`</span>; <span class="keyword">do</span> ssh <span class="symbol">$i</span> <span class="string">"echo '/home/voidking/start.sh' | sudo tee -a /etc/rc.local"</span>;done</span><br></pre></td></tr></table></figure><h2 id="curl-post请求带参数"><a href="#curl-post请求带参数" class="headerlink" title="curl post请求带参数"></a>curl post请求带参数</h2><p>1、<code>application/x-www-form-urlencoded</code>请求：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id=<span class="number">1</span></span><br><span class="line">ip=<span class="number">10.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">curl -d <span class="string">"id=$&#123;id&#125;&amp;ip=$&#123;ip&#125;"</span> http:<span class="comment">//rap2api.taobao.org/app/mock/241888/updateip</span></span><br></pre></td></tr></table></figure><p>2、<code>application/json</code>请求：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H <span class="string">"Content-type: application/json"</span> -X POST -d <span class="string">'&#123;"id":"'</span><span class="variable">$&#123;id&#125;</span><span class="string">'","ip":"'</span><span class="variable">$&#123;ip&#125;</span><span class="string">'"&#125;'</span> http:<span class="regexp">//</span>rap2api.taobao.org<span class="regexp">/app/m</span>ock<span class="regexp">/241888/u</span>pdateip</span><br></pre></td></tr></table></figure><p>3、<code>multipart/form-data</code>请求：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -F <span class="string">"id=$&#123;id&#125;"</span> -F <span class="string">"filename=@file.tar.gz"</span> http:<span class="regexp">//</span>rap2api.taobao.org<span class="regexp">/app/m</span>ock<span class="regexp">/241888/u</span>pdateip</span><br></pre></td></tr></table></figure><h2 id="EPEL源"><a href="#EPEL源" class="headerlink" title="EPEL源"></a>EPEL源</h2><p>EPEL（ExtraPackagesforEnterpriseLinux）是基于Fedora的一个项目，为RedHat系的操作系统提供额外的高质量软件包。<br><code>yum install epel-release</code></p><p>安装epel源之后，可以安装很多原本 No package xxx available 的软件，比如jq：<br><code>yum install jq</code></p><h2 id="联合查询"><a href="#联合查询" class="headerlink" title="联合查询"></a>联合查询</h2><p>使用shell，能否实现类似于SQL的联合查询？必须可以。</p><p>已知file1的内容为：</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1 </span>realname</span><br><span class="line"><span class="symbol">2 </span>nickname</span><br></pre></td></tr></table></figure><p>file2的内容为：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">voidking</span> <span class="string">nickname</span></span><br><span class="line"><span class="attr">haojin</span> <span class="string">realname</span></span><br><span class="line"><span class="attr">hankin</span> <span class="string">nickname</span></span><br><span class="line"><span class="attr">jinhao</span> <span class="string">realname</span></span><br><span class="line"><span class="attr">vk</span> <span class="string">nickname</span></span><br></pre></td></tr></table></figure><p>需求：根据file1和file2的第二列，把file1和file2合并成一个文件。</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">2 </span>voidking nickname</span><br><span class="line"><span class="symbol">1 </span>haojin realname</span><br><span class="line"><span class="symbol">2 </span>hankin nickname</span><br><span class="line"><span class="symbol">1 </span>jinhao realname</span><br><span class="line"><span class="symbol">2 </span>vk nickname</span><br></pre></td></tr></table></figure><p>这个需求使用awk命令来实现。<br>NR，表示awk开始执行程序后所读取的数据行数。<br>FNR，与NR功用类似，不同的是awk每打开一个新文件，FNR便从0重新累计。<br>NR==FNR：用于在读取两个或两个以上的文件时，判断是不是在读取第一个文件。<br>awk处理多个文件的语法：</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">awk -F 分隔符 'BEGIN </span><span class="template-variable">&#123; 初始化 &#125;</span><span class="xml"> </span><span class="template-variable">&#123; 循环执行部分 &#125;</span><span class="xml"> END </span><span class="template-variable">&#123; 结束处理 &#125;</span><span class="xml">' file_list1 file_list2</span></span><br></pre></td></tr></table></figure><p>其中BEGIN和END可以省略，-F也可以使用默认，循环执行部分，是按行对文件进行处理的。</p><p>脚本：</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk -F <span class="string">" "</span> 'NR==FNR&#123;a[<span class="variable">$2</span>]=<span class="variable">$0</span>;next&#125;&#123;<span class="keyword">print</span> a[<span class="variable">$2</span>]<span class="string">" "</span><span class="variable">$1&#125;</span>' file1 file2 \</span><br><span class="line">| awk '&#123;<span class="keyword">print</span> <span class="variable">$1</span><span class="string">" "</span><span class="variable">$3</span><span class="string">" "</span><span class="variable">$2&#125;</span>'</span><br></pre></td></tr></table></figure><p>由NR=FNR为真时，判断当前读入的是第一个文件file1，执行第一个花括号内的内容。<br>把file1中每行记录都存入数组a，并使用file1的第2个字段作为下标。</p><p>由NR=FNR为假时，判断当前读入了第二个文件file2，执行第二个花括号内的内容。<br>file2中的每行，根据file2的第2个字段打印数组a中的内容，同时打印file2中的第一列。</p><h2 id="每两行合成一行"><a href="#每两行合成一行" class="headerlink" title="每两行合成一行"></a>每两行合成一行</h2><p>已知ip-port.txt内容为：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1</span></span><br><span class="line"><span class="number">80</span></span><br><span class="line"><span class="number">127.0.0.1</span></span><br><span class="line"><span class="number">8080</span></span><br><span class="line"><span class="number">192.168.56.101</span></span><br><span class="line"><span class="number">3306</span></span><br></pre></td></tr></table></figure><p>需求：把ip和对应端口放在同一行。</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1</span> <span class="number">80</span></span><br><span class="line"><span class="number">127.0.0.1</span> <span class="number">8080</span></span><br><span class="line"><span class="number">192.168.56.101</span> <span class="number">3306</span></span><br></pre></td></tr></table></figure><p>脚本：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">awk</span> 'NR<span class="number">%2</span>&#123;printf <span class="string">"%s "</span>,<span class="number">$0</span>;next;&#125;1' ip-port.txt</span><br><span class="line"><span class="attribute">awk</span> 'ORS=NR<span class="number">%2</span>?FS:RS' ip-port.txt</span><br><span class="line"><span class="attribute">awk</span> '&#123; ORS = (NR<span class="number">%2</span> ? FS : RS) &#125; 1' ip-port.txt</span><br><span class="line"><span class="attribute">awk</span> '&#123; ORS = (NR<span class="number">%2</span> ? <span class="string">","</span> : RS) &#125; 1' ip-port.txt</span><br></pre></td></tr></table></figure><h2 id="删除10天前的日志"><a href="#删除10天前的日志" class="headerlink" title="删除10天前的日志"></a>删除10天前的日志</h2><p>需求：找出10天前的日志并删除。<br>脚本：</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">find</span> /usr/<span class="built_in">local</span>/tomcat/logs/ -<span class="built_in">type</span> f -mtime +<span class="number">10</span> -<span class="built_in">exec</span> rm -rfv &#123;&#125; \;</span><br><span class="line"><span class="built_in">find</span> /usr/<span class="built_in">local</span>/tomcat/logs/ -<span class="built_in">type</span> f -mtime +<span class="number">10</span> | xargs rm -rfv;</span><br></pre></td></tr></table></figure><h2 id="计算一列的和"><a href="#计算一列的和" class="headerlink" title="计算一列的和"></a>计算一列的和</h2><p>已知fruit.txt内容为：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apple <span class="number">10</span></span><br><span class="line">orange <span class="number">7</span></span><br><span class="line">banana <span class="number">0</span></span><br><span class="line">watermelon <span class="number">1</span></span><br></pre></td></tr></table></figure><p>第一列是水果名称，第二列是水果数量。</p><p>需求1：计算水果的总数。</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk '&#123;<span class="keyword">sum</span> += <span class="variable">$2&#125;</span>;END &#123;<span class="keyword">print</span> <span class="keyword">sum</span>&#125;' fruit.txt</span><br><span class="line"><span class="keyword">cat</span> fruit.txt | awk '&#123;<span class="keyword">sum</span> += <span class="variable">$2&#125;</span>;END &#123;<span class="keyword">print</span> <span class="keyword">sum</span>&#125;'</span><br></pre></td></tr></table></figure><p>需求2：计算存在多少种水果。</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> fruit.txt | awk '&#123;<span class="keyword">if</span> (<span class="variable">$2</span>&gt;0) (<span class="keyword">sum</span> += 1); <span class="keyword">else</span> (<span class="keyword">sum</span> += 0)&#125;;END&#123;<span class="keyword">print</span> <span class="keyword">sum</span>&#125;'</span><br></pre></td></tr></table></figure><h2 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h2><p>0 标准输入<br>1 标准输出，默认指向屏幕<br>2 错误输出，默认指向屏幕<br>/dev/null 黑洞</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 标准输出重定向到文件</span><br><span class="line"><span class="keyword">ls</span> &gt;<span class="keyword">out</span>.txt</span><br><span class="line"><span class="keyword">cat</span> <span class="keyword">out</span>.txt</span><br><span class="line"># 等同于</span><br><span class="line"><span class="keyword">ls</span> 1&gt;<span class="keyword">out</span>.txt</span><br><span class="line"><span class="keyword">cat</span> <span class="keyword">out</span>.txt</span><br><span class="line"></span><br><span class="line"># 错误输出重定向到文件</span><br><span class="line"><span class="keyword">ls</span> 2&gt;<span class="keyword">out</span>.txt</span><br><span class="line"><span class="keyword">cat</span> <span class="keyword">out</span>.txt</span><br><span class="line"><span class="keyword">ls</span> xxx 2&gt;<span class="keyword">out</span>.txt</span><br><span class="line"><span class="keyword">cat</span> <span class="keyword">out</span>.txt</span><br><span class="line"></span><br><span class="line"># 标准输出和错误输出都重定向到文件</span><br><span class="line">(<span class="keyword">ls</span> xxx || <span class="keyword">ls</span>) &gt;<span class="keyword">out</span>.txt 2&gt;&amp;1</span><br><span class="line"><span class="keyword">cat</span> <span class="keyword">out</span>.txt</span><br><span class="line"># 等同于</span><br><span class="line">(<span class="keyword">ls</span> xxx || <span class="keyword">ls</span>) &amp;&gt;<span class="keyword">out</span>.txt</span><br><span class="line"><span class="keyword">cat</span> <span class="keyword">out</span>.txt</span><br><span class="line"></span><br><span class="line"># 标准输出和错误输出都丢弃</span><br><span class="line">(<span class="keyword">ls</span> xxx || <span class="keyword">ls</span>) &amp;&gt;/dev/null</span><br><span class="line"># 等同于</span><br><span class="line">(<span class="keyword">ls</span> xxx; <span class="keyword">ls</span>) &amp;&gt;/dev/null</span><br></pre></td></tr></table></figure><h2 id="清空文件内容"><a href="#清空文件内容" class="headerlink" title="清空文件内容"></a>清空文件内容</h2><p>需求：清空text.txt文件中的内容<br>脚本：</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="string">""</span> &gt; <span class="keyword">test</span>.txt</span><br><span class="line">echo -<span class="keyword">n</span> <span class="string">""</span> &gt; <span class="keyword">test</span>.txt</span><br><span class="line"><span class="keyword">cat</span> /dev/null &gt; <span class="keyword">test</span>.txt</span><br></pre></td></tr></table></figure><h2 id="测试mtu值"><a href="#测试mtu值" class="headerlink" title="测试mtu值"></a>测试mtu值</h2><p>MTU是Maximum Transmission Unit的缩写，表示最大传输单元，MTU的单位是字节。大部分网络设备的MTU都是1500。<br>把本机的MTU设成比网关的MTU小或相同，就可以减少丢包。如果本机的MTU比网关的MTU大，大的数据包就会被拆开来传送，这样会产生很多数据包碎片，增加丢包率。<br>把数据包长度加上数据包头28字节，就得到MTU的值。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping -c 3 -s 1472 -M <span class="keyword">do</span> www.baidu.com</span><br><span class="line">ping -c 3 -s 1473 -M <span class="keyword">do</span> www.baidu.com</span><br></pre></td></tr></table></figure><h2 id="获取脚本绝对路径"><a href="#获取脚本绝对路径" class="headerlink" title="获取脚本绝对路径"></a>获取脚本绝对路径</h2><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">scriptpath</span>=$(cd <span class="string">"$(dirname "</span><span class="variable">$0</span><span class="string">")"</span><span class="comment">; pwd)</span></span><br></pre></td></tr></table></figure><h1 id="长脚本"><a href="#长脚本" class="headerlink" title="长脚本"></a>长脚本</h1><h2 id="循环读取多列文本1-0"><a href="#循环读取多列文本1-0" class="headerlink" title="循环读取多列文本1.0"></a>循环读取多列文本1.0</h2><p>已知mobile.txt为：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">haojin <span class="number">17625160000</span></span><br><span class="line"><span class="built_in">void</span>king <span class="number">17625160001</span></span><br></pre></td></tr></table></figure><p>需求：拼接成SQL，实现根据name修改mobile。</p><p>脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">grep -v <span class="string">"^$"</span> mobile.txt | <span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  name=`<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">'&#123;print $1&#125;'</span>`</span><br><span class="line">  mobile=`<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"update user set mobile=\"<span class="variable">$&#123;mobile&#125;</span>\" where name=\"<span class="variable">$&#123;name&#125;</span>\";"</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>PS：不能使用<code>for line in cat &#39;mobile.txt&#39;</code>，因为这种方法会按照空格或换行切分文本。</p><h2 id="循环读取多列文本2-0"><a href="#循环读取多列文本2-0" class="headerlink" title="循环读取多列文本2.0"></a>循环读取多列文本2.0</h2><p>以上循环读取的方法是存在一些问题的，我们再来看另外一个需求。</p><p>已知service.txt内容为：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1</span> <span class="number">80</span></span><br><span class="line"><span class="number">127.0.0.1</span> <span class="number">8080</span></span><br><span class="line"><span class="number">192.168.56.101</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure><p>需求：探测service.txt中每个服务的连通性，并记录结果。</p><p>脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">cat /dev/null &gt; detectresult.txt</span><br><span class="line">cat service.txt | <span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  ip=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">'&#123;print $1&#125;'</span>)</span><br><span class="line">  port=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">'&#123;print $2&#125;'</span>)</span><br><span class="line">  res=$(nc -w 2 -v <span class="variable">$ip</span> <span class="variable">$port</span>)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"<span class="variable">$res</span>"</span> &gt;&gt; detectresult.txt</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>执行脚本后，我们发现结果文件中只有一条结果！这就不符合预期了。<br>这是因为while使用重定向机制，<code>while read line</code>一次性将文件信息读入输入缓存，并按行赋值给变量line，直到输入缓存数据为空。而刚好nc、telnet、ssh等命令，会读取输入缓存中的所有数据，这就导致输入缓存被清空了，while循环结束。</p><p>解决办法：</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res=<span class="constructor">$(<span class="params">nc</span> -<span class="params">w</span> 2 -<span class="params">v</span> $<span class="params">ip</span> $<span class="params">port</span> &lt; <span class="operator">/</span><span class="params">dev</span><span class="operator">/</span><span class="params">null</span>)</span></span><br></pre></td></tr></table></figure><p>除此之外，1.0版本管道符后的while实际上是在子shell中执行，变量赋值等不会在父shell中生效，容易引发其他问题。因此，最终的脚本应该改成：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">cat /dev/null &gt; detectresult.txt</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  ip=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">'&#123;print $1&#125;'</span>)</span><br><span class="line">  port=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">'&#123;print $2&#125;'</span>)</span><br><span class="line">  res=$(nc -w 2 -v <span class="variable">$ip</span> <span class="variable">$port</span> &lt; /dev/null)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"<span class="variable">$res</span>"</span> &gt;&gt; detectresult.txt</span><br><span class="line"><span class="keyword">done</span> &lt; service.txt</span><br></pre></td></tr></table></figure><h2 id="参数提示和校验"><a href="#参数提示和校验" class="headerlink" title="参数提示和校验"></a>参数提示和校验</h2><p>需求：有一个脚本，需要appname、ip、hostname、domain四个参数，并且都不能为空。</p><p>脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># appname、ip、hostname、domain</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> <span class="string">"a:i:H:d:"</span> opt</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="keyword">case</span> <span class="variable">$opt</span> <span class="keyword">in</span></span><br><span class="line">    a)</span><br><span class="line">      appname=<span class="variable">$OPTARG</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"appname=<span class="variable">$&#123;appname&#125;</span>"</span></span><br><span class="line">      ;;</span><br><span class="line">    i)</span><br><span class="line">      ip=<span class="variable">$OPTARG</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"ip=<span class="variable">$&#123;ip&#125;</span>"</span></span><br><span class="line">      ;;</span><br><span class="line">    H)</span><br><span class="line">      hostname=<span class="variable">$OPTARG</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"hostname=<span class="variable">$&#123;hostname&#125;</span>"</span></span><br><span class="line">      ;;</span><br><span class="line">    d)</span><br><span class="line">      domain=<span class="variable">$OPTARG</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"domain=<span class="variable">$&#123;domain&#125;</span>"</span></span><br><span class="line">      ;;</span><br><span class="line">    \?)</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"-a -i -H -d are requierd"</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"-a: appName"</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"-i: ip"</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"-h: hostname"</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"-d: domain"</span></span><br><span class="line">      <span class="built_in">exit</span> 1</span><br><span class="line">      ;;</span><br><span class="line">  <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">checkOpts</span></span> () &#123;</span><br><span class="line">    key=<span class="variable">$1</span></span><br><span class="line">    value=<span class="variable">$2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="variable">$&#123;value&#125;</span> == <span class="string">""</span> ]]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">"\033[31mFATAL: <span class="variable">$&#123;key&#125;</span> should not be empty! \033[0m"</span></span><br><span class="line">        <span class="built_in">exit</span> 1001</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">checkOpts <span class="string">"appname"</span> <span class="variable">$&#123;appname&#125;</span></span><br><span class="line">checkOpts <span class="string">"ip"</span> <span class="variable">$&#123;ip&#125;</span></span><br><span class="line">checkOpts <span class="string">"hostname"</span> <span class="variable">$&#123;hostname&#125;</span></span><br><span class="line">checkOpts <span class="string">"domain"</span> <span class="variable">$&#123;domain&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># logic code</span></span><br></pre></td></tr></table></figure><h2 id="执行SQL语句"><a href="#执行SQL语句" class="headerlink" title="执行SQL语句"></a>执行SQL语句</h2><p>需求：mysql数据库，获取数据库vk中的app表中所有记录的name，写入到 name.txt 文件。</p><p>脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">get_all_name=<span class="string">"select name from app where app.deleted=0;"</span></span><br><span class="line"></span><br><span class="line">all_name=$(mysql -h192.168.56.100 -uroot -pmypassword -s -e <span class="string">"use vk;<span class="variable">$&#123;get_all_name&#125;</span>"</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;all_name&#125;</span>"</span> &gt; name.txt</span><br></pre></td></tr></table></figure><h2 id="模拟面试"><a href="#模拟面试" class="headerlink" title="模拟面试"></a>模拟面试</h2><p>已知 quiz.txt 内容为：</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">介绍 <span class="keyword">Java </span>垃圾回收器的基本原理。</span><br><span class="line">介绍 HashMap 的实现原理。</span><br><span class="line">讲讲 Web 应用程序中的 Cookie 和 Session 是什么关系？</span><br><span class="line">你在生产实践中使用过哪些设计模式，是什么场景下使用的？为什么使用？</span><br><span class="line"><span class="keyword">Java </span><span class="number">11</span> 的 “本地变量类型推断” 听说过么？讲讲看。</span><br><span class="line">解释一下事务隔离级别。</span><br><span class="line">什么是一致性hash？</span><br><span class="line">看你做的项目不少，请介绍一个你认为最能表现你能力的项目吧。</span><br><span class="line">讲讲你最近开发的一个项目的业务背景和架构（或技术）。</span><br><span class="line">项目开发用的是瀑布模型还是敏捷模型，团队角色在什么时候、用什么工具和资源、做什么动作，以及是如何协作的。</span><br></pre></td></tr></table></figure><p>需求：从 quiz.txt 文本中，随机选出5道题（不能重复），作为面试题目。面试结束后，发送面试题目到指定邮箱，方便回顾思考。</p><p>脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">cat /dev/null &gt; interview.txt</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"面试开始！"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"面试开始！"</span> &gt;&gt; interview.txt</span><br><span class="line">quiz=$(cat quiz.txt | grep -v -e <span class="string">'^[[:space:]]*$'</span>)</span><br><span class="line">sum=$(<span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;quiz&#125;</span>"</span> | wc -l)</span><br><span class="line"><span class="comment">#echo $&#123;sum&#125;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `seq 1 5`;<span class="keyword">do</span></span><br><span class="line">  <span class="comment">#echo "第$&#123;i&#125;题"</span></span><br><span class="line">  line=$((<span class="variable">$&#123;RANDOM&#125;</span>%<span class="variable">$&#123;sum&#125;</span>+1))</span><br><span class="line">  content=$(<span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;quiz&#125;</span>"</span> | sed -n <span class="variable">$&#123;line&#125;</span>p)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;i&#125;</span>、<span class="variable">$&#123;content&#125;</span>"</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;i&#125;</span>、<span class="variable">$&#123;content&#125;</span>"</span> &gt;&gt; interview.txt</span><br><span class="line">  quiz=$(<span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;quiz&#125;</span>"</span> | sed <span class="variable">$&#123;line&#125;</span>d)</span><br><span class="line">  sum=$((sum-1))</span><br><span class="line">  <span class="comment">#echo $&#123;sum&#125;</span></span><br><span class="line">  <span class="built_in">read</span> -p <span class="string">"是否继续下一题？[Y/N]"</span> input</span><br><span class="line">  <span class="keyword">if</span> [[ <span class="variable">$input</span> = <span class="string">"n"</span> || <span class="variable">$input</span> = <span class="string">"N"</span> ]];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">break</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">cat interview.txt | mail -s <span class="string">"面试-`date +\%Y\%m\%d-\%H\%M\%S`"</span> admin@voidking.com</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/shell/" rel="tag"># shell</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-shell-script-program-2/" rel="prev" title="Shell脚本编程——下"><i class="fa fa-chevron-left"></i> Shell脚本编程——下</a></div><div class="post-nav-item"> <a href="/dev-design-pattern-summary/" rel="next" title="设计模式概述">设计模式概述<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#短脚本"><span class="nav-number">2.</span> <span class="nav-text">短脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#查看系统版本"><span class="nav-number">2.1.</span> <span class="nav-text">查看系统版本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看命令属于哪个包"><span class="nav-number">2.2.</span> <span class="nav-text">查看命令属于哪个包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建用户"><span class="nav-number">2.3.</span> <span class="nav-text">创建用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#过滤空行"><span class="nav-number">2.4.</span> <span class="nav-text">过滤空行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#过滤windows换行符"><span class="nav-number">2.5.</span> <span class="nav-text">过滤windows换行符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#去除空格"><span class="nav-number">2.6.</span> <span class="nav-text">去除空格</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#空格转换行"><span class="nav-number">2.7.</span> <span class="nav-text">空格转换行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#utf8-bom-转-utf8"><span class="nav-number">2.8.</span> <span class="nav-text">utf8 bom 转 utf8</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#循环读取单列文本"><span class="nav-number">2.9.</span> <span class="nav-text">循环读取单列文本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#文本比较"><span class="nav-number">2.10.</span> <span class="nav-text">文本比较</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#批量添加开机启动命令"><span class="nav-number">2.11.</span> <span class="nav-text">批量添加开机启动命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#curl-post请求带参数"><span class="nav-number">2.12.</span> <span class="nav-text">curl post请求带参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EPEL源"><span class="nav-number">2.13.</span> <span class="nav-text">EPEL源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#联合查询"><span class="nav-number">2.14.</span> <span class="nav-text">联合查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#每两行合成一行"><span class="nav-number">2.15.</span> <span class="nav-text">每两行合成一行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除10天前的日志"><span class="nav-number">2.16.</span> <span class="nav-text">删除10天前的日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#计算一列的和"><span class="nav-number">2.17.</span> <span class="nav-text">计算一列的和</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重定向"><span class="nav-number">2.18.</span> <span class="nav-text">重定向</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#清空文件内容"><span class="nav-number">2.19.</span> <span class="nav-text">清空文件内容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#测试mtu值"><span class="nav-number">2.20.</span> <span class="nav-text">测试mtu值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取脚本绝对路径"><span class="nav-number">2.21.</span> <span class="nav-text">获取脚本绝对路径</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#长脚本"><span class="nav-number">3.</span> <span class="nav-text">长脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#循环读取多列文本1-0"><span class="nav-number">3.1.</span> <span class="nav-text">循环读取多列文本1.0</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#循环读取多列文本2-0"><span class="nav-number">3.2.</span> <span class="nav-text">循环读取多列文本2.0</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参数提示和校验"><span class="nav-number">3.3.</span> <span class="nav-text">参数提示和校验</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#执行SQL语句"><span class="nav-number">3.4.</span> <span class="nav-text">执行SQL语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模拟面试"><span class="nav-number">3.5.</span> <span class="nav-text">模拟面试</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">614</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">49</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">194</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2021</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://www.beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>