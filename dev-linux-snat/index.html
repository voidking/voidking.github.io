<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//cdn.jsdelivr.net/gh/voidking/voidking.github.io/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言一个局域网中，主机之间互联，其中只有一台主机可以上网，其他主机想要上网怎么办？答：使用SNAT。 情景模拟有主机A，eth0的IP为内网IP：192.168.56.101，eth1为公网IP：120.77.36.222。有主机B，eth0的IP为内网IP：192.168.56.102。 主机A可以访问外网，主机B和主机A在同一个局域网。下面我们进行配置，让主机B也可以上网。"><meta property="og:type" content="article"><meta property="og:title" content="Linux配置SNAT上网"><meta property="og:url" content="https://www.voidking.com/dev-linux-snat/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言一个局域网中，主机之间互联，其中只有一台主机可以上网，其他主机想要上网怎么办？答：使用SNAT。 情景模拟有主机A，eth0的IP为内网IP：192.168.56.101，eth1为公网IP：120.77.36.222。有主机B，eth0的IP为内网IP：192.168.56.102。 主机A可以访问外网，主机B和主机A在同一个局域网。下面我们进行配置，让主机B也可以上网。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com//imgs/linux-snat/iptables.png"><meta property="og:image" content="http://cdn.voidking.com//imgs/linux-snat/data.png"><meta property="article:published_time" content="2018-04-27T07:00:00.000Z"><meta property="article:modified_time" content="2018-04-27T07:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="网络"><meta property="article:tag" content="linux"><meta property="article:tag" content="iptables"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com//imgs/linux-snat/iptables.png"><link rel="canonical" href="https://www.voidking.com/dev-linux-snat/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>Linux配置SNAT上网 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，天天向上！</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-linux-snat/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="学而不思则罔，思而不学则殆！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Linux配置SNAT上网</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-04-27 15:00:00" itemprop="dateCreated datePublished" datetime="2018-04-27T15:00:00+08:00">2018-04-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/" itemprop="url" rel="index"><span itemprop="name">专业</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%B8%93%E4%B8%9A/%E8%BF%90%E7%BB%B4/%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">网络</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>一个局域网中，主机之间互联，其中只有一台主机可以上网，其他主机想要上网怎么办？答：使用SNAT。</p><h1 id="情景模拟"><a href="#情景模拟" class="headerlink" title="情景模拟"></a>情景模拟</h1><p>有主机A，eth0的IP为内网IP：192.168.56.101，eth1为公网IP：120.77.36.222。<br>有主机B，eth0的IP为内网IP：192.168.56.102。</p><p>主机A可以访问外网，主机B和主机A在同一个局域网。下面我们进行配置，让主机B也可以上网。</p><a id="more"></a><h1 id="数据包流向"><a href="#数据包流向" class="headerlink" title="数据包流向"></a>数据包流向</h1><h2 id="发送数据包"><a href="#发送数据包" class="headerlink" title="发送数据包"></a>发送数据包</h2><p>B发送数据包时，A也就是NAT主机，分析数据包表头，将此数据包转到可以连接公网的IP上去。由于私有IP与公有IP不能互通，A会通过iptables的NAT table内的Postrounting链将数据包表头伪装成A的公网IP，并且将这两个不同来源的数据包对应关系写入暂存内存中，然后将数据包传送出去。此时传到互联网的这个数据包，已经表现为来自公网IP，而非来自局域网。</p><h2 id="接收响应包"><a href="#接收响应包" class="headerlink" title="接收响应包"></a>接收响应包</h2><p>当互联网把数据响应给B时，会首先进入NAT主机A，A分析数据包的序号，对比刚刚记录到内存中的数据，由于发现该数据包为后端主机之前传送出去的，因此在NAT Prerouting链中，会将目标IP修改成为后端主机，即B的IP，然后发现目标已经不是A的公网IP，开始通过路由分析，将数据包传送到A的局域网接口，再传送到最终目标192.168.56.102上去。</p><h1 id="iptables小班"><a href="#iptables小班" class="headerlink" title="iptables小班"></a>iptables小班</h1><p>snat的配置，主要用到iptables命令，之前在<a href="http://www.voidking.com/dev-firewall/">《CentOS7中firewall的使用》</a>简单提过iptables，今天再认真学习一下。</p><p>主要参考文档：<br><a href="https://help.ubuntu.com/community/IptablesHowTo" target="_blank" rel="noopener">Basic iptables howto</a><br><a href="http://blog.chinaunix.net/uid-26495963-id-3279216.html" target="_blank" rel="noopener">iptables详解</a><br><a href="http://www.zsythink.net/archives/1199" target="_blank" rel="noopener">ipatebles详解（1）：iptales概念</a><br><a href="http://man.linuxde.net/iptables" target="_blank" rel="noopener">iptables命令</a><br><a href="http://www.cnblogs.com/bill1015/p/6847841.html" target="_blank" rel="noopener">25个iptables常用示例</a><br><a href="http://blog.chinaunix.net/uid-9950859-id-98279.html" target="_blank" rel="noopener">Linux防火墙iptables学习笔记（三）iptables命令详解和举例</a></p><h2 id="历史"><a href="#历史" class="headerlink" title="历史"></a>历史</h2><p>防火墙，其实说白了讲，就是用于实现Linux下访问控制的功能的，它分为硬件的或者软件的防火墙两种。无论是在哪个网络中，防火墙工作的地方一定是在网络的边缘。而我们的任务就是需要去定义到底防火墙如何工作，这就是防火墙的策略，规则，以达到让它对出入网络的IP、数据进行检测。</p><p>iptables的前身叫ipfirewall （内核1.x时代），这是一个作者从freeBSD上移植过来的，能够工作在内核当中的，对数据包进行检测的一款简易访问控制工具。但是ipfirewall工作功能极其有限（它需要将所有的规则都放进内核当中，这样规则才能够运行起来，而放进内核，这个做法一般是极其困难的）。当内核发展到2.x系列的时候，软件更名为ipchains，它可以定义多条规则，将他们串起来，共同发挥作用，而现在，它叫做iptables，<strong>可以将规则组成一个列表，实现绝对详细的访问控制功能</strong>。</p><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><h3 id="五个关卡"><a href="#五个关卡" class="headerlink" title="五个关卡"></a>五个关卡</h3><p>iptables工作在用户空间中，<strong>是定义规则的工具，本身并不算是防火墙</strong>。它定义的规则，可以让内核空间中的netfilter来读取，并且实现让防火墙工作。netfilter的架构就是在整个网络流程的若干位置设置一些关卡（HOOK），而在每个关卡上登记了一些规则，所以这些关卡的术语规则链。</p><p>在内核空间中，netfilter选择了5个位置，来作为控制的关卡，专业点叫做规则链。朱双印大神的博客中给出了直观的图像：<br><img src="http://cdn.voidking.com//imgs/linux-snat/iptables.png" alt=""></p><p>根据上图，我们能够想象出某些常用场景中，报文的流向：<br>到本机某进程的报文：PREROUTING –&gt; INPUT<br>由本机转发的报文：PREROUTING –&gt; FORWARD –&gt; POSTROUTING<br>由本机的某进程发出报文（通常为响应报文）：OUTPUT –&gt; POSTROUTING</p><p>五个规则链的作用如下：<br>INPUT链：处理输入数据包。<br>OUTPUT链：处理输出数据包。<br>PORWARD链：处理转发数据包。<br>PREROUTING链：用于目标地址转换（DNAT）。<br>POSTOUTING链：用于源地址转换（SNAT）。</p><h2 id="表的概念"><a href="#表的概念" class="headerlink" title="表的概念"></a>表的概念</h2><p>我们再想想另外一个问题，我们对每个”链”上都放置了一串规则，但是这些规则有些很相似，比如，A类规则都是对IP或者端口的过滤，B类规则是修改报文，那么这个时候，我们是不是能把实现相同功能的规则放在一起呢，必须能的。</p><p>我们把具有相同功能的规则的集合叫做”表”，所以说，不同功能的规则，我们可以放置在不同的表中进行管理，而iptables已经为我们定义了4种表，每种表对应了不同的功能，而我们定义的规则也都逃脱不了这4种功能的范围，所以，学习iptables之前，我们必须先搞明白每种表的作用。<br>iptables为我们提供了如下规则的分类，或者说，iptables为我们提供了如下”表”：</p><ul><li>filter表：负责过滤功能，防火墙；内核模块：iptables_filter</li><li>nat表：network address translation，网络地址转换功能；内核模块：iptable_nat</li><li>mangle表：拆解报文，做出修改，并重新封装的功能；iptable_mangle</li><li>raw表：关闭nat表上启用的连接追踪机制；iptable_raw</li></ul><p>也就是说，我们自定义的所有规则，都是这四种分类中的规则，或者说，所有规则都存在于这4张”表”中。</p><h2 id="数据包流向-1"><a href="#数据包流向-1" class="headerlink" title="数据包流向"></a>数据包流向</h2><p>可以将数据包通过防火墙的流程总结为下图：<br><img src="http://cdn.voidking.com//imgs/linux-snat/data.png" alt=""><br>我们在写iptables规则的时候，要时刻牢记这张路由次序图，灵活配置规则。</p><h2 id="规则"><a href="#规则" class="headerlink" title="规则"></a>规则</h2><p>规则：根据指定的匹配条件来尝试匹配每个流经此处的报文，一旦匹配成功，则由规则后面指定的处理动作进行处理。规则由匹配条件和处理动作组成。</p><p>匹配条件分为基本匹配条件与扩展匹配条件：<br>基本匹配条件包括源地址Source IP和目标地址 Destination IP。</p><p>扩展匹配条件包括源端口Source Port，目标端口Destination Port等等。</p><p>动作也可以分为基本动作和扩展动作，此处列出一些常用动作：<br>ACCEPT：允许数据包通过。<br>DROP：直接丢弃数据包，不给任何回应信息，这时候客户端会感觉自己的请求泥牛入海了，过了超时时间才会有反应。<br>REJECT：拒绝数据包通过，必要时会给数据发送端一个响应的信息，客户端刚请求就会收到拒绝的信息。<br>SNAT：源地址转换，解决内网用户用同一个公网地址上网的问题。<br>MASQUERADE：是SNAT的一种特殊形式，适用于动态的、临时会变的ip上。<br>DNAT：目标地址转换，解决外网用户访问内网的问题。<br>REDIRECT：在本机做端口映射。<br>LOG：在/var/log/messages文件中记录日志信息，然后将数据包传递给下一条规则，也就是说除了记录以外不对数据包做任何其他操作，仍然让下一条规则去匹配。</p><h2 id="命令详解"><a href="#命令详解" class="headerlink" title="命令详解"></a>命令详解</h2><p>命令格式：<br><code>iptables [选项] [参数]</code></p><p>选项包括：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">-t：指定要操纵的表；</span></span><br><span class="line"><span class="deletion">-A：向规则链中添加条目；</span></span><br><span class="line"><span class="deletion">-D：从规则链中删除条目；</span></span><br><span class="line"><span class="deletion">-I：向规则链中插入条目；</span></span><br><span class="line"><span class="deletion">-R：替换规则链中的条目；</span></span><br><span class="line"><span class="deletion">-L：显示规则链中已有的条目；</span></span><br><span class="line"><span class="deletion">-F：清楚规则链中已有的条目；</span></span><br><span class="line"><span class="deletion">-Z：清空规则链中的数据包计算器和字节计数器；</span></span><br><span class="line"><span class="deletion">-N：创建新的用户自定义规则链；</span></span><br><span class="line"><span class="deletion">-P：定义规则链中的默认目标；</span></span><br><span class="line"><span class="deletion">-h：显示帮助信息；</span></span><br><span class="line"><span class="deletion">-p：指定要匹配的数据包协议类型；</span></span><br><span class="line"><span class="deletion">-s：指定要匹配的数据包源ip地址；</span></span><br><span class="line"><span class="deletion">-d：指定要匹配的数据包目标ip地址；</span></span><br><span class="line"><span class="deletion">-j：指定要跳转的目标；</span></span><br><span class="line"><span class="deletion">-i：指定数据包进入本机的网络接口（网卡）；</span></span><br><span class="line"><span class="deletion">-o：指定数据包离开本机的网络接口（网卡）；</span></span><br><span class="line"><span class="deletion">--sport：匹配来源端口号；</span></span><br><span class="line"><span class="deletion">--dport：匹配目标端口号。</span></span><br></pre></td></tr></table></figure><p>命令选项输入顺序：<br><code>iptables -t 表名 &lt;-A/I/D/R&gt; 规则链名 [规则号] &lt;-i/o 网卡名&gt; -p 协议名 &lt;-s 源IP/源子网&gt; --sport 源端口 &lt;-d 目标IP/目标子网&gt; --dport 目标端口 -j 动作</code></p><h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>1、清除已有iptables规则</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">iptables</span> <span class="string">-F</span></span><br><span class="line"><span class="attr">iptables</span> <span class="string">-X</span></span><br><span class="line"><span class="attr">iptables</span> <span class="string">-Z</span></span><br></pre></td></tr></table></figure><p>2、开放指定的端口</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">iptables</span> <span class="string">-A</span> <span class="string">INPUT</span> <span class="string">-s</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="string">-d</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="string">-j</span> <span class="string">ACCEPT</span>               <span class="comment">#允许本地回环接口(即允许本机访问本机)</span></span><br><span class="line"><span class="string">iptables</span> <span class="string">-A</span> <span class="string">INPUT</span> <span class="string">-m</span> <span class="string">state</span> <span class="string">--state</span> <span class="string">ESTABLISHED,RELATED</span> <span class="string">-j</span> <span class="string">ACCEPT</span>    <span class="comment">#允许已建立的或相关连的通行</span></span><br><span class="line"><span class="string">iptables</span> <span class="string">-A</span> <span class="string">OUTPUT</span> <span class="string">-j</span> <span class="string">ACCEPT</span>         <span class="comment">#允许所有本机向外的访问</span></span><br><span class="line"><span class="string">iptables</span> <span class="string">-A</span> <span class="string">INPUT</span> <span class="string">-p</span> <span class="string">tcp</span> <span class="string">--dport</span> <span class="number">22</span> <span class="string">-j</span> <span class="string">ACCEPT</span>    <span class="comment">#允许访问22端口</span></span><br><span class="line"><span class="string">iptables</span> <span class="string">-A</span> <span class="string">INPUT</span> <span class="string">-p</span> <span class="string">tcp</span> <span class="string">--dport</span> <span class="number">80</span> <span class="string">-j</span> <span class="string">ACCEPT</span>    <span class="comment">#允许访问80端口</span></span><br><span class="line"><span class="string">iptables</span> <span class="string">-A</span> <span class="string">INPUT</span> <span class="string">-p</span> <span class="string">tcp</span> <span class="string">--dport</span> <span class="number">21</span> <span class="string">-j</span> <span class="string">ACCEPT</span>    <span class="comment">#允许ftp服务的21端口</span></span><br><span class="line"><span class="string">iptables</span> <span class="string">-A</span> <span class="string">INPUT</span> <span class="string">-p</span> <span class="string">tcp</span> <span class="string">--dport</span> <span class="number">20</span> <span class="string">-j</span> <span class="string">ACCEPT</span>    <span class="comment">#允许FTP服务的20端口</span></span><br><span class="line"><span class="string">iptables</span> <span class="string">-A</span> <span class="string">INPUT</span> <span class="string">-j</span> <span class="string">REJECT</span>       <span class="comment">#禁止其他未允许的规则访问</span></span><br><span class="line"><span class="string">iptables</span> <span class="string">-A</span> <span class="string">FORWARD</span> <span class="string">-j</span> <span class="string">REJECT</span>     <span class="comment">#禁止其他未允许的规则访问</span></span><br></pre></td></tr></table></figure><p>3、屏蔽IP</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iptables -I INPUT -s <span class="number">123.45</span><span class="number">.6</span><span class="number">.7</span> -j DROP       #屏蔽单个IP的命令</span><br><span class="line">iptables -I INPUT -s <span class="number">123.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">8</span> -j DROP      #封整个段即从<span class="number">123.0</span><span class="number">.0</span><span class="number">.1</span>到<span class="number">123.255</span><span class="number">.255</span><span class="number">.254</span>的命令</span><br><span class="line">iptables -I INPUT -s <span class="number">124.45</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">16</span> -j DROP    #封IP段即从<span class="number">123.45</span><span class="number">.0</span><span class="number">.1</span>到<span class="number">123.45</span><span class="number">.255</span><span class="number">.254</span>的命令</span><br><span class="line">iptables -I INPUT -s <span class="number">123.45</span><span class="number">.6</span><span class="number">.0</span>/<span class="number">24</span> -j DROP    #封IP段即从<span class="number">123.45</span><span class="number">.6</span><span class="number">.1</span>到<span class="number">123.45</span><span class="number">.6</span><span class="number">.254</span>的命令是</span><br></pre></td></tr></table></figure><p>4、查看已添加的iptables规则<br><code>iptables -L -n -v</code></p><p>5、删除已添加的iptables规则<br>将所有iptables以序号标记显示，执行：<br><code>iptables -L -n --line-numbers</code></p><p>比如要删除INPUT里序号为8的规则，执行：<br><code>iptables -D INPUT 8</code></p><h1 id="snat具体配置"><a href="#snat具体配置" class="headerlink" title="snat具体配置"></a>snat具体配置</h1><h2 id="主机A"><a href="#主机A" class="headerlink" title="主机A"></a>主机A</h2><h3 id="接收数据包"><a href="#接收数据包" class="headerlink" title="接收数据包"></a>接收数据包</h3><p>允许接收局域网网卡的数据包<br><code>sudo iptables -I INPUT -i eth0 -j ACCEPT</code></p><p>或者<br><code>sudo iptables -P INPUT ACCEPT</code></p><h3 id="开启路由功能"><a href="#开启路由功能" class="headerlink" title="开启路由功能"></a>开启路由功能</h3><p><code>sudo echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code><br>如果报错：-bash: /proc/sys/net/ipv4/ip_forward: Permission denied<br>那就切换到root用户：<br><code>sudo -i</code><br><code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code></p><p>要想永久有效，还要把/etc/sysctl.conf文件里边的net.ipv4.ip_forward的值改为1。</p><h3 id="伪装数据包"><a href="#伪装数据包" class="headerlink" title="伪装数据包"></a>伪装数据包</h3><p><code>sudo iptables -t nat -A POSTROUTING -s 192.168.56.102 -o eth1 -j MASQUERADE</code></p><p>或者用SNAT直接修改IP数据包的表头来源IP<br><code>sudo iptables -t nat -A POSTROUTING -s 192.168.56.102 -o eth1 -j SNAT --to 192.168.56.101</code></p><p>如果需要支持整个网段：<br><code>sudo iptables -t nat -A POSTROUTING -s 192.168.56.0/24 -o eth1 -j SNAT --to 192.168.56.101</code></p><p>如果需要支持连续IP：<br><code>sudo iptables -t nat -A POSTROUTING -m iprange --src-range 192.168.56.102-192.168.56.104 -o eth1 -j SNAT --to 192.168.56.101</code></p><p>注意：</p><ul><li>亲测以上所有命令中的<code>-o eth1</code>可以省略，所以，在分不清哪个网卡是内网哪个网卡是外网的情况下，直接省略即可。</li><li>如果想要允许所有IP，<code>-s 192.168.56.0/24</code>也可以省略。</li><li><code>-j SNAT --to 192.168.56.101</code>可以换成<code>-j SNAT --to 120.77.36.222</code>。</li><li><code>-j SNAT --to 120.77.36.222</code>建议换成<code>-j MASQUERADE</code>，尤其在外网IP非固定的情况下。</li><li>综上，最简单的万能SNAT命令为<code>sudo iptables -t nat -A POSTROUTING -j MASQUERADE</code></li></ul><h3 id="查看与删除"><a href="#查看与删除" class="headerlink" title="查看与删除"></a>查看与删除</h3><p>查看NAT表链规则<br><code>sudo iptables -t nat -nL --line-number</code></p><p>删除POSTROUTING第一条规则<br><code>sudo iptables -t nat -D POSTROUTING 1</code></p><h2 id="重启后依旧生效"><a href="#重启后依旧生效" class="headerlink" title="重启后依旧生效"></a>重启后依旧生效</h2><p>1、保存规则<br><code>sudo chmod a+w -R /opt</code><br><code>sudo iptables-save &gt; /opt/iptables.rules</code></p><p>2、手动导入规则<br><code>sudo iptables-restore &lt; /opt/iptables.rules</code></p><p>3、开机自动导入规则<br>在ubuntu下要把一个程序加入开机启动，一般可以通过修改rc.local来完成，但ubuntu下有两个rc.local文件，分别是/etc/rc.local和/etc/init.d/rc.local。因为/etc/init.d/rc.local调用了/etc/rc.local，所以我们的开机脚本最好直接写入/etc/rc.local，写在exit 0之前即可。</p><p><code>sudo vim /etc/rc.local</code><br>在exit 0之前添加：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/sbin/i</span>ptables-restore &lt; <span class="regexp">/opt/i</span>ptables.rules</span><br></pre></td></tr></table></figure><h2 id="主机B"><a href="#主机B" class="headerlink" title="主机B"></a>主机B</h2><h3 id="centos"><a href="#centos" class="headerlink" title="centos"></a>centos</h3><p>如果是centos，那么配置ifcfg文件<br><code>sudo vim /etc/sysconfig/network-scripts/ifcfg-eth0</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">DEVICE</span>=eth0</span><br><span class="line"><span class="attr">BOOTPROTO</span>=static</span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">IPADDR</span>=<span class="number">192.168</span>.<span class="number">56.102</span></span><br><span class="line"><span class="attr">NETMASK</span>=<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line"><span class="attr">GATEWAY</span>=<span class="number">192.168</span>.<span class="number">56.101</span></span><br></pre></td></tr></table></figure><p>然后<code>service network restart</code></p><h3 id="ubuntu"><a href="#ubuntu" class="headerlink" title="ubuntu"></a>ubuntu</h3><p>如果是ubuntu，那么配置interfaces文件<br><code>sudo vim /etc/network/interfaces</code></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">auto</span> lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line"><span class="built_in">auto</span> em1</span><br><span class="line">iface em1 inet static</span><br><span class="line">address <span class="number">192.168</span><span class="number">.56</span><span class="number">.102</span></span><br><span class="line">netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">gateway <span class="number">192.168</span><span class="number">.56</span><span class="number">.101</span></span><br></pre></td></tr></table></figure><p>然后<code>sudo /etc/init.d/networking restart</code></p><p>总之，B主机配置的关键在于网关，网关要设置成主机A的内网IP。</p><p>请问，网关不设置成主机A的内网IP可以吗？可以，那就是另外一种稍微复杂的设置方法了。</p><p>此时，使用主机B，已经可以ping通外网的IP了。但是ping域名会提示“ping: unknown host”。</p><h1 id="DNS配置"><a href="#DNS配置" class="headerlink" title="DNS配置"></a>DNS配置</h1><h2 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h2><p>1、编辑resolv.conf<br><code>sudo vim /etc/resolv.conf</code>，添加nameserver的配置</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nameserver <span class="number">180.76</span><span class="number">.76</span><span class="number">.76</span></span><br><span class="line">nameserver <span class="number">223.6</span><span class="number">.6</span><span class="number">.6</span></span><br></pre></td></tr></table></figure><p>上面的两个IP地址，分别是百度和阿里的公共DNS。</p><p>2、测试<br><code>ping www.baidu.com</code></p><p>3、不过，这种方法在重启之后会失效。想要永久生效，还需要编辑base文件。<br><code>sudo vim /etc/resolvconf/resolv.conf.d/base</code>，添加：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nameserver <span class="number">180.76</span><span class="number">.76</span><span class="number">.76</span></span><br><span class="line">nameserver <span class="number">223.6</span><span class="number">.6</span><span class="number">.6</span></span><br></pre></td></tr></table></figure><h2 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h2><p>1、编辑interfaces<br><code>sudo vim /etc/network/interfaces</code></p><p>2、添加nameserver的配置</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dns-nameserver <span class="number">180.76</span><span class="number">.76</span><span class="number">.76</span> <span class="number">223.5</span><span class="number">.5</span><span class="number">.5</span></span><br></pre></td></tr></table></figure><p>3、重启服务器<br><code>sudo reboot</code><br>实际上，重启后的dns配置会写入到resolv.conf中。</p><p>4、测试<br><code>ping www.baidu.com</code></p><h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>至此，snat完美配置成功！在这个过程中，顺带学习了一下iptables，收获满满。感觉iptables和route有很大关系，但是在配置过程中没有用到route。书签中有关于route的文档，用到的时候再深入学习。</p><h1 id="书签"><a href="#书签" class="headerlink" title="书签"></a>书签</h1><p><a href="https://www.cnblogs.com/weifeng1463/p/6795939.html" target="_blank" rel="noopener">Linux下配置SNAT上网</a></p><p><a href="https://blog.csdn.net/qq_17586821/article/details/53292096" target="_blank" rel="noopener">利用iptables的SNAT功能实现局域网共享上网</a></p><p><a href="https://blog.csdn.net/chenlycly/article/details/52141854" target="_blank" rel="noopener">linux 路由表设置之 route 指令详解</a></p><p><a href="http://blog.51cto.com/solin/1900865" target="_blank" rel="noopener">ubuntu配置静态路由及重启生效</a></p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.voidking.com/dev-linux-snat/" title="Linux配置SNAT上网">https://www.voidking.com/dev-linux-snat/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！源站会及时更新知识点及修正错误，阅读体验也更好。欢迎分享，欢迎收藏~</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag"># 网络</a> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/iptables/" rel="tag"># iptables</a></div><div class="post-nav"><div class="post-nav-item"><a href="/en-1368-words/" rel="prev" title="《1368个单词就够了》单词表"><i class="fa fa-chevron-left"></i> 《1368个单词就够了》单词表</a></div><div class="post-nav-item"> <a href="/dev-hexo-build-environment-2018-05/" rel="next" title="Hexo环境搭建2018年5月版">Hexo环境搭建2018年5月版<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODU3Mi8xNTEwMA=="></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#情景模拟"><span class="nav-number">2.</span> <span class="nav-text">情景模拟</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据包流向"><span class="nav-number">3.</span> <span class="nav-text">数据包流向</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#发送数据包"><span class="nav-number">3.1.</span> <span class="nav-text">发送数据包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#接收响应包"><span class="nav-number">3.2.</span> <span class="nav-text">接收响应包</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#iptables小班"><span class="nav-number">4.</span> <span class="nav-text">iptables小班</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#历史"><span class="nav-number">4.1.</span> <span class="nav-text">历史</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#原理"><span class="nav-number">4.2.</span> <span class="nav-text">原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#五个关卡"><span class="nav-number">4.2.1.</span> <span class="nav-text">五个关卡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#表的概念"><span class="nav-number">4.3.</span> <span class="nav-text">表的概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据包流向-1"><span class="nav-number">4.4.</span> <span class="nav-text">数据包流向</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#规则"><span class="nav-number">4.5.</span> <span class="nav-text">规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#命令详解"><span class="nav-number">4.6.</span> <span class="nav-text">命令详解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实例"><span class="nav-number">4.7.</span> <span class="nav-text">实例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#snat具体配置"><span class="nav-number">5.</span> <span class="nav-text">snat具体配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#主机A"><span class="nav-number">5.1.</span> <span class="nav-text">主机A</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#接收数据包"><span class="nav-number">5.1.1.</span> <span class="nav-text">接收数据包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#开启路由功能"><span class="nav-number">5.1.2.</span> <span class="nav-text">开启路由功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#伪装数据包"><span class="nav-number">5.1.3.</span> <span class="nav-text">伪装数据包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看与删除"><span class="nav-number">5.1.4.</span> <span class="nav-text">查看与删除</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重启后依旧生效"><span class="nav-number">5.2.</span> <span class="nav-text">重启后依旧生效</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#主机B"><span class="nav-number">5.3.</span> <span class="nav-text">主机B</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#centos"><span class="nav-number">5.3.1.</span> <span class="nav-text">centos</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ubuntu"><span class="nav-number">5.3.2.</span> <span class="nav-text">ubuntu</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DNS配置"><span class="nav-number">6.</span> <span class="nav-text">DNS配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#方法一"><span class="nav-number">6.1.</span> <span class="nav-text">方法一</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方法二"><span class="nav-number">6.2.</span> <span class="nav-text">方法二</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#结语"><span class="nav-number">7.</span> <span class="nav-text">结语</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#书签"><span class="nav-number">8.</span> <span class="nav-text">书签</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">学而不思则罔，思而不学则殆！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">637</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">51</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">199</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://www.beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  // window.livereOptions = {
  //   refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  // };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script></body></html>