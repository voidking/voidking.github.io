<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//qiniu.cdn.voidking.com/doc/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="需求描述有主机A，eth0的IP为内网IP：192.168.56.101，eth1为公网IP：120.77.36.222。有主机B，eth0的IP为内网IP：192.168.56.102。主机A可以访问外网，主机B和主机A在同一个局域网。现在我们想让主机B也可以上网，该怎么办？最简单的方法有两个：1）SNAT；2）代理 本文中，我们学习使用配置SNAT的方式，实现局域网中的所有主机可以上网。 参考"><meta property="og:type" content="article"><meta property="og:title" content="好好学Linux：Linux配置SNAT上网"><meta property="og:url" content="https://www.voidking.com/dev-linux-snat/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="需求描述有主机A，eth0的IP为内网IP：192.168.56.101，eth1为公网IP：120.77.36.222。有主机B，eth0的IP为内网IP：192.168.56.102。主机A可以访问外网，主机B和主机A在同一个局域网。现在我们想让主机B也可以上网，该怎么办？最简单的方法有两个：1）SNAT；2）代理 本文中，我们学习使用配置SNAT的方式，实现局域网中的所有主机可以上网。 参考"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2018-04-27T15:00:00.000Z"><meta property="article:modified_time" content="2022-10-17T14:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="好好学Linux"><meta property="article:tag" content="网络"><meta property="article:tag" content="iptables"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-linux-snat/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>好好学Linux：Linux配置SNAT上网 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">一个计算机技术爱好者与学习者</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-linux-snat/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="一个计算机技术爱好者与学习者"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> 好好学Linux：Linux配置SNAT上网</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-04-27 15:00:00" itemprop="dateCreated datePublished" datetime="2018-04-27T15:00:00+00:00">2018-04-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-10-17 14:00:00" itemprop="dateModified" datetime="2022-10-17T14:00:00+00:00">2022-10-17</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/shell/" itemprop="url" rel="index"><span itemprop="name">shell</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/network/" itemprop="url" rel="index"><span itemprop="name">network</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="需求描述"><span class="post-title-index">1.</span><a href="#需求描述" class="headerlink" title="需求描述"></a> 需求描述</h1><p>有主机A，eth0的IP为内网IP：192.168.56.101，eth1为公网IP：120.77.36.222。<br>有主机B，eth0的IP为内网IP：192.168.56.102。<br>主机A可以访问外网，主机B和主机A在同一个局域网。现在我们想让主机B也可以上网，该怎么办？<br>最简单的方法有两个：1）SNAT；2）代理</p><p>本文中，我们学习使用配置SNAT的方式，实现局域网中的所有主机可以上网。</p><p>参考文档：</p><ul><li><a href="http://www.voidking.com/dev-iptables-start/">《iptables入门篇》</a></li><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/weifeng1463/p/6795939.html">Linux下配置SNAT上网</a></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_17586821/article/details/53292096">利用iptables的SNAT功能实现局域网共享上网</a></li><li><a target="_blank" rel="noopener" href="http://blog.51cto.com/solin/1900865">ubuntu配置静态路由及重启生效</a></li></ul><span id="more"></span><h1 id="SNAT数据包流向"><span class="post-title-index">2.</span><a href="#SNAT数据包流向" class="headerlink" title="SNAT数据包流向"></a> SNAT数据包流向</h1><h2 id="发送数据包"><span class="post-title-index">2.1.</span><a href="#发送数据包" class="headerlink" title="发送数据包"></a> 发送数据包</h2><p>B发送数据包时，A也就是NAT主机，分析数据包表头，将此数据包转到可以连接公网的IP上去。由于私有IP与公有IP不能互通，A会通过iptables的NAT table内的Postrounting链将数据包表头伪装成A的公网IP，并且将这两个不同来源的数据包对应关系写入暂存内存中，然后将数据包传送出去。此时传到互联网的这个数据包，已经表现为来自公网IP，而非来自局域网。</p><h2 id="接收响应包"><span class="post-title-index">2.2.</span><a href="#接收响应包" class="headerlink" title="接收响应包"></a> 接收响应包</h2><p>当互联网把数据响应给B时，会首先进入NAT主机A，A分析数据包的序号，对比刚刚记录到内存中的数据，由于发现该数据包为后端主机之前传送出去的，因此在NAT Prerouting链中，会将目标IP修改成为后端主机，即B的IP，然后发现目标已经不是A的公网IP，开始通过路由分析，将数据包传送到A的局域网接口，再传送到最终目标192.168.56.102上去。</p><h1 id="snat具体配置"><span class="post-title-index">3.</span><a href="#snat具体配置" class="headerlink" title="snat具体配置"></a> snat具体配置</h1><h2 id="主机A"><span class="post-title-index">3.1.</span><a href="#主机A" class="headerlink" title="主机A"></a> 主机A</h2><h3 id="接收数据包"><span class="post-title-index">3.1.1.</span><a href="#接收数据包" class="headerlink" title="接收数据包"></a> 接收数据包</h3><p>允许接收局域网网卡的数据包<br><code>sudo iptables -I INPUT -i eth0 -j ACCEPT</code></p><p>或者<br><code>sudo iptables -P INPUT ACCEPT</code></p><h3 id="开启路由功能"><span class="post-title-index">3.1.2.</span><a href="#开启路由功能" class="headerlink" title="开启路由功能"></a> 开启路由功能</h3><p><code>sudo echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code><br>如果报错：-bash: /proc/sys/net/ipv4/ip_forward: Permission denied<br>那就切换到root用户：<br><code>sudo -i</code><br><code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code></p><p>要想永久有效，还要把/etc/sysctl.conf文件里边的net.ipv4.ip_forward的值改为1。</p><h3 id="伪装数据包"><span class="post-title-index">3.1.3.</span><a href="#伪装数据包" class="headerlink" title="伪装数据包"></a> 伪装数据包</h3><p><code>sudo iptables -t nat -A POSTROUTING -s 192.168.56.102 -o eth1 -j MASQUERADE</code></p><p>或者用SNAT直接修改IP数据包的表头来源IP<br><code>sudo iptables -t nat -A POSTROUTING -s 192.168.56.102 -o eth1 -j SNAT --to 192.168.56.101</code></p><p>如果需要支持整个网段：<br><code>sudo iptables -t nat -A POSTROUTING -s 192.168.56.0/24 -o eth1 -j SNAT --to 192.168.56.101</code></p><p>如果需要支持连续IP：<br><code>sudo iptables -t nat -A POSTROUTING -m iprange --src-range 192.168.56.102-192.168.56.104 -o eth1 -j SNAT --to 192.168.56.101</code></p><p>注意：</p><ul><li>亲测以上所有命令中的<code>-o eth1</code>可以省略，所以，在分不清哪个网卡是内网哪个网卡是外网的情况下，直接省略即可。</li><li>如果想要允许所有IP，<code>-s 192.168.56.0/24</code>也可以省略。</li><li><code>-j SNAT --to 192.168.56.101</code>可以换成<code>-j SNAT --to 120.77.36.222</code>。</li><li><code>-j SNAT --to 120.77.36.222</code>建议换成<code>-j MASQUERADE</code>，尤其在外网IP非固定的情况下。</li><li>综上，最简单的万能SNAT命令为<code>sudo iptables -t nat -A POSTROUTING -j MASQUERADE</code></li></ul><h3 id="查看与删除"><span class="post-title-index">3.1.4.</span><a href="#查看与删除" class="headerlink" title="查看与删除"></a> 查看与删除</h3><p>查看NAT表链规则<br><code>sudo iptables -t nat -nL --line-number</code></p><p>删除POSTROUTING第一条规则<br><code>sudo iptables -t nat -D POSTROUTING 1</code></p><h2 id="重启后依旧生效"><span class="post-title-index">3.2.</span><a href="#重启后依旧生效" class="headerlink" title="重启后依旧生效"></a> 重启后依旧生效</h2><p>1、保存规则<br><code>sudo chmod a+w -R /opt</code><br><code>sudo iptables-save &gt; /opt/iptables.rules</code></p><p>2、手动导入规则<br><code>sudo iptables-restore &lt; /opt/iptables.rules</code></p><p>3、开机自动导入规则<br>在ubuntu下要把一个程序加入开机启动，一般可以通过修改rc.local来完成，但ubuntu下有两个rc.local文件，分别是/etc/rc.local和/etc/init.d/rc.local。因为/etc/init.d/rc.local调用了/etc/rc.local，所以我们的开机脚本最好直接写入/etc/rc.local，写在exit 0之前即可。</p><p><code>sudo vim /etc/rc.local</code><br>在exit 0之前添加：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/sbin/i</span>ptables-restore &lt; <span class="regexp">/opt/i</span>ptables.rules</span><br></pre></td></tr></table></figure><h2 id="主机B"><span class="post-title-index">3.3.</span><a href="#主机B" class="headerlink" title="主机B"></a> 主机B</h2><h3 id="centos"><span class="post-title-index">3.3.1.</span><a href="#centos" class="headerlink" title="centos"></a> centos</h3><p>如果是centos，那么配置ifcfg文件<br><code>sudo vim /etc/sysconfig/network-scripts/ifcfg-eth0</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">DEVICE</span>=eth0</span><br><span class="line"><span class="attr">BOOTPROTO</span>=static</span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">IPADDR</span>=<span class="number">192.168</span>.<span class="number">56.102</span></span><br><span class="line"><span class="attr">NETMASK</span>=<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line"><span class="attr">GATEWAY</span>=<span class="number">192.168</span>.<span class="number">56.101</span></span><br></pre></td></tr></table></figure><p>然后<code>service network restart</code></p><h3 id="ubuntu"><span class="post-title-index">3.3.2.</span><a href="#ubuntu" class="headerlink" title="ubuntu"></a> ubuntu</h3><p>如果是ubuntu，那么配置interfaces文件<br><code>sudo vim /etc/network/interfaces</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">auto</span> lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line">auto em1</span><br><span class="line">iface em1 inet static</span><br><span class="line">address <span class="number">192.168.56.102</span></span><br><span class="line">netmask <span class="number">255.255.255.0</span></span><br><span class="line">gateway <span class="number">192.168.56.101</span></span><br></pre></td></tr></table></figure><p>然后<code>sudo /etc/init.d/networking restart</code></p><p>总之，B主机配置的关键在于网关，网关要设置成主机A的内网IP。</p><p>请问，网关不设置成主机A的内网IP可以吗？可以，那就是另外一种稍微复杂的设置方法了。</p><p>此时，使用主机B，已经可以ping通外网的IP了。但是ping域名会提示“ping: unknown host”。</p><h1 id="DNS配置"><span class="post-title-index">4.</span><a href="#DNS配置" class="headerlink" title="DNS配置"></a> DNS配置</h1><h2 id="方法一"><span class="post-title-index">4.1.</span><a href="#方法一" class="headerlink" title="方法一"></a> 方法一</h2><p>1、编辑resolv.conf<br><code>sudo vim /etc/resolv.conf</code>，添加nameserver的配置</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">nameserver</span> <span class="number">180.76.76.76</span></span><br><span class="line">nameserver <span class="number">223.6.6.6</span></span><br></pre></td></tr></table></figure><p>上面的两个IP地址，分别是百度和阿里的公共DNS。</p><p>2、测试<br><code>ping www.baidu.com</code></p><p>3、不过，这种方法在重启之后会失效。想要永久生效，还需要编辑base文件。<br><code>sudo vim /etc/resolvconf/resolv.conf.d/base</code>，添加：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">nameserver</span> <span class="number">180.76.76.76</span></span><br><span class="line">nameserver <span class="number">223.6.6.6</span></span><br></pre></td></tr></table></figure><h2 id="方法二"><span class="post-title-index">4.2.</span><a href="#方法二" class="headerlink" title="方法二"></a> 方法二</h2><p>1、编辑interfaces<br><code>sudo vim /etc/network/interfaces</code></p><p>2、添加nameserver的配置</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">dns</span>-nameserver <span class="number">180.76.76.76</span> <span class="number">223.5.5.5</span></span><br></pre></td></tr></table></figure><p>3、重启服务器<br><code>sudo reboot</code><br>实际上，重启后的dns配置会写入到resolv.conf中。</p><p>4、测试<br><code>ping www.baidu.com</code></p><h1 id="结语"><span class="post-title-index">5.</span><a href="#结语" class="headerlink" title="结语"></a> 结语</h1><p>至此，snat完美配置成功！在这个过程中，顺带复习了一下iptables，收获满满。感觉iptables和route有很大关系，但是在配置过程中没有用到route。书签中有关于route的文档，用到的时候再深入学习。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>原文链接：</strong> <a href="https://www.voidking.com/dev-linux-snat/" title="好好学Linux：Linux配置SNAT上网">https://www.voidking.com/dev-linux-snat/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本文采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议，转载请注明出处！源站会即时更新知识点并修正错误，欢迎访问~</li><li> <img width="200" height="200" src="/images/avatar.jpg"><p style="text-align:center;margin-bottom:0">微信公众号同步更新，欢迎关注~</p></li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/%E5%A5%BD%E5%A5%BD%E5%AD%A6Linux/" rel="tag"># 好好学Linux</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag"># 网络</a> <a href="/tags/iptables/" rel="tag"># iptables</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-ganglia-auth/" rel="prev" title="Ganglia认证授权"><i class="fa fa-chevron-left"></i> Ganglia认证授权</a></div><div class="post-nav-item"> <a href="/dev-hexo-build-environment-2018-05/" rel="next" title="好好学Hexo：Hexo环境搭建2018年5月版">好好学Hexo：Hexo环境搭建2018年5月版<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3284447971731414" data-ad-slot="9697986181"></ins><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%9C%80%E6%B1%82%E6%8F%8F%E8%BF%B0"><span class="nav-text">1. 需求描述</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SNAT%E6%95%B0%E6%8D%AE%E5%8C%85%E6%B5%81%E5%90%91"><span class="nav-text">2. SNAT数据包流向</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE%E5%8C%85"><span class="nav-text">2.1. 发送数据包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A5%E6%94%B6%E5%93%8D%E5%BA%94%E5%8C%85"><span class="nav-text">2.2. 接收响应包</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#snat%E5%85%B7%E4%BD%93%E9%85%8D%E7%BD%AE"><span class="nav-text">3. snat具体配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E6%9C%BAA"><span class="nav-text">3.1. 主机A</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A5%E6%94%B6%E6%95%B0%E6%8D%AE%E5%8C%85"><span class="nav-text">3.1.1. 接收数据包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%90%AF%E8%B7%AF%E7%94%B1%E5%8A%9F%E8%83%BD"><span class="nav-text">3.1.2. 开启路由功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%AA%E8%A3%85%E6%95%B0%E6%8D%AE%E5%8C%85"><span class="nav-text">3.1.3. 伪装数据包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E4%B8%8E%E5%88%A0%E9%99%A4"><span class="nav-text">3.1.4. 查看与删除</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E5%90%AF%E5%90%8E%E4%BE%9D%E6%97%A7%E7%94%9F%E6%95%88"><span class="nav-text">3.2. 重启后依旧生效</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E6%9C%BAB"><span class="nav-text">3.3. 主机B</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#centos"><span class="nav-text">3.3.1. centos</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ubuntu"><span class="nav-text">3.3.2. ubuntu</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DNS%E9%85%8D%E7%BD%AE"><span class="nav-text">4. DNS配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80"><span class="nav-text">4.1. 方法一</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="nav-text">4.2. 方法二</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%93%E8%AF%AD"><span class="nav-text">5. 结语</span></a></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">一个计算机技术爱好者与学习者</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">723</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">31</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">254</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: '13f3e2df2b01b48fb56e853455bdb41c',
      title: '好好学Linux：Linux配置SNAT上网',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>