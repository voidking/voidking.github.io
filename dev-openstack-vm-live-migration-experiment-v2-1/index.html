<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//qiniu.cdn.voidking.com/doc/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言毕业论文送审的日期是3月22日，cloud2019的deadline也是3月22日。大概从2月27日开始写毕业论文，早八点半晚十点，周末不休，3月22日终于写完送审了，算是完成了一件大事。之后，还有两件大事：一个是实现阅卷系统，一个是发表小论文。 本来打算3月20日抽出一天时间做实验写小论文，没想到实验环境崩了！无奈只能放弃cloud。论文送审后一直在忙着修复实验环境，2月24日晚上十点左右，"><meta property="og:type" content="article"><meta property="og:title" content="好好学OpenStack：虚拟机在线迁移实验V2——下"><meta property="og:url" content="https://www.voidking.com/dev-openstack-vm-live-migration-experiment-v2-1/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="前言毕业论文送审的日期是3月22日，cloud2019的deadline也是3月22日。大概从2月27日开始写毕业论文，早八点半晚十点，周末不休，3月22日终于写完送审了，算是完成了一件大事。之后，还有两件大事：一个是实现阅卷系统，一个是发表小论文。 本来打算3月20日抽出一天时间做实验写小论文，没想到实验环境崩了！无奈只能放弃cloud。论文送审后一直在忙着修复实验环境，2月24日晚上十点左右，"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cdn.voidking.com/img/openstack-vm-live-migration-experiment-v2/flavor.jpg?imageView2/0/w/600"><meta property="article:published_time" content="2019-03-25T00:00:00.000Z"><meta property="article:modified_time" content="2019-03-25T00:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="linux"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="openstack"><meta property="article:tag" content="mysql"><meta property="article:tag" content="测试"><meta property="article:tag" content="好好学OpenStack"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.voidking.com/img/openstack-vm-live-migration-experiment-v2/flavor.jpg?imageView2/0/w/600"><link rel="canonical" href="https://www.voidking.com/dev-openstack-vm-live-migration-experiment-v2-1/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>好好学OpenStack：虚拟机在线迁移实验V2——下 | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">一个计算机技术爱好者与学习者</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-openstack-vm-live-migration-experiment-v2-1/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="一个计算机技术爱好者与学习者"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> 好好学OpenStack：虚拟机在线迁移实验V2——下</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-03-25 00:00:00" itemprop="dateCreated datePublished" datetime="2019-03-25T00:00:00+00:00">2019-03-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/testing/" itemprop="url" rel="index"><span itemprop="name">testing</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><span class="post-title-index">1.</span><a href="#前言" class="headerlink" title="前言"></a> 前言</h1><p>毕业论文送审的日期是3月22日，<a target="_blank" rel="noopener" href="http://www.thecloudcomputing.org/2019/index.html">cloud2019</a>的deadline也是3月22日。大概从2月27日开始写毕业论文，早八点半晚十点，周末不休，3月22日终于写完送审了，算是完成了一件大事。之后，还有两件大事：一个是实现阅卷系统，一个是发表小论文。</p><p>本来打算3月20日抽出一天时间做实验写小论文，没想到实验环境崩了！无奈只能放弃cloud。论文送审后一直在忙着修复实验环境，2月24日晚上十点左右，终于修复成功！是时候完成小论文了！</p><span id="more"></span><h1 id="前情回顾"><span class="post-title-index">2.</span><a href="#前情回顾" class="headerlink" title="前情回顾"></a> 前情回顾</h1><p><a href="https://www.voidking.com/dev-openstack-vm-live-migration-experiment-v2-0">《虚拟机在线迁移实验V2——上》</a>一文中，实验遇到瓶颈，所以不得不重新设计实验。经过思考，打算把web服务换成mysql服务，在实例中进行测试。但是，实验表明，如果在迁移过程中对mysql试压，那么会出现和web服务同样的问题，迁移无法成功。所以，本文中去掉了服务降级这个指标，只测量停机时间、迁移时间和迁移数据量。</p><h1 id="实例准备"><span class="post-title-index">3.</span><a href="#实例准备" class="headerlink" title="实例准备"></a> 实例准备</h1><p>1、在horizon控制台，项目，计算，镜像。使用xenial-server-cloudimg-amd64-disk1.img镜像创建ubuntu16的镜像模板。</p><p>2、创建实例类型m1.tiny2，CPU个数为1，内存为512M，磁盘为5GB。</p><p>3、使用ubuntu16的镜像模板创建实例ubuntu0、ubuntu1、ubuntu2、ubuntu3、ubuntu4，实例类型分别选择m1.tiny2、m1.small、m1.medium、m1.large、m1.xlarge。之所以不使用默认的m1.tiny，是因为m1.tiny的磁盘太小，只有1G，无法安装ubuntu16。</p><p><img src="http://cdn.voidking.com/img/openstack-vm-live-migration-experiment-v2/flavor.jpg?imageView2/0/w/600"></p><p>4、创建成功后，分别分配浮动IP。</p><p>PS：在进行迁移实验时，关闭其他实例，防止资源占用产生干扰。</p><h1 id="脚本和软件准备"><span class="post-title-index">4.</span><a href="#脚本和软件准备" class="headerlink" title="脚本和软件准备"></a> 脚本和软件准备</h1><h2 id="总迁移时间"><span class="post-title-index">4.1.</span><a href="#总迁移时间" class="headerlink" title="总迁移时间"></a> 总迁移时间</h2><p>在控制节点，新建mtime.sh脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">time1=`grep <span class="string">&#x27;live-migration&#x27;</span> list.log | <span class="built_in">head</span> -n 1 | awk <span class="string">&#x27;&#123;print $24&#125;&#x27;</span>`</span><br><span class="line">time2=`grep <span class="string">&#x27;live-migration&#x27;</span> list.log | <span class="built_in">head</span> -n 1 | awk <span class="string">&#x27;&#123;print $26&#125;&#x27;</span>`</span><br><span class="line">time=$(($(date +%s -d <span class="variable">$time2</span>) - $(date +%s -d <span class="variable">$time1</span>)));</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$time</span> s&quot;</span>;</span><br></pre></td></tr></table></figure><p>新建allmtime.sh脚本，可以计算所有迁移时间：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="attribute">time1</span>=`grep <span class="string">&#x27;live-migration&#x27;</span> list.log | awk <span class="string">&#x27;&#123;print $24&#125;&#x27;</span>`</span><br><span class="line"><span class="attribute">time2</span>=`grep <span class="string">&#x27;live-migration&#x27;</span> list.log | awk <span class="string">&#x27;&#123;print $26&#125;&#x27;</span>`</span><br><span class="line"><span class="attribute">IPS</span>=<span class="string">&#x27; &#x27;</span></span><br><span class="line">array1=(<span class="variable">$time1</span>)</span><br><span class="line">array2=(<span class="variable">$time2</span>)</span><br><span class="line"><span class="attribute">length</span>=<span class="variable">$&#123;#array1[@]&#125;</span></span><br><span class="line"><span class="attribute">COUNTER</span>=0</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$COUNTER</span> -lt <span class="variable">$length</span> ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="attribute">COUNTER</span>=`expr <span class="variable">$COUNTER</span> + 1`</span><br><span class="line">    <span class="attribute">t1</span>=<span class="variable">$&#123;array1[COUNTER]&#125;</span></span><br><span class="line">    <span class="attribute">t2</span>=<span class="variable">$&#123;array2[COUNTER]&#125;</span></span><br><span class="line">    <span class="attribute">time</span>=$(($(date +%s -d <span class="variable">$t2</span>) - $(date +%s -d <span class="variable">$t1</span>)));</span><br><span class="line">    echo <span class="string">&quot;<span class="variable">$time</span> s&quot;</span>;</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h2 id="停机时间"><span class="post-title-index">4.2.</span><a href="#停机时间" class="headerlink" title="停机时间"></a> 停机时间</h2><p>在控制节点，新建downtime.sh脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">transmitted=`grep <span class="string">&#x27;packets transmitted&#x27;</span> ping.log | <span class="built_in">tail</span> -n 1 | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>`</span><br><span class="line">received=`grep <span class="string">&#x27;packets transmitted&#x27;</span> ping.log | <span class="built_in">tail</span> -n 1 | awk <span class="string">&#x27;&#123;print $4&#125;&#x27;</span>`</span><br><span class="line">lost=`<span class="built_in">expr</span> <span class="variable">$transmitted</span> - <span class="variable">$received</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;downtime is <span class="variable">$lost</span> ms&quot;</span></span><br></pre></td></tr></table></figure><h2 id="迁移数据量"><span class="post-title-index">4.3.</span><a href="#迁移数据量" class="headerlink" title="迁移数据量"></a> 迁移数据量</h2><p>在两个计算节点，安装iptraf-ng。<br><code>apt install iptraf-ng</code></p><h2 id="xshell"><span class="post-title-index">4.4.</span><a href="#xshell" class="headerlink" title="xshell"></a> xshell</h2><p>使用xshell，打开两个controller节点的shell，一个登录实例B后用来ping实例A；一个用来执行迁移命令，迁移之后执行mtime.sh脚本。打开一个compute1节点的shell，用来运行iptraf-ng。打开一个compute2节点的shell，用来运行iptraf-ng。</p><h1 id="实验流程"><span class="post-title-index">5.</span><a href="#实验流程" class="headerlink" title="实验流程"></a> 实验流程</h1><p>假设当前只启动了ubuntu0实例，<code>nova show ubuntu0</code>位于compute1节点。</p><p>1、在两个compute节点启动iptraf-ng，配置参考<a href="https://www.voidking.com/dev-openstack-vm-live-migration-performance/">《虚拟机在线迁移的性能统计》</a>。</p><p>2、在实例中启动压力测试软件，或者在两个compute节点中启动网络故障模拟软件。（flavor实验中不需要）</p><p>3、在实例B中ping实例ubuntu0<br><code>sudo ping ubuntu0_internal_ip -i 0.001 &gt;&gt; ping.log</code></p><p>4、在controller中执行迁移<br><code>nova live-migration ubuntu0 compute2</code></p><p>5、观察compute节点的iptraf-ng，等到流量不再增加。关闭压力测试软件或者网络故障模拟软件，然后在实例B中Ctrl+C结束ping命令。</p><p>6、在controller节点记录迁移列表<br><code>nova migration-list &gt; list.log</code></p><p>7、controller节点执行mtime.sh得到迁移时间，在实例B中执行downtime.sh得到停机时间，在两个计算节点观察iptraf-ng得到迁移数据量。</p><p>以上流程，适用于接下来的所有实验。</p><h1 id="flavor实验"><span class="post-title-index">6.</span><a href="#flavor实验" class="headerlink" title="flavor实验"></a> flavor实验</h1><p>按照实验流程，分别使用五个flavor，进行五次迁移实验，记录实验结果。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Flavor    迁移时间s    停机时间ms    迁出数据量MB   迁入数据量MB</span></span><br><span class="line"><span class="attribute">tiny</span>    <span class="number">24</span>  <span class="number">297</span>   <span class="number">275</span>  <span class="number">277</span></span><br><span class="line"><span class="attribute">small</span>   <span class="number">26</span>  <span class="number">14</span>    <span class="number">329</span>  <span class="number">332</span></span><br><span class="line"><span class="attribute">medium</span>  <span class="number">27</span>  <span class="number">69</span>    <span class="number">373</span>  <span class="number">375</span></span><br><span class="line"><span class="attribute">large</span>   <span class="number">30</span>  <span class="number">50</span>    <span class="number">846</span>  <span class="number">852</span></span><br><span class="line"><span class="attribute">xlarge</span>  <span class="number">31</span>  <span class="number">57</span>    <span class="number">923</span>  <span class="number">929</span>  </span><br></pre></td></tr></table></figure><p>由实验结果可以看出，随着CPU和内存的增加，迁移时间也会随之增加。tiny模板的停机时间最大，其他模板的停机时间在10ms到70ms之间。源主机的迁出数据量和目标主机的迁入数据量也会随之增加，而且迁入数据量要比迁出数据量多2到6MB。</p><h2 id="系统压力实验"><span class="post-title-index">6.1.</span><a href="#系统压力实验" class="headerlink" title="系统压力实验"></a> 系统压力实验</h2><h2 id="CPU实验"><span class="post-title-index">6.2.</span><a href="#CPU实验" class="headerlink" title="CPU实验"></a> CPU实验</h2><p>接下来的实验，都使用small类型的flavor。<br>1、先给实例安装stress-ng<br><code>sudo apt install stress-ng</code></p><p>2、在实例中创建一个CPU进程，CPU占用率10%<br><code>stress-ng -c 1 -l 10</code></p><p>3、创建CPU进程，CPU占用率20%-100%，记录实验结果。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CPU占用率%   迁移时间s    停机时间ms    迁出数据量MB   迁入数据量MB</span></span><br><span class="line"><span class="attribute">Idle</span>    <span class="number">26</span>  <span class="number">14</span>    <span class="number">329</span>  <span class="number">332</span></span><br><span class="line"><span class="attribute">10</span>%     <span class="number">27</span>  <span class="number">15</span>    <span class="number">330</span>  <span class="number">333</span></span><br><span class="line"><span class="attribute">20</span>%     <span class="number">26</span>  <span class="number">18</span>    <span class="number">331</span>  <span class="number">333</span></span><br><span class="line"><span class="attribute">30</span>%     <span class="number">24</span>  <span class="number">403</span>   <span class="number">330</span>  <span class="number">333</span></span><br><span class="line"><span class="attribute">40</span>%     <span class="number">25</span>  <span class="number">3332</span>  <span class="number">330</span>  <span class="number">334</span></span><br><span class="line"><span class="attribute">50</span>%     <span class="number">25</span>  <span class="number">3175</span>  <span class="number">330</span>  <span class="number">332</span></span><br><span class="line"><span class="attribute">60</span>%     <span class="number">24</span>  <span class="number">505</span>   <span class="number">327</span>  <span class="number">329</span></span><br><span class="line"><span class="attribute">70</span>%     <span class="number">26</span>  <span class="number">10372</span> <span class="number">328</span>  <span class="number">331</span></span><br><span class="line"><span class="attribute">80</span>%     <span class="number">25</span>  <span class="number">292</span>   <span class="number">329</span>  <span class="number">331</span></span><br><span class="line"><span class="attribute">90</span>%     <span class="number">26</span>  <span class="number">124</span>   <span class="number">330</span>  <span class="number">333</span></span><br><span class="line"><span class="attribute">100</span>%    <span class="number">26</span>  <span class="number">573</span>   <span class="number">328</span>  <span class="number">330</span></span><br></pre></td></tr></table></figure><p>由实验结果可以看出，随着CPU占用率的提高，迁移时间没有太大变化。停机时间在CPU使用率大于30%之后，停机时间普遍大于100ms，偶尔会出现停机时间大于3s，没有明显的规律。迁移数据量并没有太大变化，迁入数据一直比迁出数据多2到4MB。</p><p>在迁移时，偶尔会出现OpenStack显示实例迁移成功，但是实例停机时间特别长（大于600s）的情况。本文中认为这种情况属于异常，会重做实验，去除这些异常值。</p><h2 id="内存实验"><span class="post-title-index">6.3.</span><a href="#内存实验" class="headerlink" title="内存实验"></a> 内存实验</h2><p>1、在实例中创建一个200M的内存进程<br><code>stress-ng --vm 1 --vm-bytes 200M --vm-keep</code></p><p>2、创建内存进程，内存占用400M-1600M，记录实验结果。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 内存占用MB   迁移时间s    停机时间ms    迁出数据量MB   迁入数据量MB</span></span><br><span class="line"><span class="attribute">Idle</span>    <span class="number">26</span>      <span class="number">14</span>      <span class="number">329</span>     <span class="number">332</span></span><br><span class="line"><span class="attribute">200</span>     <span class="number">79</span>      <span class="number">3090</span>    <span class="number">6543</span>    <span class="number">6585</span></span><br><span class="line"><span class="attribute">400</span>     <span class="number">199</span>     <span class="number">144</span>     <span class="number">21344</span>   <span class="number">21481</span> </span><br><span class="line"><span class="attribute">600</span>     <span class="number">308</span>     <span class="number">440</span>     <span class="number">33368</span>   <span class="number">33585</span></span><br><span class="line"><span class="attribute">800</span>     <span class="number">422</span>     <span class="number">560</span>     <span class="number">47712</span>   <span class="number">48019</span></span><br><span class="line"><span class="attribute">1000</span>    <span class="number">541</span>     <span class="number">23560</span>   <span class="number">61417</span>   <span class="number">61814</span>    </span><br><span class="line"><span class="attribute">1200</span>    <span class="number">649</span>     <span class="number">250080</span>  <span class="number">74617</span>   <span class="number">75103</span></span><br><span class="line"><span class="attribute">1400</span>    <span class="number">925</span>     <span class="number">27230</span>   <span class="number">107004</span>  <span class="number">107702</span></span><br><span class="line"><span class="attribute">1600</span>    <span class="number">1049</span>    <span class="number">3140</span>    <span class="number">121600</span>  <span class="number">122390</span></span><br></pre></td></tr></table></figure><p>从实验结果中可以看出，随着内存使用量的增加，总迁移时间急剧增加。停机时间一般大于100ms，有时甚至超过20s。迁移数据量也急剧增加，数量级变为GB。当内存占用1600MB时，总迁移时间超过1000s，迁移数据大于120GB，传输到目标机器的数据与从源机器传输的数据之间的差异为700MB。</p><h2 id="磁盘实验"><span class="post-title-index">6.4.</span><a href="#磁盘实验" class="headerlink" title="磁盘实验"></a> 磁盘实验</h2><p>1、在实例中创建2个写入进程，每个进程写入大小为1M的文件。<br><code>stress-ng -d 2 --hdd-bytes 1M</code></p><p>2、在实例中创建4-20个写入进程，记录实验结果。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 写入进程数   迁移时间s    停机时间ms    迁出数据量MB   迁入数据量MB</span></span><br><span class="line"><span class="attribute">0</span>       <span class="number">26</span>      <span class="number">14</span>      <span class="number">329</span>     <span class="number">332</span></span><br><span class="line"><span class="attribute">2</span>       <span class="number">42</span>      <span class="number">510</span>     <span class="number">2178</span>    <span class="number">2192</span></span><br><span class="line"><span class="attribute">4</span>       <span class="number">50</span>      <span class="number">100</span>     <span class="number">2954</span>    <span class="number">2974</span></span><br><span class="line"><span class="attribute">6</span>       <span class="number">127</span>     <span class="number">3350</span>    <span class="number">12456</span>   <span class="number">12537</span></span><br><span class="line"><span class="attribute">8</span>       <span class="number">137</span>     <span class="number">490</span>     <span class="number">13519</span>   <span class="number">13608</span></span><br><span class="line"><span class="attribute">10</span>      <span class="number">172</span>     <span class="number">4570</span>    <span class="number">18179</span>   <span class="number">18296</span> </span><br><span class="line"><span class="attribute">12</span>      <span class="number">182</span>     <span class="number">6340</span>    <span class="number">18948</span>   <span class="number">19072</span>     </span><br><span class="line"><span class="attribute">14</span>      <span class="number">172</span>     <span class="number">6860</span>    <span class="number">18034</span>   <span class="number">18150</span></span><br><span class="line"><span class="attribute">16</span>      <span class="number">189</span>     <span class="number">410</span>     <span class="number">19569</span>   <span class="number">19696</span></span><br><span class="line"><span class="attribute">18</span>      <span class="number">179</span>     <span class="number">600</span>     <span class="number">18790</span>   <span class="number">18910</span></span><br><span class="line"><span class="attribute">20</span>      <span class="number">246</span>     <span class="number">3160</span>    <span class="number">26687</span>   <span class="number">26859</span>           </span><br></pre></td></tr></table></figure><p>从实验结果中可以看出，随着写入进程的增加，迁移时间也在不断增加。停机时间普遍大于400ms，频繁出现大于3s停机时间。迁移数据量呈现阶梯式变化，数量级变成GB。当写入进程数为20时，迁移时间约为250s，迁移数据约为27GB。</p><h1 id="网络故障实验"><span class="post-title-index">7.</span><a href="#网络故障实验" class="headerlink" title="网络故障实验"></a> 网络故障实验</h1><p>网络故障实验之前，需要重启测试实例，否则测出的迁移数据量会偏大一个数量级。</p><h2 id="网络延迟"><span class="post-title-index">7.1.</span><a href="#网络延迟" class="headerlink" title="网络延迟"></a> 网络延迟</h2><p>1、在compute节点（迁出节点）添加网络延迟20ms<br><code>sudo tc qdisc add dev eth1 root netem delay 20ms</code><br>注：原本的延迟在0.2ms上下。</p><p>2、将网络延迟修改为40ms-200ms，记录实验结果。<br><code>sudo tc qdisc replace dev eth1 root netem delay 40ms</code></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 网络延迟ms   迁移时间s    停机时间ms    迁出数据量MB   迁入数据量MB</span></span><br><span class="line"><span class="attribute">0</span>       <span class="number">26</span>      <span class="number">14</span>      <span class="number">329</span>     <span class="number">332</span></span><br><span class="line"><span class="attribute">20</span>      <span class="number">27</span>      <span class="number">6720</span>    <span class="number">354</span>     <span class="number">356</span></span><br><span class="line"><span class="attribute">40</span>      <span class="number">29</span>      <span class="number">320</span>     <span class="number">354</span>     <span class="number">356</span></span><br><span class="line"><span class="attribute">60</span>      <span class="number">32</span>      <span class="number">3200</span>    <span class="number">355</span>     <span class="number">357</span></span><br><span class="line"><span class="attribute">80</span>      <span class="number">39</span>      <span class="number">160</span>     <span class="number">356</span>     <span class="number">358</span></span><br><span class="line"><span class="attribute">100</span>     <span class="number">39</span>      <span class="number">3370</span>    <span class="number">360</span>     <span class="number">362</span></span><br><span class="line"><span class="attribute">120</span>     <span class="number">43</span>      <span class="number">320</span>     <span class="number">357</span>     <span class="number">358</span></span><br><span class="line"><span class="attribute">140</span>     <span class="number">45</span>      <span class="number">310</span>     <span class="number">358</span>     <span class="number">360</span></span><br><span class="line"><span class="attribute">160</span>     <span class="number">51</span>      <span class="number">580</span>     <span class="number">356</span>     <span class="number">357</span></span><br><span class="line"><span class="attribute">180</span>     <span class="number">51</span>      <span class="number">5480</span>    <span class="number">356</span>     <span class="number">357</span>  </span><br><span class="line"><span class="attribute">200</span>     <span class="number">59</span>      <span class="number">620</span>     <span class="number">380</span>     <span class="number">382</span></span><br></pre></td></tr></table></figure><p>由实验结果可以看出，随着网络延迟时间的增加，迁移时间也会随之增加。停机时间普遍大于300ms，经常出现3s到7s的停机时间。迁出数据量和迁入数据量没有明显的变化，差值也保持在稳定的范围。</p><p>此外，在网络延迟实验中，实例死机（停机时间大于600s）的频率要高于CPU、内存和磁盘实验。</p><p>3、取消模拟：<br><code>sudo tc qdisc del dev eth1 root</code></p><h2 id="丢包"><span class="post-title-index">7.2.</span><a href="#丢包" class="headerlink" title="丢包"></a> 丢包</h2><p>1、两个计算节点，都模拟丢包率1%<br><code>sudo tc qdisc add dev eth1 root netem loss 1%</code></p><p>2、将模拟丢包率修改为1%-10%，记录实验结果。<br><code>sudo tc qdisc change dev eth1 root netem loss 2%</code></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 丢包率   迁移时间s    停机时间ms    迁出数据量MB   迁入数据量MB</span></span><br><span class="line"><span class="attribute">0</span>%      <span class="number">26</span>      <span class="number">14</span>      <span class="number">329</span>     <span class="number">332</span></span><br><span class="line"><span class="attribute">1</span>%      <span class="number">24</span>      <span class="number">1460</span>    <span class="number">354</span>     <span class="number">356</span></span><br><span class="line"><span class="attribute">2</span>%      <span class="number">26</span>      <span class="number">4190</span>    <span class="number">355</span>     <span class="number">356</span></span><br><span class="line"><span class="attribute">3</span>%      <span class="number">30</span>      <span class="number">3990</span>    <span class="number">358</span>     <span class="number">359</span></span><br><span class="line"><span class="attribute">4</span>%      <span class="number">38</span>      <span class="number">2640</span>    <span class="number">357</span>     <span class="number">357</span></span><br><span class="line"><span class="attribute">5</span>%      <span class="number">43</span>      <span class="number">7610</span>    <span class="number">359</span>     <span class="number">360</span></span><br><span class="line"><span class="attribute">6</span>%      <span class="number">67</span>      <span class="number">5960</span>    <span class="number">361</span>     <span class="number">361</span></span><br><span class="line"><span class="attribute">7</span>%      <span class="number">131</span>     <span class="number">43890</span>   <span class="number">363</span>     <span class="number">363</span></span><br><span class="line"><span class="attribute">8</span>%      <span class="number">170</span>     <span class="number">20850</span>   <span class="number">368</span>     <span class="number">368</span></span><br><span class="line"><span class="attribute">9</span>%      <span class="number">283</span>     <span class="number">11430</span>   <span class="number">371</span>     <span class="number">371</span></span><br><span class="line"><span class="attribute">10</span>%     <span class="number">392</span>     <span class="number">67520</span>   <span class="number">365</span>     <span class="number">365</span>     </span><br></pre></td></tr></table></figure><p>从实验结果中可以看出，随着丢包率的增大，迁移时间也会明显增加。丢包率大于7%之后，停机时间普遍大于10s，甚至出现了68s的停机时间。迁移数据量变化不大，迁入迁出数据量的差值稳定在1MB以内。</p><p>3、取消模拟：<br><code>sudo tc qdisc del dev eth1 root</code></p><h2 id="包重复"><span class="post-title-index">7.3.</span><a href="#包重复" class="headerlink" title="包重复"></a> 包重复</h2><p>1、两个计算节点，都模拟包重复率10%<br><code>sudo tc qdisc add dev eth1 root netem duplicate 10%</code><br>随机产生 10% 重复的包。</p><p>2、将模拟包重复率修改为20%-100%，记录实验结果<br><code>sudo tc qdisc change dev eth1 root netem duplicate 20%</code></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 包重复率   迁移时间s    停机时间ms    迁出数据量MB   迁入数据量MB</span></span><br><span class="line"><span class="attribute">0</span>%      <span class="number">26</span>      <span class="number">14</span>      <span class="number">329</span>     <span class="number">332</span></span><br><span class="line"><span class="attribute">10</span>%     <span class="number">32</span>      <span class="number">180</span>     <span class="number">652</span>     <span class="number">656</span></span><br><span class="line"><span class="attribute">20</span>%     <span class="number">28</span>      <span class="number">180</span>     <span class="number">712</span>     <span class="number">717</span></span><br><span class="line"><span class="attribute">30</span>%     <span class="number">27</span>      <span class="number">120</span>     <span class="number">769</span>     <span class="number">774</span></span><br><span class="line"><span class="attribute">40</span>%     <span class="number">28</span>      <span class="number">300</span>     <span class="number">840</span>     <span class="number">845</span></span><br><span class="line"><span class="attribute">50</span>%     <span class="number">29</span>      <span class="number">3060</span>    <span class="number">887</span>     <span class="number">893</span></span><br><span class="line"><span class="attribute">60</span>%     <span class="number">29</span>      <span class="number">140</span>     <span class="number">959</span>     <span class="number">965</span></span><br><span class="line"><span class="attribute">70</span>%     <span class="number">28</span>      <span class="number">540</span>     <span class="number">1016</span>    <span class="number">1023</span></span><br><span class="line"><span class="attribute">80</span>%     <span class="number">32</span>      <span class="number">440</span>     <span class="number">1073</span>    <span class="number">1080</span></span><br><span class="line"><span class="attribute">90</span>%     <span class="number">35</span>      <span class="number">3490</span>    <span class="number">1135</span>    <span class="number">1142</span></span><br><span class="line"><span class="attribute">100</span>%    <span class="number">32</span>      <span class="number">90</span>      <span class="number">1196</span>    <span class="number">1204</span>     </span><br></pre></td></tr></table></figure><p>从实验结果可以看出，随着包重复率的增加，总的迁移时间变化不大。停机时间普遍大于100ms，偶尔出现大于3s的情况，没有明显的变化趋势。迁移数据量随着包重复率的增加而增大，迁入数据量和迁出数据量的差值在4M到8M。</p><p>3、取消模拟：<br><code>sudo tc qdisc del dev eth1 root</code></p><h2 id="包损坏"><span class="post-title-index">7.4.</span><a href="#包损坏" class="headerlink" title="包损坏"></a> 包损坏</h2><p>1、两个计算节点，都模拟包损坏率1%<br><code>sudo tc qdisc add dev eth1 root netem corrupt 1%</code><br>随机产生 1% 损坏的报文（在报文的随机位置造成一个比特的错误）。</p><p>在ping的时候会报错：Warning: time of day goes back , taking countermeasures，不过没关系，不影响我们的停机时间统计结果。</p><p>2、将模拟包损坏率修改为2%-5%，记录实验结果。<br><code>sudo tc qdisc change dev eth1 root netem corrupt 2%</code></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 包损坏率   迁移时间s    停机时间ms    迁出数据量MB   迁入数据量MB</span></span><br><span class="line"><span class="attribute">0</span>%      <span class="number">26</span>      <span class="number">14</span>      <span class="number">329</span>     <span class="number">332</span></span><br><span class="line"><span class="attribute">1</span>%      <span class="number">26</span>      <span class="number">660</span>     <span class="number">333</span>     <span class="number">334</span> </span><br><span class="line"><span class="attribute">2</span>%      <span class="number">27</span>      <span class="number">1120</span>    <span class="number">334</span>     <span class="number">335</span></span><br><span class="line"><span class="attribute">3</span>%      <span class="number">35</span>      <span class="number">4160</span>    <span class="number">337</span>     <span class="number">337</span></span><br><span class="line"><span class="attribute">4</span>%      <span class="number">149</span>     <span class="number">2760</span>    <span class="number">342</span>     <span class="number">342</span> </span><br><span class="line"><span class="attribute">5</span>%      <span class="number">254</span>     <span class="number">15040</span>   <span class="number">352</span>     <span class="number">353</span> </span><br><span class="line"><span class="attribute">6</span>%      <span class="number">1228</span>    <span class="number">117760</span>  <span class="number">356</span>     <span class="number">356</span></span><br></pre></td></tr></table></figure><p>从实验数据中可以看出，包损坏率大于3%之后，迁移时间会急剧增加。停机时间普遍大于1s，总体呈上升趋势。停机时间在包损坏率等于5%和6%时发生突变。迁移数据量没有明显变化。当包损坏率等于6%时，迁移时间超过20min，停机时间接近120s。</p><p>而且，在本文中的实验环境中，包损坏率大于等于7%时，迁移会失败。迁移进行了1600s还没有完成，OpenStack会自动撤销迁移。还有一个有趣的现象是，正常迁移中只要使用49152端口就可以了，在出现包损坏的情况下，会使用49153-49216端口来辅助传输数据。</p><p>3、取消模拟：<br><code>sudo tc qdisc del dev eth1 root</code></p><p>PS：如果迁移无法成功，那么就取消包损坏的模拟，或者撤销迁移。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">nova</span> migration-list</span><br><span class="line"><span class="attribute">nova</span> server-migration-show <span class="number">29</span>a58cf7-<span class="number">646</span>a-<span class="number">43</span>f2-b1d6-<span class="number">89</span>ec421fc9d6 <span class="number">152</span></span><br><span class="line"><span class="attribute">nova</span> live-migration-abort <span class="number">29</span>a58cf7-<span class="number">646</span>a-<span class="number">43</span>f2-b1d6-<span class="number">89</span>ec421fc9d6 <span class="number">152</span></span><br></pre></td></tr></table></figure><h1 id="后记"><span class="post-title-index">8.</span><a href="#后记" class="headerlink" title="后记"></a> 后记</h1><p>从以上结果可以看出，在OpenStack中选择VM进行迁移的时候，为了提高迁移的效率，有以下几个结论：<br>（1）选择更小的flavor，能够减少迁移时间和迁移数据量。<br>（2）基本不用考虑CPU使用率，因为它对迁移影响很小。<br>（3）选择内存占用小的VM，能够减少迁移时间、停机时间和迁移数据量。<br>（4）选择磁盘写入进程较少的VM，能够减少迁移时间、停机时间和迁移数据量。<br>（5）包延迟会稍微增加迁移时间，对停机时间和迁移数据量的影响很小。<br>（6）丢包会急剧增加迁移时间，对停机时间和迁移数据量的影响很小。<br>（7）包重复会增加一些迁移数据量，但是对迁移时间和迁移停机时间的影响很小。<br>（8）包损坏率小于等于3%时，对迁移影响较少，可以忽略。包损坏率大于4%之后，迁移时间和停机时间会急剧上升。包损坏率大于7%时，已经无法迁移成功。</p><p>至此，实验完成，数据有了，就差论文了！加油加油！</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>原文链接：</strong> <a href="https://www.voidking.com/dev-openstack-vm-live-migration-experiment-v2-1/" title="好好学OpenStack：虚拟机在线迁移实验V2——下">https://www.voidking.com/dev-openstack-vm-live-migration-experiment-v2-1/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本文采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议，转载请注明出处！源站会即时更新知识点并修正错误，欢迎访问~</li><li> <img width="200" height="200" src="/images/avatar.jpg"><p style="text-align:center;margin-bottom:0">微信公众号同步更新，欢迎关注~</p></li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/ubuntu/" rel="tag"># ubuntu</a> <a href="/tags/openstack/" rel="tag"># openstack</a> <a href="/tags/mysql/" rel="tag"># mysql</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" rel="tag"># 测试</a> <a href="/tags/%E5%A5%BD%E5%A5%BD%E5%AD%A6OpenStack/" rel="tag"># 好好学OpenStack</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-openstack-compute-node-broken/" rel="prev" title="好好学OpenStack：OpenStack计算节点的奇葩问题"><i class="fa fa-chevron-left"></i> 好好学OpenStack：OpenStack计算节点的奇葩问题</a></div><div class="post-nav-item"> <a href="/dev-create-ubuntu-installer/" rel="next" title="制作Ubuntu安装源方法小结">制作Ubuntu安装源方法小结<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3284447971731414" data-ad-slot="9697986181"></ins><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">1. 前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E6%83%85%E5%9B%9E%E9%A1%BE"><span class="nav-text">2. 前情回顾</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B%E5%87%86%E5%A4%87"><span class="nav-text">3. 实例准备</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC%E5%92%8C%E8%BD%AF%E4%BB%B6%E5%87%86%E5%A4%87"><span class="nav-text">4. 脚本和软件准备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E8%BF%81%E7%A7%BB%E6%97%B6%E9%97%B4"><span class="nav-text">4.1. 总迁移时间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%81%9C%E6%9C%BA%E6%97%B6%E9%97%B4"><span class="nav-text">4.2. 停机时间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%81%E7%A7%BB%E6%95%B0%E6%8D%AE%E9%87%8F"><span class="nav-text">4.3. 迁移数据量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xshell"><span class="nav-text">4.4. xshell</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E6%B5%81%E7%A8%8B"><span class="nav-text">5. 实验流程</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#flavor%E5%AE%9E%E9%AA%8C"><span class="nav-text">6. flavor实验</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E5%8E%8B%E5%8A%9B%E5%AE%9E%E9%AA%8C"><span class="nav-text">6.1. 系统压力实验</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CPU%E5%AE%9E%E9%AA%8C"><span class="nav-text">6.2. CPU实验</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E5%AE%9E%E9%AA%8C"><span class="nav-text">6.3. 内存实验</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A3%81%E7%9B%98%E5%AE%9E%E9%AA%8C"><span class="nav-text">6.4. 磁盘实验</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E6%95%85%E9%9A%9C%E5%AE%9E%E9%AA%8C"><span class="nav-text">7. 网络故障实验</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E5%BB%B6%E8%BF%9F"><span class="nav-text">7.1. 网络延迟</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%A2%E5%8C%85"><span class="nav-text">7.2. 丢包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8C%85%E9%87%8D%E5%A4%8D"><span class="nav-text">7.3. 包重复</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8C%85%E6%8D%9F%E5%9D%8F"><span class="nav-text">7.4. 包损坏</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E8%AE%B0"><span class="nav-text">8. 后记</span></a></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">一个计算机技术爱好者与学习者</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">723</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">31</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">254</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: '34153cfd90f44f4c9acb8ebae93362c4',
      title: '好好学OpenStack：虚拟机在线迁移实验V2——下',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>