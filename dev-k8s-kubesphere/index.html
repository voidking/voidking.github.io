<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://www.voidking.com").hostname,root:"/",scheme:"Gemini",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1,cdn:{enable:!0,url:"//qiniu.cdn.voidking.com/doc/search.xml"}},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="KubeSphere简介 KubeSphere 愿景是打造一个以 Kubernetes 为内核的云原生分布式操作系统，它的架构可以非常方便地使第三方应用与云原生生态组件进行即插即用（plug-and-play）的集成，支持云原生应用在多云与多集群的统一分发和运维管理。  简单来说，KubeSphere（下文简称ks）就是一个容器管理平台，可以图形化管理多个K8S集群。 相关链接：  KubeSph"><meta property="og:type" content="article"><meta property="og:title" content="好好学K8S：K8S中安装配置KubeSphere"><meta property="og:url" content="https://www.voidking.com/dev-k8s-kubesphere/index.html"><meta property="og:site_name" content="好好学习的郝"><meta property="og:description" content="KubeSphere简介 KubeSphere 愿景是打造一个以 Kubernetes 为内核的云原生分布式操作系统，它的架构可以非常方便地使第三方应用与云原生生态组件进行即插即用（plug-and-play）的集成，支持云原生应用在多云与多集群的统一分发和运维管理。  简单来说，KubeSphere（下文简称ks）就是一个容器管理平台，可以图形化管理多个K8S集群。 相关链接：  KubeSph"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2022-10-10T15:00:00.000Z"><meta property="article:modified_time" content="2023-10-29T08:00:00.000Z"><meta property="article:author" content="好好学习的郝"><meta property="article:tag" content="k8s"><meta property="article:tag" content="好好学K8S"><meta property="article:tag" content="问题排查"><meta property="article:tag" content="存储"><meta property="article:tag" content="bitnami"><meta property="article:tag" content="kubesphere"><meta property="article:tag" content="storageclass"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.voidking.com/dev-k8s-kubesphere/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>好好学K8S：K8S中安装配置KubeSphere | 好好学习的郝</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b759ac2a7fa45129e3ef060bf68259f0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="好好学习的郝" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">好好学习的郝</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">一个计算机技术爱好者与学习者</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/voidking" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.voidking.com/dev-k8s-kubesphere/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="好好学习的郝"><meta itemprop="description" content="一个计算机技术爱好者与学习者"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="好好学习的郝"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> 好好学K8S：K8S中安装配置KubeSphere</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2022-10-10 15:00:00" itemprop="dateCreated datePublished" datetime="2022-10-10T15:00:00+00:00">2022-10-10</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2023-10-29 08:00:00" itemprop="dateModified" datetime="2023-10-29T08:00:00+00:00">2023-10-29</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/" itemprop="url" rel="index"><span itemprop="name">engineering</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/cloudnative/" itemprop="url" rel="index"><span itemprop="name">cloudnative</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/troubleshooting/" itemprop="url" rel="index"><span itemprop="name">troubleshooting</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/engineering/storage/" itemprop="url" rel="index"><span itemprop="name">storage</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="KubeSphere简介"><span class="post-title-index">1.</span><a href="#KubeSphere简介" class="headerlink" title="KubeSphere简介"></a> KubeSphere简介</h1><blockquote><p>KubeSphere 愿景是打造一个以 Kubernetes 为内核的云原生分布式操作系统，它的架构可以非常方便地使第三方应用与云原生生态组件进行即插即用（plug-and-play）的集成，支持云原生应用在多云与多集群的统一分发和运维管理。</p></blockquote><p>简单来说，KubeSphere（下文简称ks）就是一个容器管理平台，可以图形化管理多个K8S集群。</p><p>相关链接：</p><ul><li><a target="_blank" rel="noopener" href="https://kubesphere.io/zh/">KubeSphere官网</a></li><li><a target="_blank" rel="noopener" href="https://kubesphere.io/zh/videos/">KubeSphere学习视频</a></li></ul><span id="more"></span><h1 id="安装准备"><span class="post-title-index">2.</span><a href="#安装准备" class="headerlink" title="安装准备"></a> 安装准备</h1><p>参考<a target="_blank" rel="noopener" href="https://kubesphere.io/zh/docs/v3.3/installing-on-kubernetes/introduction/prerequisites/">在 Kubernetes 上安装 KubeSphere - 准备工作</a>，确认环境满足ks安装需求。</p><h2 id="K8S版本需求"><span class="post-title-index">2.1.</span><a href="#K8S版本需求" class="headerlink" title="K8S版本需求"></a> K8S版本需求</h2><p>计划安装kubesphere-v3.3.0版本，需要确认 Kubernetes 版本必须为：v1.19.x，v1.20.x，v1.21.x，v1.22.x 或 v1.23.x（实验性支持）。</p><h2 id="资源需求"><span class="post-title-index">2.2.</span><a href="#资源需求" class="headerlink" title="资源需求"></a> 资源需求</h2><p>CPU &gt; 1 核；内存 &gt; 2 G。CPU 必须为 x86_64，暂时不支持 Arm 架构的 CPU。</p><h2 id="StorageClass需求"><span class="post-title-index">2.3.</span><a href="#StorageClass需求" class="headerlink" title="StorageClass需求"></a> StorageClass需求</h2><p>Kubernetes 集群已配置默认 StorageClass（请使用 <code>kubectl get sc</code> 进行确认）。<br>这一条是最重要的，因为k8s集群默认并不会配置storageclass，需要我们自己单独配置。<br>storage安装配置方法参考<a href="https://www.voidking.com/dev-k8s-storageclass/">《K8S中安装配置StorageClass》</a></p><h1 id="安装KubeSphere"><span class="post-title-index">3.</span><a href="#安装KubeSphere" class="headerlink" title="安装KubeSphere"></a> 安装KubeSphere</h1><p>参考<a target="_blank" rel="noopener" href="https://kubesphere.io/zh/docs/v3.3/installing-on-kubernetes/introduction/overview/">在 Kubernetes 上安装 KubeSphere - 概述</a>，安装kubesphere-v3.3.0版本</p><p>1、下载manifests</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/kubesphere/ks-installer/releases/download/v3.3.0/kubesphere-installer.yaml</span><br><span class="line">wget https://github.com/kubesphere/ks-installer/releases/download/v3.3.0/cluster-configuration.yaml</span><br></pre></td></tr></table></figure><p>2、修改集群配置 cluster-configuration.yaml<br>ks-apiserver和ks-controller-manager的资源调整示例如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">common:</span></span><br><span class="line">    <span class="attr">core:</span></span><br><span class="line">      <span class="attr">console:</span></span><br><span class="line">        <span class="attr">enableMultiLogin:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">30880</span></span><br><span class="line">      <span class="attr">apiserver:</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">400Mi</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">8Gi</span></span><br><span class="line">      <span class="attr">controllerManager:</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">400Mi</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">8Gi</span></span><br><span class="line">    <span class="attr">minio:</span></span><br><span class="line">      <span class="attr">volumeSize:</span> <span class="string">200Gi</span> <span class="comment"># Minio PVC size.</span></span><br></pre></td></tr></table></figure><p>因为ks-apiserver和ks-controller-manager容易OOM，所以内存上限设置高一些。</p><p>kubesphere的一些功能（数据备份、日志存储、应用数据存储）需要依赖minio，因此把minio的存储调大一些。</p><p>opensearch一般用不到，opensearch.enabled 改成false。</p><p>3、提交资源清单到k8s集群</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f kubesphere-installer.yaml</span><br><span class="line">kubectl apply -f cluster-configuration.yaml</span><br></pre></td></tr></table></figure><p>4、查看安装过程</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">k describe pod/ks-installer-xxx-xxx -n kubesphere-system</span><br><span class="line">kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l <span class="string">&#x27;app in (ks-install, ks-installer)&#x27;</span> -o jsonpath=<span class="string">&#x27;&#123;.items[0].metadata.name&#125;&#x27;</span>) -f</span><br></pre></td></tr></table></figure><p>5、查看ks状态</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get all -n kubesphere-system</span><br><span class="line">kubectl get svc/ks-console -n kubesphere-system</span><br></pre></td></tr></table></figure><h1 id="StorageClass问题排查"><span class="post-title-index">4.</span><a href="#StorageClass问题排查" class="headerlink" title="StorageClass问题排查"></a> StorageClass问题排查</h1><p>ks的redis没有ready，一直处于pending状态，查看详情</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod/redis-d744b7468-45sh4 -n kubesphere-system</span><br></pre></td></tr></table></figure><p>报错：0/x nodes are available: x pod has unbound immediate PersistentVolumeClaims.</p><p>查看nfs-client-provisioner日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs --<span class="built_in">tail</span>=100 nfs-client-provisioner-7975f9b954-7fw5l</span><br></pre></td></tr></table></figure><p>报错：<br>provision “kubesphere-system/redis-pvc” class “nfs-storage”: unexpected error getting claim reference: selfLink was empty, can’t make reference</p><p>这是因为，1.20.x之后的k8s版本，selflink已经弃用了。而nfs-client-provisioner的实现基于selflink，因此报错。</p><p>解决办法：apiserver启动时添加参数<code>--feature-gates=RemoveSelfLink=false</code><br>1、编辑kube-apiserver.yaml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/kubernetes/manifests/kube-apiserver.yaml</span><br></pre></td></tr></table></figure><p>如下修改：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">command:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kube-apiserver</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--...</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--feature-gates=RemoveSelfLink=false</span></span><br></pre></td></tr></table></figure><p>2、重建apiserver pod<br>因为apiserver是static pod，所以在修改完kube-apiserver.yaml后会自动重建。</p><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner/issues/25">unexpected error getting claim reference: selfLink was empty, can’t make reference</a></li><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhangsi-lzq/p/14292628.html">kubernetes1.20版本 nfs-provisioner报错问题:”selfLink was empty”</a></li></ul><h1 id="验证KubeSphere"><span class="post-title-index">5.</span><a href="#验证KubeSphere" class="headerlink" title="验证KubeSphere"></a> 验证KubeSphere</h1><p>KS默认对外开放 30880 端口，通过 NodePort (IP:30880) 使用默认帐户和密码 (admin/P@88w0rd) 访问 Web 控制台。<br><a target="_blank" rel="noopener" href="http://192.168.56.101:30880/login">http://192.168.56.101:30880/login</a><br>第一次登录时，会提示修改密码。</p><h1 id="KubeSphere常用操作"><span class="post-title-index">6.</span><a href="#KubeSphere常用操作" class="headerlink" title="KubeSphere常用操作"></a> KubeSphere常用操作</h1><h2 id="修改KubeSphere配置"><span class="post-title-index">6.1.</span><a href="#修改KubeSphere配置" class="headerlink" title="修改KubeSphere配置"></a> 修改KubeSphere配置</h2><p>如果ks已经安装完成，想要修改ks集群配置的话，可以通过修改 kubesphere-config 和 ks-installer 配置来实现。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl get cm kubesphere-config -n kubesphere-system -oyaml</span><br><span class="line">kubectl edit cm kubesphere-config -n kubesphere-system <span class="comment"># 例如修改使用集群外部的Prometheus</span></span><br><span class="line"></span><br><span class="line">kubectl get clusterconfiguration ks-installer -n kubesphere-system -oyaml</span><br><span class="line">kubectl edit clusterconfiguration ks-installer -n kubesphere-system <span class="comment"># 例如修改Pod资源</span></span><br></pre></td></tr></table></figure><p>修改ks-installer配置后，相关pod会自动重启（请耐心等待，大概5分钟内会自动重启）。</p><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://kubesphere.io/zh/docs/v3.3/access-control-and-account-management/external-authentication/use-an-ldap-service/">KubeSphere - LDAP身份提供者</a></li><li><a target="_blank" rel="noopener" href="https://www.kubesphere.io/zh/docs/v3.3/faq/observability/byop/">集成您自己的 Prometheus</a></li></ul><h2 id="修改使用外部Prometheus"><span class="post-title-index">6.2.</span><a href="#修改使用外部Prometheus" class="headerlink" title="修改使用外部Prometheus"></a> 修改使用外部Prometheus</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit cm -n kubesphere-system kubesphere-config</span><br></pre></td></tr></table></figure><p>monitoring 部分修改为：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">monitoring:</span></span><br><span class="line">  <span class="attr">endpoint:</span> <span class="string">http://prometheus-operated.kubesphere-monitoring-system.svc:9090</span></span><br></pre></td></tr></table></figure><p>参考文档：<a target="_blank" rel="noopener" href="https://www.kubesphere.io/zh/docs/v3.3/faq/observability/byop/">集成您自己的 Prometheus</a></p><h2 id="安装Grafana"><span class="post-title-index">6.3.</span><a href="#安装Grafana" class="headerlink" title="安装Grafana"></a> 安装Grafana</h2><p>KubeSphere 3.3.0 版本的Grafana需要自行安装。</p><p>1、添加helm chart仓库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br></pre></td></tr></table></figure><p>2、获取redis的配置<br>这里选择chart版本9.0.7，app版本10.0.3</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">helm search repo bitnami/grafana -l</span><br><span class="line">helm pull bitnami/grafana --version 9.0.7</span><br><span class="line">tar -xzvf grafana-9.0.7.tgz</span><br><span class="line">vim grafana/values.yaml</span><br></pre></td></tr></table></figure><p>3、values.yaml 修改配置</p><ul><li>global.storageClass 修改为期望的storageclass</li><li>admin.user 改为期望的用户名</li><li>admin.password 改为期望的密码</li><li>service.type 改为NodePort</li></ul><p>4、安装grafana</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">helm install grafana grafana \</span><br><span class="line">    -n grafana --create-namespace</span><br></pre></td></tr></table></figure><p>5、查看安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get all -n grafana</span><br></pre></td></tr></table></figure><h2 id="重置KubeSphere密码"><span class="post-title-index">6.4.</span><a href="#重置KubeSphere密码" class="headerlink" title="重置KubeSphere密码"></a> 重置KubeSphere密码</h2><p>如果忘记了ks的密码，可以通过kubectl命令进行重置。参考文档<a target="_blank" rel="noopener" href="https://kubesphere.io/docs/v3.3/faq/access-control/forgot-password/">Reset the Account Password</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl patch <span class="built_in">users</span> &lt;USERNAME&gt; -p <span class="string">&#x27;&#123;&quot;spec&quot;:&#123;&quot;password&quot;:&quot;&lt;YOURPASSWORD&gt;&quot;&#125;&#125;&#x27;</span> --<span class="built_in">type</span>=<span class="string">&#x27;merge&#x27;</span> &amp;&amp; kubectl annotate <span class="built_in">users</span> &lt;USERNAME&gt; iam.kubesphere.io/password-encrypted-</span><br></pre></td></tr></table></figure><h2 id="添加项目到企业空间"><span class="post-title-index">6.5.</span><a href="#添加项目到企业空间" class="headerlink" title="添加项目到企业空间"></a> 添加项目到企业空间</h2><p>Kubernetes命名空间就是KubeSphere项目，这些项目可以在 平台管理-&gt;集群管理-&gt;具体集群-&gt;项目 中查看到。</p><p>添加现有KubeSphere项目到企业空间：<br>1、以管理员身份登录KubeSphere控制台，转到集群管理页面。点击项目，可以查看在当前集群中运行的所有项目。<br>2、通过 kubectl 创建的命名空间不属于任何企业空间。请点击右侧的三个点，选择分配企业空间。<br>3、在弹出的对话框中，为该项目选择一个企业空间和项目管理员，然后点击确定。<br>4、转到企业空间，可以在项目页面看到该项目已显示。</p><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://kubesphere.io/zh/docs/v3.3/faq/access-control/add-kubernetes-namespace-to-kubesphere-workspace/">添加现有 Kubernetes 命名空间至 KubeSphere 企业空间</a></li></ul><h2 id="批量添加项目到企业空间"><span class="post-title-index">6.6.</span><a href="#批量添加项目到企业空间" class="headerlink" title="批量添加项目到企业空间"></a> 批量添加项目到企业空间</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get ns |grep voidking | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | xargs kubectl patch ns -p <span class="string">&#x27;metadata: &#123;labels: &#123;kubesphere.io/workspace: &quot;voidking&quot;&#125;, annotations: &#123;kubesphere.io/creator: &quot;haojin&quot;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="修改KS组件亲和性"><span class="post-title-index">6.7.</span><a href="#修改KS组件亲和性" class="headerlink" title="修改KS组件亲和性"></a> 修改KS组件亲和性</h2><p>安装KS时，是不支持配置KS组件的亲和性的。<br>如果自己通过脚本批量修改，会被ks-intaller自动改回，并且不同资源修改的方法是不同的。</p><p>下面是一个可行的办法：</p><p>1、关闭 ks-intaller</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl scale --replicas=0 deployment ks-installer -n kubesphere-system</span><br></pre></td></tr></table></figure><p>2、准备亲和性配置 data.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">nodetype:</span> <span class="string">infra</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">&quot;nodetype&quot;</span></span><br><span class="line">          <span class="attr">operator:</span> <span class="string">&quot;Equal&quot;</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;infra&quot;</span></span><br><span class="line">          <span class="attr">effect:</span> <span class="string">&quot;NoSchedule&quot;</span></span><br></pre></td></tr></table></figure><p>3、deployment批量添加节点亲和性</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deployment -n kubesphere-system -o=jsonpath=<span class="string">&#x27;&#123;.items[*].metadata.name&#125;&#x27;</span> | xargs kubectl patch deployment --<span class="built_in">type</span>=merge --patch-file data.yaml -n kubesphere-system</span><br><span class="line">kubectl get deployment -n kubesphere-monitoring-system -o=jsonpath=<span class="string">&#x27;&#123;.items[*].metadata.name&#125;&#x27;</span> | xargs kubectl patch deployment --<span class="built_in">type</span>=merge --patch-file data.yaml -n kubesphere-monitoring-system</span><br></pre></td></tr></table></figure><p>4、准备亲和性配置 data2.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">nodeSelector:</span></span><br><span class="line">    <span class="attr">nodetype:</span> <span class="string">infra</span></span><br><span class="line">  <span class="attr">tolerations:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">&quot;nodetype&quot;</span></span><br><span class="line">      <span class="attr">operator:</span> <span class="string">&quot;Equal&quot;</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">&quot;infra&quot;</span></span><br><span class="line">      <span class="attr">effect:</span> <span class="string">&quot;NoSchedule&quot;</span></span><br></pre></td></tr></table></figure><p>4、自定义资源添加节点亲和性</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kubectl get prometheus k8s -n kubesphere-monitoring-system</span><br><span class="line">kubectl patch prometheus k8s --<span class="built_in">type</span>=merge --patch-file=data2.yaml -n kubesphere-monitoring-system</span><br><span class="line"></span><br><span class="line">kubectl get alertmanager main -n kubesphere-monitoring-system</span><br><span class="line">kubectl patch alertmanager main --<span class="built_in">type</span>=merge --patch-file=data2.yaml -n kubesphere-monitoring-system</span><br><span class="line"></span><br><span class="line">kubectl get notificationmanager -n kubesphere-monitoring-system</span><br><span class="line">kubectl patch notificationmanager/notification-manager --<span class="built_in">type</span>=merge --patch-file=data2.yaml -n kubesphere-monitoring-system</span><br></pre></td></tr></table></figure><p>参考文档：</p><ul><li><a href="https://www.voidking.com/dev-kubectl-curd/">《kubectl命令——资源对象增删查改篇》</a></li><li><a target="_blank" rel="noopener" href="https://ask.kubesphere.io/forum/d/4327-cluster-configurationyaml-kubesphere">如何配置 cluster-configuration.yaml 将kubesphere安装到指定节点上？</a></li></ul><h1 id="KubeSphere问题记录"><span class="post-title-index">7.</span><a href="#KubeSphere问题记录" class="headerlink" title="KubeSphere问题记录"></a> KubeSphere问题记录</h1><h2 id="Could-not-connect-to-the-container"><span class="post-title-index">7.1.</span><a href="#Could-not-connect-to-the-container" class="headerlink" title="Could not connect to the container"></a> Could not connect to the container</h2><p>问题描述：配置好nginx，通过域名访问ks正常，但是在ks页面上访问容器终端时报错：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Could not connect to the container. Do you have sufficient privileges?</span><br></pre></td></tr></table></figure><p>解决办法：因为页面访问终端需要websocket支持，所以nginx配置中需要添加websocket支持，配置方法参考<a href="https://www.voidking.com/dev-nginx-start/">《Nginx入门篇》</a>。</p><h2 id="Pod详情页没有监控数据"><span class="post-title-index">7.2.</span><a href="#Pod详情页没有监控数据" class="headerlink" title="Pod详情页没有监控数据"></a> Pod详情页没有监控数据</h2><p>问题描述：安装了Prometheus套装后，Pod详情页看不到监控数据。访问获取监控数据的API，看到报错：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error: &quot;execution: found duplicate series for the match group &#123;namespace=&quot;xxx&quot;, pod=&quot;xxx&quot;&#125; on the right hand-side of the operation: [&#123;__name__=&quot;kube_pod_owner&quot;, container=&quot;kube-rbac-proxy-main&quot;, instance=&quot;10.244.92.200:8443&quot;, job=&quot;kube-state-metrics&quot;, namespace=&quot;xxx&quot;, owner_is_controller=&quot;true&quot;, owner_kind=&quot;ReplicaSet&quot;, owner_name=&quot;xxx&quot;, pod=&quot;xxx&quot;, uid=&quot;xxx&quot;&#125;, &#123;__name__=&quot;kube_pod_owner&quot;, container=&quot;kube-rbac-proxy-main&quot;, instance=&quot;10.244.218.131:8443&quot;, job=&quot;kube-state-metrics&quot;, namespace=&quot;act&quot;, owner_is_controller=&quot;true&quot;, owner_kind=&quot;ReplicaSet&quot;, owner_name=&quot;xxx&quot;, pod=&quot;xxx&quot;&#125;];many-to-many matching not allowed: matching labels must be unique on one side&quot;</span><br></pre></td></tr></table></figure><p>原因分析：ks自带的Prometheus，和Prometheus套装，两个Prometheus的serviceMonitor存在重合，导致获取了两遍数据。<br>解决办法：删除两个Prometheus的其中一份serviceMonitor。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get servicemonitor -n kubesphere-monitoring-system -oyaml &gt; servicemonitor.yaml</span><br><span class="line">kubectl get servicemonitor -n kubesphere-monitoring-system | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep -v <span class="string">&quot;NAME&quot;</span> | xargs kubectl delete servicemonitor -n kubesphere-monitoring-system</span><br></pre></td></tr></table></figure><p>参考文档：<a target="_blank" rel="noopener" href="https://ask.kubesphere.io/forum/d/2557-pod">pod监控都没有数据展示</a></p><h1 id="KubeSphere多集群"><span class="post-title-index">8.</span><a href="#KubeSphere多集群" class="headerlink" title="KubeSphere多集群"></a> KubeSphere多集群</h1><p>参考文档：</p><ul><li><a target="_blank" rel="noopener" href="https://kubesphere.io/zh/docs/v3.3/multicluster-management/">多集群管理</a></li><li><a target="_blank" rel="noopener" href="https://kubesphere.io/zh/docs/v3.3/multicluster-management/enable-multicluster/direct-connection/">多集群管理 - 直接连接</a></li><li><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15127592/2803374">Kubernetes 多集群在开源项目 KubeSphere 的应用</a></li></ul><h2 id="主集群配置"><span class="post-title-index">8.1.</span><a href="#主集群配置" class="headerlink" title="主集群配置"></a> 主集群配置</h2><p>1、设置为主集群</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit cc ks-installer -n kubesphere-system</span><br></pre></td></tr></table></figure><p>修改配置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">multicluster:</span></span><br><span class="line">  <span class="attr">clusterRole:</span> <span class="string">host</span></span><br></pre></td></tr></table></figure><p>2、获取jwtSecret</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kubesphere-system get cm kubesphere-config -o yaml | grep -v <span class="string">&quot;apiVersion&quot;</span> | grep jwtSecret</span><br></pre></td></tr></table></figure><h2 id="成员集群配置"><span class="post-title-index">8.2.</span><a href="#成员集群配置" class="headerlink" title="成员集群配置"></a> 成员集群配置</h2><p>1、设置为成员集群</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit cc ks-installer -n kubesphere-system</span><br></pre></td></tr></table></figure><p>修改配置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">authentication:</span></span><br><span class="line">  <span class="attr">jwtSecret:</span> <span class="string">gfIwilcc0WjNGKJ5DLeksf2JKfcLgTZU</span></span><br><span class="line"></span><br><span class="line"><span class="attr">multicluster:</span></span><br><span class="line">  <span class="attr">clusterRole:</span> <span class="string">member</span></span><br></pre></td></tr></table></figure><p>其中，authentication.jwtSecret 修改和主集群保持一致；multicluster.clusterRole 修改为member。</p><h2 id="导入成员集群"><span class="post-title-index">8.3.</span><a href="#导入成员集群" class="headerlink" title="导入成员集群"></a> 导入成员集群</h2><p>1、以 admin 身份登录 KubeSphere 控制台，转到集群管理页面点击添加集群。</p><p>2、在导入集群页面，输入要导入的集群的基本信息。您也可以点击右上角的编辑模式以 YAML 格式查看并编辑基本信息。编辑完成后，点击下一步。</p><p>3、在连接方式，选择直接连接 Kubernetes 集群，复制 kubeconfig 内容并粘贴至文本框。您也可以点击右上角的编辑模式以 YAML 格式编辑的 kubeconfig。请确保 server 地址为该 member 集群可访问的 kube-apiserver 地址（主集群的任何节点都能访问）。</p><p>4、点击创建，然后等待集群初始化完成。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 好好学习的郝</li><li class="post-copyright-link"> <strong>原文链接：</strong> <a href="https://www.voidking.com/dev-k8s-kubesphere/" title="好好学K8S：K8S中安装配置KubeSphere">https://www.voidking.com/dev-k8s-kubesphere/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本文采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议，转载请注明出处！源站会即时更新知识点并修正错误，欢迎访问~</li><li> <img width="200" height="200" src="/images/avatar.jpg"><p style="text-align:center;margin-bottom:0">微信公众号同步更新，欢迎关注~</p></li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/k8s/" rel="tag"># k8s</a> <a href="/tags/%E5%A5%BD%E5%A5%BD%E5%AD%A6K8S/" rel="tag"># 好好学K8S</a> <a href="/tags/%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/" rel="tag"># 问题排查</a> <a href="/tags/%E5%AD%98%E5%82%A8/" rel="tag"># 存储</a> <a href="/tags/bitnami/" rel="tag"># bitnami</a> <a href="/tags/kubesphere/" rel="tag"># kubesphere</a> <a href="/tags/storageclass/" rel="tag"># storageclass</a></div><div class="post-nav"><div class="post-nav-item"><a href="/dev-kubesphere-session-timeout/" rel="prev" title="KubeSphere登录后报错Session Timeout"><i class="fa fa-chevron-left"></i> KubeSphere登录后报错Session Timeout</a></div><div class="post-nav-item"> <a href="/dev-k8s-imagepullsecrets/" rel="next" title="好好学K8S：K8S配置使用imagePullSecrets">好好学K8S：K8S配置使用imagePullSecrets<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="footer-ads" style="margin-top:10px"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3284447971731414" data-ad-slot="9697986181"></ins><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3284447971731414" crossorigin="anonymous"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#KubeSphere%E7%AE%80%E4%BB%8B"><span class="nav-text">1. KubeSphere简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E5%87%86%E5%A4%87"><span class="nav-text">2. 安装准备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#K8S%E7%89%88%E6%9C%AC%E9%9C%80%E6%B1%82"><span class="nav-text">2.1. K8S版本需求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B5%84%E6%BA%90%E9%9C%80%E6%B1%82"><span class="nav-text">2.2. 资源需求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#StorageClass%E9%9C%80%E6%B1%82"><span class="nav-text">2.3. StorageClass需求</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85KubeSphere"><span class="nav-text">3. 安装KubeSphere</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#StorageClass%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5"><span class="nav-text">4. StorageClass问题排查</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81KubeSphere"><span class="nav-text">5. 验证KubeSphere</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#KubeSphere%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C"><span class="nav-text">6. KubeSphere常用操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9KubeSphere%E9%85%8D%E7%BD%AE"><span class="nav-text">6.1. 修改KubeSphere配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E4%BD%BF%E7%94%A8%E5%A4%96%E9%83%A8Prometheus"><span class="nav-text">6.2. 修改使用外部Prometheus</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Grafana"><span class="nav-text">6.3. 安装Grafana</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E7%BD%AEKubeSphere%E5%AF%86%E7%A0%81"><span class="nav-text">6.4. 重置KubeSphere密码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E9%A1%B9%E7%9B%AE%E5%88%B0%E4%BC%81%E4%B8%9A%E7%A9%BA%E9%97%B4"><span class="nav-text">6.5. 添加项目到企业空间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0%E9%A1%B9%E7%9B%AE%E5%88%B0%E4%BC%81%E4%B8%9A%E7%A9%BA%E9%97%B4"><span class="nav-text">6.6. 批量添加项目到企业空间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9KS%E7%BB%84%E4%BB%B6%E4%BA%B2%E5%92%8C%E6%80%A7"><span class="nav-text">6.7. 修改KS组件亲和性</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#KubeSphere%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95"><span class="nav-text">7. KubeSphere问题记录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Could-not-connect-to-the-container"><span class="nav-text">7.1. Could not connect to the container</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pod%E8%AF%A6%E6%83%85%E9%A1%B5%E6%B2%A1%E6%9C%89%E7%9B%91%E6%8E%A7%E6%95%B0%E6%8D%AE"><span class="nav-text">7.2. Pod详情页没有监控数据</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#KubeSphere%E5%A4%9A%E9%9B%86%E7%BE%A4"><span class="nav-text">8. KubeSphere多集群</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE"><span class="nav-text">8.1. 主集群配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%88%90%E5%91%98%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE"><span class="nav-text">8.2. 成员集群配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E6%88%90%E5%91%98%E9%9B%86%E7%BE%A4"><span class="nav-text">8.3. 导入成员集群</span></a></li></ol></li></ol></div></div><div class="sidecar-ads" style="margin-top:10px"><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="好好学习的郝" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">好好学习的郝</p><div class="site-description" itemprop="description">一个计算机技术爱好者与学习者</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">728</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">31</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">254</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:voidking@qq.com" title="E-Mail → mailto:voidking@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://github.com/voidking" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/voidking" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/voidking" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;voidking" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i> Zhihu</a></span></div></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">好好学习的郝</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="footer-beian"> <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备14021030号</a>&nbsp;|&nbsp; <img src="/images/beian.png" alt=""> <a target="_blank" href="http://www.beian.gov.cn/">苏公网安备 32032202000223号</a></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5a238b8c32b1e4dd2156',
      clientSecret: 'bfb5d518626f6fdc7da0351d1e0cd37ab75c6361',
      repo: 'gitalk-comments',
      owner: 'voidking',
      admin: ['voidking'],
      id: '80a23454d4cc86a2040a82570a211fd2',
      title: '好好学K8S：K8S中安装配置KubeSphere',
      body: '欢迎留言，互相交流学习~',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>